import{l as w,T as Se,a as Re,k as ze}from"./index.e9d54774.js";/* empty css                *//* empty css               *//* empty css               *//* empty css               */import{d as de,f as m,w as se,D as c,aH as $,aI as e,aS as a,E as O,aU as K,aV as H,u as k,aY as o,aW as x,aZ as J,H as G,n as _e,aP as he,bo as ge,a$ as Ce,aO as Ae,c7 as Pe,c8 as Te,bX as De,a_ as ce,b0 as me,bZ as Le,c6 as Ne,bp as be,bi as Be,o as Ve,G as te,bY as je,bt as we,aM as ye,aN as Fe,c as xe,bg as $e,cy as Ge,cz as Me,r as qe,aT as Ke,bz as He,bq as We,ch as Ye,P as Ze,ag as Xe,bG as Je,cx as Qe,bB as ea}from"./arco.a97fe066.js";import{d as Oe}from"./index.127a6572.js";import{p as aa}from"./pagination.72a5f225.js";import{d as ie,e as le,a as ue,r as oe,i as ta,s as la,f as ua,q as oa,b as na}from"./common.067deda9.js";/* empty css              *//* empty css                *//* empty css                *//* empty css                */import{t as re}from"./problem.b594769f.js";import{f as sa}from"./app-instance.ab836c4c.js";import{c as ne}from"./color.562bf6e9.js";import{_ as ia}from"./index.vue_vue_type_script_setup_true_lang.6079a524.js";import{_ as ra}from"./index.vue_vue_type_script_setup_true_lang.a54811bd.js";import{_ as da}from"./setting-draw.vue_vue_type_script_setup_true_lang.1e66f128.js";import"./chart.a235fbdf.js";import"./vue.4eb70094.js";import"./FileSaver.min.64c4208e.js";import"./_commonjs-dynamic-modules.30ae7933.js";/* empty css                */import"./zabbix.d3c3bb08.js";import"./table.vue_vue_type_script_setup_true_lang.4e051305.js";/* empty css               */const ca={style:{display:"flex","flex-direction":"column"}},ma=de({__name:"dimension-draw",props:{visible:{type:Boolean,default:!1},initForm:{}},emits:["ok","cancel"],setup(ae,{emit:Q}){const E=ae,D=Q,R=()=>{D("cancel")},C=m([]),A=m([]),d=m([]),B=m(!1),P=m(!1),M=s=>{s.length===Object.keys(le).length?(P.value=!0,B.value=!1):s.length===0?(P.value=!1,B.value=!1):(P.value=!1,B.value=!0)},t=s=>{B.value=!1,P.value=s,C.value=s?Object.keys(le):[]},v=m(!1),L=m(!1),I=s=>{s.length===Object.keys(ue).length?(L.value=!0,v.value=!1):s.length===0?(L.value=!1,v.value=!1):(L.value=!1,v.value=!0)},q=s=>{v.value=!1,L.value=s,A.value=s?Object.keys(ue):[]},V=m(!1),N=m(!1),X=s=>{s.length===Object.keys(oe).length?(N.value=!0,V.value=!1):s.length===0?(N.value=!1,V.value=!1):(N.value=!1,V.value=!0)},ee=s=>{V.value=!1,N.value=s,d.value=s?Object.keys(oe):[]},b=m(w.cloneDeep(ie)),y=m();let u=[];const n=async()=>{u=await ta(),E.initForm&&(b.value=w.cloneDeep(E.initForm),b.value.fields&&b.value.fields.length>0?(b.value.fields.forEach(s=>{Object.keys(le).indexOf(s)>-1?C.value.push(s):Object.keys(ue).indexOf(s)>-1?A.value.push(s):Object.keys(oe).indexOf(s)>-1&&d.value.push(s)}),await _e(()=>{y.value.validateField("fields")})):(C.value=[],A.value=[],d.value=[],await _e(()=>{y.value.clearValidate()})),M(C.value),I(A.value),X(d.value))},U=()=>{b.value.fields=w.uniq([...C.value,...A.value,...d.value]),y.value.validateField("fields")};se(()=>C,()=>{U()},{deep:!0}),se(()=>A,()=>{U()},{deep:!0}),se(()=>d,()=>{U()},{deep:!0});const W=async()=>{await y.value.validate()||D("ok",b.value)};return(s,_)=>{const j=he,S=ge,T=Ce,i=Ae,r=Pe,p=Te,h=De,l=ce,F=me,g=Le,Y=Ne,pe=be,ve=Be;return c(),$(ve,{visible:s.visible,width:"50vw","title-align":"start","mask-closable":!1,"unmount-on-close":"",title:"\u4E8B\u4EF6\u7EDF\u8BA1\u62A5\u8868\u7EDF\u8BA1\u7EF4\u5EA6",onOk:W,onCancel:R,onBeforeOpen:n},{default:e(()=>[a(pe,{ref_key:"submitFormRef",ref:y,model:b.value,"label-col-props":{span:4},"wrapper-col-props":{span:15}},{default:e(()=>[a(S,{field:"name",label:"\u7EDF\u8BA1\u7EF4\u5EA6\u540D\u79F0",rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u7EDF\u8BA1\u7EF4\u5EA6\u540D\u79F0"},{maxLength:31,message:"\u7EDF\u8BA1\u7EF4\u5EA6\u540D\u79F0\u957F\u5EA6\u6700\u5927\u4E0D\u80FD\u8D85\u8FC731"}],"validate-trigger":"blur"},{default:e(()=>[a(j,{modelValue:b.value.name,"onUpdate:modelValue":_[0]||(_[0]=f=>b.value.name=f)},null,8,["modelValue"])]),_:1}),a(S,{field:"eventAttribute",label:"\u7EDF\u8BA1\u7EF4\u5EA6",rules:[{required:!0,message:"\u8BF7\u9009\u62E9\u7EDF\u8BA1\u7EF4\u5EA6"}],"validate-trigger":"blur"},{default:e(()=>[a(i,{modelValue:b.value.eventAttribute,"onUpdate:modelValue":_[1]||(_[1]=f=>b.value.eventAttribute=f)},{default:e(()=>[(c(!0),O(K,null,H(k(u),(f,Z)=>(c(),$(T,{key:Z,value:f.value},{default:e(()=>[o(x(f.label),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),_:1}),b.value.eventAttribute==="clock"||b.value.eventAttribute==="r_clock"?(c(),$(S,{key:0,field:"datetimeDimension",label:"\u65F6\u95F4\u7EF4\u5EA6",rules:[{required:!0,message:"\u8BF7\u9009\u62E9\u65F6\u95F4\u7EF4\u5EA6"}],"validate-trigger":"blur"},{default:e(()=>[a(p,{modelValue:b.value.datetimeDimension,"onUpdate:modelValue":_[2]||(_[2]=f=>b.value.datetimeDimension=f),size:"mini"},{default:e(()=>[a(r,{value:"HOUR"},{default:e(()=>[o("\u6309\u5C0F\u65F6")]),_:1}),a(r,{value:"DAY"},{default:e(()=>[o("\u6309\u5929")]),_:1}),a(r,{value:"WEEK"},{default:e(()=>[o("\u6309\u5468")]),_:1}),a(r,{value:"MONTH"},{default:e(()=>[o("\u6309\u6708")]),_:1})]),_:1},8,["modelValue"])]),_:1})):J("",!0),b.value.eventAttribute==="tags"?(c(),$(S,{key:1,field:"tagName",label:"\u6807\u7B7E\u540D\u79F0"},{default:e(()=>[a(j,{modelValue:b.value.tagName,"onUpdate:modelValue":_[3]||(_[3]=f=>b.value.tagName=f)},null,8,["modelValue"])]),_:1})):J("",!0),a(S,{field:"fields",label:"\u9644\u52A0\u5B57\u6BB5",rules:[{required:!0,message:"\u8BF7\u9009\u62E9\u9644\u52A0\u5B57\u6BB5"}],"validate-trigger":"blur"},{default:e(()=>[G("div",ca,[a(F,{style:{width:"100%"}},{default:e(()=>[a(l,{span:24},{default:e(()=>[a(h,{orientation:"left"},{default:e(()=>[o("\u4E8B\u4EF6\u7EA7\u522B")]),_:1})]),_:1})]),_:1}),a(F,{style:{width:"100%"}},{default:e(()=>[a(l,{span:24},{default:e(()=>[a(g,{"model-value":P.value,indeterminate:B.value,onChange:t},{default:e(()=>[o(" \u5168\u9009 ")]),_:1},8,["model-value","indeterminate"])]),_:1}),a(l,{span:24},{default:e(()=>[a(Y,{modelValue:C.value,"onUpdate:modelValue":_[4]||(_[4]=f=>C.value=f),onChange:M},{default:e(()=>[(c(!0),O(K,null,H(Object.keys(k(le)),(f,Z)=>(c(),$(g,{key:Z,value:f},{default:e(()=>[o(x(k(le)[f]),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),a(F,{style:{width:"100%"}},{default:e(()=>[a(l,{span:24},{default:e(()=>[a(h,{orientation:"left"},{default:e(()=>[o("\u786E\u8BA4\u4E8B\u4EF6")]),_:1})]),_:1})]),_:1}),a(F,{style:{width:"100%"}},{default:e(()=>[a(l,{span:24},{default:e(()=>[a(g,{"model-value":L.value,indeterminate:v.value,onChange:q},{default:e(()=>[o(" \u5168\u9009 ")]),_:1},8,["model-value","indeterminate"])]),_:1}),a(l,{span:24},{default:e(()=>[a(Y,{modelValue:A.value,"onUpdate:modelValue":_[5]||(_[5]=f=>A.value=f),onChange:I},{default:e(()=>[(c(!0),O(K,null,H(Object.keys(k(ue)),(f,Z)=>(c(),$(g,{key:Z,value:f},{default:e(()=>[o(x(k(ue)[f]),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),a(F,{style:{width:"100%"}},{default:e(()=>[a(l,{span:24},{default:e(()=>[a(h,{orientation:"left"},{default:e(()=>[o("\u6062\u590D\u4E8B\u4EF6")]),_:1})]),_:1})]),_:1}),a(F,{style:{width:"100%"}},{default:e(()=>[a(l,{span:24},{default:e(()=>[a(g,{"model-value":N.value,indeterminate:V.value,onChange:ee},{default:e(()=>[o(" \u5168\u9009 ")]),_:1},8,["model-value","indeterminate"])]),_:1}),a(l,{span:24},{default:e(()=>[a(Y,{modelValue:d.value,"onUpdate:modelValue":_[6]||(_[6]=f=>d.value=f),onChange:X},{default:e(()=>[(c(!0),O(K,null,H(Object.keys(k(oe)),(f,Z)=>(c(),$(g,{key:Z,value:f},{default:e(()=>[o(x(k(oe)[f]),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})])]),_:1})]),_:1},8,["model"])]),_:1},8,["visible"])}}}),pa={style:{width:"100%"}},va={style:{width:"100%"}},fa=de({__name:"event-search-form",props:{searchParam:{type:Object,default:()=>({})},isProblem:{type:Boolean,default:!0}},emits:["update:searchParam","search"],setup(ae,{emit:Q}){const E={appKeys:[],appKey:void 0,keyword:void 0,name:void 0,severities:[!1,!1,!1,!1,!1,!1],timeFrom:void 0,timeTill:void 0,hostGroups:[],hosts:[],hostInventories:[{label:"",code:"",value:""}],evalType:"0",tags:[{tag:"",operator:re[0].value,value:""}]},D=ae,R=ne("info-6"),C=ne("warn-6"),A=ne("average-6"),d=ne("high-6"),B=ne("disaster-6"),P=m(),M=Q,t=m(w.cloneDeep(E)),v=()=>{M("update:searchParam",t.value)},L=()=>{t.value.hostGroups=[],t.value.hosts=[],v()},I=m([]),q=async()=>{const{data:u}=await Se("\u544A\u8B66\u901A\u7528\u5B57\u6BB5\u914D\u7F6E");I.value=u.filter(n=>n.enable).map(n=>({value:n.code,label:n.name}))},V=m([]),N=async()=>{try{const{data:u}=await sa("ZABBIX");V.value=u.map(n=>({value:n.id,label:n.name}))}catch(u){console.error(u)}},X=()=>{var u;(u=t.value.hostInventories)==null||u.push({label:"",code:"",value:""})},ee=u=>{var n;(n=t.value.hostInventories)==null||n.splice(u,1)},b=()=>{var u;(u=t.value.tags)==null||u.push({tag:"",operator:re[0].value,value:""})},y=u=>{var n;(n=t.value.tags)==null||n.splice(u,1)};return t.value=w.cloneDeep(D.searchParam),se(()=>D.searchParam,u=>{u&&(t.value=w.cloneDeep(u))},{deep:!0}),Ve(()=>{N(),q()}),(u,n)=>{const U=je,W=we,s=ge,_=Ce,j=Ae,S=he,T=ce,i=ye,r=me,p=Fe,h=be;return c(),O("div",null,[a(h,{ref_key:"formRef",ref:P,model:t.value,size:"medium"},{default:e(()=>[a(s,{label:"\u4E8B\u4EF6\u7EA7\u522B"},{default:e(()=>[a(W,null,{default:e(()=>[a(U,{checked:t.value.severities[5],"onUpdate:checked":n[0]||(n[0]=l=>t.value.severities[5]=l),style:te({border:"1px solid "+k(B)}),color:"red",checkable:"",bordered:"",onCheck:v},{default:e(()=>[o(x(u.$t("problem.searchForm.eventDisasterTag")),1)]),_:1},8,["checked","style"]),a(U,{checked:t.value.severities[4],"onUpdate:checked":n[1]||(n[1]=l=>t.value.severities[4]=l),style:te({border:"1px solid "+k(d)}),color:"orangered",checkable:"",bordered:"",onCheck:v},{default:e(()=>[o(x(u.$t("problem.searchForm.eventHighTag")),1)]),_:1},8,["checked","style"]),a(U,{checked:t.value.severities[3],"onUpdate:checked":n[2]||(n[2]=l=>t.value.severities[3]=l),style:te({border:"1px solid "+k(A)}),color:"orange",checkable:"",bordered:"",onCheck:v},{default:e(()=>[o(x(u.$t("problem.searchForm.eventAverageTag")),1)]),_:1},8,["checked","style"]),a(U,{checked:t.value.severities[2],"onUpdate:checked":n[3]||(n[3]=l=>t.value.severities[2]=l),style:te({border:"1px solid "+k(C)}),color:"gold",checkable:"",bordered:"",onCheck:v},{default:e(()=>[o(x(u.$t("problem.searchForm.eventWarnTag")),1)]),_:1},8,["checked","style"]),a(U,{checked:t.value.severities[1],"onUpdate:checked":n[4]||(n[4]=l=>t.value.severities[1]=l),style:te({border:"1px solid "+k(R)}),color:"blue",checkable:"",bordered:"",onCheck:v},{default:e(()=>[o(x(u.$t("problem.searchForm.eventInfoTag")),1)]),_:1},8,["checked","style"]),a(U,{checked:t.value.severities[0],"onUpdate:checked":n[5]||(n[5]=l=>t.value.severities[0]=l),checkable:"",bordered:"",onCheck:v},{default:e(()=>[o(x(u.$t("problem.searchForm.eventNoClassTag")),1)]),_:1},8,["checked"])]),_:1})]),_:1}),a(W,{direction:"vertical",fill:""},{default:e(()=>[a(s,{label:"\u5E94\u7528"},{default:e(()=>[a(j,{modelValue:t.value.appKeys,"onUpdate:modelValue":n[6]||(n[6]=l=>t.value.appKeys=l),placeholder:u.$t("problem.searchForm.appName"),"allow-clear":"",multiple:"",onChange:L},{default:e(()=>[(c(!0),O(K,null,H(V.value,(l,F)=>(c(),$(_,{key:F,value:l.value},{default:e(()=>[o(x(l.label),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue","placeholder"])]),_:1}),a(s,{label:"\u4E3B\u673A\u7FA4\u7EC4"},{default:e(()=>[a(ia,{modelValue:t.value.hostGroups,"onUpdate:modelValue":[n[7]||(n[7]=l=>t.value.hostGroups=l),v],"app-keys":t.value.appKeys?t.value.appKeys:[],multiple:""},null,8,["modelValue","app-keys"])]),_:1}),a(s,{label:"\u4E3B\u673A"},{default:e(()=>[a(ra,{modelValue:t.value.hosts,"onUpdate:modelValue":[n[8]||(n[8]=l=>t.value.hosts=l),v],"app-keys":t.value.appKeys?t.value.appKeys:[],"app-key-host-group-ids":t.value.hostGroups?t.value.hostGroups:[],multiple:"",style:{width:"100%"}},null,8,["modelValue","app-keys","app-key-host-group-ids"])]),_:1}),a(s,{label:"\u4E8B\u4EF6\u6807\u9898"},{default:e(()=>[a(S,{modelValue:t.value.name,"onUpdate:modelValue":n[9]||(n[9]=l=>t.value.name=l),modelModifiers:{trim:!0},placeholder:"\u4E8B\u4EF6\u6807\u9898",onInput:v},null,8,["modelValue"])]),_:1}),a(s,{label:"\u8D44\u4EA7\u8FC7\u6EE4"},{default:e(()=>[G("div",pa,[(c(!0),O(K,null,H(t.value.hostInventories,(l,F)=>(c(),$(r,{key:F,style:{"align-items":"center","margin-bottom":"10px"},gutter:8},{default:e(()=>[a(T,{span:10},{default:e(()=>[a(j,{modelValue:l.code,"onUpdate:modelValue":g=>l.code=g,"trigger-props":{updateAtScroll:!0},placeholder:u.$t("problem.searchForm.inventoryField"),"allow-clear":"",onChange:v},{default:e(()=>[(c(!0),O(K,null,H(I.value,(g,Y)=>(c(),$(_,{key:Y,value:g.value},{default:e(()=>[o(x(g.label),1)]),_:2},1032,["value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder"])]),_:2},1024),a(T,{span:11},{default:e(()=>[a(S,{modelValue:l.value,"onUpdate:modelValue":g=>l.value=g,modelModifiers:{trim:!0},placeholder:u.$t("problem.searchForm.inventoryValue"),"allow-clear":"",onInput:v},null,8,["modelValue","onUpdate:modelValue","placeholder"])]),_:2},1024),a(T,{span:3},{default:e(()=>[a(i,{style:{"font-size":"12px"},hoverable:!1,onClick:g=>ee(F)},{default:e(()=>[o(" \u79FB\u9664 ")]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024))),128)),G("div",null,[a(i,{style:{"text-align":"left"},size:"mini",onClick:X},{default:e(()=>[o(" \u6DFB\u52A0\u8D44\u4EA7\u8FC7\u6EE4 ")]),_:1})])])]),_:1}),a(s,{label:"\u6807\u7B7E\u8FC7\u6EE4"},{default:e(()=>[G("div",va,[(c(!0),O(K,null,H(t.value.tags,(l,F)=>(c(),$(r,{key:"tag"+F,style:{"align-items":"center","margin-bottom":"10px"},gutter:8},{default:e(()=>[a(T,{span:7},{default:e(()=>[a(S,{modelValue:l.tag,"onUpdate:modelValue":g=>l.tag=g,modelModifiers:{trim:!0},placeholder:u.$t("problem.searchForm.tags"),onInput:v},null,8,["modelValue","onUpdate:modelValue","placeholder"])]),_:2},1024),a(T,{span:6},{default:e(()=>[a(j,{modelValue:l.operator,"onUpdate:modelValue":g=>l.operator=g,"trigger-props":{updateAtScroll:!0},onChange:v},{default:e(()=>[(c(!0),O(K,null,H(k(re),(g,Y)=>(c(),$(_,{key:Y,value:g.value},{default:e(()=>[o(x(g.label),1)]),_:2},1032,["value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1024),a(T,{span:8},{default:e(()=>[a(S,{modelValue:l.value,"onUpdate:modelValue":g=>l.value=g,modelModifiers:{trim:!0},placeholder:u.$t("problem.searchForm.tagValue"),onInput:v},null,8,["modelValue","onUpdate:modelValue","placeholder"])]),_:2},1024),a(T,{span:3},{default:e(()=>[a(i,{style:{"font-size":"12px"},hoverable:!1,onClick:g=>y(F)},{default:e(()=>[o(" \u79FB\u9664 ")]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024))),128)),G("div",null,[a(p,{type:"text",size:"mini",style:{"text-align":"left"},onClick:b},{default:e(()=>[o(" \u6DFB\u52A0\u6807\u7B7E\u8FC7\u6EE4 ")]),_:1})])])]),_:1})]),_:1})]),_:1},8,["model"])])}}}),_a={key:0},ha={key:1},ga={style:{width:"100%"}},ba=de({__name:"form-draw",props:{visible:{type:Boolean,default:!1},initForm:{}},emits:["ok","cancel"],setup(ae,{emit:Q}){const E=m(1),D=ae,R=Q,C=m(),A={appKey:void 0,keyword:void 0,name:void 0,severities:[!1,!1,!1,!1,!1,!1],timeFrom:void 0,timeTill:void 0,hostGroups:[],hosts:[],hostInventories:[{label:"",code:"",value:""}],evalType:"0",tags:[{tag:"",operator:re[0].value,value:""}]},d=m({name:"",filterParams:w.cloneDeep(A),statisticDimensionList:[w.cloneDeep(ie)]}),B=async()=>{await C.value.validate()?console.warn("\u9A8C\u8BC1\u4E0D\u901A\u8FC7"):(await la(d.value),$e.success("\u63D0\u4EA4\u6210\u529F"),R("ok"))},P=m(""),M=Oe(async(y,u)=>{if(y!==P.value){const{data:n}=await ua(y);n&&u("\u62A5\u8868\u540D\u79F0\u5DF2\u5B58\u5728")}},500),t=async()=>{D.initForm?(w.assign(d.value,w.cloneDeep(D.initForm)),P.value=D.initForm.name,C.value.validate()):(d.value.id="",d.value.name="",d.value.filterParams=w.cloneDeep(A),d.value.statisticDimensionList=[],d.value.statisticDimensionList.push(w.cloneDeep(ie)),P.value=""),E.value=1},v=()=>{R("cancel")},L=()=>{d.value.statisticDimensionList.push(w.assign(w.cloneDeep(ie),{sortIndex:d.value.statisticDimensionList.length}))},I=y=>{d.value.statisticDimensionList.splice(y,1)},q=m(!1),V=m(0),N=y=>{V.value=y,q.value=!0},X=y=>{y.sortIndex=V.value,Object.assign(d.value.statisticDimensionList[V.value],w.cloneDeep(y)),q.value=!1,C.value.validate()},ee=xe(()=>{if(d.value.statisticDimensionList&&d.value.statisticDimensionList.length>0)return d.value.statisticDimensionList[V.value]}),b=()=>{C.value.validate(y=>{y||E.value===1&&(E.value+=1)})};return(y,u)=>{const n=Ge,U=Me,W=De,s=he,_=ge,j=ce,S=ye,T=me,i=Fe,r=be,p=Be;return c(),$(p,{visible:y.visible,width:"50%","title-align":"start","mask-closable":!1,onOk:B,onCancel:v,onBeforeOpen:t},{title:e(()=>[o(x(d.value.id?"\u7F16\u8F91\u62A5\u8868":"\u65B0\u5EFA\u62A5\u8868"),1)]),footer:e(()=>[E.value===1?(c(),$(i,{key:0,type:"primary",onClick:b},{default:e(()=>[o(" \u4E0B\u4E00\u6B65 ")]),_:1})):J("",!0),E.value===2?(c(),$(i,{key:1,type:"primary",onClick:u[3]||(u[3]=h=>E.value--)},{default:e(()=>[o(" \u4E0A\u4E00\u6B65 ")]),_:1})):J("",!0),d.value.id||E.value===2?(c(),$(i,{key:2,type:"primary",onClick:B},{default:e(()=>[o(" \u5B8C\u6210 ")]),_:1})):J("",!0)]),default:e(()=>[G("div",null,[a(U,{current:E.value},{default:e(()=>[a(n,null,{default:e(()=>[o("\u57FA\u7840\u914D\u7F6E")]),_:1}),a(n,null,{default:e(()=>[o("\u7EDF\u8BA1\u65B9\u5F0F")]),_:1})]),_:1},8,["current"]),a(W),a(r,{ref_key:"submitFormRef",ref:C,model:d.value,style:{width:"600px"}},{default:e(()=>[E.value===1?(c(),O("div",_a,[a(_,{field:"name",label:"\u62A5\u8868\u540D\u79F0",rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u62A5\u8868\u540D\u79F0"},{validator:k(M)},{maxLength:64,message:"\u62A5\u8868\u540D\u957F\u5EA6\u6700\u5927\u4E0D\u80FD\u8D85\u8FC764"}],"validate-trigger":"blur"},{default:e(()=>[a(s,{modelValue:d.value.name,"onUpdate:modelValue":u[0]||(u[0]=h=>d.value.name=h)},null,8,["modelValue"])]),_:1},8,["rules"]),a(W,{orientation:"left"},{default:e(()=>[o("\u7B5B\u9009\u6761\u4EF6")]),_:1}),a(fa,{searchParam:d.value.filterParams,"onUpdate:searchParam":u[1]||(u[1]=h=>d.value.filterParams=h),"is-problem":!1},null,8,["searchParam"])])):J("",!0),E.value===2?(c(),O("div",ha,[G("div",ga,[(c(!0),O(K,null,H(k(w).sortBy(d.value.statisticDimensionList,["sortIndex"],["asc"]),(h,l)=>(c(),O("div",{key:l,style:{"margin-bottom":"5px",width:"100%"}},[a(_,{class:"noAfter",field:`statisticDimensionList[${l}].name`,label:l===0?"\u7EDF\u8BA1\u7EF4\u5EA6":"",rules:[{required:!0,message:"\u8BF7\u7F16\u8F91\u7EDF\u8BA1\u7EF4\u5EA6"}]},{default:e(()=>[a(T,{gutter:5,style:{width:"100%"}},{default:e(()=>[a(j,{span:20},{default:e(()=>[a(s,{modelValue:h.name,"onUpdate:modelValue":F=>h.name=F,placeholder:"\u7EDF\u8BA1\u7EF4\u5EA6\u540D\u79F0",readonly:"",disabled:"",onClick:F=>N(l)},null,8,["modelValue","onUpdate:modelValue","onClick"])]),_:2},1024),a(j,{span:4,style:{"margin-top":"4px"}},{default:e(()=>[a(S,{type:"primary",size:"small",onClick:F=>N(l)},{default:e(()=>[o(" \u7F16\u8F91 ")]),_:2},1032,["onClick"]),a(S,{type:"primary",size:"small",onClick:F=>I(l)},{default:e(()=>[o(" \u5220\u9664 ")]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1032,["field","label"])]))),128)),a(_,{class:"noAfter"},{default:e(()=>[a(i,{style:{width:"100%"},type:"dashed",onClick:L},{default:e(()=>[o(" \u6DFB\u52A0 ")]),_:1})]),_:1})])])):J("",!0)]),_:1},8,["model"]),a(ma,{visible:q.value,"init-form":ee.value,onCancel:u[2]||(u[2]=h=>q.value=!1),onOk:X},null,8,["visible","init-form"])])]),_:1},8,["visible"])}}}),ya={class:"page-container"},Fa={class:"page-panel"},ka={key:0},Ea={class:"selected-count"},Ca={style:{height:"calc(100vh - 144px)"}},Aa=["onClick"],Qa=de({__name:"index",setup(ae){const{loading:Q,setLoading:E}=Re(!1),D=m(!1),{pagination:R,pageSizeOptions:C}=aa(),A=m(),d=m();let B=[];const P=m({size:"mini",height:"auto",columnConfig:{resizable:!0},showOverflow:"tooltip",rowConfig:{isHover:!0,keyField:"id"},columns:[{type:"checkbox",width:40,resizable:!1},{title:"\u62A5\u8868\u540D",field:"name",minWidth:120,slots:{default:"name"}},{title:"\u521B\u5EFA\u4EBA",field:"createUserName",minWidth:60},{title:"\u521B\u5EFA\u65F6\u95F4",field:"createTime",minWidth:60},{title:"\u64CD\u4F5C",width:120,resizable:!1,slots:{default:"action"}}]}),M=qe({name:""}),t=m([]),v=m(void 0),L=()=>{const i=A.value;B&&B.length>0&&B.forEach(r=>{const p=r.id,h=t.value.indexOf(p)!==-1;_e(()=>{i.getRowById(p)&&i.setCheckboxRow(i.getRowById(p),h)})})},I=async(i={...M,page:R})=>{E(!0);const r=A.value;try{const{data:p}=await oa(i);R.total=p.totalElements,B=p.content,r&&await r.reloadData(p.content)}catch(p){console.error(p)}finally{E(!1),L()}},q=i=>{const{checked:r,row:p}=i;r?t.value.push(p.id):t.value=t.value.filter(h=>h!==p.id)},V=xe(()=>B.map(i=>i.id)),N=i=>{const{checked:r}=i;if(r){const p=V.value.filter(h=>!t.value.includes(h));t.value.push(...p)}else t.value=t.value.filter(p=>!V.value.includes(p))},X=()=>{t.value=[],L()},ee=i=>{R.current=i,I()},b=i=>{R.pageSize=i,I()},y=()=>{I()},u=Oe(async()=>{await I()},500),n=()=>{v.value=void 0,D.value=!0},U=i=>{let r,p;i?(r=[i.id],p=`\u6B64\u64CD\u4F5C\u5C06\u6C38\u4E45\u5220\u9664'${i.name}'\u53CA\u5176\u8BA2\u9605\u8BB0\u5F55, \u662F\u5426\u7EE7\u7EED?`):(r=t.value,p=`\u6B64\u64CD\u4F5C\u5C06\u6C38\u4E45\u5220\u9664\u60A8\u6240\u9009\u7684${r.length}\u6761\u62A5\u8868\u53CA\u5176\u8BA2\u9605\u8BB0\u5F55, \u662F\u5426\u7EE7\u7EED?`),We.warning({title:"\u63D0\u793A",titleAlign:"start",hideCancel:!1,content:p,onOk:async()=>{await na(r),$e.success("\u5220\u9664\u62A5\u8868\u6210\u529F"),i?t.value=t.value.filter(h=>h!==i.id):t.value=[],await I()}})},W=async i=>{v.value=i,D.value=!0},s=m(!1),_=m(void 0),j=i=>{_.value=i,s.value=!0},S=async()=>{D.value=!1,await I()},T=i=>{ze.push({name:"EventStatisticReportDetail",query:{"report-config-id":i.id}})};return Ve(()=>{I()}),(i,r)=>{var ke,Ee;const p=Ye,h=we,l=ce,F=ye,g=Fe,Y=Ze,pe=Xe,ve=Je,f=Qe,Z=me,Ie=ea,Ue=Ke("vxe-grid");return c(),O("div",ya,[G("div",Fa,[a(Z,null,{default:e(()=>[a(l,{span:14},{default:e(()=>[a(h,{style:{"margin-bottom":"5px"}},{default:e(()=>[a(p,{modelValue:M.name,"onUpdate:modelValue":r[0]||(r[0]=z=>M.name=z),style:{width:"320px"},placeholder:"\u62A5\u8868\u540D\u79F0","allow-clear":"",onSearch:y,onInput:k(u),onClear:k(u)},null,8,["modelValue","onInput","onClear"])]),_:1})]),_:1}),a(l,{span:10,style:{"text-align":"right"}},{default:e(()=>[a(h,{style:{"margin-bottom":"5px"}},{default:e(()=>[t.value.length>0?(c(),O("span",ka,[G("span",Ea," \u5DF2\u9009\u62E9\u4E86"+x(t.value.length)+"\u6761 ",1),a(F,{onClick:X},{default:e(()=>[o("\u6E05\u7A7A")]),_:1})])):J("",!0),a(g,{type:"primary",size:"medium",onClick:n},{default:e(()=>[o(" \u65B0\u5EFA ")]),_:1}),a(f,null,{icon:e(()=>[a(Y)]),content:e(()=>[a(ve,{disabled:t.value.length===0,onClick:r[1]||(r[1]=z=>U())},{default:e(()=>[a(pe),o(" \u6279\u91CF\u5220\u9664 ")]),_:1},8,["disabled"])]),default:e(()=>[o(" \u7BA1\u7406 ")]),_:1})]),_:1})]),_:1})]),_:1}),G("div",Ca,[a(Ue,He({ref_key:"xGrid",ref:A,loading:k(Q)},P.value,{onCheckboxChange:q,onCheckboxAll:N}),{name:e(({row:z})=>[G("div",{class:"table-link",onClick:fe=>T(z)},x(z.name),9,Aa)]),action:e(({row:z})=>[a(h,null,{default:e(()=>[a(F,{style:{"font-size":"12px"},hoverable:!1,type:"text",onClick:fe=>W(z)},{default:e(()=>[o(" \u7F16\u8F91 ")]),_:2},1032,["onClick"]),a(F,{style:{"font-size":"12px"},hoverable:!1,type:"text",onClick:fe=>j(z)},{default:e(()=>[o(" \u8BA2\u9605 ")]),_:2},1032,["onClick"]),a(F,{style:{"font-size":"12px"},hoverable:!1,type:"text",onClick:fe=>U(z)},{default:e(()=>[o(" \u5220\u9664 ")]),_:2},1032,["onClick"])]),_:2},1024)]),pager:e(()=>[a(Ie,{ref_key:"xPagination",ref:d,current:k(R).current,"page-size":k(R).pageSize,total:k(R).total,"page-size-options":k(C),style:{"padding-top":"10px"},"show-total":"","show-jumper":"","show-page-size":"",onChange:ee,onPageSizeChange:b},null,8,["current","page-size","total","page-size-options"])]),_:1},16,["loading"])])]),a(ba,{visible:D.value,"onUpdate:visible":r[2]||(r[2]=z=>D.value=z),"init-form":v.value,onCancel:r[3]||(r[3]=z=>D.value=!1),onOk:S},null,8,["visible","init-form"]),a(da,{visible:s.value,name:(ke=_.value)==null?void 0:ke.name,"report-config-id":(Ee=_.value)==null?void 0:Ee.id,"report-type":"EVENT_STATISTIC_REPORT",onOk:r[4]||(r[4]=z=>s.value=!1),onCancel:r[5]||(r[5]=z=>s.value=!1)},null,8,["visible","name","report-config-id"])])}}});export{Qa as default};
