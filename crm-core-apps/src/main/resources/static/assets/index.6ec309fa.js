import{h as k,a as Ve,l as le,U as ke,V as we,_ as De}from"./index.e9d54774.js";/* empty css               *//* empty css                *//* empty css                *//* empty css                *//* empty css              *//* empty css                *//* empty css                *//* empty css               */import{d as Ae,f as h,c as ae,o as Re,D as i,E,H as c,aS as e,aI as l,aY as o,u as F,aH as v,F as $e,G as Ue,aW as te,aU as z,aV as O,aZ as V,$ as Ie,aN as ze,bh as Se,ch as Le,ci as Ne,bt as qe,bV as Me,bW as Oe,a_ as Ge,bY as Te,aP as Pe,bo as je,bp as He,c5 as Je,cj as We,b0 as Ye,bX as Xe,ck as Ze,c6 as Ke,aO as Qe,a$ as el,a7 as ll,cl as al,bv as tl,bI as ul,bJ as ol}from"./arco.a97fe066.js";import{l as nl}from"./app-instance.ab836c4c.js";import{r as ue}from"./index.adfe86d2.js";import"./chart.a235fbdf.js";import"./vue.4eb70094.js";const w="/event-redefine";function sl(p){return k.post(`${w}/save`,p)}function il(p){return k.post(`${w}/remove/${p}`)}function dl(p){return p.enabled=!p.enabled,k.post(`${w}/enabled`,p)}function cl(){return k.get(`${w}/rules`)}function rl(){return k.get(`${w}/get-fields`)}const b=p=>(ul("data-v-ca758ec6"),p=p(),ol(),p),pl={class:"page-container"},ml={class:"page-panel"},_l={style:{height:"80vh","max-height":"80vh","overflow-y":"auto",padding:"0 0 0 10px","margin-top":"-12px"}},vl={class:"rule-item-group"},fl=["onClick"],gl={class:"rule-item-label"},yl=b(()=>c("span",{class:"rule-define-connect"},null,-1)),hl=b(()=>c("div",{class:"rule-item-connect-and"},"\xA0",-1)),El={style:{margin:"0 0 4px 6px",width:"40vw",padding:"0 8px"}},bl=b(()=>c("div",{class:"rule-item-label"},"\u4E14",-1)),xl=b(()=>c("span",{class:"rule-define-connect"},null,-1)),Bl=b(()=>c("div",{class:"rule-item-connect-or"},"\xA0",-1)),Cl=b(()=>c("div",{class:"rule-item-connect-group"},"\xA0",-1)),Fl={class:"rule-item-group",style:{width:"100%",padding:"4px 16px 0"}},Vl={class:"rule-item-group",style:{width:"100%",padding:"4px 16px 1px"}},kl=Ae({__name:"index",setup(p){const{loading:D,setLoading:G}=Ve(),A={background:"#e5e6eb",color:"#86909C"},T={rules:[[{field:"",op:"eq",value:""}]],fields:[{field:"",value:""}]},x=h(-1),S=h(),L=h(),s=h(le.cloneDeep(T)),P={apps:[{required:!0,message:"\u81F3\u5C11\u9009\u62E9\u4E00\u4E2A\u5E94\u7528\u6E90"}],name:[{required:!0,message:"\u89C4\u5219\u540D\u4E0D\u80FD\u4E3A\u7A7A"},{maxLength:64,message:"\u89C4\u5219\u540D\u6700\u5927\u957F\u5EA6\u4E0D\u80FD\u8D85\u8FC764\u5B57\u7B26"}]},y=h(),R=h([]),N=h(),oe=u=>({"rule-item":!0,"rule-item-selected":x.value===u}),ne=(u,a)=>{x.value=a,s.value=u.data,q(u.data.apps)},q=u=>{u.join("").indexOf("all")!==-1?y.value=y.value.map(a=>(a.disabled=a.value!=="all",a)):y.value=y.value.map(a=>(a.disabled=!1,a))},se=u=>{s.value.rules[u].push({field:"",op:"eq",value:""})},ie=(u,a)=>{s.value.rules[u].splice(a,1)},de=()=>{s.value.rules.push([{field:"",op:"eq",value:""}])},ce=u=>{s.value.rules.splice(u,1)},re=()=>{s.value.fields.push({field:"",value:""})},pe=u=>{s.value.fields.splice(u,1)},j=()=>{L.value.clearValidate(),S.value.clearValidate(),s.value=le.cloneDeep(T),x.value=-1,q([])},M=async()=>{G(!0);const{data:u}=await cl();N.value=u.map(a=>({title:a.name,description:a.comment,data:a})),G(!1),j()},H=async(u=!1)=>{const a=await L.value.validate(),r=await S.value.validate();if(!a&&!r){const m=s.value;m.enabled=u,m.ruleGroup="COMMON",await sl(m),await M(),await ue()}else console.log("\u6821\u9A8C\u4E0D\u901A\u8FC7",a,r)},me=async u=>{await il(N.value[u].data.id),await M()},_e=ae(()=>s.value.fields.filter(u=>!!u.field).length===0),J=ae(()=>R.value.filter(u=>u.value!=="severity").map(u=>`{${u.value}}`));return Re(async()=>{const{data:u}=await rl();R.value=JSON.parse(u[0].content).map(r=>({value:r.field,label:r.label}));const{data:a}=await nl();y.value=a.filter(r=>r.enable&&!r.deleteTime).map(r=>({value:r.id,label:r.name})),y.value.unshift({value:"all",label:"\u5168\u90E8"}),await M()}),(u,a)=>{const r=Ie,m=ze,W=Se,ve=Le,fe=Ne,f=qe,ge=Me,ye=Oe,$=Ge,Y=Te,X=Pe,B=je,Z=He,he=Je,Ee=We,K=Ye,be=Xe,U=Ze,xe=Ke,C=Qe,d=el,Q=ke,Be=ll,Ce=we,ee=al,Fe=tl;return i(),E("div",pl,[c("div",ml,[e(K,{style:{height:"calc(100vh - 110px)"},gutter:12},{default:l(()=>[e($,{span:11},{default:l(()=>[e(f,{direction:"vertical",fill:""},{default:l(()=>[e(W,null,{icon:l(()=>[e(r)]),action:l(()=>[e(m,{size:"mini",type:"primary",status:"warning",onClick:j},{default:l(()=>[o(" \u65B0\u589E\u89C4\u5219 ")]),_:1})]),default:l(()=>[o(" \u91CD\u5B9A\u4E49\u89C4\u5219\u8BBE\u7F6E ")]),_:1}),e(ve,{placeholder:"\u5173\u952E\u5B57"}),e(ye,{"virtual-list-props":{height:"76vh"},loading:F(D),data:N.value},{item:l(({item:t,index:_})=>[(i(),v(ge,{key:_,class:$e(oe(_)),style:Ue({borderLeft:t.data.enabled?"10px solid #7bc616":"10px solid #ff7d00"}),onClick:n=>ne(t,_)},{extra:l(()=>[e(f,{direction:"vertical"},{default:l(()=>[e(m,{size:"mini",status:t.data.enabled?"success":"warning",disabled:t.data.fields.filter(n=>!!n.field).length===0,style:{float:"right"},onClick:n=>{dl(t.data).then(()=>{F(ue)()})}},{default:l(()=>[o(te(t.data.enabled?"\u5DF2":"\u672A")+"\u6FC0\u6D3B ",1)]),_:2},1032,["status","disabled","onClick"])]),_:2},1024)]),default:l(()=>[e(fe,{title:t.title,description:t.description},null,8,["title","description"])]),_:2},1032,["class","style","onClick"]))]),_:1},8,["loading","data"])]),_:1})]),_:1}),e($,{span:13},{default:l(()=>[e(f,{direction:"vertical",fill:""},{default:l(()=>[e(K,null,{default:l(()=>[e($,{span:12},{default:l(()=>[e(Z,{ref_key:"ruleNameFormRef",ref:S,model:s.value,rules:P},{default:l(()=>[e(B,{"hide-asterisk":"",class:"noAfter",field:"name"},{label:l(()=>[e(Y,{size:"large"},{default:l(()=>[o("\u89C4\u5219\u540D\u79F0:")]),_:1})]),default:l(()=>[e(X,{modelValue:s.value.name,"onUpdate:modelValue":a[0]||(a[0]=t=>s.value.name=t),placeholder:"\u8BF7\u8F93\u5165\u540D\u79F0...",style:{margin:"0 0 -2px -6px"}},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1}),e($,{span:12},{default:l(()=>[e(Ee,{type:"primary",style:{float:"right","margin-top":"6px"}},{default:l(()=>[e(he,{content:"\u786E\u8BA4\u5220\u9664?",type:"warning",onOk:a[1]||(a[1]=t=>me(x.value))},{default:l(()=>[e(m,{size:"mini",status:"danger",loading:F(D),disabled:x.value===-1},{default:l(()=>[o(" \u5220\u9664 ")]),_:1},8,["loading","disabled"])]),_:1}),e(m,{size:"mini",status:"success",loading:F(D),disabled:_e.value,onClick:a[2]||(a[2]=t=>H(!0))},{default:l(()=>[o(" \u4FDD\u5B58\u6FC0\u6D3B ")]),_:1},8,["loading","disabled"]),e(m,{size:"mini",status:"warning",loading:F(D),onClick:a[3]||(a[3]=t=>H())},{default:l(()=>[o(" \u4FDD\u5B58 ")]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1}),e(be,{style:{"margin-top":"-8px"}}),c("div",_l,[e(Z,{ref_key:"formRef",ref:L,layout:"vertical",model:s.value,rules:P,style:{borderLeft:"1px solid #ff7d00"}},{default:l(()=>[e(B,{class:"noAfter",field:"apps",style:{padding:"0 16px"},"hide-asterisk":""},{label:l(()=>[e(f,{align:"center",style:{"margin-left":"-26px"}},{default:l(()=>[e(U,{count:1,"dot-style":A}),o(" \u9009\u62E9\u4E8B\u4EF6\u6E90 ")]),_:1})]),default:l(()=>[e(xe,{modelValue:s.value.apps,"onUpdate:modelValue":a[4]||(a[4]=t=>s.value.apps=t),modelModifiers:{trim:!0},options:y.value,onChange:q},null,8,["modelValue","options"])]),_:1}),e(B,{class:"noAfter",style:{height:"20px"}},{label:l(()=>[e(f,{align:"center",style:{"margin-left":"-10px"}},{default:l(()=>[e(U,{count:2,"dot-style":A}),o(" \u7B5B\u9009\u4E8B\u4EF6\u8303\u56F4 ")]),_:1})]),_:1}),(i(!0),E(z,null,O(s.value.rules,(t,_)=>(i(),E(z,{key:_},[c("div",vl,[s.value.rules.length>1?(i(),E("div",{key:0,class:"remove-rule-group-btn",onClick:n=>ce(_)},null,8,fl)):V("",!0),(i(!0),E(z,null,O(t,(n,I)=>(i(),E("div",{key:I,class:"rule-item-conditions"},[c("div",gl,"\u6761\u4EF6"+te(I+1),1),yl,e(f,null,{default:l(()=>[e(C,{modelValue:n.field,"onUpdate:modelValue":g=>n.field=g,placeholder:"\u9009\u62E9\u4E8B\u4EF6\u5B57\u6BB5","allow-clear":"",style:{width:"160px"},options:R.value,onChange:()=>{n.value="",n.op="eq"}},null,8,["modelValue","onUpdate:modelValue","options","onChange"]),e(C,{modelValue:n.op,"onUpdate:modelValue":g=>n.op=g,placeholder:"\u8FD0\u7B97\u7B26",style:{width:"120px"}},{default:l(()=>[e(d,{value:"eq"},{default:l(()=>[o("\u7B49\u4E8E")]),_:1}),e(d,{value:"nq"},{default:l(()=>[o("\u4E0D\u7B49\u4E8E")]),_:1}),n.field!=="severity"?(i(),v(d,{key:0,value:"in"},{default:l(()=>[o(" \u5305\u542B ")]),_:1})):V("",!0),n.field!=="severity"?(i(),v(d,{key:1,value:"ni"},{default:l(()=>[o(" \u4E0D\u5305\u542B ")]),_:1})):V("",!0)]),_:2},1032,["modelValue","onUpdate:modelValue"]),n.field!=="severity"?(i(),v(X,{key:0,modelValue:n.value,"onUpdate:modelValue":g=>n.value=g,modelModifiers:{trim:!0}},null,8,["modelValue","onUpdate:modelValue"])):(i(),v(C,{key:1,modelValue:n.value,"onUpdate:modelValue":g=>n.value=g,placeholder:"\u9009\u62E9\u7EA7\u522B",style:{width:"160px"}},{default:l(()=>[e(d,{value:"1"},{default:l(()=>[o("\u4FE1\u606F")]),_:1}),e(d,{value:"2"},{default:l(()=>[o("\u8B66\u544A")]),_:1}),e(d,{value:"3"},{default:l(()=>[o("\u4E00\u822C")]),_:1}),e(d,{value:"4"},{default:l(()=>[o("\u4E25\u91CD")]),_:1}),e(d,{value:"5"},{default:l(()=>[o("\u707E\u96BE")]),_:1})]),_:2},1032,["modelValue","onUpdate:modelValue"])),I!==0?(i(),v(m,{key:2,type:"text",status:"danger",size:"small",onClick:g=>ie(_,I)},{icon:l(()=>[e(Q)]),_:2},1032,["onClick"])):V("",!0)]),_:2},1024),hl]))),128)),c("div",El,[bl,xl,e(m,{size:"mini",style:{color:"#c9cdd5","border-color":"#c9cdd5"},onClick:n=>se(_)},{icon:l(()=>[e(Be)]),_:2},1032,["onClick"])])]),Bl,Cl],64))),128)),c("div",{class:"rule-item-group-btn",onClick:a[5]||(a[5]=t=>de())}," \u65B0\u6761\u4EF6 "),e(B,{class:"noAfter",style:{"margin-top":"20px"}},{label:l(()=>[e(f,{align:"center",style:{"margin-left":"-10px"}},{default:l(()=>[e(U,{count:3,"dot-style":A}),o(" \u91CD\u5B9A\u4E49\u4E8B\u4EF6\u4FE1\u606F "),e(W,null,{icon:l(()=>[e(Ce,{style:{color:"#d48a1b"}})]),default:l(()=>[o(" \u6309\u4E0B`$`\u7B26\u53F7\u9009\u62E9\u5B57\u6BB5\uFF0C\u5B57\u6BB5\u652F\u6301 "),e(Y,{color:"arcoblue"},{default:l(()=>[o("substring\u3001replaceAll")]),_:1}),o(" \u51FD\u6570 ")]),_:1})]),_:1})]),default:l(()=>[c("div",Fl,[c("div",{class:"evt-filed-change-add-btn",onClick:re}),(i(!0),E(z,null,O(s.value.fields,(t,_)=>(i(),v(f,{key:_,style:{"margin-bottom":"8px"}},{default:l(()=>[e(C,{modelValue:t.field,"onUpdate:modelValue":n=>t.field=n,placeholder:"\u9009\u62E9\u4E8B\u4EF6\u5B57\u6BB5","allow-clear":"",style:{width:"160px"},options:R.value,onChange:()=>t.value=""},null,8,["modelValue","onUpdate:modelValue","options","onChange"]),t.field==="summary"?(i(),v(ee,{key:0,modelValue:t.value,"onUpdate:modelValue":n=>t.value=n,type:"textarea",prefix:"$",data:J.value,"max-length":256,"auto-size":{minRows:2,maxRows:3},style:{width:"320px"},"show-word-limit":""},null,8,["modelValue","onUpdate:modelValue","data"])):t.field==="severity"?(i(),v(C,{key:1,modelValue:t.value,"onUpdate:modelValue":n=>t.value=n,placeholder:"\u9009\u62E9\u7EA7\u522B",style:{width:"320px"}},{default:l(()=>[e(d,{value:"0"},{default:l(()=>[o("\u4FDD\u6301\u539F\u7EA7\u522B")]),_:1}),e(d,{value:"1"},{default:l(()=>[o("\u4FE1\u606F")]),_:1}),e(d,{value:"2"},{default:l(()=>[o("\u8B66\u544A")]),_:1}),e(d,{value:"3"},{default:l(()=>[o("\u4E00\u822C")]),_:1}),e(d,{value:"4"},{default:l(()=>[o("\u4E25\u91CD")]),_:1}),e(d,{value:"5"},{default:l(()=>[o("\u707E\u96BE")]),_:1})]),_:2},1032,["modelValue","onUpdate:modelValue"])):(i(),v(ee,{key:2,modelValue:t.value,"onUpdate:modelValue":n=>t.value=n,prefix:"$",data:J.value,style:{width:"320px"}},null,8,["modelValue","onUpdate:modelValue","data"])),_!==0?(i(),v(m,{key:3,type:"text",status:"danger",size:"small",onClick:n=>pe(_)},{icon:l(()=>[e(Q)]),_:2},1032,["onClick"])):V("",!0)]),_:2},1024))),128))])]),_:1}),e(B,{class:"noAfter"},{label:l(()=>[e(f,{align:"center",style:{"margin-left":"-10px"}},{default:l(()=>[e(U,{count:4,"dot-style":A}),o(" \u89C4\u5219\u63CF\u8FF0 ")]),_:1})]),default:l(()=>[c("div",Vl,[e(Fe,{modelValue:s.value.comment,"onUpdate:modelValue":a[6]||(a[6]=t=>s.value.comment=t),"max-length":256,"auto-size":{minRows:3,maxRows:5},"show-word-limit":""},null,8,["modelValue"])])]),_:1})]),_:1},8,["model"])])]),_:1})]),_:1})]),_:1})])])}}});const Gl=De(kl,[["__scopeId","data-v-ca758ec6"]]);export{Gl as default};
