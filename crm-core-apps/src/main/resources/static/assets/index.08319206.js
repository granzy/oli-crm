import{a as ae,l as P,ae as ye,k as Ee}from"./index.e9d54774.js";/* empty css                *//* empty css               *//* empty css               *//* empty css               */import{d as Z,f as i,D as I,aH as Q,aI as t,aS as e,E as j,aU as oe,aV as ne,aY as f,aW as W,u as h,aP as le,bo as ue,a_ as K,a$ as ke,aO as we,aN as X,bt as se,b0 as Y,bp as ie,c3 as xe,c4 as Be,bi as re,r as ce,c as de,H as $,bg as me,aM as pe,o as Ae,aT as Se,aZ as Le,bz as Ie,bq as Ve,ch as Re,P as qe,ag as $e,bG as ze,cx as Oe,bB as Pe,n as Te}from"./arco.a97fe066.js";import{d as fe}from"./index.127a6572.js";import{p as Ue}from"./pagination.72a5f225.js";import{P as Ne,p as Me,s as We,f as je,q as He,r as Ge}from"./report-dataset.d2c16129.js";/* empty css              *//* empty css                */import{_ as Qe}from"./index.vue_vue_type_script_setup_true_lang.a6146e11.js";import{q as Ze}from"./datasource.5313e56a.js";import{_ as Ke}from"./setting-draw.vue_vue_type_script_setup_true_lang.1e66f128.js";import"./chart.a235fbdf.js";import"./vue.4eb70094.js";import"./table.vue_vue_type_script_setup_true_lang.4e051305.js";/* empty css               *//* empty css                */import"./_commonjs-dynamic-modules.30ae7933.js";const Xe=Z({__name:"index",props:{visible:{type:Boolean,default:!1},initForm:{}},emits:["ok","cancel"],setup(H,{emit:T}){const F=H,v=T,m=()=>{v("cancel")},r=i({name:"",datasetSql:"",datasourceId:""}),n=i(),V=i(),_=i(),w=i([]),D=i(),{loading:u,setLoading:x}=ae(),z=async()=>{var d;if(w.value=[],D.value={},r.value.datasetSql=((d=_.value.getEditor())==null?void 0:d.getValue())||"",!await V.value.validate())try{x(!0);const b=(await Me(r.value)).data;b&&(w.value=b.headers,D.value=b.rows)}catch(b){console.error(b)}finally{x(!1)}},p=async()=>{n.value=(await Ze({type:"ZABBIX"})).data,F.initForm&&(r.value=P.cloneDeep(F.initForm)),w.value=[],D.value={}},B=async()=>{var d;r.value.datasetSql=((d=_.value.getEditor())==null?void 0:d.getValue())||"",await V.value.validate()||v("ok",r.value)};return(y,d)=>{const b=le,s=ue,g=K,A=ke,S=we,O=ye,R=X,U=se,L=Y,q=ie,N=xe,E=Be,k=re;return I(),Q(k,{visible:y.visible,width:"80vw","title-align":"start","mask-closable":!1,"unmount-on-close":"",title:"\u6570\u636E\u96C6",onOk:B,onCancel:m,onBeforeOpen:p},{default:t(()=>[e(q,{ref_key:"submitFormRef",ref:V,model:r.value},{default:t(()=>[e(L,{gutter:16},{default:t(()=>[e(g,{span:8},{default:t(()=>[e(s,{field:"name",label:"\u6570\u636E\u96C6\u540D\u79F0","label-col-flex":"140px",rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u6570\u636E\u96C6\u540D\u79F0"},{maxLength:31,message:"\u6570\u636E\u96C6\u540D\u957F\u5EA6\u6700\u5927\u4E0D\u80FD\u8D85\u8FC731"}],"validate-trigger":"blur"},{default:t(()=>[e(b,{modelValue:r.value.name,"onUpdate:modelValue":d[0]||(d[0]=a=>r.value.name=a)},null,8,["modelValue"])]),_:1})]),_:1}),e(g,{span:8},{default:t(()=>[e(s,{field:"datasourceId",label:"\u6570\u636E\u6E90",rules:[{required:!0,message:"\u8BF7\u9009\u62E9\u6570\u636E\u6E90"}],"validate-trigger":"blur"},{default:t(()=>[e(S,{modelValue:r.value.datasourceId,"onUpdate:modelValue":d[1]||(d[1]=a=>r.value.datasourceId=a),placeholder:"\u8BF7\u9009\u62E9\u6570\u636E\u6E90","allow-clear":""},{default:t(()=>[(I(!0),j(oe,null,ne(n.value,a=>(I(),Q(A,{key:a.id,value:a.id},{default:t(()=>[f(W(a.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(g,{span:8,style:{"text-align":"right"}},{default:t(()=>[e(U,null,{default:t(()=>[e(R,{loading:h(u),onClick:z},{icon:t(()=>[e(O)]),default:t(()=>[f("\u9884\u89C8")]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1}),e(s,{field:"datasetSql",label:"SQL\u67E5\u8BE2\u8BED\u53E5","validate-trigger":"blur","label-col-flex":"140px",rules:[{required:!0,message:"\u8BF7\u8F93\u5165SQL\u8BED\u53E5"}]},{default:t(()=>[e(Qe,{ref_key:"MonacoEditRef",ref:_,modelValue:r.value.datasetSql,"onUpdate:modelValue":d[2]||(d[2]=a=>r.value.datasetSql=a),"editor-option":{readOnly:!1,minimap:{enabled:!1},contextmenu:!1},style:{border:"1px solid var(--color-border-3)"},height:300,language:"sql"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"]),e(E,null,{default:t(()=>[e(N,{title:"\u6570\u636E\u9884\u89C8"},{default:t(()=>[e(Ne,{headers:w.value,rows:D.value,loading:h(u),height:"36vh","empty-text":"\u6682\u65E0\u6570\u636E,\u8BF7\u70B9\u51FB'\u9884\u89C8'\u6309\u94AE\u67E5\u8BE2\u6570\u636E,\u9ED8\u8BA4\u9884\u89C8\u524D100\u6761"},null,8,["headers","rows","loading"])]),_:1})]),_:1})]),_:1},8,["visible"])}}}),Ye=$("div",{class:"form-attr-group-name"},"\u6570\u636E\u96C6",-1),Je={style:{width:"100%"}},et=Z({__name:"form-draw",props:{visible:{type:Boolean,default:!1},initForm:{}},emits:["ok","cancel"],setup(H,{emit:T}){const F=H,v=T,m=i(),r=[{name:"",datasetSql:"",datasourceId:"",sortIndex:0}],n=ce({name:"",reportDatasetList:P.cloneDeep(r)}),V=async()=>{await m.value.validate()?console.warn("\u9A8C\u8BC1\u4E0D\u901A\u8FC7"):(await We(n),me.success("\u63D0\u4EA4\u6210\u529F"),v("ok"))},_=i(""),w=fe(async(s,g)=>{if(s!==_.value){const{data:A}=await je(s);A&&g("\u62A5\u8868\u540D\u79F0\u5DF2\u5B58\u5728")}},500),D=async()=>{F.initForm?(P.assign(n,F.initForm),_.value=F.initForm.name,m.value.validate()):(n.id="",n.reportDatasetList=P.cloneDeep(r),_.value="",m.value.resetFields())},u=()=>{v("cancel")},x=()=>{n.reportDatasetList.push({name:"",datasetSql:"",datasourceId:"",sortIndex:n.reportDatasetList.length})},z=s=>{n.reportDatasetList.splice(s,1)},p=i(!1),B=i(0),y=s=>{B.value=s,p.value=!0},d=s=>{s.sortIndex=B.value,Object.assign(n.reportDatasetList[B.value],P.cloneDeep(s)),p.value=!1},b=de(()=>{if(n.reportDatasetList&&n.reportDatasetList.length>0)return n.reportDatasetList[B.value]});return(s,g)=>{const A=le,S=ue,O=K,R=pe,U=Y,L=X,q=ie,N=re;return I(),Q(N,{visible:s.visible,width:"50%","title-align":"start","mask-closable":!1,onOk:V,onCancel:u,onBeforeOpen:D},{title:t(()=>[f(W(n.id?"\u7F16\u8F91\u62A5\u8868":"\u65B0\u5EFA\u62A5\u8868"),1)]),default:t(()=>[$("div",null,[e(q,{ref_key:"submitFormRef",ref:m,model:n,style:{width:"600px"}},{default:t(()=>[e(S,{field:"name",label:"\u62A5\u8868\u540D\u79F0",rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u62A5\u8868\u540D\u79F0"},{validator:h(w)},{maxLength:64,message:"\u62A5\u8868\u540D\u957F\u5EA6\u6700\u5927\u4E0D\u80FD\u8D85\u8FC764"}],"validate-trigger":"blur"},{default:t(()=>[e(A,{modelValue:n.name,"onUpdate:modelValue":g[0]||(g[0]=E=>n.name=E)},null,8,["modelValue"])]),_:1},8,["rules"]),Ye,$("div",Je,[(I(!0),j(oe,null,ne(h(P).sortBy(n.reportDatasetList,["sortIndex"],["asc"]),(E,k)=>(I(),j("div",{key:k,style:{"margin-bottom":"5px"}},[e(S,{class:"noAfter",field:`reportDatasetList[${k}].name`,rules:[{required:!0,message:"\u8BF7\u7F16\u8F91\u6570\u636E\u96C6"}]},{default:t(()=>[e(U,{gutter:5,style:{width:"100%"}},{default:t(()=>[e(O,{span:20},{default:t(()=>[e(A,{modelValue:E.name,"onUpdate:modelValue":a=>E.name=a,placeholder:"\u6570\u636E\u96C6\u540D\u79F0",readonly:"",disabled:"",onClick:a=>y(k)},null,8,["modelValue","onUpdate:modelValue","onClick"])]),_:2},1024),e(O,{span:4,style:{"margin-top":"4px"}},{default:t(()=>[e(R,{type:"primary",size:"small",onClick:a=>y(k)},{default:t(()=>[f(" \u7F16\u8F91 ")]),_:2},1032,["onClick"]),e(R,{type:"primary",size:"small",onClick:a=>z(k)},{default:t(()=>[f(" \u5220\u9664 ")]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1032,["field"])]))),128)),e(S,{class:"noAfter"},{default:t(()=>[e(L,{style:{width:"100%"},type:"dashed",onClick:x},{default:t(()=>[f(" \u6DFB\u52A0 ")]),_:1})]),_:1})])]),_:1},8,["model"]),e(Xe,{visible:p.value,"init-form":b.value,onCancel:g[1]||(g[1]=E=>p.value=!1),onOk:d},null,8,["visible","init-form"])])]),_:1},8,["visible"])}}}),tt={class:"page-container"},at={class:"page-panel"},ot={key:0},nt={class:"selected-count"},lt={style:{height:"calc(100vh - 144px)"}},ut=["onClick"],xt=Z({__name:"index",setup(H){const{loading:T,setLoading:F}=ae(!1),v=i(!1),{pagination:m,pageSizeOptions:r}=Ue(),n=i(),V=i();let _=[];const w=i({size:"mini",height:"auto",columnConfig:{resizable:!0},showOverflow:"tooltip",rowConfig:{isHover:!0,keyField:"id"},columns:[{type:"checkbox",width:40,resizable:!1},{title:"\u62A5\u8868\u540D\u79F0",field:"name",minWidth:120,slots:{default:"name"}},{title:"\u6570\u636E\u96C6",field:"reportDatasetList",minWidth:120,slots:{default:"reportDatasetList"}},{title:"\u521B\u5EFA\u4EBA",field:"createUserName",minWidth:60},{title:"\u521B\u5EFA\u65F6\u95F4",field:"createTime",minWidth:60},{title:"\u64CD\u4F5C",width:120,resizable:!1,slots:{default:"action"}}]}),D=ce({name:""}),u=i([]),x=i(void 0),z=()=>{const a=n.value;_&&_.length>0&&_.forEach(o=>{const l=o.id,C=u.value.indexOf(l)!==-1;Te(()=>{a.getRowById(l)&&a.setCheckboxRow(a.getRowById(l),C)})})},p=async(a={...D,page:m})=>{F(!0);const o=n.value;try{const{data:l}=await He(a);m.total=l.totalElements,_=l.content,o&&await o.reloadData(l.content)}catch(l){console.error(l)}finally{F(!1),z()}},B=a=>{const{checked:o,row:l}=a;o?u.value.push(l.id):u.value=u.value.filter(C=>C!==l.id)},y=de(()=>_.map(a=>a.id)),d=a=>{const{checked:o}=a;if(o){const l=y.value.filter(C=>!u.value.includes(C));u.value.push(...l)}else u.value=u.value.filter(l=>!y.value.includes(l))},b=()=>{u.value=[],z()},s=a=>{m.current=a,p()},g=a=>{m.pageSize=a,p()},A=()=>{p()},S=fe(async()=>{await p()},500),O=()=>{x.value=void 0,v.value=!0},R=a=>{let o,l;a?(o=[a.id],l=`\u6B64\u64CD\u4F5C\u5C06\u6C38\u4E45\u5220\u9664'${a.name}'\u53CA\u5176\u8BA2\u9605\u8BB0\u5F55, \u662F\u5426\u7EE7\u7EED?`):(o=u.value,l=`\u6B64\u64CD\u4F5C\u5C06\u6C38\u4E45\u5220\u9664\u60A8\u6240\u9009\u7684${o.length}\u6761\u62A5\u8868\u53CA\u5176\u8BA2\u9605\u8BB0\u5F55, \u662F\u5426\u7EE7\u7EED?`),Ve.warning({title:"\u63D0\u793A",titleAlign:"start",hideCancel:!1,content:l,onOk:async()=>{await Ge(o),me.success("\u5220\u9664\u62A5\u8868\u6210\u529F"),a?u.value=u.value.filter(C=>C!==a.id):u.value=[],await p()}})},U=async a=>{x.value=a,v.value=!0},L=i(!1),q=i(void 0),N=a=>{q.value=a,L.value=!0},E=async()=>{v.value=!1,await p()},k=a=>{Ee.push({name:"DatasetReportDetail",query:{"report-config-id":a.id}})};return Ae(()=>{p()}),(a,o)=>{var ee,te;const l=Re,C=se,J=K,G=pe,_e=X,ve=qe,ge=$e,be=ze,Ce=Oe,he=Y,De=Pe,Fe=Se("vxe-grid");return I(),j("div",tt,[$("div",at,[e(he,null,{default:t(()=>[e(J,{span:14},{default:t(()=>[e(C,{style:{"margin-bottom":"5px"}},{default:t(()=>[e(l,{modelValue:D.name,"onUpdate:modelValue":o[0]||(o[0]=c=>D.name=c),style:{width:"320px"},placeholder:"\u62A5\u8868\u540D\u79F0","allow-clear":"",onSearch:A,onInput:h(S),onClear:h(S)},null,8,["modelValue","onInput","onClear"])]),_:1})]),_:1}),e(J,{span:10,style:{"text-align":"right"}},{default:t(()=>[e(C,{style:{"margin-bottom":"5px"}},{default:t(()=>[u.value.length>0?(I(),j("span",ot,[$("span",nt," \u5DF2\u9009\u62E9\u4E86"+W(u.value.length)+"\u6761 ",1),e(G,{onClick:b},{default:t(()=>[f("\u6E05\u7A7A")]),_:1})])):Le("",!0),e(_e,{type:"primary",size:"medium",onClick:O},{default:t(()=>[f(" \u65B0\u5EFA ")]),_:1}),e(Ce,null,{icon:t(()=>[e(ve)]),content:t(()=>[e(be,{disabled:u.value.length===0,onClick:o[1]||(o[1]=c=>R())},{default:t(()=>[e(ge),f(" \u6279\u91CF\u5220\u9664 ")]),_:1},8,["disabled"])]),default:t(()=>[f(" \u7BA1\u7406 ")]),_:1})]),_:1})]),_:1})]),_:1}),$("div",lt,[e(Fe,Ie({ref_key:"xGrid",ref:n,loading:h(T)},w.value,{onCheckboxChange:B,onCheckboxAll:d}),{name:t(({row:c})=>[$("div",{class:"table-link",onClick:M=>k(c)},W(c.name),9,ut)]),reportDatasetList:t(({row:c})=>[f(W(c.reportDatasetList.length>0?c.reportDatasetList.map(M=>M.name).join(","):""),1)]),action:t(({row:c})=>[e(C,null,{default:t(()=>[e(G,{style:{"font-size":"12px"},hoverable:!1,type:"text",onClick:M=>U(c)},{default:t(()=>[f(" \u7F16\u8F91 ")]),_:2},1032,["onClick"]),e(G,{style:{"font-size":"12px"},hoverable:!1,type:"text",onClick:M=>N(c)},{default:t(()=>[f(" \u8BA2\u9605 ")]),_:2},1032,["onClick"]),e(G,{style:{"font-size":"12px"},hoverable:!1,type:"text",onClick:M=>R(c)},{default:t(()=>[f(" \u5220\u9664 ")]),_:2},1032,["onClick"])]),_:2},1024)]),pager:t(()=>[e(De,{ref_key:"xPagination",ref:V,current:h(m).current,"page-size":h(m).pageSize,total:h(m).total,"page-size-options":h(r),style:{"padding-top":"10px"},"show-total":"","show-jumper":"","show-page-size":"",onChange:s,onPageSizeChange:g},null,8,["current","page-size","total","page-size-options"])]),_:1},16,["loading"])])]),e(et,{visible:v.value,"onUpdate:visible":o[2]||(o[2]=c=>v.value=c),"init-form":x.value,onCancel:o[3]||(o[3]=c=>v.value=!1),onOk:E},null,8,["visible","init-form"]),e(Ke,{visible:L.value,name:(ee=q.value)==null?void 0:ee.name,"report-config-id":(te=q.value)==null?void 0:te.id,"report-type":"DATASET_REPORT",onOk:o[4]||(o[4]=c=>L.value=!1),onCancel:o[5]||(o[5]=c=>L.value=!1)},null,8,["visible","name","report-config-id"])])}}});export{xt as default};
