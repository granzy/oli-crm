import{h as re,a as de,ad as pe,l as X,q as Re,k as xe,Z as we}from"./index.e9d54774.js";/* empty css                */import{d as ie,f as h,r as le,c as oe,aT as J,D as p,E,aS as c,aI as s,aU as N,aV as L,aH as m,aY as R,aW as O,H as U,aZ as F,bz as fe,u as ne,G as ce,bg as se,bE as ge,n as ue,bh as Ee,c3 as be,c4 as $e,z as ke,cc as S,cD as Pe,cE as Be,w as Ae,a$ as De,aO as Te,bo as Fe,cd as Ye,cF as Ne,cG as Le,cH as Me,cI as qe,c7 as Ie,c8 as Oe,bp as Ke,a_ as Ge,aN as _e,bt as Se,b0 as He,bX as ze}from"./arco.a97fe066.js";/* empty css               *//* empty css              *//* empty css                *//* empty css               *//* empty css                */import{h as Ue}from"./vue.4eb70094.js";import{d as me,b as We}from"./zabbix-monitor-object.93807a64.js";import{_ as je}from"./index.vue_vue_type_script_setup_true_lang.dff799f7.js";/* empty css                *//* empty css               */import{a as ve}from"./unit-util.2cbd6bbc.js";import{g as ye}from"./common.93e76438.js";import{c as W}from"./date-time.3a778351.js";import{d as Qe}from"./global.90f51a62.js";import"./chart.a235fbdf.js";import"./moment.a1678c09.js";function Ce(b){return b.periodCompareType===""&&(b.periodCompareType=void 0),re.post("/zabbixPeriodCompareReportDetail/getReportPeriodCompareDetail",b,{timeout:36e5})}function he(b){return re.post("/zabbixPeriodCompareReportDetail/getPeriodRanges",b)}function Ze(b){return b.periodCompareType===""&&(b.periodCompareType=void 0),re.post("/zabbixPeriodCompareReportDetail/exportReport",b,{responseType:"blob",timeout:36e5})}const Xe=ie({__name:"lld-type-table",props:{reportConfig:{},queryParams:{},type:{},height:{}},setup(b,{expose:K}){const{loading:$,setLoading:V}=de(!1),y=h(),n=le({current:1,pageSize:30,total:0}),r=b,v=h(),C=h(),M=async()=>{const a={border:!0,align:null,size:"mini",height:"auto",columnConfig:{resizable:!0}};v.value={...a}},w=h([]),k=h([]),P=h([]),Y=h([]),B=h([]),f=a=>a?ve(Number(a),2):"-",x=oe(()=>{let a=0;return r.reportConfig&&r.reportConfig.statsMax&&(a+=1),r.reportConfig&&r.reportConfig.statsMin&&(a+=1),r.reportConfig&&r.reportConfig.statsAvg&&(a+=1),a}),G=a=>{let t="";switch(a){case"_max":t="\u6700\u5927\u503C";break;case"_min":t="\u6700\u5C0F\u503C";break;case"_avg":t="\u5E73\u5747\u503C";break}return t},q=(a,t,e)=>{var u,i;const d=G(e),o=[{field:`${a.name+e}Value`,title:"\u503C",width:t},{field:`${a.name+e}Value_ringValue`,title:"\u73AF\u6BD4\u503C",width:t},{field:`${a.name+e}Value_ringRatio`,title:"\u73AF\u6BD4\u6BD4\u7387",width:t}];return((u=r.queryParams)==null?void 0:u.period)!=="YEAR"&&((i=r.queryParams)==null?void 0:i.periodCompareType)&&o.push({field:`${a.name+e}Value_lastPeriodValue`,title:"\u540C\u6BD4\u503C",width:t},{field:`${a.name+e}Value_lastPeriodRatio`,title:"\u540C\u6BD4\u6BD4\u7387",width:t}),{title:d,columns:o}},H=(a,t,e)=>{var u,i;const d=G(e),o=[{field:`${a.name+e}Value`,title:d,width:t},{field:`${a.name+e}Value_ringValue`,title:"\u73AF\u6BD4\u503C",width:t},{field:`${a.name+e}Value_ringRatio`,title:"\u73AF\u6BD4\u6BD4\u7387",width:t}];return((u=r.queryParams)==null?void 0:u.period)!=="YEAR"&&((i=r.queryParams)==null?void 0:i.periodCompareType)&&o.push({field:`${a.name+e}Value_lastPeriodValue`,title:"\u540C\u6BD4\u503C",width:t},{field:`${a.name+e}Value_lastPeriodRatio`,title:"\u540C\u6BD4\u6BD4\u7387",width:t}),o},ee=async(a={...r.queryParams,page:n})=>{V(!0);try{a.itemTypeList=[r.type],C.value=await ye(r.reportConfig),w.value=[],me.filter(t=>{var e;return r.reportConfig&&r.reportConfig.monitorObjectTypeAttrs?((e=r.reportConfig.monitorObjectTypeAttrs)==null?void 0:e.indexOf(t.value))>-1:!1}).forEach(t=>{w.value.push({field:`${t.value}`,title:t.label,width:150})}),C.value&&C.value.forEach(t=>{w.value.push({field:`zbxHostInventory_${t.inventoryField}`,title:t.fieldName,width:150})}),w.value.push({field:"itemKey",title:"\u5173\u952E\u5B57",width:150}),k.value=[],r.reportConfig&&r.reportConfig.metricTags&&(k.value=r.reportConfig.metricTags.filter(e=>e.type===r.type).map(e=>{var o,u,i;const d=[];return(o=r.reportConfig)!=null&&o.statsMax&&d.push(...H(e,150,"_max")),(u=r.reportConfig)!=null&&u.statsMin&&d.push(...H(e,150,"_max")),(i=r.reportConfig)!=null&&i.statsAvg&&d.push(...H(e,150,"_avg")),{title:e.name,key:e.name,columns:d}})),x.value>1&&(P.value=[],r.reportConfig&&r.reportConfig.metricTags&&(P.value=r.reportConfig.metricTags.filter(t=>t.type===r.type).map(t=>{var d,o,u;const e=[];return x.value>1&&((d=r.reportConfig)!=null&&d.statsMax&&e.push(q(t,100,"_max")),(o=r.reportConfig)!=null&&o.statsMin&&e.push(q(t,100,"_min")),(u=r.reportConfig)!=null&&u.statsAvg&&e.push(q(t,100,"_avg"))),{title:t.name,key:t.name,columns:e}})))}catch(t){console.error(t)}finally{V(!1)}},D=h(),j=oe(()=>a=>{var t,e;return a.title==="\u73AF\u6BD4\u503C"&&((t=D.value)==null?void 0:t.ringRange.length)===2?`${W(D.value.ringRange[0])} ~ ${W(D.value.ringRange[1])}`:a.title==="\u540C\u6BD4\u503C"&&((e=D.value)==null?void 0:e.lastPeriodRange.length)===2?`${W(D.value.lastPeriodRange[0])} ~ ${W(D.value.lastPeriodRange[1])}`:""}),Q=async(a={...r.queryParams,page:n})=>{const t=y.value;try{if(V(!0),t){const{data:e}=await Ce(a);if(he(a).then(d=>{D.value=d.data}),B.value=e.content,await M(),e.content.length>0){e.content.forEach(o=>{if(o.statisticItemValueList.length>0)o.statisticItemValueList.forEach(u=>{u.itemDataList.forEach(i=>{let l={appKey:o.appKey,hostId:o.hostId};w.value.forEach(A=>{l[A.field]=o.fieldValues[A.field]}),l.itemKey=i.itemKeyTagValue||"-";const T=i.itemId,g=i.itemKeyTagValue&&X.find(Y.value,{appKey:o.appKey,hostId:o.hostId,itemKey:i.itemKeyTagValue});g?(l=g,l.itemIds.push(T)):l.itemIds=[T];const I=f(i.maxValue),_=f(i.minValue),Z=f(i.value);i.maxRatioValue&&(l[`${u.tagName}_maxValue_ringValue`]=f(i.maxRatioValue.value),l[`${u.tagName}_maxValue_ringRatio`]=i.maxRatioValue.ratio),i.maxLastPeriodRatioValue&&(l[`${u.tagName}_maxValue_lastPeriodValue`]=f(i.maxLastPeriodRatioValue.value),l[`${u.tagName}_maxValue_lastPeriodRatio`]=i.maxLastPeriodRatioValue.ratio),i.minRatioValue&&(l[`${u.tagName}_minValue_ringValue`]=f(i.minRatioValue.value),l[`${u.tagName}_minValue_ringRatio`]=i.minRatioValue.ratio),i.minLastPeriodRatioValue&&(l[`${u.tagName}_minValue_lastPeriodValue`]=f(i.minLastPeriodRatioValue.value),l[`${u.tagName}_minValue_lastPeriodRatio`]=i.minLastPeriodRatioValue.ratio),i.avgRatioValue&&(l[`${u.tagName}_avgValue_ringValue`]=f(i.avgRatioValue.value),l[`${u.tagName}_avgValue_ringRatio`]=i.avgRatioValue.ratio),i.avgLastPeriodRatioValue&&(l[`${u.tagName}_avgValue_lastPeriodValue`]=f(i.avgLastPeriodRatioValue.value),l[`${u.tagName}_avgValue_lastPeriodRatio`]=i.avgLastPeriodRatioValue.ratio),l[`${u.tagName}_maxValue`]=I,l[`${u.tagName}_minValue`]=_,l[`${u.tagName}_avgValue`]=Z,g||Y.value.push(l)})});else{const u={hostId:o.hostId};w.value.forEach(i=>{u[i.field]=o.fieldValues[i.field]}),Y.value.push(u)}});const d={};e.content.forEach(o=>{o.statisticItemValueList.forEach(u=>{d[u.tagName]||(d[u.tagName]=[]),d[u.tagName].push(...u.itemDataList.filter(i=>i.units).map(i=>i.units))})}),k.value.forEach(o=>{o.title=`${o.key} \u5355\u4F4D(${X.uniq(d[o.key])})`}),P.value.forEach(o=>{o.title=`${o.key} \u5355\u4F4D(${X.uniq(d[o.key])})`}),await t.loadData(Y.value)}}}catch(e){console.error(e)}finally{V(!1)}},z=async(a={...r.queryParams,page:n})=>{await ee(a),await Q(a)},te=()=>{n.current=1,Y.value=[];const a=y.value;a&&(a.clearScroll(),a.clearData(),a.loadData([])),z()},ae=async a=>{const{scrollTop:t,scrollHeight:e,bodyHeight:d,isY:o}=a;y.value&&o&&t+d+1>=e&&(n.current+=1,await Q(),B.value.length===0&&se.warning("\u6CA1\u6709\u66F4\u591A\u6570\u636E\u4E86~~"))};return K({fetchData:z,refreshData:te}),(a,t)=>{const e=J("vxe-column"),d=pe,o=ge,u=J("vxe-colgroup"),i=J("vxe-table");return p(),E("div",{style:ce([{height:a.height},{margin:"0 12px 6px 12px"}])},[c(i,fe({ref_key:"xGrid",ref:y,size:"mini",loading:ne($)},v.value,{onScroll:ae}),{default:s(()=>[(p(!0),E(N,null,L(w.value,(l,T)=>(p(),m(e,{key:T,field:l.field,title:l.title,width:l.width},{default:s(({row:g})=>[R(O(g[l.field]||"-"),1)]),_:2},1032,["field","title","width"]))),128)),x.value===1?(p(!0),E(N,{key:0},L(k.value,(l,T)=>(p(),m(u,{key:T,title:l.title},{default:s(()=>[(p(!0),E(N,null,L(l.columns,(g,I)=>(p(),m(e,{key:I,field:g.field,title:g.title,width:g.width},{header:s(({column:_})=>[U("span",null,O(_.title),1),c(o,{content:j.value(_)},{default:s(()=>[_.title==="\u73AF\u6BD4\u503C"||_.title==="\u540C\u6BD4\u503C"?(p(),m(d,{key:0,style:{cursor:"pointer"}})):F("",!0)]),_:2},1032,["content"])]),default:s(({row:_})=>[R(O(_[g.field]||"-"),1)]),_:2},1032,["field","title","width"]))),128))]),_:2},1032,["title"]))),128)):(p(!0),E(N,{key:1},L(P.value,(l,T)=>(p(),m(u,{key:T,title:l.title},{default:s(()=>[(p(!0),E(N,null,L(l.columns,(g,I)=>(p(),m(u,{key:I,title:g.title},{default:s(()=>[(p(!0),E(N,null,L(g.columns,(_,Z)=>(p(),m(e,{key:Z,field:_.field,title:_.title,width:_.width},{header:s(({column:A})=>[U("span",null,O(A.title),1),c(o,{content:j.value(A)},{default:s(()=>[A.title==="\u73AF\u6BD4\u503C"||A.title==="\u540C\u6BD4\u503C"?(p(),m(d,{key:0,style:{cursor:"pointer"}})):F("",!0)]),_:2},1032,["content"])]),default:s(({row:A})=>[R(O(A[_.field]||"-"),1)]),_:2},1032,["field","title","width"]))),128))]),_:2},1032,["title"]))),128))]),_:2},1032,["title"]))),128))]),_:1},16,["loading"])],4)}}}),Je=ie({__name:"common-type-table",props:{reportConfig:{},queryParams:{},type:{},height:{}},setup(b,{expose:K}){const{loading:$,setLoading:V}=de(!1),y=h(),n=le({current:1,pageSize:30,total:0}),r=b,v=h(),C=h(),M=async()=>{const a={border:!0,align:null,size:"mini",height:"auto",columnConfig:{resizable:!0}};v.value={...a}},w=h([]),k=h([]),P=h([]),Y=h([]),B=h([]),f=a=>a?ve(Number(a),2):"-",x=oe(()=>{let a=0;return r.reportConfig&&r.reportConfig.statsMax&&(a+=1),r.reportConfig&&r.reportConfig.statsMin&&(a+=1),r.reportConfig&&r.reportConfig.statsAvg&&(a+=1),a}),G=a=>{let t="";switch(a){case"_max":t="\u6700\u5927\u503C";break;case"_min":t="\u6700\u5C0F\u503C";break;case"_avg":t="\u5E73\u5747\u503C";break}return t},q=(a,t,e)=>{var u,i;const d=G(e),o=[{field:`${a.name+e}Value`,title:"\u503C",width:t},{field:`${a.name+e}Value_ringValue`,title:"\u73AF\u6BD4\u503C",width:t},{field:`${a.name+e}Value_ringRatio`,title:"\u73AF\u6BD4\u6BD4\u7387",width:t}];return((u=r.queryParams)==null?void 0:u.period)!=="YEAR"&&((i=r.queryParams)==null?void 0:i.periodCompareType)&&o.push({field:`${a.name+e}Value_lastPeriodValue`,title:"\u540C\u6BD4\u503C",width:t},{field:`${a.name+e}Value_lastPeriodRatio`,title:"\u540C\u6BD4\u6BD4\u7387",width:t}),{title:d,columns:o}},H=(a,t,e)=>{var u,i;const d=G(e),o=[{field:`${a.name+e}Value`,title:d,width:t},{field:`${a.name+e}Value_ringValue`,title:"\u73AF\u6BD4\u503C",width:t},{field:`${a.name+e}Value_ringRatio`,title:"\u73AF\u6BD4\u6BD4\u7387",width:t}];return((u=r.queryParams)==null?void 0:u.period)!=="YEAR"&&((i=r.queryParams)==null?void 0:i.periodCompareType)&&o.push({field:`${a.name+e}Value_lastPeriodValue`,title:"\u540C\u6BD4\u503C",width:t},{field:`${a.name+e}Value_lastPeriodRatio`,title:"\u540C\u6BD4\u6BD4\u7387",width:t}),o},ee=async(a={...r.queryParams,page:n})=>{V(!0);try{a.itemTypeList=[r.type],C.value=await ye(r.reportConfig),w.value=[],me.filter(t=>{var e;return r.reportConfig&&r.reportConfig.monitorObjectTypeAttrs?((e=r.reportConfig.monitorObjectTypeAttrs)==null?void 0:e.indexOf(t.value))>-1:!1}).forEach(t=>{w.value.push({field:`${t.value}`,title:t.label,width:150})}),C.value&&C.value.forEach(t=>{w.value.push({field:`zbxHostInventory_${t.inventoryField}`,title:t.fieldName,width:150})}),k.value=[],r.reportConfig&&r.reportConfig.metricTags&&(k.value=r.reportConfig.metricTags.filter(e=>e.type===r.type).map(e=>{var o,u,i;const d=[];return(o=r.reportConfig)!=null&&o.statsMax&&d.push(...H(e,150,"_max")),(u=r.reportConfig)!=null&&u.statsMin&&d.push(...H(e,150,"_max")),(i=r.reportConfig)!=null&&i.statsAvg&&d.push(...H(e,150,"_avg")),{title:e.name,key:e.name,columns:d}})),x.value>1&&(P.value=[],r.reportConfig&&r.reportConfig.metricTags&&(P.value=r.reportConfig.metricTags.filter(t=>t.type===r.type).map(t=>{var d,o,u;const e=[];return x.value>1&&((d=r.reportConfig)!=null&&d.statsMax&&e.push(q(t,100,"_max")),(o=r.reportConfig)!=null&&o.statsMin&&e.push(q(t,100,"_min")),(u=r.reportConfig)!=null&&u.statsAvg&&e.push(q(t,100,"_avg"))),{title:t.name,key:t.name,columns:e}})))}catch(t){console.error(t)}finally{V(!1)}},D=h(),j=oe(()=>a=>{var t,e;return a.title==="\u73AF\u6BD4\u503C"&&((t=D.value)==null?void 0:t.ringRange.length)===2?`${W(D.value.ringRange[0])} ~ ${W(D.value.ringRange[1])}`:a.title==="\u540C\u6BD4\u503C"&&((e=D.value)==null?void 0:e.lastPeriodRange.length)===2?`${W(D.value.lastPeriodRange[0])} ~ ${W(D.value.lastPeriodRange[1])}`:""}),Q=async(a={...r.queryParams,page:n})=>{const t=y.value;try{if(V(!0),t){const{data:e}=await Ce(a);if(he(a).then(d=>{D.value=d.data}),B.value=e.content,await M(),e.content.length>0){e.content.forEach(o=>{if(o.statisticItemValueList.length>0)o.statisticItemValueList.forEach(u=>{u.itemDataList.forEach(i=>{let l={appKey:o.appKey,hostId:o.hostId};w.value.forEach(A=>{l[A.field]=o.fieldValues[A.field]}),l.itemKey=i.itemKeyTagValue||"-";const T=i.itemId,g=X.find(Y.value,{appKey:o.appKey,hostId:o.hostId});g?(l=g,l.itemIds.push(T)):l.itemIds=[T];const I=f(i.maxValue),_=f(i.minValue),Z=f(i.value);i.maxRatioValue&&(l[`${u.tagName}_maxValue_ringValue`]=f(i.maxRatioValue.value),l[`${u.tagName}_maxValue_ringRatio`]=i.maxRatioValue.ratio),i.maxLastPeriodRatioValue&&(l[`${u.tagName}_maxValue_lastPeriodValue`]=f(i.maxLastPeriodRatioValue.value),l[`${u.tagName}_maxValue_lastPeriodRatio`]=i.maxLastPeriodRatioValue.ratio),i.minRatioValue&&(l[`${u.tagName}_minValue_ringValue`]=f(i.minRatioValue.value),l[`${u.tagName}_minValue_ringRatio`]=i.minRatioValue.ratio),i.minLastPeriodRatioValue&&(l[`${u.tagName}_minValue_lastPeriodValue`]=f(i.minLastPeriodRatioValue.value),l[`${u.tagName}_minValue_lastPeriodRatio`]=i.minLastPeriodRatioValue.ratio),i.avgRatioValue&&(l[`${u.tagName}_avgValue_ringValue`]=f(i.avgRatioValue.value),l[`${u.tagName}_avgValue_ringRatio`]=i.avgRatioValue.ratio),i.avgLastPeriodRatioValue&&(l[`${u.tagName}_avgValue_lastPeriodValue`]=f(i.avgLastPeriodRatioValue.value),l[`${u.tagName}_avgValue_lastPeriodRatio`]=i.avgLastPeriodRatioValue.ratio),l[`${u.tagName}_maxValue`]=I,l[`${u.tagName}_minValue`]=_,l[`${u.tagName}_avgValue`]=Z,g||Y.value.push(l)})});else{const u={hostId:o.hostId};w.value.forEach(i=>{u[i.field]=o.fieldValues[i.field]}),Y.value.push(u)}});const d={};e.content.forEach(o=>{o.statisticItemValueList.forEach(u=>{d[u.tagName]||(d[u.tagName]=[]),d[u.tagName].push(...u.itemDataList.filter(i=>i.units).map(i=>i.units))})}),k.value.forEach(o=>{o.title=`${o.key} \u5355\u4F4D(${X.uniq(d[o.key])})`}),P.value.forEach(o=>{o.title=`${o.key} \u5355\u4F4D(${X.uniq(d[o.key])})`}),await t.loadData(Y.value)}}}catch(e){console.error(e)}finally{V(!1)}},z=async(a={...r.queryParams,page:n})=>{await ee(a),await Q(a)},te=()=>{n.current=1,Y.value=[];const a=y.value;a&&(a.clearScroll(),a.clearData(),a.loadData([])),z()},ae=async a=>{const{scrollTop:t,scrollHeight:e,bodyHeight:d,isY:o}=a;y.value&&o&&t+d+1>=e&&(n.current+=1,await Q(),B.value.length===0&&se.warning("\u6CA1\u6709\u66F4\u591A\u6570\u636E\u4E86~~"))};return K({fetchData:z,refreshData:te}),(a,t)=>{const e=J("vxe-column"),d=pe,o=ge,u=J("vxe-colgroup"),i=J("vxe-table");return p(),E("div",{style:ce([{height:a.height},{margin:"0 12px 6px 12px"}])},[c(i,fe({ref_key:"xGrid",ref:y,size:"mini",loading:ne($)},v.value,{onScroll:ae}),{default:s(()=>[(p(!0),E(N,null,L(w.value,(l,T)=>(p(),m(e,{key:T,field:l.field,title:l.title,width:l.width},{default:s(({row:g})=>[R(O(g[l.field]||"-"),1)]),_:2},1032,["field","title","width"]))),128)),x.value===1?(p(!0),E(N,{key:0},L(k.value,(l,T)=>(p(),m(u,{key:T,title:l.title},{default:s(()=>[(p(!0),E(N,null,L(l.columns,(g,I)=>(p(),m(e,{key:I,field:g.field,title:g.title,width:g.width},{header:s(({column:_})=>[U("span",null,O(_.title),1),c(o,{content:j.value(_)},{default:s(()=>[_.title==="\u73AF\u6BD4\u503C"||_.title==="\u540C\u6BD4\u503C"?(p(),m(d,{key:0,style:{cursor:"pointer"}})):F("",!0)]),_:2},1032,["content"])]),default:s(({row:_})=>[R(O(_[g.field]||"-"),1)]),_:2},1032,["field","title","width"]))),128))]),_:2},1032,["title"]))),128)):(p(!0),E(N,{key:1},L(P.value,(l,T)=>(p(),m(u,{key:T,title:l.title},{default:s(()=>[(p(!0),E(N,null,L(l.columns,(g,I)=>(p(),m(u,{key:I,title:g.title},{default:s(()=>[(p(!0),E(N,null,L(g.columns,(_,Z)=>(p(),m(e,{key:Z,field:_.field,title:_.title,width:_.width},{header:s(({column:A})=>[U("span",null,O(A.title),1),c(o,{content:j.value(A)},{default:s(()=>[A.title==="\u73AF\u6BD4\u503C"||A.title==="\u540C\u6BD4\u503C"?(p(),m(d,{key:0,style:{cursor:"pointer"}})):F("",!0)]),_:2},1032,["content"])]),default:s(({row:A})=>[R(O(A[_.field]||"-"),1)]),_:2},1032,["field","title","width"]))),128))]),_:2},1032,["title"]))),128))]),_:2},1032,["title"]))),128))]),_:1},16,["loading"])],4)}}}),et={key:0},tt=U("p",null," \u8BE5\u7C7B\u578B\u5305\u542B\u81EA\u52A8\u53D1\u73B0\u76D1\u63A7\u9879\u548C\u975E\u81EA\u52A8\u53D1\u73B0\u76D1\u63A7\u9879,\u65E0\u6CD5\u5C55\u793A\u6570\u636E,\u8BF7\u8054\u7CFB\u7BA1\u7406\u5458\u68C0\u67E5zabbix\u6807\u7B7E ",-1),at=ie({__name:"index",props:{reportConfig:{},queryParams:{}},setup(b,{expose:K}){const $=b,V=h(),y=h([]),n=()=>{$.reportConfig&&$.reportConfig.metricTags&&(y.value=X.uniq($.reportConfig.metricTags.map(v=>v.type))),ue(()=>{V.value&&V.value.forEach(v=>{v.refreshData()})})},r=v=>{if($.reportConfig&&$.reportConfig.metricTags){const C=$.reportConfig.metricTags.filter(k=>k.type===v),M=C.every(k=>k.discover==="true"),w=C.every(k=>k.discover==="false");return M?"lld":w?"common":"mixin"}return""};return K({refreshData:n}),(v,C)=>{const M=Ee,w=be,k=$e;return p(),m(k,{type:"card"},{default:s(()=>[(p(!0),E(N,null,L(y.value,(P,Y)=>(p(),m(w,{key:Y,title:P},{default:s(()=>[r(P)==="mixin"?(p(),E("div",et,[c(M,{type:"error"},{default:s(()=>[tt]),_:1})])):F("",!0),r(P)==="lld"?(p(),m(Xe,{key:1,ref_for:!0,ref_key:"mixinTypeTableRef",ref:V,height:"calc(100vh - 252px)","query-params":v.queryParams,"report-config":v.reportConfig,type:P},null,8,["query-params","report-config","type"])):F("",!0),r(P)==="common"?(p(),m(Je,{key:2,ref_for:!0,ref_key:"mixinTypeTableRef",ref:V,height:"calc(100vh - 252px)","query-params":v.queryParams,"report-config":v.reportConfig,type:P},null,8,["query-params","report-config","type"])):F("",!0)]),_:2},1032,["title"]))),128))]),_:1})}}});var Ve={exports:{}};(function(b,K){(function($,V){b.exports=V()})(ke,function(){return function($,V){V.prototype.weekday=function(y){var n=this.$locale().weekStart||0,r=this.$W,v=(r<n?r+7:r)-n;return this.$utils().u(y)?v:this.subtract(v,"day").add(y,"day")}}})})(Ve);const ot=Ve.exports,it=ie({__name:"index",emits:["getReportConfig"],setup(b,{emit:K}){S.extend(Pe),S.extend(ot),S.extend(Be);const $=Ue(),V=h(),y=h(),n=le({reportConfigId:$.query["report-config-id"],hoursPeriod:"ALL_DAY",period:"DAY",periodValue:S().format("YYYY-MM-DD"),periodCompareType:"WEEK"}),r=K,v=h("ALL_DAY"),C=()=>{ue(()=>{n.hoursPeriod=v.value,V.value.refreshData()})},M=async()=>{const B=(await We($.query["report-config-id"])).data;B&&(y.value=B,r("getReportConfig",B)),C()},w=B=>{if(B==="DAY")n.periodValue=S().format("YYYY-MM-DD");else if(B==="WEEK")n.periodValue=S().weekday(1).format("YYYY-MM-DD");else if(B==="MONTH")n.periodValue=S().format("YYYY-MM");else if(B==="QUARTER"){const f=S().startOf("quarter");n.periodValue=f.format("YYYY-MM")}else B==="YEAR"&&(n.periodValue=S().format("YYYY"));n.period==="DAY"?n.periodCompareType="WEEK":n.period!=="YEAR"?n.periodCompareType="YEAR":n.periodCompareType=void 0,C()},k=oe(()=>n.period==="DAY"?"\u65E5\u671F":n.period==="WEEK"?"\u5468":n.period==="MONTH"?"\u6708":n.period==="QUARTER"?"\u5B63\u5EA6":n.period==="YEAR"?"\u5E74":""),P=Re(),Y=async()=>{var B,f,x;se.loading("\u5DF2\u521B\u5EFA\u4E0B\u8F7D\u4EFB\u52A1\uFF0C\u5B8C\u6210\u540E\u6D4F\u89C8\u5668\u5C06\u81EA\u52A8\u4E0B\u8F7D\uFF01");try{P.addDownloadItem((B=y.value)==null?void 0:B.name),Qe(await Ze(n),`${(f=y.value)==null?void 0:f.name}.xlsx`),P.delDownloadItem((x=y.value)==null?void 0:x.name)}catch(G){console.error(G)}};return Ae(()=>$.query["report-config-id"],()=>{ue(()=>{M()})},{deep:!0,immediate:!0}),(B,f)=>{const x=De,G=Te,q=Fe,H=Ye,ee=Ne,D=Le,j=Me,Q=qe,z=Ie,te=Oe,ae=Ke,a=Ge,t=_e,e=Se,d=He;return p(),E("div",null,[c(d,null,{default:s(()=>[c(a,{span:22},{default:s(()=>[c(ae,{model:n,layout:"inline"},{default:s(()=>[c(q,{field:"period",label:"\u6BD4\u5BF9\u5468\u671F"},{default:s(()=>[c(G,{modelValue:n.period,"onUpdate:modelValue":f[0]||(f[0]=o=>n.period=o),placeholder:"\u8BF7\u9009\u62E9\u6BD4\u5BF9\u5468\u671F",style:{width:"100px"},onChange:w},{default:s(()=>[c(x,{value:"DAY"},{default:s(()=>[R("\u6309\u5929")]),_:1}),c(x,{value:"WEEK"},{default:s(()=>[R("\u6309\u5468")]),_:1}),c(x,{value:"MONTH"},{default:s(()=>[R("\u6309\u6708")]),_:1}),c(x,{value:"QUARTER"},{default:s(()=>[R("\u6309\u5B63\u5EA6")]),_:1}),c(x,{value:"YEAR"},{default:s(()=>[R("\u6309\u5E74")]),_:1})]),_:1},8,["modelValue"])]),_:1}),c(q,{field:"periodValue",label:k.value},{default:s(()=>[n.period==="DAY"?(p(),m(H,{key:0,modelValue:n.periodValue,"onUpdate:modelValue":f[1]||(f[1]=o=>n.periodValue=o),style:{width:"150px"},"value-format":"YYYY-MM-DD","default-value":ne(S)().format("YYYY-MM-DD"),onChange:C},null,8,["modelValue","default-value"])):F("",!0),n.period==="WEEK"?(p(),m(ee,{key:1,modelValue:n.periodValue,"onUpdate:modelValue":f[2]||(f[2]=o=>n.periodValue=o),style:{width:"150px"},"day-start-of-week":1,onChange:C},null,8,["modelValue"])):F("",!0),n.period==="MONTH"?(p(),m(D,{key:2,modelValue:n.periodValue,"onUpdate:modelValue":f[3]||(f[3]=o=>n.periodValue=o),style:{width:"150px"},onChange:C},null,8,["modelValue"])):F("",!0),n.period==="QUARTER"?(p(),m(j,{key:3,modelValue:n.periodValue,"onUpdate:modelValue":f[4]||(f[4]=o=>n.periodValue=o),style:{width:"150px"},onChange:C},null,8,["modelValue"])):F("",!0),n.period==="YEAR"?(p(),m(Q,{key:4,modelValue:n.periodValue,"onUpdate:modelValue":f[5]||(f[5]=o=>n.periodValue=o),style:{width:"150px"},onChange:C},null,8,["modelValue"])):F("",!0)]),_:1},8,["label"]),n.period!=="YEAR"?(p(),m(q,{key:0,label:"\u540C\u6BD4"},{default:s(()=>[c(G,{modelValue:n.periodCompareType,"onUpdate:modelValue":f[6]||(f[6]=o=>n.periodCompareType=o),placeholder:"\u8BF7\u9009\u62E9",style:{width:"120px"},"allow-clear":"",onChange:C},{default:s(()=>[n.period==="DAY"?(p(),E(N,{key:0},[c(x,{value:"WEEK"},{default:s(()=>[R("\u5468\u540C\u6BD4")]),_:1}),c(x,{value:"MONTH"},{default:s(()=>[R("\u6708\u540C\u6BD4")]),_:1}),c(x,{value:"YEAR"},{default:s(()=>[R("\u5E74\u540C\u6BD4")]),_:1})],64)):F("",!0),n.period==="WEEK"?(p(),E(N,{key:1},[c(x,{value:"MONTH"},{default:s(()=>[R("\u6708\u540C\u6BD4")]),_:1}),c(x,{value:"YEAR"},{default:s(()=>[R("\u5E74\u540C\u6BD4")]),_:1})],64)):F("",!0),n.period==="MONTH"||n.period==="QUARTER"?(p(),m(x,{key:2,value:"YEAR"},{default:s(()=>[R("\u5E74\u540C\u6BD4")]),_:1})):F("",!0)]),_:1},8,["modelValue"])]),_:1})):F("",!0),c(q,{label:"\u65F6\u95F4\u6BB5"},{default:s(()=>[c(te,{modelValue:v.value,"onUpdate:modelValue":f[7]||(f[7]=o=>v.value=o),onChange:C},{default:s(()=>[c(z,{value:"ALL_DAY"},{default:s(()=>[R("\u5168\u5929")]),_:1}),c(z,{value:"WORK_HOURS"},{default:s(()=>[R("\u5DE5\u4F5C\u65F6\u95F4\u6BB5")]),_:1}),c(z,{value:"NOT_WORK_HOURS"},{default:s(()=>[R("\u975E\u5DE5\u4F5C\u65F6\u95F4\u6BB5")]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1}),c(a,{span:2,style:{"text-align":"right"}},{default:s(()=>[c(e,null,{default:s(()=>[c(je,{onClick:C}),c(t,{type:"primary",onClick:Y},{default:s(()=>[R("\u5BFC\u51FA")]),_:1})]),_:1})]),_:1})]),_:1}),c(at,{ref_key:"horizontalDisplayAggregationRef",ref:V,"query-params":n,"report-config":y.value},null,8,["query-params","report-config"])])}}}),ut={class:"page-container"},rt={class:"page-panel",style:{height:"calc(100vh - 84px)"}},lt={style:{"border-bottom":"1px solid var(--color-border)","margin-bottom":"4px","padding-bottom":"4px",display:"flex","justify-content":"space-between","align-items":"center"}},nt={style:{width:"100%",display:"flex","justify-content":"space-between","align-items":"center"}},kt=ie({__name:"index",setup(b){const K=()=>{window.parent.history.state.back?xe.push({path:window.parent.history.state.back}):window.history.go(-1)},$=h(),V=y=>{$.value=y};return(y,n)=>{var M;const r=we,v=_e,C=ze;return p(),E("div",ut,[U("div",rt,[U("div",lt,[U("div",nt,[U("div",null,[c(v,{type:"text",onClick:K},{icon:s(()=>[c(r)]),default:s(()=>[R("\u8FD4\u56DE")]),_:1}),c(C,{direction:"vertical"}),R(" "+O((M=$.value)==null?void 0:M.name),1)])])]),c(it,{onGetReportConfig:V})])])}}});export{kt as default};
