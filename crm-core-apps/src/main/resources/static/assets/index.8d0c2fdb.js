import{a as le,as as mt,N as ht,aw as gt,ax as yt,_ as ve,b as kt,ay as bt,I as Dt,az as ne,l as te,aA as Ct,aB as He,h as ie}from"./index.e9d54774.js";/* empty css                *//* empty css                *//* empty css               */import{d as Y,f as o,r as Se,aT as Ie,D as h,E as j,aS as t,aI as e,aY as w,aW as U,u as G,aH as T,bz as Le,G as Te,aM as Ve,bt as ue,bB as je,c as Z,H as F,aZ as q,bN as J,bO as Q,aU as ae,aV as oe,bg as ee,aN as ce,ch as he,cm as Ce,ca as ge,a_ as Fe,ag as Ge,bV as xt,bW as Et,b0 as Oe,bq as pe,w as se,aQ as Me,cf as Rt,bo as Ue,aP as ye,bp as ze,bE as wt,a$ as Xe,aO as Ye,bf as Bt,o as Je,bL as Be,n as me,ah as Qe,b_ as et,h as Ne,bZ as fe,c3 as ke,c4 as be,c6 as xe,bI as tt,bJ as at,c7 as lt,c8 as ot,bK as Ae,bY as ut,bD as nt,O as It,N as Ft}from"./arco.a97fe066.js";import{g as Ot,t as we,c as At,s as $t,b as Nt,d as st,e as it,f as St,h as Ze,i as Lt,j as Tt,k as _e,u as Vt,l as jt,m as de,n as Gt}from"./role.255dbbaf.js";/* empty css                *//* empty css                *//* empty css               */import{s as Ee,d as Mt,e as Ut,w as ct,g as zt}from"./tree-util.a8ddc3e6.js";import{p as Pe}from"./pagination.72a5f225.js";import{b as rt}from"./bus.4c102fb6.js";/* empty css              *//* empty css                *//* empty css                */import{d as Re}from"./index.127a6572.js";import{S as Pt}from"./index.d4fbf381.js";/* empty css               */import{c as Kt}from"./color.562bf6e9.js";import{q as qt}from"./business.22e8b088.js";import{f as dt}from"./app-instance.ab836c4c.js";/* empty css               */import{q as Wt}from"./monitor-object.647fdfa2.js";import{c as vt}from"./host-group.ed397ed1.js";import{l as Ht}from"./model-group.e81e15b0.js";import"./chart.a235fbdf.js";import"./vue.4eb70094.js";import"./config-backup-device.df1a641e.js";const pt=Y({__name:"index",props:{height:{type:String,default:"0px"},actionName:{type:String,default:"\u79FB\u9664",required:!1}},emits:["getSelectUserIds","removeUserRole","adjustOrg"],setup(x,{expose:V,emit:g}){const{loading:n,setLoading:l}=le(!1),u=g,{pagination:c,pageSizeOptions:i}=Pe(),y=o(),D=o(),v=o({size:"mini",height:"auto",columnConfig:{resizable:!0},rowConfig:{keyField:"id",isHover:!0},checkboxConfig:{reserve:!0},showOverflow:"tooltip",columns:[{type:"checkbox",width:40},{title:"\u7528\u6237\u540D\u79F0",field:"username",minWidth:120},{title:"\u767B\u5F55\u540D\u79F0",field:"account",minWidth:120},{title:"\u90AE\u7BB1",minWidth:120,slots:{default:"mailList"}},{title:"\u624B\u673A",minWidth:120,slots:{default:"phoneList"}},{title:"\u4F01\u4E1A\u5FAE\u4FE1",minWidth:120,slots:{default:"wechatList"}},{title:"\u9489\u9489",minWidth:120,slots:{default:"dingdingList"}},{title:"\u90E8\u95E8",minWidth:120,slots:{default:"orgGroupList"}},{title:"\u64CD\u4F5C",width:120,fixed:"right",slots:{default:"action"}}]}),p=(s,_)=>{var m;return(m=s.mediasList)==null?void 0:m.filter(k=>k.type===_).map(k=>k.account).join(",")},r=o([]),a=()=>{r.value=[];const s=y.value;s&&s.clearCheckboxRow(),u("getSelectUserIds",r.value)},d=s=>{r.value=s;const _=y.value;_&&s.forEach(m=>{const k=_.getRowById(m);k&&_.setCheckboxRow(k,!0)})},f=async()=>{const s=y.value;s&&await s.reloadData([]),a()},$=()=>{r.value=[];const s=y.value;if(s){const _=s.getCheckboxRecords();_.push(...s.getCheckboxReserveRecords()),r.value=_.map(m=>m.id)}u("getSelectUserIds",r.value)},E=$,R=$;let I=Se({});const S=async(s={...I,page:c})=>{l(!0);try{const{data:_}=await ht(s);c.total=_.totalElements;const m=y.value;m&&await m.reloadData(_.content)}catch(_){console.error(_)}finally{l(!1)}},z=s=>{c.current=s,S()},W=s=>{c.pageSize=s,S()};return V({initData:async s=>{I=s,await S()},fetchData:S,clearSelect:a,clearTableData:f,selectUserIds:r,setSelect:d}),(s,_)=>{const m=Ve,k=ue,A=je,b=Ie("vxe-grid");return h(),j("div",{style:Te({height:x.height})},[t(b,Le({ref_key:"xGrid",ref:y,loading:G(n)},v.value,{onCheckboxChange:G(E),onCheckboxAll:G(R)}),{index:e(({rowIndex:B})=>[w(U(B+1+(G(c).current-1)*G(c).pageSize),1)]),phoneList:e(({row:B})=>[w(U(p(B,"phone")),1)]),wechatList:e(({row:B})=>[w(U(p(B,"wechat")),1)]),dingdingList:e(({row:B})=>[w(U(p(B,"dingding")),1)]),mailList:e(({row:B})=>[w(U(p(B,"mail")),1)]),orgGroupList:e(({row:B})=>[w(U(B.orgGroupList.map(L=>L.name).join(",")),1)]),status:e(({row:B})=>[B.status===G(mt).ENABLED?(h(),T(m,{key:0,status:"success"},{default:e(()=>[w(" \u5141\u8BB8 ")]),_:1})):(h(),T(m,{key:1,status:"danger"},{default:e(()=>[w("\u7981\u6B62")]),_:1}))]),action:e(({row:B})=>[t(k,null,{default:e(()=>[t(m,{onClick:L=>{u("removeUserRole",[B.id]),u("adjustOrg",B)}},{default:e(()=>[w(U(x.actionName),1)]),_:2},1032,["onClick"])]),_:2},1024)]),pager:e(()=>[t(A,{ref_key:"xPagination",ref:D,current:G(c).current,"page-size":G(c).pageSize,total:G(c).total,"page-size-options":G(i),style:{"padding-top":"10px"},"show-total":"","show-jumper":"","show-page-size":"",onChange:z,onPageSizeChange:W},null,8,["current","page-size","total","page-size-options"])]),_:1},16,["loading","onCheckboxChange","onCheckboxAll"])],4)}}}),Zt={style:{"font-weight":"bold","font-size":"16px","margin-bottom":"6px",display:"flex","justify-content":"space-between"}},Xt={key:0,style:{"font-weight":"normal","font-size":"14px"}},Yt={class:"selected-count"},Jt={class:"page-panel org-select-panel"},Qt={class:"page-panel org-select-panel"},ea=Y({__name:"index",props:{currentOrgDataNode:{}},setup(x,{expose:V}){const g=x,n=o(),l=async()=>{if(g.currentOrgDataNode){let S;g.currentOrgDataNode.key!=="0"&&(S=(await Ot(g.currentOrgDataNode.key)).data);const z={orgGroupIds:S};n.value&&n.value.initData(z)}},u=o([]),c=S=>{u.value=S},i=()=>{n.value.clearSelect()},y=()=>{n.value.clearTableData()},D=o(!1),v=()=>{u.value=n.value.selectUserIds,u.value.length===0?ee.warning({content:"\u8BF7\u9009\u62E9\u7528\u6237",duration:5*1e3}):D.value=!0},p=S=>{u.value=[S.id],D.value=!0},r=o([]),a=o([]),d=async()=>{r.value=(await we()).data,a.value=[]},f=async()=>{await gt({userIds:u.value,orgGroupIds:a.value}),D.value=!1,await l(),rt.emit("user-adjust-org-success-event",!0)},$=S=>{a.value=a.value.filter(z=>z!==S)},E=o(""),R=Z(()=>E.value?Ee(E.value,r.value):r.value),I=Z(()=>R.value.filter(S=>S.key!=="0"));return V({fetchData:l,clearSelect:i,clearTableData:y}),(S,z)=>{const W=yt,O=Ve,s=ce,_=ue,m=he,k=Ce,A=ge,b=Fe,B=Ge,L=xt,H=Et,M=Oe,C=pe;return h(),j(ae,null,[F("div",Zt,[F("div",null,[t(W),w(" \u90E8\u95E8\u6210\u5458 ")]),t(_,null,{default:e(()=>[u.value.length>0?(h(),j("span",Xt,[F("span",Yt,"\u5DF2\u9009\u62E9\u4E86"+U(u.value.length)+"\u6761",1),t(O,{onClick:i},{default:e(()=>[w("\u6E05\u7A7A")]),_:1})])):q("",!0),t(s,{type:"primary",disabled:u.value.length===0,onClick:v},{default:e(()=>[w(" \u8C03\u6574\u90E8\u95E8 ")]),_:1},8,["disabled"])]),_:1})]),t(C,{visible:D.value,width:"auto","title-align":"start","mask-closable":!1,draggable:"",onOk:f,onBeforeOpen:d,onCancel:z[2]||(z[2]=N=>D.value=!1)},{title:e(()=>[w("\u8C03\u6574\u90E8\u95E8")]),default:e(()=>[t(M,{style:{width:"800px"},gutter:12},{default:e(()=>[t(b,{span:12},{default:e(()=>[F("div",Jt,[t(m,{modelValue:E.value,"onUpdate:modelValue":z[0]||(z[0]=N=>E.value=N),"allow-clear":!0,style:{"margin-bottom":"8px"}},null,8,["modelValue"]),I.value.length>0?(h(),T(k,{key:0,ref:"treeRef","checked-keys":a.value,"onUpdate:checkedKeys":z[1]||(z[1]=N=>a.value=N),checkable:!0,"check-strictly":!0,"checked-strategy":"all",data:I.value},null,8,["checked-keys","data"])):q("",!0),J(t(A,null,null,512),[[Q,I.value.length===0]])])]),_:1}),t(b,{span:12},{default:e(()=>[F("div",Qt,[t(H,{size:"small"},{header:e(()=>[w("\u5DF2\u9009\u62E9")]),default:e(()=>[(h(!0),j(ae,null,oe(a.value,(N,K)=>(h(),T(L,{key:K},{actions:e(()=>[t(B,{onClick:P=>$(N)},null,8,["onClick"])]),default:e(()=>[w(" "+U(G(Mt)(r.value,N)),1)]),_:2},1024))),128))]),_:1})])]),_:1})]),_:1})]),_:1},8,["visible"]),t(pt,{ref_key:"userListRef",ref:n,height:"calc(100vh - 186px)","action-name":"\u8C03\u6574\u90E8\u95E8",onGetSelectUserIds:c,onAdjustOrg:p},null,512)],64)}}});const ta=ve(ea,[["__scopeId","data-v-aa7845b5"]]),aa={class:"page-panel-no-padding",style:{height:"calc(100vh - 84px)","overflow-y":"auto"}},la=Y({__name:"index",props:{currentOrgDataNode:{}},setup(x,{expose:V}){const g=x,n=o();se(()=>g.currentOrgDataNode,i=>{n.value=i},{deep:!0,immediate:!0});const l=o();return V({initOrgMemberTableData:()=>{g.currentOrgDataNode&&l.value.fetchData(),l.value.clearSelect()},clearOrgMemberTableData:()=>{l.value.clearTableData()}}),(i,y)=>{const D=Me;return h(),j("div",aa,[t(D,{"header-style":{height:"40px"},"body-style":{padding:"12px"},bordered:!1},{title:e(()=>{var v;return[w(U((v=n.value)==null?void 0:v.title),1)]}),default:e(()=>[t(ta,{ref_key:"orgMemberRef",ref:l,"current-org-data-node":i.currentOrgDataNode},null,8,["current-org-data-node"])]),_:1})])}}}),oa=Y({__name:"index",props:{currentOrgDataNode:{},visible:{type:Boolean,default:!1}},emits:["ok","cancel"],setup(x,{emit:V}){const g=x,n=o(),l=o({id:"",pid:"",name:"",description:""}),u=o(""),c=o([]),i=async()=>{var a,d,f,$;l.value.id=(a=g.currentOrgDataNode)==null?void 0:a.key,l.value.pid=(d=g.currentOrgDataNode)==null?void 0:d.pid,l.value.name=(f=g.currentOrgDataNode)==null?void 0:f.title,u.value=($=g.currentOrgDataNode)==null?void 0:$.title;const r=(await At()).data;r.length>0&&(c.value=Ut(l.value.id,r.filter(E=>E.value!=="0")))},y=V,D=async()=>{if(!await n.value.validate())await $t(l.value),ee.success("\u63D0\u4EA4\u6210\u529F");else return console.warn("\u9A8C\u8BC1\u4E0D\u901A\u8FC7"),!1;return y("ok",l.value),!0},v=Re(async(r,a)=>{if(r!==u.value){const{data:d}=await Nt(l.value);d&&a("\u90E8\u95E8\u5DF2\u5B58\u5728")}},500),p=()=>{y("cancel")};return(r,a)=>{const d=Rt,f=Ue,$=ye,E=ze,R=pe;return h(),T(R,{"unmount-on-close":"",visible:r.visible,width:"auto","mask-closable":!1,draggable:"","title-align":"start","on-before-ok":D,onCancel:p,onBeforeOpen:i},{title:e(()=>[w(U(r.currentOrgDataNode?"\u7F16\u8F91\u90E8\u95E8":"\u6DFB\u52A0\u90E8\u95E8"),1)]),default:e(()=>[F("div",null,[t(E,{ref_key:"submitFormRef",ref:n,model:l.value,style:{width:"500px"}},{default:e(()=>[l.value.id!=="0"?(h(),T(f,{key:0,field:"pid",label:"\u4E0A\u7EA7\u90E8\u95E8"},{default:e(()=>[t(d,{modelValue:l.value.pid,"onUpdate:modelValue":a[0]||(a[0]=I=>l.value.pid=I),"check-strictly":"",options:c.value},null,8,["modelValue","options"])]),_:1})):q("",!0),t(f,{field:"name",label:"\u540D\u79F0",rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u540D\u79F0"},{validator:G(v)}],"validate-trigger":"blur"},{default:e(()=>[t($,{modelValue:l.value.name,"onUpdate:modelValue":a[1]||(a[1]=I=>l.value.name=I),"max-length":"64","show-word-limit":""},null,8,["modelValue"])]),_:1},8,["rules"])]),_:1},8,["model"])])]),_:1},8,["visible"])}}}),ua=Y({__name:"role-group-form",props:{visible:{type:Boolean,default:!1},currentRoleGroupDataNode:{}},emits:["ok","cancel"],setup(x,{emit:V}){const g=x,n=V,l=o({pid:"0",name:"",isGroup:!0}),u=o(""),c=()=>{n("cancel")},i=o(),{loading:y,setLoading:D}=le(!1),v=()=>{g.currentRoleGroupDataNode?(l.value={id:g.currentRoleGroupDataNode.key,name:g.currentRoleGroupDataNode.title,pid:g.currentRoleGroupDataNode.pid},u.value=g.currentRoleGroupDataNode.title):(l.value={pid:"0",name:"",isGroup:!0},u.value="")},p=Re(async(a,d)=>{if(a!==u.value){l.value.isGroup=!0;const{data:f}=await st(l.value);f&&d("\u89D2\u8272\u7EC4\u5DF2\u5B58\u5728")}},500),r=async()=>{const a=await i.value.validate();try{a?console.warn("\u9A8C\u8BC1\u4E0D\u901A\u8FC7"):(D(!0),await it(l.value),ee.success("\u63D0\u4EA4\u6210\u529F"),D(!1),n("ok",l.value))}catch(d){console.error(d)}finally{D(!1)}};return(a,d)=>{const f=ye,$=Ue,E=ze,R=ce,I=ue,S=pe;return h(),T(S,{"unmount-on-close":"",visible:a.visible,width:"500","title-align":"start","mask-closable":!1,draggable:"","ok-loading":G(y),onCancel:c,onOk:r,onBeforeOpen:v},{title:e(()=>[w(U(l.value.id?"\u7F16\u8F91":"\u65B0\u589E")+"\u89D2\u8272\u7EC4",1)]),footer:e(()=>[l.value.id?(h(),T(I,{key:0},{default:e(()=>[t(R,{onClick:c},{default:e(()=>[w("\u53D6\u6D88")]),_:1}),t(R,{type:"primary",loading:G(y),onClick:r},{default:e(()=>[w(" \u786E\u5B9A ")]),_:1},8,["loading"])]),_:1})):q("",!0)]),default:e(()=>[t(E,{ref_key:"submitFormRef",ref:i,model:l.value},{default:e(()=>[t($,{field:"name",label:"\u540D\u79F0",rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u540D\u79F0"},{validator:G(p)}],"validate-trigger":"blur"},{default:e(()=>[t(f,{modelValue:l.value.name,"onUpdate:modelValue":d[0]||(d[0]=z=>l.value.name=z),"max-length":"64","show-word-limit":""},null,8,["modelValue"])]),_:1},8,["rules"])]),_:1},8,["model"])]),_:1},8,["visible","ok-loading"])}}}),na={key:0},sa={key:1},ia=Y({__name:"role-form",props:{visible:{type:Boolean,default:!1},isEdit:{type:Boolean,default:!1},currentRoleDataNode:{}},emits:["ok","cancel"],setup(x,{emit:V}){const g=x,n=V,l=o({pid:"",name:"",isGroup:!1,readOnly:!1}),u=()=>{n("cancel")},c=o(""),i=o(),{loading:y,setLoading:D}=le(!1),v=o([]),p=async()=>{const{data:d}=await St();d.length>0&&(v.value=d.filter(f=>f.id!=="1")),g.isEdit&&g.currentRoleDataNode?(l.value={id:g.currentRoleDataNode.key,name:g.currentRoleDataNode.title,pid:g.currentRoleDataNode.pid,readOnly:g.currentRoleDataNode.data.readOnly||!1},c.value=g.currentRoleDataNode.title):(l.value={name:"",isGroup:!1,pid:"",readOnly:!1},c.value="")},r=Re(async(d,f)=>{if(d!==c.value){l.value.isGroup=!1;const{data:$}=await st(l.value);$&&f("\u89D2\u8272\u5DF2\u5B58\u5728")}},500),a=async()=>{const d=await i.value.validate();try{if(d)console.warn("\u9A8C\u8BC1\u4E0D\u901A\u8FC7");else{console.log(l.value),D(!0);const{data:f}=await it(l.value);ee.success("\u63D0\u4EA4\u6210\u529F"),D(!1),n("ok",f,l.value)}}catch(f){console.error(f)}finally{D(!1)}};return(d,f)=>{const $=wt,E=Xe,R=Ye,I=Ue,S=ye,z=Bt,W=ze,O=ce,s=ue,_=pe;return h(),T(_,{"unmount-on-close":"",visible:d.visible,width:"500","title-align":"start","mask-closable":!1,draggable:"","ok-loading":G(y),onCancel:u,onOk:a,onBeforeOpen:p},{title:e(()=>[w(U(l.value.id?"\u7F16\u8F91":"\u65B0\u589E")+"\u89D2\u8272",1)]),footer:e(()=>[l.value.id?(h(),T(s,{key:0},{default:e(()=>[t(O,{onClick:u},{default:e(()=>[w("\u53D6\u6D88")]),_:1}),t(O,{type:"primary",loading:G(y),onClick:a},{default:e(()=>[w(" \u786E\u5B9A ")]),_:1},8,["loading"])]),_:1})):q("",!0)]),default:e(()=>[t(W,{ref_key:"submitFormRef",ref:i,model:l.value},{default:e(()=>[t(I,{field:"pid",label:"\u89D2\u8272\u7EC4",rules:[{required:!0,message:"\u8BF7\u9009\u62E9\u89D2\u8272\u7EC4"}],"validate-trigger":"blur"},{default:e(()=>[t(R,{modelValue:l.value.pid,"onUpdate:modelValue":f[0]||(f[0]=m=>l.value.pid=m)},{default:e(()=>[(h(!0),j(ae,null,oe(v.value,(m,k)=>(h(),T(E,{key:k,value:m.id},{default:e(()=>[m.name.length>22?(h(),j("div",na,[t($,{content:m.name},{default:e(()=>[F("span",null,U(m.name.slice(0,22)+"..."),1)]),_:2},1032,["content"])])):(h(),j("span",sa,U(m.name),1))]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(I,{field:"name",label:"\u89D2\u8272\u540D\u79F0",rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u540D\u79F0"},{validator:G(r)}],"validate-trigger":"blur"},{default:e(()=>[t(S,{modelValue:l.value.name,"onUpdate:modelValue":f[1]||(f[1]=m=>l.value.name=m),"max-length":"64","show-word-limit":""},null,8,["modelValue"])]),_:1},8,["rules"]),t(I,{field:"readOnly",label:"\u53EA\u8BFB"},{default:e(()=>[t(z,{modelValue:l.value.readOnly,"onUpdate:modelValue":f[2]||(f[2]=m=>l.value.readOnly=m),type:"line"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["visible","ok-loading"])}}}),ca={style:{height:"calc(100vh - 164px)"}},ra=["onMouseenter","onMouseleave"],da={key:0,style:{right:"8px"}},va={style:{position:"absolute",bottom:"0",width:"100%","text-align":"center","border-top":"var(--color-border) 1px solid",padding:"10px 0 0 0"}},pa=Y({__name:"index",props:{initRoleDataNode:{}},emits:["getCurrentRoleNode"],setup(x,{expose:V,emit:g}){const n=o(""),l=o(),u=x,c=o(),i=o(),y=o([]),D=o(),v=o([]),p=g,{isSuperAdmin:r}=kt(),a=async()=>{y.value=(await Ze()).data,r||(y.value=y.value.filter(m=>m.key!=="1")),y.value.length>0&&!D.value&&(D.value=y.value[0],v.value=y.value.map(m=>m.key),await me(()=>{u.initRoleDataNode?(l.value.selectNode([u.initRoleDataNode.key],!0),i.value=u.initRoleDataNode,p("getCurrentRoleNode",i.value)):D.value&&D.value.children&&D.value.children.length>0&&(l.value.selectNode([D.value.children[0].key],!0),i.value=D.value.children[0],p("getCurrentRoleNode",i.value))}))},d=async()=>{y.value=(await Ze()).data,y.value.length>0?(D.value=y.value[0],v.value=y.value.map(m=>m.key),D.value&&D.value.children&&D.value.children.length>0&&(l.value.selectNode([D.value.children[0].key],!0),i.value=D.value.children[0],p("getCurrentRoleNode",i.value))):i.value=void 0},f=Z(()=>n.value?Ee(n.value,y.value):y.value),$=o(!1),E=o(!1),R=o(!1),I=(m,k)=>{m.showExtra=k},S=m=>{m.pid==="0"?(c.value=m,$.value=!0):(i.value=m,E.value=!0,R.value=!0)},z=m=>{let k="\u89D2\u8272";m.data.isGroup&&(k="\u89D2\u8272\u7EC4"),pe.confirm({title:"\u63D0\u793A",simple:!1,draggable:!0,titleAlign:"start",content:`\u6B64\u64CD\u4F5C\u5C06\u6C38\u4E45\u5220\u9664'${m==null?void 0:m.title}'${k} , \u662F\u5426\u7EE7\u7EED?`,okText:"\u786E\u5B9A",async onOk(){try{m&&(await Lt(m.key),await d(),ee.success("\u5220\u9664\u6210\u529F"))}catch{ee.error("\u5220\u9664\u5931\u8D25")}}})},W=(m,k)=>{k.node&&(k.node.pid==="0"?D.value=k.node:(i.value=k.node,p("getCurrentRoleNode",k.node)))},O=()=>{$.value=!0,c.value=void 0},s=()=>{E.value=!0,R.value=!1};Je(()=>{a()});const _=async()=>{E.value=!1,await a(),await me(()=>{l.value.getSelectedNodes()&&l.value.getSelectedNodes().length>0&&(i.value=l.value.getSelectedNodes()[0],p("getCurrentRoleNode",i.value))})};return V({initData:a}),(m,k)=>{const A=he,b=bt,B=Dt,L=Qe,H=ce,M=Ge,C=Ce,N=ge,K=et,P=ue;return h(),j("div",ca,[t(A,{modelValue:n.value,"onUpdate:modelValue":k[0]||(k[0]=X=>n.value=X),"allow-clear":!0,placeholder:"\u8BF7\u8F93\u5165\u89D2\u8272\u540D\u79F0\u641C\u7D22",style:{"margin-bottom":"8px"}},null,8,["modelValue"]),t(K,{style:{height:"calc(100vh - 252px)",overflow:"auto"}},{default:e(()=>[f.value.length>0?(h(),T(C,{key:0,ref_key:"treeRef",ref:l,"selected-keys":i.value?[i.value.key]:[],"block-node":"","default-expanded-keys":v.value,data:f.value,"action-on-node-click":"expand",onSelect:W},{title:e(X=>[F("div",{style:{height:"24px",width:"58vw",display:"flex","align-items":"center","white-space":"nowrap"},onMouseenter:De=>I(X,!0),onMouseleave:De=>I(X,!1)},[F("div",null,[X.pid==="0"?(h(),T(b,{key:0})):(h(),T(B,{key:1})),w(" "+U(X.title)+" "+U(X.data.readOnly?"(\u53EA\u8BFB)":""),1)]),X.showExtra?(h(),j("div",da,[X.data.isBuiltin?q("",!0):(h(),T(H,{key:0,type:"text",size:"mini",onClick:Be(De=>S(X),["stop"])},{icon:e(()=>[t(L)]),_:2},1032,["onClick"])),X.data.isBuiltin?q("",!0):(h(),T(H,{key:1,type:"text",size:"mini",onClick:Be(De=>z(X),["stop"])},{icon:e(()=>[t(M)]),_:2},1032,["onClick"]))])):q("",!0)],40,ra)]),_:1},8,["selected-keys","default-expanded-keys","data"])):q("",!0),J(t(N,null,null,512),[[Q,y.value.length===0]])]),_:1}),F("div",va,[t(P,null,{default:e(()=>[t(H,{size:"mini",onClick:O},{default:e(()=>[t(b),w(" \u6DFB\u52A0\u89D2\u8272\u7EC4 ")]),_:1}),t(H,{size:"mini",onClick:s},{default:e(()=>[t(B),w(" \u6DFB\u52A0\u89D2\u8272 ")]),_:1})]),_:1})]),t(ua,{visible:$.value,"current-role-group-data-node":c.value,onCancel:k[1]||(k[1]=X=>$.value=!1),onOk:k[2]||(k[2]=X=>{$.value=!1,a()})},null,8,["visible","current-role-group-data-node"]),t(ia,{"is-edit":R.value,visible:E.value,"current-role-data-node":i.value,onCancel:k[3]||(k[3]=X=>E.value=!1),onOk:_},null,8,["is-edit","visible","current-role-data-node"])])}}}),fa={key:0},_a={class:"selected-count"},ma=Y({__name:"0-user-perm",props:{roleId:{},roleName:{}},setup(x,{expose:V}){const g=x,n=o(),l=async()=>{if(g.roleId){const D={userRoleId:g.roleId};n.value&&n.value.initData(D)}},u=o([]),c=D=>{u.value=D},i=()=>{n.value.clearSelect()};se(()=>g.roleId,()=>{l()},{deep:!0,immediate:!0});const y=async D=>{pe.confirm({title:"\u63D0\u793A",simple:!1,draggable:!0,closable:!1,content:()=>Ne("div",{},[Ne("span",{},["\u6B64\u64CD\u4F5C\u5C06\u79FB\u9664 ",Ne("span",{style:`font-size: 20px;font-weight: bolder;color: ${Kt("danger-6")}`},D.length),` \u4E2A\u7528\u6237\u7684'${g.roleName}'\u89D2\u8272, \u662F\u5426\u7EE7\u7EED?`])]),titleAlign:"start",async onOk(){const v={userIds:D,flushRoleId:g.roleId},{data:p}=await Tt(v),r=p.failure?p.failure.length:0,a=p.success?p.success.length:0;r>0?D.length===1?ee.error("\u7528\u6237\u5E94\u81F3\u5C11\u5305\u542B\u4E00\u4E2A\u89D2\u8272"):a===0?ee.error(`\u79FB\u9664\u5931\u8D25${r}\u4E2A\u7528\u6237,\u7528\u6237\u5E94\u81F3\u5C11\u5305\u542B\u4E00\u4E2A\u89D2\u8272`):(ee.error(`\u79FB\u9664\u5931\u8D25${r}\u4E2A\u7528\u6237,\u79FB\u9664\u6210\u529F${a}\u4E2A\u7528\u6237,\u7528\u6237\u5E94\u81F3\u5C11\u5305\u542B\u4E00\u4E2A\u89D2\u8272`),await n.value.fetchData(),u.value=u.value.filter(d=>!p.success.includes(d)),u.value.length>0&&n.value&&n.value.setSelect(u.value)):(ee.success("\u79FB\u9664\u6210\u529F"),await n.value.fetchData(),u.value=u.value.filter(d=>!D.includes(d)),u.value.length>0&&n.value&&n.value.setSelect(u.value))}})};return V({clearSelect:i}),(D,v)=>{const p=Ve,r=ue;return h(),j("div",null,[t(r,{style:{display:"flex",width:"100%","justify-content":"flex-end"}},{default:e(()=>[u.value.length>0?(h(),j("span",fa,[F("span",_a,"\u5DF2\u9009\u62E9\u4E86"+U(u.value.length)+"\u6761",1),t(p,{onClick:i},{default:e(()=>[w("\u6E05\u7A7A")]),_:1})])):q("",!0),t(p,{disabled:u.value.length===0,onClick:v[0]||(v[0]=a=>y(u.value))},{default:e(()=>[w(" \u79FB\u9664 ")]),_:1},8,["disabled"])]),_:1}),t(pt,{ref_key:"userListRef",ref:n,height:"calc(100vh - 228px)",onGetSelectUserIds:c,onRemoveUserRole:y},null,512)])}}}),ha={style:{height:"calc(100vh - 292px)","overflow-y":"auto","border-bottom":"1px solid var(--color-border-2)"}},ga={class:"check-all"},ya={style:{display:"flex","justify-content":"center","margin-top":"10px"}},ka=Y({__name:"1-menu-perm",props:{roleId:{}},setup(x,{expose:V}){const g=x,n=o(""),l=o(),u=o(),c=o(!1),i=o(!1),y=Z(()=>ne(g.roleId)),{loading:D,setLoading:v}=le(!1),p=o([]),r=Z(()=>n.value?Ee(n.value,te.cloneDeep(p.value)):te.cloneDeep(p.value)),a=o([]),d=o([]),f=o([]),$=o(0),E=Z(()=>ne(g.roleId)),R=b=>{b.length===$.value?(c.value=!0,i.value=!1):b.length===0?(c.value=!1,i.value=!1):(c.value=!1,i.value=!0)},I=(b,B)=>{B.push(b.key),b.children&&b.children.length>0&&b.children.forEach(L=>{I(L,B)})},S=()=>{const b=[];p.value.forEach(B=>{I(B,b)}),a.value=b,d.value=b},z=(b,B)=>{if(b.children&&b.children.length>0){let L=!0;a.value.indexOf(b.key)!==-1&&b.children.forEach(H=>{a.value.indexOf(H.key)===-1&&(L=!1)}),L||B.push(...zt(p.value,b.key)),b.children.forEach(H=>{z(H,B)})}},W=()=>{const b=[];return p.value.forEach(B=>{z(B,b)}),b},O=async()=>{if(g.roleId){if(E.value)S();else{const{data:b}=await jt(g.roleId);a.value=b.map(L=>L.menuName);const B=W();a.value=a.value.filter(L=>!B.includes(L)),d.value=b.map(L=>L.menuName)}f.value=te.cloneDeep(a.value),R(a.value)}},s=(b,B)=>{const L=B.node.key;u.value.checkNode(L,B.checked,!1),a.value=te.cloneDeep(d.value),R(a.value)},_=async()=>{const b=(await Ct(g.roleId)).data;p.value=b.filter(L=>{if(L.key==="dashboard")return!1;if(!y.value){if(He.includes(L.key))return!1;L.children&&L.children.length>0&&(L.children=L.children.filter(H=>!He.includes(H.key)))}return!0});let B=0;ct(p.value,()=>{B+=1}),$.value=B,await O()},m=async()=>{if(d.value.length>0)try{v(!0),await Vt({roleId:g.roleId,menuNames:d.value}),f.value=te.cloneDeep(d.value),ee.success("\u4FDD\u5B58\u6210\u529F")}catch(b){console.error(b)}finally{v(!1)}else ee.warning("\u6CA1\u6709\u9009\u4E2D\u4EFB\u4F55\u83DC\u5355")},k=()=>{_()},A=b=>{i.value=!1,b?(c.value=!0,S()):(c.value=!1,a.value=[],d.value=[]),R(a.value)};return se(()=>g.roleId,b=>{b&&_()},{immediate:!0}),V({checkDataChange:()=>_e(f.value,d.value),handleReset:k}),(b,B)=>{const L=he,H=fe,M=Ce,C=ge,N=ce,K=ue;return h(),j("div",null,[t(L,{modelValue:n.value,"onUpdate:modelValue":B[0]||(B[0]=P=>n.value=P),"allow-clear":!0,placeholder:"\u8BF7\u8F93\u5165\u83DC\u5355\u540D\u79F0\u641C\u7D22",style:{"margin-bottom":"8px"}},null,8,["modelValue"]),F("div",ha,[F("div",ga,[t(H,{"model-value":c.value,disabled:y.value,indeterminate:i.value,onChange:A},{default:e(()=>[w(" \u5168\u9009 ")]),_:1},8,["model-value","disabled","indeterminate"])]),r.value.length>0?(h(),T(M,{key:0,ref_key:"treeRef",ref:l,"checked-keys":a.value,"onUpdate:checkedKeys":B[1]||(B[1]=P=>a.value=P),checkable:!0,"block-node":"",data:r.value,"default-expand-all":!0,onCheck:s},null,8,["checked-keys","data"])):q("",!0),J(t(C,null,null,512),[[Q,p.value.length===0]]),J(t(M,{ref_key:"hiddenTreeRef",ref:u,"checked-keys":d.value,"onUpdate:checkedKeys":B[2]||(B[2]=P=>d.value=P),checkable:!0,"block-node":"",data:p.value},null,8,["checked-keys","data"]),[[Q,!1]])]),J(F("div",ya,[t(K,null,{default:e(()=>[t(N,{onClick:k},{default:e(()=>[w("\u91CD\u7F6E")]),_:1}),t(N,{type:"primary",loading:G(D),onClick:m},{default:e(()=>[w(" \u786E\u5B9A ")]),_:1},8,["loading"])]),_:1})],512),[[Q,!E.value]])])}}});const ba=ve(ka,[["__scopeId","data-v-11b152f9"]]);function Da(x){return ie.get(`/sysRoleMonitorData/getAssignedBusinessDataByRoleId/${x}`)}function Ca(x){return ie.get(`/sysRoleMonitorData/getAssignedCategoryDataByRoleId/${x}`)}function xa(x){return ie.get(`/sysRoleMonitorData/getAssignedGroupDataByRoleId/${x}`)}function Ea(x){return ie.get(`/sysRoleMonitorData/getAssignedTagDataByRoleId/${x}`)}function Ra(x){return ie.get(`/sysRoleMonitorData/getAssignMonitorObjectByRoleId/${x}`)}function wa(x){return ie.post("/sysRoleMonitorData/assignDataByBusiness",x)}function Ba(x){return ie.post("/sysRoleMonitorData/assignDataByCategory",x)}function Ia(x){return ie.post("/sysRoleMonitorData/assignDataByGroup",x)}function Fa(x){return ie.post("/sysRoleMonitorData/assignDataByTag",x)}function Oa(x){return ie.post("/sysRoleMonitorData/assignDataByMonitorObject",x)}const Aa={style:{height:"calc(100vh - 350px)","overflow-y":"auto","border-bottom":"1px solid var(--color-border-2)"}},$a={class:"check-all"},Na={style:{display:"flex","justify-content":"center","margin-top":"10px"}},Sa=Y({__name:"index",props:{roleId:{}},setup(x,{expose:V}){const g=x,n=o(""),l=o(),u=o(),c=o(!1),i=o(!1),y=Z(()=>ne(g.roleId)),{loading:D,setLoading:v}=le(!1),p=o([]),r=Z(()=>n.value?Ee(n.value,p.value.filter(m=>m.key!=="0")):p.value.filter(m=>m.key!=="0")),a=Z(()=>{let m=0;return ct(r.value,()=>{m+=1}),m}),d=o([]),f=o([]),$=o([]),E=Z(()=>ne(g.roleId)),R=m=>{m.length===a.value?(c.value=!0,i.value=!1):m.length===0?(c.value=!1,i.value=!1):(c.value=!1,i.value=!0)},I=(m,k)=>{const A=[];return m.forEach(b=>{k&&b.key!=="0"&&A.push(b.key),b.children&&b.children.length>0&&I(b.children,!0).forEach(B=>A.push(B))}),A},S=async()=>{if(g.roleId){if(E.value){const m=I(p.value,!0);f.value=m,d.value=m}else{const{data:m}=await Da(g.roleId);f.value=m,d.value=m}$.value=te.cloneDeep(f.value),R(f.value)}},z=(m,k)=>{const A=k.node.key;u.value.checkNode(A,k.checked,!1),f.value=te.cloneDeep(d.value),R(f.value)},W=async()=>{p.value=(await qt({onlyFolder:!1,roleId:g.roleId})).data,await S()},O=async()=>{try{v(!0),await wa({roleId:g.roleId,businessIds:d.value}),ee.success("\u76EE\u5F55\u6743\u9650\u5206\u914D\u6210\u529F"),$.value=te.cloneDeep(d.value)}catch(m){console.error(m)}finally{v(!1)}},s=()=>{f.value=te.cloneDeep($.value),d.value=te.cloneDeep($.value)},_=m=>{if(i.value=!1,m){c.value=!0;const k=I(p.value,!0);f.value=k,d.value=k}else c.value=!1,f.value=[],d.value=[]};return V({initData:W,checkDataChange:()=>_e($.value,d.value),handleReset:s}),(m,k)=>{const A=he,b=fe,B=Ce,L=ge,H=ce,M=ue;return h(),j("div",null,[t(A,{modelValue:n.value,"onUpdate:modelValue":k[0]||(k[0]=C=>n.value=C),"allow-clear":!0,placeholder:"\u8BF7\u8F93\u5165\u76EE\u5F55\u6216\u8282\u70B9\u540D\u79F0\u641C\u7D22",style:{"margin-bottom":"8px"}},null,8,["modelValue"]),F("div",Aa,[F("div",$a,[t(b,{"model-value":c.value,indeterminate:i.value,disabled:y.value,onChange:_},{default:e(()=>[w(" \u5168\u9009 ")]),_:1},8,["model-value","indeterminate","disabled"])]),r.value.length>0?(h(),T(B,{key:0,ref_key:"treeRef",ref:l,"checked-keys":f.value,"onUpdate:checkedKeys":k[1]||(k[1]=C=>f.value=C),checkable:!0,"block-node":"",data:r.value,"default-expand-all":!0,onCheck:z},null,8,["checked-keys","data"])):q("",!0),J(t(L,null,null,512),[[Q,p.value.length===0]]),J(t(B,{ref_key:"hiddenTreeRef",ref:u,"checked-keys":d.value,"onUpdate:checkedKeys":k[2]||(k[2]=C=>d.value=C),checkable:!0,"block-node":"",data:p.value,"default-expand-all":!0},null,8,["checked-keys","data"]),[[Q,!1]])]),J(F("div",Na,[t(M,null,{default:e(()=>[t(H,{onClick:s},{default:e(()=>[w("\u91CD\u7F6E")]),_:1}),t(H,{type:"primary",loading:G(D),onClick:O},{default:e(()=>[w(" \u786E\u5B9A ")]),_:1},8,["loading"])]),_:1})],512),[[Q,!E.value]])])}}});const La=ve(Sa,[["__scopeId","data-v-6a9004bd"]]),Ke=x=>(tt("data-v-ea9ea47c"),x=x(),at(),x),Ta={key:0,class:"type-group"},Va=Ke(()=>F("div",{class:"subtitle"},"\u5206\u7EC4",-1)),ja={class:"item"},Ga={key:1,class:"type-group"},Ma=Ke(()=>F("div",{class:"subtitle"},"\u6807\u7B7E",-1)),Ua={class:"item"},za={key:2,class:"type-group"},Pa=Ke(()=>F("div",{class:"subtitle"},"\u5B50\u7C7B\u578B",-1)),Ka={class:"item"},qa=Y({__name:"index",props:{item:{},appMap:{}},emits:["setCategoryConditionAssignRoleData"],setup(x,{emit:V}){const g=x,n=o([]),l=o([]),u=o([]),c=V,i=Z(()=>({categoryName:g.item.label,categoryCode:g.item.value,conditionType:"CONDITION",groups:n.value,tags:l.value,subtypes:u.value})),y=()=>{c("setCategoryConditionAssignRoleData",i.value)},D=()=>{n.value=[],Object.keys(g.item.groups).forEach(v=>{g.item.groups[v].filter(p=>p.selected).forEach(p=>{n.value.push(`${p.appKey}/${p.value}`)})}),l.value=g.item.tags.filter(v=>v.selected).map(v=>v.value),u.value=g.item.subtypes.filter(v=>v.selected).map(v=>v.value),y()};return se(()=>g.item,()=>{D()},{immediate:!0,deep:!0}),(v,p)=>{const r=fe,a=ke,d=be,f=xe,$=ge;return h(),j("div",null,[v.item.groups&&Object.keys(v.item.groups).length>0?(h(),j("div",Ta,[Va,F("div",ja,[Object.keys(v.item.groups).length>1?(h(),T(f,{key:0,modelValue:n.value,"onUpdate:modelValue":p[0]||(p[0]=E=>n.value=E),onChange:y},{default:e(()=>[t(d,null,{default:e(()=>[(h(!0),j(ae,null,oe(Object.keys(v.item.groups),E=>(h(),T(a,{key:E,title:v.appMap[E]},{default:e(()=>[(h(!0),j(ae,null,oe(v.item.groups[E],R=>(h(),T(r,{key:R.appKey+"/"+R.value,value:R.appKey+"/"+R.value},{default:e(()=>[w(U(R.label),1)]),_:2},1032,["value"]))),128))]),_:2},1032,["title"]))),128))]),_:1})]),_:1},8,["modelValue"])):q("",!0),Object.keys(v.item.groups).length===1?(h(),T(f,{key:1,modelValue:n.value,"onUpdate:modelValue":p[1]||(p[1]=E=>n.value=E),onChange:y},{default:e(()=>[(h(!0),j(ae,null,oe(v.item.groups[Object.keys(v.item.groups)[0]],E=>(h(),T(r,{key:E.appKey+"/"+E.value,value:E.appKey+"/"+E.value},{default:e(()=>[w(U(E.label),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])):q("",!0)])])):q("",!0),v.item.tags&&v.item.tags.length>0?(h(),j("div",Ga,[Ma,F("div",Ua,[t(f,{modelValue:l.value,"onUpdate:modelValue":p[2]||(p[2]=E=>l.value=E),onChange:y},{default:e(()=>[(h(!0),j(ae,null,oe(v.item.tags,E=>(h(),T(r,{key:E.value,value:E.value},{default:e(()=>[w(U(E.label),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])])])):q("",!0),v.item.subtypes&&v.item.subtypes.length>0?(h(),j("div",za,[Pa,F("div",Ka,[t(f,{modelValue:u.value,"onUpdate:modelValue":p[3]||(p[3]=E=>u.value=E),onChange:y},{default:e(()=>[(h(!0),j(ae,null,oe(v.item.subtypes,E=>(h(),T(r,{key:E.value,value:E.value},{default:e(()=>[w(U(E.label),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])])])):q("",!0),Object.keys(v.item.groups).length===0&&v.item.tags.length===0&&v.item.subtypes.length===0?(h(),T($,{key:3,size:"small"},{default:e(()=>[w(" \u8BE5\u7C7B\u578B\u4E0B\u6682\u65E0\u5173\u8054\u5BF9\u8C61 ")]),_:1})):q("",!0)])}}});const Wa=ve(qa,[["__scopeId","data-v-ea9ea47c"]]),Ha=Y({__name:"index",props:{type:{default:"ALL"}},emits:["change"],setup(x,{emit:V}){const g=V,n=x,l=o(n.type),u=c=>{g("change",c)};return se(()=>n.type,c=>{l.value=c,u(c)},{immediate:!0,deep:!0}),(c,i)=>{const y=lt,D=ot;return h(),T(D,{modelValue:l.value,"onUpdate:modelValue":i[0]||(i[0]=v=>l.value=v),disabled:n.disabled,onChange:u},{default:e(()=>[t(y,{value:"ALL"},{default:e(()=>[w("\u6388\u6743\u5168\u90E8")]),_:1}),t(y,{value:"CONDITION"},{default:e(()=>[w("\u6761\u4EF6\u7EC6\u5206")]),_:1})]),_:1},8,["modelValue","disabled"])}}}),Za={style:{"border-bottom":"1px solid var(--color-border-2)",height:"calc(100vh - 308px)","overflow-y":"auto"}},Xa={class:"check-all"},Ya={class:"type-group-header"},Ja={class:"category-subtype-checkbox"},Qa={class:"items-content"},el={key:0,style:{display:"flex","justify-content":"center","margin-top":"10px"}},tl=Y({__name:"index",props:{roleId:{}},setup(x,{expose:V}){const g=x,{loading:n,setLoading:l}=le(!1),{loading:u,setLoading:c}=le(!1),i=o(!1),y=o(!1),D=o([]),v=o([]),p=Z(()=>ne(g.roleId)),r=o([]),a=o({}),d=o({}),f=o({}),$=(s,_)=>{f.value[_]=s},E=s=>{i.value=!1,s?(y.value=!0,v.value=r.value.map(_=>_.value)):(y.value=!1,v.value=[],f.value={})},R=s=>{s.length===r.value.length?(y.value=!0,i.value=!1):s.length===0?(y.value=!1,i.value=!1):(y.value=!1,i.value=!0),Object.keys(f.value).forEach(_=>{s.indexOf(_)===-1&&(f.value[_]=void 0)})},I=async()=>{l(!0),dt("ZABBIX").then(_=>{_.data.forEach(m=>{m.id&&(a.value[m.id]=m.name)})});const{data:s}=await Ca(g.roleId);r.value=s,v.value=s.filter(_=>_.selected).map(_=>_.value),p.value?E(!0):R(v.value),D.value=te.cloneDeep(v.value),l(!1)},S=Z(()=>{const s={};return r.value.forEach(_=>{s[_.value]=_.label}),s}),z=(s,_)=>{d.value[_]=s,f.value[_]={categoryName:S.value[_],categoryCode:_,conditionType:s,groups:[],tags:[],subtypes:[]}},W=async()=>{const s=[];v.value.forEach(_=>{f.value[_]?s.push(f.value[_]):s.push({categoryName:S.value[_],categoryCode:_,conditionType:"ALL",groups:[],tags:[],subtypes:[]})}),s.forEach(_=>{if(_.conditionType==="CONDITION"&&_.groups.length===0&&_.tags.length===0&&_.subtypes.length===0)throw ee.error(`${S.value[_.categoryCode]}\u5206\u7EC4,\u6807\u7B7E,\u5B50\u7C7B\u578B\u4E0D\u80FD\u540C\u65F6\u4E3A\u7A7A`),new Error(`${S.value[_.categoryCode]}\u5206\u7EC4,\u6807\u7B7E,\u5B50\u7C7B\u578B\u4E0D\u80FD\u540C\u65F6\u4E3A\u7A7A`)});try{c(!0),await Ba({data:s,roleId:g.roleId}),D.value=te.cloneDeep(v.value),ee.success("\u7C7B\u578B\u6743\u9650\u5206\u914D\u6210\u529F")}catch(_){console.log(_)}finally{c(!1)}},O=()=>{y.value=!1,v.value=[],i.value=!1,f.value={},I()};return V({initData:I,checkDataChange:()=>_e(D.value,v.value),handleReset:O}),(s,_)=>{const m=fe,k=xe,A=ce,b=ue,B=Ae;return h(),T(B,{loading:G(n),style:{width:"100%",height:"calc(100vh - 262px)"}},{default:e(()=>[F("div",null,[F("div",Za,[F("div",Xa,[t(m,{"model-value":y.value,indeterminate:i.value,disabled:p.value,onChange:E},{default:e(()=>[w(" \u5168\u9009 ")]),_:1},8,["model-value","indeterminate","disabled"])]),t(k,{modelValue:v.value,"onUpdate:modelValue":_[0]||(_[0]=L=>v.value=L),style:{width:"100%"},onChange:R},{default:e(()=>[(h(!0),j(ae,null,oe(r.value,(L,H)=>(h(),j("div",{key:H,class:"type-group-container"},[F("div",Ya,[F("div",Ja,[t(m,{disabled:p.value,value:L.value},{default:e(()=>[w(U(L.label),1)]),_:2},1032,["disabled","value"])]),v.value.indexOf(L.value)>-1?(h(),T(Ha,{key:0,type:L.type,disabled:p.value,onChange:M=>z(M,L.value)},null,8,["type","disabled","onChange"])):q("",!0)]),F("div",Qa,[d.value[L.value]==="CONDITION"&&v.value.indexOf(L.value)>-1?(h(),T(Wa,{key:0,item:L,"app-map":a.value,onSetCategoryConditionAssignRoleData:M=>$(M,L.value)},null,8,["item","app-map","onSetCategoryConditionAssignRoleData"])):q("",!0)])]))),128))]),_:1},8,["modelValue"])]),G(ne)(s.roleId)?q("",!0):(h(),j("div",el,[t(b,null,{default:e(()=>[t(A,{onClick:O},{default:e(()=>[w("\u91CD\u7F6E")]),_:1}),t(A,{type:"primary",loading:G(u),onClick:W},{default:e(()=>[w(" \u786E\u5B9A ")]),_:1},8,["loading"])]),_:1})]))])]),_:1},8,["loading"])}}});const al=ve(tl,[["__scopeId","data-v-c4a48514"]]),ll={key:0},ol={style:{"border-bottom":"1px solid var(--color-border-2)",height:"calc(100vh - 308px)","overflow-y":"auto"}},ul={style:{"margin-bottom":"10px"}},nl={style:{"margin-bottom":"10px"}},sl={key:0,style:{display:"flex","justify-content":"center","margin-top":"10px"}},il=Y({__name:"index",props:{roleId:{}},setup(x,{expose:V}){const g=x,n=o(!1),l=o(!1),u=o([]),c=Z(()=>ne(g.roleId)),i=o([]),{loading:y,setLoading:D}=le(!1),{loading:v,setLoading:p}=le(!1),r=o(void 0),a=o(void 0),d=s=>{n.value=!1,u.value=[],s?(l.value=!0,a.value&&Object.keys(a.value).forEach(_=>{a.value&&a.value[_].forEach(m=>{u.value.push(`${m.appKey}/${m.value}`)})})):l.value=!1},f=Z(()=>{let s=0;return a.value&&Object.keys(a.value).forEach(_=>{a.value&&(s+=a.value[_].length)}),s}),$=s=>{s.length===f.value?(l.value=!0,n.value=!1):s.length===0?(l.value=!1,n.value=!1):(l.value=!1,n.value=!0)},E=o(),R=o({}),I=o({}),S=async()=>{var m;I.value={},D(!0),(await dt("ZABBIX")).data.forEach(k=>{k.id&&(R.value[k.id]=k.name)});const{data:_}=await xa(g.roleId);if(r.value=_,r.value){const k=Object.keys(R.value);Object.keys((m=r.value)==null?void 0:m.groups).forEach(A=>{var b;k.includes(A)||(b=r.value)==null||delete b.groups[A]}),a.value=r.value.groups,u.value=[],Object.keys(a.value).forEach(A=>{a.value&&a.value[A].filter(b=>b.selected).forEach(b=>{u.value.push(`${b.appKey}/${b.value}`)})})}c.value?d(!0):$(u.value),i.value=te.cloneDeep(u.value),D(!1)},z=async()=>{try{p(!0),await Ia({hostGroupIds:u.value,roleId:g.roleId}),i.value=te.cloneDeep(u.value),ee.success("\u5206\u7EC4\u6743\u9650\u5206\u914D\u6210\u529F")}catch(s){console.log(s)}finally{p(!1)}},W=Z(()=>{const s={};return a.value&&Object.keys(a.value).forEach(_=>{a.value&&(s[_]=a.value[_].filter(m=>m.label.indexOf(I.value[_]||"")!==-1))}),s}),O=()=>{l.value=!1,u.value=[],n.value=!1,S()};return V({initData:S,checkDataChange:()=>_e(i.value,u.value),handleReset:O}),(s,_)=>{const m=fe,k=he,A=ke,b=be,B=xe,L=ce,H=ue,M=Ae;return h(),T(M,{loading:G(y),style:{width:"100%",height:"calc(100vh - 260px)"}},{default:e(()=>[a.value&&Object.keys(a.value).length>0?(h(),j("div",ll,[F("div",ol,[t(m,{"model-value":l.value,indeterminate:n.value,disabled:c.value,onChange:d},{default:e(()=>[w(" \u5168\u9009 ")]),_:1},8,["model-value","indeterminate","disabled"]),t(B,{modelValue:u.value,"onUpdate:modelValue":_[3]||(_[3]=C=>u.value=C),style:{width:"100%"},disabled:c.value,onChange:$},{default:e(()=>[Object.keys(a.value).length>1?(h(),T(b,{key:0,modelValue:E.value,"onUpdate:modelValue":_[0]||(_[0]=C=>E.value=C),onChange:_[1]||(_[1]=C=>E.value=C)},{default:e(()=>[(h(!0),j(ae,null,oe(Object.keys(a.value),C=>(h(),T(A,{key:C,title:R.value[C]+"("+a.value[C].length+")"},{default:e(()=>[F("div",ul,[t(k,{modelValue:I.value[C],"onUpdate:modelValue":N=>I.value[C]=N,placeholder:"\u8BF7\u8F93\u5165\u4E3B\u673A\u7EC4\u540D\u79F0\u641C\u7D22",size:"small",style:{width:"300px"},disabled:c.value,"allow-clear":""},null,8,["modelValue","onUpdate:modelValue","disabled"])]),(h(!0),j(ae,null,oe(W.value[C],N=>(h(),T(m,{key:N.appKey+"/"+N.value,value:N.appKey+"/"+N.value},{default:e(()=>[w(U(N.label),1)]),_:2},1032,["value"]))),128))]),_:2},1032,["title"]))),128))]),_:1},8,["modelValue"])):Object.keys(a.value).length===1?(h(),j(ae,{key:1},[F("div",nl,[t(k,{modelValue:I.value[Object.keys(a.value)[0]],"onUpdate:modelValue":_[2]||(_[2]=C=>I.value[Object.keys(a.value)[0]]=C),placeholder:"\u8BF7\u8F93\u5165\u4E3B\u673A\u7EC4\u540D\u79F0\u641C\u7D22",size:"small",style:{width:"300px"},disabled:c.value,"allow-clear":""},null,8,["modelValue","disabled"])]),(h(!0),j(ae,null,oe(W.value[Object.keys(a.value)],C=>(h(),T(m,{key:C.appKey+"/"+C.value,value:C.appKey+"/"+C.value},{default:e(()=>[w(U(C.label),1)]),_:2},1032,["value"]))),128))],64)):q("",!0)]),_:1},8,["modelValue","disabled"])]),G(ne)(s.roleId)?q("",!0):(h(),j("div",sl,[t(H,null,{default:e(()=>[t(L,{onClick:O},{default:e(()=>[w("\u91CD\u7F6E")]),_:1}),t(L,{type:"primary",loading:G(v),onClick:z},{default:e(()=>[w(" \u786E\u5B9A ")]),_:1},8,["loading"])]),_:1})]))])):q("",!0)]),_:1},8,["loading"])}}}),cl={style:{"border-bottom":"1px solid var(--color-border-2)",height:"calc(100vh - 308px)","overflow-y":"auto"}},rl={key:0,style:{display:"flex","justify-content":"center","margin-top":"10px"}},dl=Y({__name:"index",props:{roleId:{}},setup(x,{expose:V}){const g=x,n=o(!1),l=o(!1),u=o([]),c=Z(()=>ne(g.roleId)),i=o([]),{loading:y,setLoading:D}=le(!1),{loading:v,setLoading:p}=le(!1),r=o([]),a=R=>{n.value=!1,R?(l.value=!0,u.value=r.value.map(I=>I.value)):(l.value=!1,u.value=[])},d=R=>{R.length===r.value.length?(l.value=!0,n.value=!1):R.length===0?(l.value=!1,n.value=!1):(l.value=!1,n.value=!0)},f=async()=>{D(!0);const{data:R}=await Ea(g.roleId);r.value=R,c.value?u.value=r.value.map(I=>I.value):(u.value=[],r.value&&r.value.forEach(I=>{I.selected&&u.value.push(I.value)})),i.value=te.cloneDeep(u.value),d(u.value),D(!1)},$=async()=>{try{p(!0),await Fa({tagIds:u.value,roleId:g.roleId}),i.value=te.cloneDeep(u.value),ee.success("\u6807\u7B7E\u6743\u9650\u5206\u914D\u6210\u529F")}catch(R){console.log(R)}finally{p(!1)}},E=()=>{l.value=!1,u.value=[],n.value=!1,f()};return V({initData:f,checkDataChange:()=>_e(i.value,u.value),handleReset:E}),(R,I)=>{const S=fe,z=xe,W=ue,O=ce,s=Ae;return h(),T(s,{loading:G(y),style:{width:"100%",height:"calc(100vh - 260px)"}},{default:e(()=>[F("div",cl,[t(W,{direction:"vertical"},{default:e(()=>[t(S,{"model-value":l.value,indeterminate:n.value,disabled:c.value,onChange:a},{default:e(()=>[w(" \u5168\u9009 ")]),_:1},8,["model-value","indeterminate","disabled"]),t(z,{modelValue:u.value,"onUpdate:modelValue":I[0]||(I[0]=_=>u.value=_),disabled:c.value,onChange:d},{default:e(()=>[(h(!0),j(ae,null,oe(r.value,_=>(h(),T(S,{key:_.value,value:_.value},{default:e(()=>[w(U(_.label),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue","disabled"])]),_:1})]),G(ne)(R.roleId)?q("",!0):(h(),j("div",rl,[t(W,null,{default:e(()=>[t(O,{onClick:E},{default:e(()=>[w("\u91CD\u7F6E")]),_:1}),t(O,{type:"primary",loading:G(v),onClick:$},{default:e(()=>[w(" \u786E\u5B9A ")]),_:1},8,["loading"])]),_:1})]))]),_:1},8,["loading"])}}}),vl={style:{display:"flex"}},pl={class:"selected-count"},fl={key:1},_l={key:1},ml=Y({__name:"table-left",props:{assignedTableData:{},height:{},roleId:{}},setup(x,{expose:V}){const{loading:g,setLoading:n}=le(!1),{pagination:l,pageSizeOptions:u}=Pe(),c=o(),i=o(),y=x,D=Z(()=>ne(y.roleId)),v=o({size:"mini",height:"auto",columnConfig:{resizable:!0},rowConfig:{keyField:"checkId",isHover:!0},checkboxConfig:{reserve:!0,checkMethod(k){return D.value?!1:y.assignedTableData?!y.assignedTableData.some(A=>A.checkId===k.row.checkId):!0}},showOverflow:"tooltip",columns:[{type:"checkbox",width:40},{title:"\u53EF\u89C1\u540D\u79F0",slots:{default:"displayName"},minWidth:80},{title:"IP",field:"ip",minWidth:80},{title:"\u5E94\u7528",field:"appName",minWidth:80},{title:"\u7C7B\u578B",slots:{default:"categoryName"},minWidth:60},{title:"\u5206\u7EC4",slots:{default:"hostGroup"},minWidth:60},{title:"\u6807\u7B7E",slots:{default:"tag"},minWidth:60}]}),p=Se({queryStr:""}),r=o([]),a=o([]),d=Z(()=>{const k=c.value,A=[];return k&&(A.push(...k.getCheckboxRecords()),A.push(...k.getCheckboxReserveRecords())),A.filter(b=>a.value.includes(b.checkId))}),f=()=>{const k=c.value;r.value.forEach(A=>{const b=A.checkId,B=a.value.indexOf(b)!==-1;k.getRowById(b)&&k.setCheckboxRow(k.getRowById(b),B)})};se(()=>y.assignedTableData,k=>{k&&(a.value=k.map(A=>A.checkId)),f()},{immediate:!0});const $=async(k={...p,page:l})=>{n(!0);try{const A=c.value,{data:b}=await Wt(k);l.total=b.totalElements,A&&(await A.loadData(b.content),r.value=b.content)}catch(A){console.error(A)}finally{n(!1),f()}},E=k=>{const{checked:A,row:b}=k;A?a.value.push(b.checkId):a.value=a.value.filter(B=>B!==b.checkId)},R=Z(()=>r.value.filter(k=>{var A;return!((A=y.assignedTableData)!=null&&A.map(b=>b.checkId).includes(k.checkId))}).map(k=>k.checkId)),I=k=>{const{checked:A}=k;if(A){const b=R.value.filter(B=>!a.value.includes(B));a.value.push(...b)}else a.value=a.value.filter(b=>!R.value.includes(b))},S=Re(async()=>{await $()},500),z=k=>{l.current=k,$()},W=k=>{l.pageSize=k,$()},O=o([]);return V({initData:()=>{$(),vt().then(k=>{O.value=k.data})},getSelectRow:()=>d.value,clearSelectRow:()=>{l.current=1,a.value=[],p.queryStr="",f()}}),(k,A)=>{const b=ye,B=ue,L=Fe,H=Oe,M=ut,C=nt,N=je,K=Ie("vxe-grid");return h(),j(ae,null,[t(H,null,{default:e(()=>[t(L,{span:18},{default:e(()=>[F("div",vl,[t(B,{style:{"margin-bottom":"5px"}},{default:e(()=>[t(b,{modelValue:p.queryStr,"onUpdate:modelValue":A[0]||(A[0]=P=>p.queryStr=P),style:{width:"250px"},placeholder:"\u540D\u79F0/IP","allow-clear":"",onClear:G(S),onInput:G(S)},null,8,["modelValue","onClear","onInput"])]),_:1})])]),_:1}),t(L,{span:6,style:{"text-align":"right"}},{default:e(()=>[F("span",pl,"\u5DF2\u9009\u62E9\u4E86"+U(a.value.length)+"\u6761",1)]),_:1})]),_:1}),F("div",{style:Te([{height:k.height},{"margin-left":"-16px","margin-right":"-16px"}])},[t(K,Le({ref_key:"xGrid",ref:c,loading:G(g)},v.value,{onCheckboxChange:E,onCheckboxAll:I}),{displayName:e(({row:P})=>[w(U(P.displayName),1)]),categoryName:e(({row:P})=>[F("span",null,U(P.categoryName||"--"),1)]),hostGroup:e(({row:P})=>[F("span",null,[P.hostGroupDtos.length>0?(h(),T(C,{key:0},{content:e(()=>[w(U(P.hostGroupDtos.map(X=>X.name).join("\uFF0C")||"--"),1)]),default:e(()=>[t(M,{color:"blue"},{default:e(()=>[w("\u67E5\u770B")]),_:1})]),_:2},1024)):(h(),j("span",fl,"--"))])]),tag:e(({row:P})=>[F("span",null,[P.tagDtos.length>0?(h(),T(C,{key:0},{content:e(()=>[w(U(P.tagDtos.map(X=>X.name).join("\uFF0C")||"--"),1)]),default:e(()=>[t(M,{color:"blue"},{default:e(()=>[w("\u67E5\u770B")]),_:1})]),_:2},1024)):(h(),j("span",_l,"--"))])]),pager:e(()=>[t(N,{ref_key:"xPagination",ref:i,current:G(l).current,"page-size":G(l).pageSize,total:G(l).total,"page-size-options":G(u),style:{"padding-top":"10px","padding-left":"10px"},size:"mini","show-total":"","show-jumper":!1,"buffer-size":1,onChange:z,onPageSizeChange:W},null,8,["current","page-size","total","page-size-options"])]),_:1},16,["loading"])],4)],64)}}}),hl={style:{display:"flex"}},gl={class:"selected-count"},yl={key:1},kl={key:1},bl=Y({__name:"table-right",props:{height:{},roleId:{}},emits:["getAssignedTableData"],setup(x,{expose:V,emit:g}){const{loading:n,setLoading:l}=le(!1),u=o(),{pagination:c,pageSizeOptions:i}=Pe(),y=x,D=Z(()=>ne(y.roleId)),v=o({size:"mini",height:"auto",columnConfig:{resizable:!0},rowConfig:{keyField:"checkId",isHover:!0},checkboxConfig:{reserve:!0,checkMethod(){return!D.value}},showOverflow:"tooltip",columns:[{type:"checkbox",width:40},{title:"\u53EF\u89C1\u540D\u79F0",slots:{default:"displayName"},minWidth:80},{title:"IP",field:"ip",minWidth:80},{title:"\u5E94\u7528",field:"appName",minWidth:80},{title:"\u7C7B\u578B",slots:{default:"categoryName"},minWidth:60},{title:"\u5206\u7EC4",slots:{default:"hostGroup"},minWidth:60},{title:"\u6807\u7B7E",slots:{default:"tag"},minWidth:60}]}),p=Se({queryStr:""}),r=o([]),a=o([]),d=Z(()=>r.value.filter(C=>p.queryStr?C.displayName&&C.displayName.includes(p.queryStr)||C.ip&&C.ip.includes(p.queryStr):!0).slice((c.current-1)*c.pageSize,c.current*c.pageSize)),f=Z(()=>r.value.filter(C=>p.queryStr?C.displayName&&C.displayName.includes(p.queryStr)||C.ip&&C.ip.includes(p.queryStr):!0)),$=Z(()=>{const C=u.value,N=[];return C&&(N.push(...C.getCheckboxRecords()),N.push(...C.getCheckboxReserveRecords())),N}),E=()=>{const C=u.value;r.value.forEach(N=>{const K=N.checkId,P=a.value.indexOf(K)!==-1;C.getRowById(K)&&C.setCheckboxRow(C.getRowById(K),P)})},R=g,I=o([]),S=async()=>{l(!0);try{await u.value.loadData(d.value),c.total=f.value.length}catch(C){console.error(C)}finally{l(!1),E()}},z=C=>{const{checked:N,row:K}=C;N?a.value.push(K.checkId):a.value=a.value.filter(P=>P!==K.checkId)},W=Z(()=>r.value.map(C=>C.checkId)),O=C=>{const{checked:N}=C,K=d.value.map(P=>P.checkId);if(N){const P=K.filter(X=>!a.value.includes(X));a.value.push(...P)}else a.value=a.value.filter(P=>!K.includes(P))},s=Re(async()=>{await S()},500),_=o([]),m=async C=>{const N=u.value;I.value=te.cloneDeep(C),r.value=te.cloneDeep(C),R("getAssignedTableData",I.value),vt().then(K=>{_.value=K.data}),await N.loadData(d.value),c.total=r.value.length},k=()=>a.value,A=()=>$.value,b=()=>{c.current=1,a.value=[],p.queryStr="",E()},B=C=>{C.forEach(N=>{const K=N.checkId;W.value.indexOf(K)===-1&&(r.value.push(N),I.value.push(N))}),S(),R("getAssignedTableData",I.value)},L=C=>{C.forEach(N=>{const K=N.checkId;W.value.indexOf(K)!==-1&&(r.value=r.value.filter(P=>P.checkId!==K),I.value=I.value.filter(P=>P.checkId!==K))}),a.value=a.value.filter(N=>!C.map(K=>K.checkId).includes(N)),S(),R("getAssignedTableData",I.value)},H=C=>{c.current=C,S()},M=C=>{c.pageSize=C,S()};return V({initData:m,addRowDataToTable:B,removeRowDataFromTable:L,getSelectRow:A,getSelectRowKeys:k,clearSelectRow:b}),(C,N)=>{const K=ye,P=ue,X=Fe,De=Oe,qe=ut,We=nt,ft=je,_t=Ie("vxe-grid");return h(),j(ae,null,[t(De,null,{default:e(()=>[t(X,{span:18},{default:e(()=>[F("div",hl,[t(P,{style:{"margin-bottom":"5px"}},{default:e(()=>[t(K,{modelValue:p.queryStr,"onUpdate:modelValue":N[0]||(N[0]=re=>p.queryStr=re),style:{width:"250px"},placeholder:"\u540D\u79F0/IP","allow-clear":"",onClear:G(s),onInput:G(s)},null,8,["modelValue","onClear","onInput"])]),_:1})])]),_:1}),t(X,{span:6,style:{"text-align":"right"}},{default:e(()=>[F("span",gl,"\u5DF2\u9009\u62E9\u4E86"+U(a.value.length)+"\u6761",1)]),_:1})]),_:1}),F("div",{style:Te([{height:C.height},{"margin-left":"-16px","margin-right":"-16px"}])},[t(_t,Le({ref_key:"xGrid",ref:u,loading:G(n)},v.value,{"scroll-y":{enabled:!0,gt:100},onCheckboxChange:z,onCheckboxAll:O}),{displayName:e(({row:re})=>[w(U(re.displayName),1)]),categoryName:e(({row:re})=>[F("span",null,U(re.categoryName||"--"),1)]),hostGroup:e(({row:re})=>[F("span",null,[re.hostGroupDtos.length>0?(h(),T(We,{key:0},{content:e(()=>[w(U(re.hostGroupDtos.map($e=>$e.name).join("\uFF0C")||"--"),1)]),default:e(()=>[t(qe,{color:"blue"},{default:e(()=>[w("\u67E5\u770B")]),_:1})]),_:2},1024)):(h(),j("span",yl,"--"))])]),tag:e(({row:re})=>[F("span",null,[re.tagDtos.length>0?(h(),T(We,{key:0},{content:e(()=>[w(U(re.tagDtos.map($e=>$e.name).join("\uFF0C")||"--"),1)]),default:e(()=>[t(qe,{color:"blue"},{default:e(()=>[w("\u67E5\u770B")]),_:1})]),_:2},1024)):(h(),j("span",kl,"--"))])]),pager:e(()=>[t(ft,{ref:"xPagination",current:G(c).current,"page-size":G(c).pageSize,total:G(c).total,"page-size-options":G(i),style:{"padding-top":"10px","padding-left":"10px"},size:"mini","show-total":"","show-jumper":!1,"buffer-size":1,onChange:H,onPageSizeChange:M},null,8,["current","page-size","total","page-size-options"])]),_:1},16,["loading"])],4)],64)}}}),Dl={class:"transfer-button-container"},Cl={style:{"margin-top":"10px"}},xl={key:0,style:{display:"flex","justify-content":"center","margin-top":"10px"}},El=Y({__name:"index",props:{roleId:{}},setup(x,{expose:V}){const g=x,n=o([]),l=o(),u=o(),c=async()=>{l.value.clearSelectRow(),u.value.clearSelectRow();const{data:f}=await Ra(g.roleId);l.value.initData(),u.value.initData(f),n.value=f.map($=>$.checkId)},{loading:i,setLoading:y}=le(!1),D=()=>{const f=l.value.getSelectRow();u.value.addRowDataToTable(f)},v=()=>{const f=u.value.getSelectRow();u.value.removeRowDataFromTable(f)},p=o([]),r=f=>{p.value=f},a=()=>{l.value.clearSelectRow(),u.value.clearSelectRow(),p.value=[],c()},d=async()=>{try{y(!0);const f=p.value.map($=>`${$.checkId}`);await Oa({monitorObjectAppKeyHostIds:f,roleId:g.roleId}),n.value=f,ee.success("\u76D1\u63A7\u5BF9\u8C61\u6743\u9650\u5206\u914D\u6210\u529F")}catch(f){console.log(f)}finally{y(!1)}};return V({initData:c,checkDataChange:()=>_e(n.value,p.value.map(f=>f.checkId)),handleReset:a}),(f,$)=>{const E=Me,R=Fe,I=It,S=ce,z=Ft,W=Oe,O=ue;return h(),j("div",null,[t(W,null,{default:e(()=>[t(R,{span:12,style:{"padding-right":"20px"}},{default:e(()=>[t(E,{size:"small",title:"\u672A\u5206\u914D\u5BF9\u8C61"},{default:e(()=>[t(ml,{ref_key:"monitorObjectTableLeftRef",ref:l,height:"calc(100vh - 410px)","assigned-table-data":p.value,"role-id":f.roleId},null,8,["assigned-table-data","role-id"])]),_:1})]),_:1}),F("div",Dl,[F("div",null,[t(S,{type:"primary",size:"mini",onClick:D},{icon:e(()=>[t(I)]),_:1})]),F("div",Cl,[t(S,{type:"primary",size:"mini",onClick:v},{icon:e(()=>[t(z)]),_:1})])]),t(R,{span:12,style:{"padding-left":"20px"}},{default:e(()=>[t(E,{size:"small",title:"\u5DF2\u5206\u914D\u5BF9\u8C61"},{default:e(()=>[t(bl,{ref_key:"monitorObjectTableRightRef",ref:u,height:"calc(100vh - 410px)","role-id":f.roleId,onGetAssignedTableData:r},null,8,["role-id"])]),_:1})]),_:1})]),_:1}),G(ne)(f.roleId)?q("",!0):(h(),j("div",xl,[t(O,null,{default:e(()=>[t(S,{onClick:a},{default:e(()=>[w("\u91CD\u7F6E")]),_:1}),t(S,{type:"primary",loading:G(i),onClick:d},{default:e(()=>[w(" \u786E\u5B9A ")]),_:1},8,["loading"])]),_:1})]))])}}});const Rl=ve(El,[["__scopeId","data-v-5c88b2bb"]]),wl=Y({__name:"index",props:{roleId:{}},setup(x,{expose:V}){const g=x,n=o("1"),l=o(),u=o(),c=o(),i=o(),y=o(),D=()=>{me(()=>{l.value&&l.value.initData(),u.value&&u.value.initData(),c.value&&c.value.initData(),i.value&&i.value.initData(),y.value&&y.value.initData()})};se(()=>g.roleId,r=>{r&&D()},{immediate:!0});const v=()=>l.value&&l.value.checkDataChange()?"\u6309\u76EE\u5F55\u5206\u914D":u.value&&u.value.checkDataChange()?"\u6309\u7C7B\u578B\u5206\u914D":c.value&&c.value.checkDataChange()?"\u6309\u5206\u7EC4\u5206\u914D":i.value&&i.value.checkDataChange()?"\u6309\u6807\u7B7E\u5206\u914D":y.value&&y.value.checkDataChange()?"\u6309\u5BF9\u8C61\u5206\u914D":"",p=()=>{if(l.value&&l.value.checkDataChange()){l.value.handleReset();return}if(u.value&&u.value.checkDataChange()){u.value.handleReset();return}if(c.value&&c.value.checkDataChange()){c.value.handleReset();return}if(i.value&&i.value.checkDataChange()){i.value.handleReset();return}y.value&&y.value.checkDataChange()&&y.value.handleReset()};return se(()=>n.value,(r,a)=>{a&&(a==="1"?de(a,r,"\u6309\u76EE\u5F55\u5206\u914D",n,l,void 0):a==="2"?de(a,r,"\u6309\u7C7B\u578B\u5206\u914D",n,u,void 0):a==="3"?de(a,r,"\u6309\u5206\u7EC4\u5206\u914D",n,c,void 0):a==="4"?de(a,r,"\u6309\u6807\u7B7E\u5206\u914D",n,i,void 0):a==="5"&&de(a,r,"\u6309\u5BF9\u8C61\u5206\u914D",n,y,void 0))},{immediate:!0}),V({checkDataChange:()=>l.value&&l.value.checkDataChange()||u.value&&u.value.checkDataChange()||c.value&&c.value.checkDataChange()||i.value&&i.value.checkDataChange()||y.value&&y.value.checkDataChange(),getChangeTabName:v,handleReset:p}),(r,a)=>{const d=ke,f=be;return h(),T(f,{"active-key":n.value,"onUpdate:activeKey":a[0]||(a[0]=$=>n.value=$)},{default:e(()=>[t(d,{key:"1",title:"\u6309\u76EE\u5F55\u5206\u914D"},{default:e(()=>[J(t(La,{ref_key:"monitorObjectDataPermBusinessRef",ref:l,"role-id":r.roleId},null,8,["role-id"]),[[Q,n.value==="1"]])]),_:1}),t(d,{key:"2",title:"\u6309\u7C7B\u578B\u5206\u914D"},{default:e(()=>[J(t(al,{ref_key:"monitorObjectDataPermCategoryRef",ref:u,"role-id":r.roleId},null,8,["role-id"]),[[Q,n.value==="2"]])]),_:1}),t(d,{key:"3",title:"\u6309\u5206\u7EC4\u5206\u914D"},{default:e(()=>[J(t(il,{ref_key:"monitorObjectDataPermGroupRef",ref:c,"role-id":r.roleId},null,8,["role-id"]),[[Q,n.value==="3"]])]),_:1}),t(d,{key:"4",title:"\u6309\u6807\u7B7E\u5206\u914D"},{default:e(()=>[J(t(dl,{ref_key:"monitorObjectDataPermTagRef",ref:i,"role-id":r.roleId},null,8,["role-id"]),[[Q,n.value==="4"]])]),_:1}),t(d,{key:"5",title:"\u6309\u5BF9\u8C61\u5206\u914D"},{default:e(()=>[J(t(Rl,{ref_key:"monitorObjectSelectRef",ref:y,"role-id":r.roleId},null,8,["role-id"]),[[Q,n.value==="5"]])]),_:1})]),_:1},8,["active-key"])}}}),Bl=Y({__name:"index",props:{type:{default:"ALL"}},emits:["change"],setup(x,{emit:V}){const g=V,n=x,l=o(n.type),u=c=>{g("change",c)};return se(()=>n.type,c=>{l.value=c,u(c)},{immediate:!0,deep:!0}),(c,i)=>{const y=lt,D=ot;return h(),T(D,{modelValue:l.value,"onUpdate:modelValue":i[0]||(i[0]=v=>l.value=v),disabled:n.disabled,onChange:u},{default:e(()=>[t(y,{value:"ALL"},{default:e(()=>[w("\u6388\u6743\u5168\u90E8")]),_:1})]),_:1},8,["modelValue","disabled"])}}});function Il(x){return ie.get(`/sysRoleAsset/getAssignedModelDataByRoleId/${x}`)}function Fl(x){return ie.post("/sysRoleAsset/assignDataByModel",x)}const Ol=x=>(tt("data-v-50e8735f"),x=x(),at(),x),Al={class:"searchCondition"},$l={style:{"border-bottom":"1px solid var(--color-border-2)",height:"calc(100vh - 348px)","overflow-y":"auto"}},Nl={class:"check-all"},Sl={class:"type-group-header"},Ll={class:"category-subtype-checkbox"},Tl=Ol(()=>F("div",{class:"items-content"},null,-1)),Vl={style:{display:"flex","justify-content":"center","margin-top":"10px"}},jl=Y({__name:"index",props:{roleId:{}},setup(x,{expose:V}){const g=x,{loading:n,setLoading:l}=le(!1),{loading:u,setLoading:c}=le(!1),i=o(!1),y=o(!1),D=o([]),v=o([]),p=Z(()=>ne(g.roleId)),r=o({searchText:"",oneLevel:void 0,twoLevel:void 0}),a=o([]),d=o([]),f=o([]),$=o([]),E=O=>{i.value=!1,O?(y.value=!0,v.value=a.value.map(s=>s.value)):(y.value=!1,v.value=[])},R=O=>{O.length===a.value.length?(y.value=!0,i.value=!1):O.length===0?(y.value=!1,i.value=!1):(y.value=!1,i.value=!0)},I=async()=>{l(!0);const{data:O}=await Ht({});f.value=O.filter(_=>_.level===1),$.value=O.filter(_=>_.level===2);const{data:s}=await Il(g.roleId);a.value=s,d.value=s,v.value=s.filter(_=>_.selected).map(_=>_.value),p.value?E(!0):R(v.value),D.value=te.cloneDeep(v.value),l(!1)},S=()=>{d.value=a.value,r.value.searchText&&(d.value=d.value.filter(O=>O.label.indexOf(r.value.searchText)>-1)),r.value.oneLevel&&(d.value=d.value.filter(O=>O.firstGroup===r.value.oneLevel)),r.value.twoLevel&&(d.value=d.value.filter(O=>O.secondGroup===r.value.twoLevel))},z=async()=>{const O=[];v.value.forEach(s=>{O.push({modelCode:s,conditionType:"ALL"})});try{c(!0),await Fl({data:O,roleId:g.roleId}),D.value=te.cloneDeep(v.value),ee.success("\u4FDD\u5B58\u6210\u529F")}catch(s){console.log(s)}finally{c(!1)}},W=()=>{y.value=!1,v.value=[],i.value=!1,I()};return V({initData:I,checkDataChange:()=>_e(D.value,v.value),handleReset:W}),(O,s)=>{const _=ye,m=Xe,k=Ye,A=ce,b=ue,B=fe,L=xe,H=Ae;return h(),T(H,{loading:G(n),style:{width:"100%",height:"calc(100vh - 262px)"}},{default:e(()=>[F("div",null,[F("div",Al,[t(b,null,{default:e(()=>[t(_,{modelValue:r.value.searchText,"onUpdate:modelValue":s[0]||(s[0]=M=>r.value.searchText=M),placeholder:"\u8BF7\u8F93\u5165\u5173\u952E\u5B57",style:{width:"200px"},onPressEnter:S},null,8,["modelValue"]),t(k,{modelValue:r.value.oneLevel,"onUpdate:modelValue":s[1]||(s[1]=M=>r.value.oneLevel=M),placeholder:"\u8BF7\u9009\u62E9\u4E00\u7EA7\u5206\u7EC4",style:{width:"200px"},"allow-clear":""},{default:e(()=>[(h(!0),j(ae,null,oe(f.value,(M,C)=>(h(),T(m,{key:C,value:M.id},{default:e(()=>[w(U(M.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"]),t(k,{modelValue:r.value.twoLevel,"onUpdate:modelValue":s[2]||(s[2]=M=>r.value.twoLevel=M),style:{width:"200px"},placeholder:"\u8BF7\u9009\u62E9\u4E8C\u7EA7\u5206\u7EC4","allow-clear":""},{default:e(()=>[(h(!0),j(ae,null,oe($.value,(M,C)=>(h(),T(m,{key:C,value:M.id},{default:e(()=>[w(U(M.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"]),t(A,{type:"primary",onClick:S},{default:e(()=>[w("\u67E5\u8BE2")]),_:1}),t(A,{onClick:s[3]||(s[3]=M=>{r.value={searchText:"",oneLevel:void 0,twoLevel:void 0},S()})},{default:e(()=>[w(" \u91CD\u7F6E ")]),_:1})]),_:1})]),F("div",$l,[F("div",Nl,[t(B,{"model-value":y.value,indeterminate:i.value,disabled:p.value,onChange:E},{default:e(()=>[w(" \u5168\u9009 ")]),_:1},8,["model-value","indeterminate","disabled"])]),t(L,{modelValue:v.value,"onUpdate:modelValue":s[4]||(s[4]=M=>v.value=M),style:{width:"100%"},onChange:R},{default:e(()=>[(h(!0),j(ae,null,oe(d.value,(M,C)=>(h(),j("div",{key:C,class:"type-group-container"},[F("div",Sl,[F("div",Ll,[t(B,{disabled:p.value,value:M.value},{default:e(()=>[w(U(M.label),1)]),_:2},1032,["disabled","value"])]),v.value.indexOf(M.value)>-1?(h(),T(Bl,{key:0,type:M.type,disabled:!0},null,8,["type"])):q("",!0)]),Tl]))),128))]),_:1},8,["modelValue"])]),J(F("div",Vl,[t(b,null,{default:e(()=>[t(A,{onClick:W},{default:e(()=>[w("\u91CD\u7F6E")]),_:1}),t(A,{type:"primary",loading:G(u),onClick:z},{default:e(()=>[w(" \u786E\u5B9A ")]),_:1},8,["loading"])]),_:1})],512),[[Q,!p.value]])])]),_:1},8,["loading"])}}});const Gl=ve(jl,[["__scopeId","data-v-50e8735f"]]),Ml=Y({__name:"index",props:{roleId:{}},setup(x,{expose:V}){const g=x,n=o("1"),l=o(),u=()=>{me(()=>{l.value&&l.value.initData()})},c=i=>{n.value=i,u()};return se(()=>g.roleId,i=>{i&&u()},{immediate:!0}),V({checkDataChange:()=>l.value&&l.value.checkDataChange(),handleReset:()=>l.value&&l.value.handleReset()}),(i,y)=>{const D=ke,v=be;return h(),T(v,{"active-key":n.value,onChange:c},{default:e(()=>[t(D,{key:"1",title:"\u6309\u6A21\u578B\u5206\u914D"},{default:e(()=>[n.value==="1"?(h(),T(Gl,{key:0,ref_key:"assetDataPermModelRef",ref:l,"role-id":i.roleId},null,8,["role-id"])):q("",!0)]),_:1})]),_:1},8,["active-key"])}}}),Ul={class:"page-panel-no-padding",style:{height:"calc(100vh - 84px)","overflow-y":"auto"}},zl=Y({__name:"index",props:{currentRoleDataNode:{},defaultActiveKey:{}},emits:["editRoleSubmit","tabChange"],setup(x,{expose:V,emit:g}){const n=x,l=g,u=o(void 0),c=Z(()=>{var a,d,f;return u.value?{title:(a=u.value)==null?void 0:a.name,key:(d=u.value)==null?void 0:d.id,pid:(f=u.value)==null?void 0:f.pid,data:u.value}:n.currentRoleDataNode});se(()=>n.currentRoleDataNode,a=>{a&&(u.value={id:a.key,name:a.title,pid:a.pid,isBuiltin:a.data.isBuiltin})},{immediate:!0});const i=o(n.defaultActiveKey),y=o(),D=o(),v=o();se(()=>i.value,(a,d)=>{d&&(d==="menu_permission"?de(d,a,"\u83DC\u5355\u6743\u9650",i,y,l):d==="asset_data_permission"?de(d,a,"\u8D44\u6E90\u6570\u636E\u6743\u9650",i,D,l):d==="monitor_object_data_permission"?de(d,a,`\u76D1\u63A7\u6570\u636E\u6743\u9650-${v.value.getChangeTabName()}`,i,v,l):(l("tabChange",a),i.value=a))},{immediate:!0});const p=o();return V({clearSelect:()=>{i.value==="user"&&p.value&&p.value.clearSelect()}}),(a,d)=>{const f=ke,$=be,E=Me;return h(),j("div",null,[F("div",Ul,[t(E,{"header-style":{height:"40px"},"body-style":{padding:"12px"},bordered:!1},{title:e(()=>[w(U(c.value?c.value.title:""),1)]),default:e(()=>[F("div",null,[t($,{"active-key":i.value,"onUpdate:activeKey":d[0]||(d[0]=R=>i.value=R),"default-active-key":a.defaultActiveKey},{default:e(()=>[t(f,{key:"user",title:"\u7528\u6237"},{default:e(()=>{var R,I;return[J(t(ma,{ref_key:"userPerm",ref:p,"role-id":a.currentRoleDataNode?(R=a.currentRoleDataNode)==null?void 0:R.key:"","role-name":a.currentRoleDataNode?(I=a.currentRoleDataNode)==null?void 0:I.title:""},null,8,["role-id","role-name"]),[[Q,i.value==="user"]])]}),_:1}),t(f,{key:"menu_permission",title:"\u83DC\u5355\u6743\u9650"},{default:e(()=>{var R;return[J(t(ba,{ref_key:"menuPermissionRef",ref:y,"role-id":a.currentRoleDataNode?(R=a.currentRoleDataNode)==null?void 0:R.key:""},null,8,["role-id"]),[[Q,i.value==="menu_permission"]])]}),_:1}),t(f,{key:"monitor_object_data_permission",title:"\u76D1\u63A7\u6570\u636E\u6743\u9650"},{default:e(()=>{var R;return[J(t(wl,{ref_key:"monitorObjectDataPermissionRef",ref:v,"role-id":a.currentRoleDataNode?(R=a.currentRoleDataNode)==null?void 0:R.key:""},null,8,["role-id"]),[[Q,i.value==="monitor_object_data_permission"]])]}),_:1}),t(f,{key:"asset_data_permission",title:"\u8D44\u6E90\u6570\u636E\u6743\u9650"},{default:e(()=>{var R;return[J(t(Ml,{ref_key:"assetDataPermissionRef",ref:D,"role-id":a.currentRoleDataNode?(R=a.currentRoleDataNode)==null?void 0:R.key:""},null,8,["role-id"]),[[Q,i.value==="asset_data_permission"]])]}),_:1})]),_:1},8,["active-key","default-active-key"])])]),_:1})])])}}}),Pl={class:"page-container"},Kl={class:"page-panel",style:{height:"calc(100vh - 84px)","overflow-y":"auto"}},ql={style:{height:"calc(100vh - 164px)"}},Wl=["onMouseenter","onMouseleave"],Hl={key:0,style:{right:"8px"}},Zl={style:{position:"absolute",bottom:"0",width:"100%","text-align":"center","border-top":"var(--color-border) 1px solid",padding:"10px 0 0 0"}},Xl={class:"page-panel-no-padding",style:{height:"calc(100vh - 84px)","overflow-y":"auto",display:"flex","align-items":"center"}},Ro=Y({__name:"index",setup(x){const V=o(),g=o([]),n=o(),l=o(),u=o(),c=o(),i=async()=>{g.value=(await we()).data,g.value.length>0&&(n.value=g.value[0],await me(()=>{var O;c.value.initOrgMemberTableData(),u.value.selectNode([(O=n.value)==null?void 0:O.key],!0)}))},y=(O,s)=>{s.node&&(n.value=s.node,me(()=>{c.value.initOrgMemberTableData()}))},D=o(),v=()=>{D.value.initData()},p=o(""),r=Z(()=>p.value?Ee(p.value,g.value):g.value);Je(()=>{i()});const a=o(),d=o("org-group"),f=O=>{var s;((s=V.value)==null?void 0:s.key)!==O.key&&d.value==="role"&&a.value&&a.value.clearSelect(),V.value=O},$=o("user"),E=(O,s)=>{O.showExtra=s},R=o(!1),I=()=>{l.value=void 0,R.value=!0},S=O=>{l.value=O,R.value=!0},z=O=>{pe.confirm({title:"\u63D0\u793A",simple:!1,draggable:!0,titleAlign:"start",content:`\u6B64\u64CD\u4F5C\u5C06\u6C38\u4E45\u5220\u9664'${O==null?void 0:O.title}' , \u662F\u5426\u7EE7\u7EED?`,okText:"\u786E\u5B9A",async onOk(){try{O&&(await Gt(O.key),await i(),ee.success("\u5220\u9664\u6210\u529F"))}catch{ee.error("\u5220\u9664\u5931\u8D25")}}})};rt.on("user-adjust-org-success-event",async()=>{g.value=(await we()).data});const W=async O=>{var s,_;g.value=(await we()).data,R.value=!1,n.value&&((s=n.value)==null?void 0:s.title)&&O.id===((_=n.value)==null?void 0:_.key)&&(n.value.title=O.name)};return(O,s)=>{const _=he,m=Ie("icon-font"),k=Qe,A=ce,b=Ge,B=Ce,L=ge,H=et,M=ke,C=be;return h(),j("div",Pl,[t(Pt,{"left-width":{xxl:4,xl:4,lg:8,md:8,sm:8,xs:8},mode:"space"},{left:e(()=>[F("div",Kl,[t(C,{"active-key":d.value,"onUpdate:activeKey":s[1]||(s[1]=N=>d.value=N)},{default:e(()=>[t(M,{key:"org-group",title:"\u7EC4\u7EC7\u67B6\u6784"},{default:e(()=>[F("div",ql,[t(_,{modelValue:p.value,"onUpdate:modelValue":s[0]||(s[0]=N=>p.value=N),"allow-clear":!0,placeholder:"\u8BF7\u8F93\u5165\u90E8\u95E8\u540D\u79F0\u641C\u7D22",style:{"margin-bottom":"8px"}},null,8,["modelValue"]),t(H,{style:{height:"calc(100vh - 252px)","overflow-y":"auto"}},{default:e(()=>[g.value.length>0?(h(),T(B,{key:0,ref_key:"treeRef",ref:u,"block-node":"","default-expand-all":!0,data:r.value,onSelect:y},{title:e(N=>[F("div",{style:{height:"24px",width:"58vw",display:"flex","align-items":"center","white-space":"nowrap"},onMouseenter:K=>E(N,!0),onMouseleave:K=>E(N,!1)},[F("div",null,[t(m,{type:"icon-organization"}),w(" "+U(N.title)+"("+U(N.data)+") ",1)]),N.showExtra?(h(),j("div",Hl,[t(A,{type:"text",size:"mini",onClick:Be(K=>S(N),["stop"])},{icon:e(()=>[t(k)]),_:2},1032,["onClick"]),N.key!=="0"?(h(),T(A,{key:0,type:"text",size:"mini",onClick:Be(K=>z(N),["stop"])},{icon:e(()=>[t(b)]),_:2},1032,["onClick"])):q("",!0)])):q("",!0)],40,Wl)]),_:1},8,["data"])):q("",!0),J(t(L,null,null,512),[[Q,r.value.length===0]])]),_:1}),F("div",Zl,[t(A,{size:"mini",onClick:I},{icon:e(()=>[t(m,{type:"icon-organization"})]),default:e(()=>[w(" \u6DFB\u52A0\u90E8\u95E8 ")]),_:1})])])]),_:1}),t(M,{key:"role",title:"\u89D2\u8272"},{default:e(()=>[d.value==="role"?(h(),T(pa,{key:0,ref_key:"sysRolePaneRef",ref:D,"init-role-data-node":V.value,onGetCurrentRoleNode:f},null,8,["init-role-data-node"])):q("",!0)]),_:1})]),_:1},8,["active-key"])])]),right:e(()=>[J(F("div",null,[J(F("div",null,[t(la,{ref_key:"orgGroupsRef",ref:c,"current-org-data-node":n.value},null,8,["current-org-data-node"])],512),[[Q,n.value!==void 0]]),J(F("div",Xl,[t(L,{description:"\u8BF7\u9009\u62E9\u4E00\u4E2A\u90E8\u95E8"})],512),[[Q,n.value===void 0]])],512),[[Q,d.value==="org-group"]]),J(t(zl,{ref_key:"rolePermRef",ref:a,"default-active-key":$.value,"current-role-data-node":V.value,onTabChange:s[2]||(s[2]=N=>$.value=N),onEditRoleSubmit:v},null,8,["default-active-key","current-role-data-node"]),[[Q,d.value==="role"]])]),_:1}),t(oa,{"current-org-data-node":l.value,visible:R.value,onOk:W,onCancel:s[3]||(s[3]=N=>R.value=!1)},null,8,["current-org-data-node","visible"])])}}});export{Ro as default};
