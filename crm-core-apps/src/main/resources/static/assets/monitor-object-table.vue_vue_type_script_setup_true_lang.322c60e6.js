import{a as he,l as x,X as fe,Y as ge}from"./index.e9d54774.js";/* empty css                *//* empty css               *//* empty css                *//* empty css                */import{d as ye,f as m,r as be,c as z,w as D,o as ve,n as j,aT as Ce,D as g,E as U,aS as p,aI as r,H as A,u as i,aH as _,aZ as I,aY as E,aW as K,bz as xe,G as _e,aU as ke,aO as we,cf as Ve,aP as Ae,bZ as Ie,aN as Ke,bt as Oe,a_ as Be,aM as ze,b0 as Ee,bB as Pe}from"./arco.a97fe066.js";import{p as Se}from"./pagination.72a5f225.js";import{q as Re}from"./monitor-object.647fdfa2.js";import{d as De}from"./index.127a6572.js";import{c as Me}from"./host-group.ed397ed1.js";import{_ as Ge}from"./index.vue_vue_type_script_setup_true_lang.d3e8b168.js";const He={style:{display:"flex"}},Ne={key:0},je={class:"selected-count"},Je=ye({__name:"monitor-object-table",props:{modelValue:{},monitorObjectQueryParams:{},disableKeys:{default:()=>[]},height:{},selectAllMode:{default:()=>({enabled:!1,selectAll:!1})}},emits:["update:modelValue","update:selectAllMode"],setup(W,{expose:F,emit:q}){const{loading:$,setLoading:M}=he(!1),{pagination:y,pageSizeOptions:L}=Se(),b=m(),Q=m(),u=m(!1),o=W,k=m({size:"mini",height:"auto",columnConfig:{resizable:!0},rowConfig:{keyField:"checkId",isHover:!0},checkboxConfig:{reserve:!0},showOverflow:"tooltip",columns:[{type:"checkbox",width:40},{title:"\u76D1\u63A7\u5BF9\u8C61",slots:{default:"displayName"},minWidth:200},{title:"IP",field:"ip",minWidth:120},{title:"\u5E94\u7528",field:"appName",minWidth:120},{title:"\u7C7B\u578B",slots:{default:"category"},minWidth:120},{title:"\u5B50\u7C7B",slots:{default:"subtype"},minWidth:120}]}),l=be({queryStr:"",appKey:"",appKeys:[],ip:"",subtype:"",accurate:!0,zabbixHostGroupIds:[],zabbixHostGroupIdsWithAppKey:[]}),P=m([]),s=m([]),T=z(()=>{const t=b.value,e=[];return t&&(e.push(...t.getCheckboxRecords()),e.push(...t.getCheckboxReserveRecords())),e}),w=t=>`${t.checkId}`,O=()=>{j(()=>{var e;const t=b.value;P.value.forEach(a=>{var C;const n=a.checkId,h=w(a),v=s.value.indexOf(h)!==-1&&((C=o.disableKeys)==null?void 0:C.indexOf(h))===-1;t.getRowById(n)&&t.setCheckboxRow(t.getRowById(n),v)}),(e=o.disableKeys)!=null&&e.length&&k.value.checkboxConfig&&(k.value.checkboxConfig.checkMethod=({row:a})=>{var n;return((n=o.disableKeys)==null?void 0:n.indexOf(a.checkId))===-1})})},B=async(t={...l,page:y})=>{M(!0);try{const e=b.value,{data:a}=await Re(t);y.total=a.totalElements,e&&(await e.loadData(a.content),P.value=a.content)}catch(e){console.error(e)}finally{M(!1),setTimeout(()=>{var e,a;((e=o.selectAllMode)==null?void 0:e.enabled)&&u.value?(a=b.value)==null||a.setAllCheckboxRow(!0):O()},10)}},G=q;D(()=>o.modelValue,t=>{t&&(s.value=x.cloneDeep(t),O())},{deep:!0,immediate:!0}),D(()=>o.disableKeys,t=>{t&&O()},{deep:!0,immediate:!0}),D(()=>u.value,t=>{var e,a;typeof t<"u"&&(t?((e=b.value)==null||e.setAllCheckboxRow(!0),Object.assign(k.value,{checkboxConfig:{reserve:!0,checkMethod:()=>!1}})):t||((a=b.value)==null||a.setAllCheckboxRow(!1),Object.assign(k.value,{checkboxConfig:{reserve:!0}}),s.value=[])),G("update:selectAllMode",{enabled:!0,selectAll:t,queryParams:x.cloneDeep(l)})});const Y=t=>{const{checked:e,row:a}=t;e?s.value.push(w(a)):(s.value=s.value.filter(n=>n!==w(a)),u.value=!1),G("update:modelValue",s.value)},H=z(()=>x.reduce(P.value,(t,e)=>{var n;const a=w(e);return((n=o.disableKeys)==null?void 0:n.indexOf(a))===-1&&t.push(w(e)),t},[])),Z=t=>{const{checked:e}=t;if(e){const a=H.value.filter(n=>!s.value.includes(n));s.value.push(...a)}else s.value=s.value.filter(a=>!H.value.includes(a)),u.value=!1},d=De(async()=>{await B()},500),X=t=>{y.current=t,B()},J=t=>{y.pageSize=t,B()},ee=()=>{l.queryStr="",o.monitorObjectQueryParams&&x.assign(l,o.monitorObjectQueryParams)},V=m([]),te=m([]),S=m(!1),ae=async()=>{ee(),s.value=x.cloneDeep(o.modelValue?o.modelValue:[]),await B(),Me().then(t=>{V.value=t.data,t.data.forEach(e=>{te.value.push(e)}),t.data.length===1&&(S.value=!0,l.appKey=t.data[0].value)})},le=()=>s.value,oe=()=>T.value,se=z(()=>{const t=[];let e;return l.appKey?e=V.value.filter(a=>a.value===l.appKey):e=V.value,e.length>0&&e.forEach(a=>{var h;const n=(h=a.children)==null?void 0:h.map(v=>{const C=v.value;return{label:v.label,value:C.split("/")[1]}});t.push(...n)}),t}),ne=z(()=>l.appKeys&&l.appKeys.length>0?V.value.filter(t=>x.includes(l.appKeys,t.value)):V.value);return ve(()=>{j(()=>{o.selectAllMode&&o.selectAllMode.enabled&&(u.value=o.selectAllMode.selectAll,Object.assign(l,o.selectAllMode.queryParams))})}),F({initData:ae,getSelectRow:oe,getSelectRowKeys:le}),(t,e)=>{const a=we,n=Ve,h=Ae,v=Ie,C=fe,ue=ge,ie=Ke,re=Oe,N=Be,ce=ze,de=Ee,pe=Pe,me=Ce("vxe-grid");return g(),U(ke,null,[p(de,null,{default:r(()=>{var f;return[p(N,{span:18},{default:r(()=>[A("div",He,[p(re,{style:{"margin-bottom":"5px"}},{default:r(()=>{var R;return[p(Ge,{modelValue:l.subtype,"onUpdate:modelValue":e[0]||(e[0]=c=>l.subtype=c),disabled:u.value,style:{width:"170px"},placeholder:"\u8BF7\u9009\u62E9\u7C7B\u578B",onUpdate:i(d)},null,8,["modelValue","disabled","onUpdate"]),S.value?(g(),_(a,{key:0,modelValue:l.zabbixHostGroupIds,"onUpdate:modelValue":e[1]||(e[1]=c=>l.zabbixHostGroupIds=c),"virtual-list-props":{height:300},options:se.value,disabled:u.value,"allow-search":"",style:{width:"200px"},"allow-clear":"",multiple:"",placeholder:"\u8BF7\u9009\u62E9\u5206\u7EC4","max-tag-count":1,onChange:i(d),onClear:i(d)},null,8,["modelValue","options","disabled","onChange","onClear"])):I("",!0),S.value?I("",!0):(g(),_(n,{key:1,modelValue:l.zabbixHostGroupIdsWithAppKey,"onUpdate:modelValue":e[2]||(e[2]=c=>l.zabbixHostGroupIdsWithAppKey=c),options:ne.value,disabled:u.value,placeholder:"\u8BF7\u9009\u62E9\u5206\u7EC4","allow-search":"",style:{width:"200px"},"allow-clear":"",multiple:"","max-tag-count":1,"virtual-list-props":{height:300},onChange:i(d),onClear:i(d)},null,8,["modelValue","options","disabled","onChange","onClear"])),p(h,{modelValue:l.displayName,"onUpdate:modelValue":e[3]||(e[3]=c=>l.displayName=c),style:{width:"200px"},disabled:u.value,placeholder:"\u76D1\u63A7\u5BF9\u8C61","allow-clear":"",onClear:i(d),onInput:i(d)},null,8,["modelValue","disabled","onClear","onInput"]),p(h,{modelValue:l.ip,"onUpdate:modelValue":e[5]||(e[5]=c=>l.ip=c),style:{width:"200px"},disabled:u.value,placeholder:"IP","allow-clear":"",onClear:i(d),onInput:i(d)},{suffix:r(()=>[p(v,{modelValue:l.accurate,"onUpdate:modelValue":e[4]||(e[4]=c=>l.accurate=c),disabled:u.value,onChange:i(d)},{default:r(()=>[E(" \u7CBE\u786E ")]),_:1},8,["modelValue","disabled","onChange"])]),_:1},8,["modelValue","disabled","onClear","onInput"]),(R=t.selectAllMode)!=null&&R.enabled?(g(),_(ie,{key:2,type:"primary",onClick:e[6]||(e[6]=c=>u.value=!u.value)},{icon:r(()=>[u.value?(g(),_(ue,{key:1})):(g(),_(C,{key:0}))]),default:r(()=>[E(" "+K(u.value?"\u53D6\u6D88\u5168\u9009":"\u9009\u62E9\u5168\u90E8"),1)]),_:1})):I("",!0)]}),_:1})])]),_:1}),(f=o.disableKeys)!=null&&f.length?(g(),_(N,{key:0,span:6,style:{"text-align":"right"}},{default:r(()=>[s.value.length>0?(g(),U("span",Ne,[A("span",je,"\u5DF2\u9009\u62E9\u4E86"+K(s.value.length)+"\u6761",1),p(ce,{onClick:e[7]||(e[7]=R=>{s.value=[],O()})},{default:r(()=>[E(" \u6E05\u7A7A ")]),_:1})])):I("",!0)]),_:1})):I("",!0)]}),_:1}),A("div",{style:_e({height:o.height?o.height:"calc(100vh - 176px)"})},[p(me,xe({ref_key:"xGrid",ref:b,loading:i($)},k.value,{onCheckboxChange:Y,onCheckboxAll:Z}),{displayName:r(({row:f})=>[E(K(f.displayName),1)]),category:r(({row:f})=>[A("span",null,K(f.categoryName||"--"),1)]),subtype:r(({row:f})=>[A("span",null,K(f.subtypeName||"--"),1)]),pager:r(()=>[p(pe,{ref_key:"xPagination",ref:Q,current:i(y).current,"page-size":i(y).pageSize,total:i(y).total,"page-size-options":i(L),style:{"padding-top":"10px"},"show-total":"","show-jumper":"","show-page-size":"",onChange:X,onPageSizeChange:J},null,8,["current","page-size","total","page-size-options"])]),_:1},16,["loading"])],4)],64)}}});export{Je as _};
