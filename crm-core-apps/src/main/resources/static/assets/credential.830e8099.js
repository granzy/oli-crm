import{a as T,l as A}from"./index.e9d54774.js";/* empty css                *//* empty css               *//* empty css               */import{d as M,cu as H,cv as G,f as c,D as C,aH as E,aI as t,aS as e,aY as p,aZ as S,bg as z,aP as j,bo as W,c7 as Z,c8 as J,bs as Q,aN as N,bt as I,bp as X,r as ee,o as ae,aT as ue,E as te,H as V,u as g,bz as oe,bq as le,a_ as ne,b0 as se,aM as ie,bB as re,bi as de}from"./arco.a97fe066.js";import{p as me}from"./pagination.72a5f225.js";import{c as ce,s as pe,a as fe,d as _e}from"./credential.27b94543.js";/* empty css              *//* empty css                */import{d as ge}from"./index.127a6572.js";import"./chart.a235fbdf.js";import"./vue.4eb70094.js";const Fe=M({__name:"form",props:H({isEdit:{type:Boolean,default:!1}},{form:{},formModifiers:{}}),emits:H(["afterSubmit"],["update:form"]),setup(h,{emit:b}){const D=h,u=G(h,"form"),F=b,v=c(),f={name:[{required:!0,message:"\u51ED\u8BC1\u540D\u4E0D\u80FD\u4E3A\u7A7A"},{maxLength:128,message:"\u51ED\u8BC1\u540D\u6700\u5927\u957F\u5EA6\u4E0D\u80FD\u8D85\u8FC7128\u5B57\u7B26"},{validator:ge(async(l,o)=>{const{data:d}=await ce(l);d&&!D.isEdit&&o("\u8BE5\u540D\u79F0\u5DF2\u5B58\u5728")},500)}],username:[{maxLength:128,message:"\u7528\u6237\u540D\u6700\u5927\u957F\u5EA6\u4E0D\u80FD\u8D85\u8FC7128\u5B57\u7B26"}],password:[{maxLength:128,message:"\u5BC6\u7801\u6700\u5927\u957F\u5EA6\u4E0D\u80FD\u8D85\u8FC7128\u5B57\u7B26"}],keyFilePath:[{maxLength:255,message:"\u7CFB\u7EDF\u7248\u672C\u6700\u5927\u957F\u5EA6\u4E0D\u80FD\u8D85\u8FC7255\u5B57\u7B26"}],keyPassphrase:[{maxLength:128,message:"\u79C1\u94A5\u5BC6\u7801\u6700\u5927\u957F\u5EA6\u4E0D\u80FD\u8D85\u8FC7200\u5B57\u7B26"}]},n=()=>{v.value.validate(l=>{l||pe(u.value).then(()=>{z.success("\u64CD\u4F5C\u6210\u529F")}).catch(o=>{z.error(`\u64CD\u4F5C\u5931\u8D25: ${o}`)}).finally(()=>{F("afterSubmit")})})},k=l=>{Object.assign(u.value,{keyFilePath:l?`/home/${l}/.ssh/id_rsa`:""})};return(l,o)=>{const d=j,s=W,r=Z,w=J,B=Q,y=N,P=I,x=X;return C(),E(x,{ref_key:"formRef",ref:v,"label-align":"right","auto-label-width":"",layout:"vertical",model:u.value,rules:f,onSubmit:a=>{}},{default:t(()=>[e(s,{field:"name",label:"\u51ED\u8BC1\u540D\u79F0"},{default:t(()=>[e(d,{modelValue:u.value.name,"onUpdate:modelValue":o[0]||(o[0]=a=>u.value.name=a),modelModifiers:{trim:!0},placeholder:"\u8BF7\u8F93\u5165\u51ED\u8BC1\u540D\u79F0..."},null,8,["modelValue"])]),_:1}),e(s,{field:"username",label:"\u4E3B\u673A\u7528\u6237\u540D"},{default:t(()=>[e(d,{modelValue:u.value.username,"onUpdate:modelValue":o[1]||(o[1]=a=>u.value.username=a),placeholder:"\u8BF7\u8F93\u5165\u7528\u6237\u540D...",onChange:k},null,8,["modelValue"])]),_:1}),e(s,{field:"connectProto",label:"\u8BA4\u8BC1\u65B9\u5F0F"},{default:t(()=>[e(w,{modelValue:u.value.connectProto,"onUpdate:modelValue":o[2]||(o[2]=a=>u.value.connectProto=a),type:"button"},{default:t(()=>[e(r,{value:"SSH_PLAIN"},{default:t(()=>[p("\u7528\u6237\u5BC6\u7801")]),_:1}),e(r,{value:"SSH_KEY"},{default:t(()=>[p("SSH\u514D\u5BC6")]),_:1})]),_:1},8,["modelValue"])]),_:1}),u.value.connectProto!=="SSH_KEY"?(C(),E(s,{key:0,field:"password",label:"\u5BC6\u7801"},{default:t(()=>[e(B,{modelValue:u.value.password,"onUpdate:modelValue":o[3]||(o[3]=a=>u.value.password=a),placeholder:"\u8BF7\u8F93\u5165\u5BC6\u7801..."},null,8,["modelValue"])]),_:1})):S("",!0),u.value.connectProto==="SSH_KEY"?(C(),E(s,{key:1,field:"keyFilePath",label:"\u79C1\u94A5\u8DEF\u5F84"},{default:t(()=>[e(d,{modelValue:u.value.keyFilePath,"onUpdate:modelValue":o[4]||(o[4]=a=>u.value.keyFilePath=a),placeholder:"\u8BF7\u8F93\u5165id_rsa\u8DEF\u5F84..."},null,8,["modelValue"])]),_:1})):S("",!0),u.value.connectProto==="SSH_KEY"?(C(),E(s,{key:2,field:"keyPassphrase",label:"\u79C1\u94A5\u5BC6\u7801"},{default:t(()=>[e(B,{modelValue:u.value.keyPassphrase,"onUpdate:modelValue":o[5]||(o[5]=a=>u.value.keyPassphrase=a),placeholder:"\u8BF7\u8F93\u5165key\u5BC6\u7801..."},null,8,["modelValue"])]),_:1})):S("",!0),e(s,{class:"noAfter"},{default:t(()=>[e(P,null,{default:t(()=>[e(y,{type:"primary",size:"small",onClick:n},{default:t(()=>[p("\u63D0\u4EA4")]),_:1}),e(y,{size:"small",onClick:o[6]||(o[6]=a=>l.$refs.formRef.resetFields())},{default:t(()=>[p(" \u91CD\u7F6E ")]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])}}}),ve={class:"page-container"},Ce={class:"page-panel"},De={style:{height:"calc(100vh - 145px)"}},ze=M({__name:"credential",setup(h){const{loading:b,setLoading:D}=T(!1),u=c(!1),F=c(!1),v={name:"",username:"",connectProto:"SSH_PLAIN"},f=c(A.clone(v)),{pagination:n,pageSizeOptions:k}=me(),l=c(),o=c(),d=c({size:"mini",height:"auto",columnConfig:{resizable:!0},rowConfig:{keyField:"id",isHover:!0},checkboxConfig:{reserve:!0},showOverflow:"tooltip",columns:[{title:"\u51ED\u8BC1\u540D\u79F0",field:"name",minWidth:120},{title:"\u7528\u6237\u540D",field:"username",minWidth:120},{title:"\u521B\u5EFA\u65F6\u95F4",field:"createTime",width:150},{title:"\u4FEE\u6539\u65F6\u95F4",field:"updateTime",width:150},{title:"\u64CD\u4F5C",width:120,fixed:"right",resizable:!1,slots:{default:"action"}}]}),s=ee({}),r=async(a={...s,page:n})=>{D(!0);const i=l.value;try{const{data:m}=await fe(a);n.total=m.totalElements,i&&await i.reloadData(m.content)}catch(m){console.error(m)}finally{D(!1)}},w=a=>{n.current=a,r()},B=a=>{n.pageSize=a,r()},y=async()=>{u.value=!1,await r()},P=a=>{f.value=A.cloneDeep(a),u.value=!0,F.value=!0},x=a=>{le.warning({title:"\u63D0\u793A",titleAlign:"start",hideCancel:!1,content:`\u786E\u5B9A\u5220\u9664\u51ED\u8BC1${a.name}\u5417?`,onOk:async()=>{await _e(a.id),z.success("\u5220\u9664\u6210\u529F"),await r()}})};return ae(()=>{r()}),(a,i)=>{const m=ne,R=N,$=I,U=se,L=ie,O=re,Y=ue("vxe-grid"),q=de;return C(),te("div",ve,[V("div",Ce,[V("div",null,[e(U,null,{default:t(()=>[e(m,{span:14}),e(m,{span:10,style:{"text-align":"right"}},{default:t(()=>[e($,{style:{"margin-bottom":"5px"}},{default:t(()=>[e(R,{type:"primary",onClick:i[0]||(i[0]=_=>{f.value=g(A).cloneDeep(v),u.value=!0,F.value=!1})},{default:t(()=>[p(" \u65B0\u5EFA ")]),_:1})]),_:1})]),_:1})]),_:1}),V("div",De,[e(Y,oe({ref_key:"xGrid",ref:l,loading:g(b)},d.value),{action:t(({row:_})=>[e($,null,{default:t(()=>[e(L,{type:"text",onClick:K=>P(_)},{default:t(()=>[p("\u7F16\u8F91")]),_:2},1032,["onClick"]),e(L,{type:"text",onClick:K=>x(_)},{default:t(()=>[p("\u5220\u9664")]),_:2},1032,["onClick"])]),_:2},1024)]),pager:t(()=>[e(O,{ref_key:"xPagination",ref:o,current:g(n).current,"page-size":g(n).pageSize,total:g(n).total,"page-size-options":g(k),style:{"padding-top":"10px"},"show-total":"","show-jumper":"","show-page-size":"",onChange:w,onPageSizeChange:B},null,8,["current","page-size","total","page-size-options"])]),_:1},16,["loading"])])]),e(q,{width:"50vw",title:"\u51ED\u8BC1\u8868\u5355",visible:u.value,"drawer-style":{padding:0},"mask-closable":!1,footer:!1,"unmount-on-close":"",onCancel:i[2]||(i[2]=_=>u.value=!1)},{default:t(()=>[e(Fe,{form:f.value,"onUpdate:form":i[1]||(i[1]=_=>f.value=_),"is-edit":F.value,onAfterSubmit:y},null,8,["form","is-edit"])]),_:1},8,["visible"])])])}}});export{ze as default};
