import{d as Q,f as y,r as $e,c as q,o as we,aT as U,ce as je,D as g,E as S,aS as n,aI as s,H as m,u as i,aY as u,aU as Se,aV as Pe,aH as C,aW as b,aZ as Ve,bN as Ge,bz as Ne,aP as Oe,a$ as ze,aO as He,bt as Te,aM as Le,P as Re,bG as Me,cx as We,a_ as Ke,b0 as qe,bY as Ue,bE as Ye,bB as Ze,bq as Y,bg as j}from"./arco.a97fe066.js";import{a as z,l as Je,_ as Qe}from"./index.e9d54774.js";/* empty css                *//* empty css               *//* empty css               *//* empty css               *//* empty css               */import{p as Xe}from"./pagination.72a5f225.js";import{g as Z,t as J,q as et,a as tt,e as at,b as ot,c as st}from"./monitor-object.647fdfa2.js";import{p as nt}from"./alert-record.078e7032.js";import{d as lt}from"./index.127a6572.js";import{f as it}from"./dict.7add4266.js";import{_ as ut}from"./batch-assign-host-group.vue_vue_type_script_setup_true_lang.1c13ab87.js";import{_ as rt,a as ct}from"./batch-assign-business.vue_vue_type_script_setup_true_lang.92520241.js";import{b as D}from"./bus.4c102fb6.js";import{u as dt}from"./router.2bf8d2ce.js";import{d as pt}from"./global.90f51a62.js";import{_ as mt}from"./index.vue_vue_type_script_setup_true_lang.5f4a4784.js";import{_ as bt}from"./index.vue_vue_type_script_setup_true_lang.8914bf7d.js";import{S as ft}from"./index.d4fbf381.js";import"./chart.a235fbdf.js";import"./vue.4eb70094.js";import"./config-backup-device.df1a641e.js";import"./color.562bf6e9.js";/* empty css              *//* empty css                *//* empty css                */import"./index.vue_vue_type_script_setup_true_lang.6079a524.js";/* empty css                */import"./zabbix.d3c3bb08.js";import"./app-instance.ab836c4c.js";import"./host-group.ed397ed1.js";import"./monitor-object-tag.71c4a187.js";/* empty css                */import"./business.22e8b088.js";import"./tree-util.a8ddc3e6.js";/* empty css                */import"./category.8586a983.js";const gt={class:"page-panel",style:{height:"calc(100vh - 84px)"}},yt={style:{display:"flex"}},ht={style:{"justify-content":"flex-end","margin-left":"auto"}},vt={key:0},_t={class:"selected-count"},Ct={style:{height:"calc(100vh - 146px)"}},kt=["onClick"],xt={style:{color:"var(--color-bg-5)"}},Dt={style:{display:"flex",width:"100%","padding-top":"10px","justify-content":"space-between"}},Bt={style:{"padding-top":"10px"}},It=Q({__name:"monitor-object-table",setup(X,{expose:h}){const B=y([]),{loading:P,setLoading:I}=z(!1),{pagination:f,pageSizeOptions:V}=Xe(),r=y(),A=y(),ee=y({size:"mini",height:"auto",columnConfig:{resizable:!0},rowConfig:{keyField:"checkId",isHover:!0},checkboxConfig:{reserve:!0},showOverflow:"tooltip",columns:[{type:"checkbox",width:40},{title:"\u76D1\u63A7\u5BF9\u8C61",field:"displayName",slots:{default:"displayName"},minWidth:200},{title:"IP",field:"ip",minWidth:120},{title:"\u542F\u7528\u72B6\u6001",slots:{default:"enable"},minWidth:120},{title:"\u53EF\u7528\u6027",slots:{default:"available"},minWidth:120},{title:"\u544A\u8B66\u72B6\u6001",slots:{default:"hostPriority"},minWidth:120},{title:"\u76EE\u5F55",slots:{default:"business"},minWidth:200},{title:"\u7C7B\u578B",slots:{default:"categoryName"},minWidth:120},{title:"\u5B50\u7C7B\u578B",slots:{default:"subtypeName"},minWidth:120},{title:"\u6807\u7B7E",slots:{default:"tag"},minWidth:200},{title:"\u5206\u7EC4",slots:{default:"hostGroup"},minWidth:200},{title:"Proxy\u76D1\u63A7",field:"zabbixProxyName",minWidth:120},{title:"\u5E94\u7528",field:"appName",minWidth:120}]}),H=()=>{const t=r.value;t&&t.getCheckboxRecords().push(...t.getCheckboxReserveRecords())},te=H,ae=H,G=()=>{const t=r.value;t&&(t.clearCheckboxReserve(),t.clearCheckboxRow())},o=$e({queryStr:"",businessId:"",enable:void 0,available:void 0,priorityList:[],subtype:void 0,category:void 0}),d=async(t={...o,page:f})=>{I(!0);const e=r.value,{data:l}=await et(t);f.total=l.totalElements,e&&await e.loadData(l.content),I(!1)},N=q(()=>{const t=r.value,e=[];return t&&(e.push(...t.getCheckboxRecords()),e.push(...t.getCheckboxReserveRecords())),e}),c=q(()=>{const t=r.value,e=[];return t&&(e.push(...t.getCheckboxRecords().map(l=>`${l.checkId}`)),e.push(...t.getCheckboxReserveRecords().map(l=>`${l.checkId}`))),e}),k=lt(async()=>{f.current=1,await d(),D.emit("refresh-monitor-object-left-tree-list",o)},500),T=t=>{f.current=t,d()},oe=t=>{f.pageSize=t,d()},{openInNewTab:se}=dt(),ne=t=>{se({name:"MonitorObjectDetail",query:{appKey:t.appKey,hostId:t.hostId,ip:t.ip}})},E=y(!1),F=y(!1),$=y(!1),le=async t=>{Y.confirm({title:"\u63D0\u793A",simple:!1,draggable:!0,closable:!1,titleAlign:"start",content:"\u6B64\u64CD\u4F5C\u5C06\u6C38\u4E45\u5220\u9664\u6240\u9009\u5BF9\u8C61 , \u662F\u5426\u7EE7\u7EED?",async onOk(){try{await ot(t),await d(),j.success("\u5220\u9664\u6210\u529F"),G()}catch{j.error("\u5220\u9664\u5931\u8D25")}}})},L=async(t,e)=>{Y.confirm({title:"\u63D0\u793A",simple:!1,draggable:!0,closable:!1,titleAlign:"start",content:`\u6B64\u64CD\u4F5C\u5C06${e?"\u542F\u7528":"\u7981\u7528"}\u6240\u9009\u5BF9\u8C61 , \u662F\u5426\u7EE7\u7EED?`,async onOk(){try{await st(t,e),await d(),j.success(`${e?"\u542F\u7528":"\u7981\u7528"}\u6210\u529F`),G(),D.emit("refresh-monitor-object-left-tree-list")}catch{j.error(`${e?"\u542F\u7528":"\u7981\u7528"}\u5931\u8D25`)}}})},v=t=>{t==="batchAssignHostGroup"?E.value=!0:t==="batchAssignTag"?F.value=!0:t==="batchAssignBusiness"?$.value=!0:t==="batchDelete"?le(c.value):t==="batchOpen"?L(c.value,!0):t==="batchClose"&&L(c.value,!1)},ie=t=>{const e=t.cell.getElementsByClassName("table-link")[0],{row:l}=t,{column:p}=t;return e&&e.scrollWidth>e.offsetWidth&&p.field==="displayName"&&l[p.field]?l[p.field]:null};we(async()=>{B.value=(await it("\u544A\u8B66\u7EA7\u522B")).data,await d()});const ue=t=>{o.appKey=void 0,o.tagId=void 0,o.businessId=t,o.zabbixHostGroupIds=[],o.subtype=void 0,o.category=void 0,d()},re=t=>{o.appKey=void 0,o.tagId=void 0,o.businessId=void 0,o.zabbixHostGroupIds=[],o.subtype=void 0,o.category=t,d()},ce=t=>{o.appKey=void 0,o.tagId=void 0,o.businessId=void 0,o.zabbixHostGroupIds=[],o.subtype=t,o.category=void 0,d()},de=t=>{t!=="-1"?o.tagId=t:o.tagId=void 0,o.appKey=void 0,o.businessId=void 0,o.zabbixHostGroupIds=[],o.subtype=void 0,o.category=void 0,d()},pe=(t,e)=>{o.businessId=void 0,o.tagId=void 0,t?o.appKey=t:o.appKey=void 0,e?o.zabbixHostGroupIds=[e]:o.zabbixHostGroupIds=[],o.subtype=void 0,o.category=void 0,d()},me=t=>t.businessDtos&&t.businessDtos.map(l=>l.name).join("\uFF0C")||"--",be=t=>t.hostGroupDtos&&t.hostGroupDtos.map(l=>l.name).join("\uFF0C")||"--",fe=t=>t.tagDtos&&t.tagDtos.map(l=>l.name).join("\uFF0C")||"--",O=y(""),{loading:ge,setLoading:R}=z(!1),ye=async(t,e)=>{if(t){R(!0);try{const l=(await tt(e.appKey,e.hostId)).data;if(l&&l.length===2){const p=l[0],x=l[1];p?O.value=p:O.value="",e.available=x}}catch(l){console.error(l)}finally{R(!1)}}},{loading:he,setLoading:M}=z(!1),ve=async t=>{try{M(!0);let e={category:""};t==="selected"?e.hostIdsWidthAppKey=c.value:t==="condition"&&(e=Je.assign(o,e)),pt(await at(e))}catch(e){console.error(e)}finally{M(!1)}};return h({onPageChange:T,searchDataByBusinessId:ue,searchDataByAppKeyAndHostGroupId:pe,searchDataByTagId:de,searchDataByCategoryCode:re,searchDataByCategorySubtype:ce}),(t,e)=>{const l=Oe,p=ze,x=He,W=Te,_e=Le,Ce=U("icon-font"),ke=Re,_=Me,xe=We,De=Ke,Be=qe,w=Ue,Ie=Ye,Ae=Ze,Ee=U("vxe-grid"),Fe=je("read-only");return g(),S("div",gt,[n(Be,null,{default:s(()=>[n(De,{span:24},{default:s(()=>[m("div",yt,[n(W,{style:{"margin-bottom":"5px"}},{default:s(()=>[n(l,{modelValue:o.queryStr,"onUpdate:modelValue":e[0]||(e[0]=a=>o.queryStr=a),style:{width:"320px"},placeholder:"\u76D1\u63A7\u5BF9\u8C61/IP","allow-clear":"",onClear:i(k),onInput:i(k)},null,8,["modelValue","onClear","onInput"]),n(x,{modelValue:o.enable,"onUpdate:modelValue":e[1]||(e[1]=a=>o.enable=a),style:{width:"120px"},placeholder:"\u542F\u7528\u72B6\u6001","allow-clear":"",onChange:i(k)},{default:s(()=>[n(p,{value:!0},{default:s(()=>[u("\u5DF2\u542F\u7528")]),_:1}),n(p,{value:!1},{default:s(()=>[u("\u5DF2\u505C\u7528")]),_:1})]),_:1},8,["modelValue","onChange"]),n(x,{modelValue:o.available,"onUpdate:modelValue":e[2]||(e[2]=a=>o.available=a),style:{width:"120px"},placeholder:"\u53EF\u7528\u6027","allow-clear":"",onChange:i(k)},{default:s(()=>[n(p,{value:"1"},{default:s(()=>[u("\u6B63\u5E38")]),_:1}),n(p,{value:"2"},{default:s(()=>[u("\u5F02\u5E38")]),_:1}),n(p,{value:"0"},{default:s(()=>[u("\u672A\u77E5")]),_:1})]),_:1},8,["modelValue","onChange"]),n(x,{modelValue:o.priorityList,"onUpdate:modelValue":e[3]||(e[3]=a=>o.priorityList=a),style:{width:"120px"},placeholder:"\u544A\u8B66\u72B6\u6001",multiple:"","allow-clear":"","max-tag-count":1,onChange:i(k)},{default:s(()=>[(g(!0),S(Se,null,Pe(B.value,a=>(g(),C(p,{key:a.code,value:a.code},{default:s(()=>[u(b(a.name),1)]),_:2},1032,["value"]))),128)),n(p,{value:""},{default:s(()=>[u("\u6B63\u5E38")]),_:1})]),_:1},8,["modelValue","onChange"])]),_:1}),m("div",ht,[n(W,null,{default:s(()=>[c.value.length>0?(g(),S("span",vt,[m("span",_t," \u5DF2\u9009\u62E9\u4E86"+b(c.value.length)+"\u6761 ",1),n(_e,{onClick:G},{default:s(()=>[u("\u6E05\u7A7A")]),_:1})])):Ve("",!0),n(Ce,{type:"icon-shuaxin",size:18,style:{cursor:"pointer",color:"var(--color-text-2)"},onClick:e[4]||(e[4]=a=>d())}),Ge((g(),C(xe,null,{icon:s(()=>[n(ke)]),content:s(()=>[n(_,{disabled:c.value.length===0,onClick:e[5]||(e[5]=a=>v("batchAssignBusiness"))},{default:s(()=>[u(" \u5206\u914D\u76EE\u5F55 ")]),_:1},8,["disabled"]),n(_,{disabled:c.value.length===0,onClick:e[6]||(e[6]=a=>v("batchAssignHostGroup"))},{default:s(()=>[u(" \u6279\u91CF\u5206\u7EC4 ")]),_:1},8,["disabled"]),n(_,{disabled:c.value.length===0,onClick:e[7]||(e[7]=a=>v("batchAssignTag"))},{default:s(()=>[u(" \u5206\u914D\u6807\u7B7E ")]),_:1},8,["disabled"]),n(_,{disabled:c.value.length===0,onClick:e[8]||(e[8]=a=>v("batchDelete"))},{default:s(()=>[u(" \u6279\u91CF\u5220\u9664 ")]),_:1},8,["disabled"]),n(_,{disabled:c.value.length===0,onClick:e[9]||(e[9]=a=>v("batchOpen"))},{default:s(()=>[u(" \u6279\u91CF\u542F\u7528 ")]),_:1},8,["disabled"]),n(_,{disabled:c.value.length===0,onClick:e[10]||(e[10]=a=>v("batchClose"))},{default:s(()=>[u(" \u6279\u91CF\u7981\u7528 ")]),_:1},8,["disabled"])]),default:s(()=>[u(" \u64CD\u4F5C ")]),_:1})),[[Fe]])]),_:1})])])]),_:1})]),_:1}),m("div",Ct,[n(Ee,Ne({ref_key:"xGrid",ref:r,loading:i(P)},ee.value,{"tooltip-config":{contentMethod:ie},onCheckboxChange:i(te),onCheckboxAll:i(ae)}),{displayName:s(({row:a})=>[m("div",{class:"table-link",onClick:K=>ne(a)},b(a.displayName),9,kt)]),enable:s(({row:a})=>[u(b(a.enable?"\u5DF2\u542F\u7528":"\u5DF2\u505C\u7528"),1)]),available:s(({row:a})=>[a.available!=="2"?(g(),C(w,{key:0,color:i(Z)(a.available)},{default:s(()=>[u(b(i(J)(a.available)),1)]),_:2},1032,["color"])):(g(),C(Ie,{key:1,content:i(ge)?"\u52A0\u8F7D\u4E2D...":O.value,onPopupVisibleChange:K=>ye(K,a)},{default:s(()=>[n(w,{style:{cursor:"pointer"},color:i(Z)(a.available)},{default:s(()=>[u(b(i(J)(a.available)),1)]),_:2},1032,["color"])]),_:2},1032,["content","onPopupVisibleChange"]))]),hostPriority:s(({row:a})=>[a.hostPriority?(g(),C(w,{key:0,color:`rgb(var(--${(a.hostPriority?a.hostPriority:"").toLowerCase()}-6))`},{default:s(()=>[m("span",xt,b(i(nt)[a.hostPriority]),1)]),_:2},1032,["color"])):(g(),C(w,{key:1,color:"green"},{default:s(()=>[u("\u6B63\u5E38")]),_:1}))]),categoryName:s(({row:a})=>[m("span",null,b(a.categoryName||"--"),1)]),subtypeName:s(({row:a})=>[m("span",null,b(a.subtypeName||"--"),1)]),business:s(({row:a})=>[m("span",null,b(me(a)),1)]),hostGroup:s(({row:a})=>[m("span",null,b(be(a)),1)]),tag:s(({row:a})=>[m("span",null,b(fe(a)),1)]),pager:s(()=>[m("div",Dt,[n(Ae,{ref_key:"xPagination",ref:A,current:i(f).current,"page-size":i(f).pageSize,total:i(f).total,"page-size-options":i(V),style:{"padding-top":"10px"},"show-total":"","show-jumper":"","show-page-size":"",onChange:T,onPageSizeChange:oe},null,8,["current","page-size","total","page-size-options"]),m("div",Bt,[n(mt,{"selected-data":c.value,loading:i(he),onExport:ve},null,8,["selected-data","loading"])])])]),_:1},16,["loading","tooltip-config","onCheckboxChange","onCheckboxAll"])]),n(ut,{visible:E.value,records:N.value,"check-keys":c.value,onOk:e[11]||(e[11]=a=>{E.value=!1,d(),i(D).emit("refresh-monitor-object-left-tree-list",o)}),onCancel:e[12]||(e[12]=a=>E.value=!1)},null,8,["visible","records","check-keys"]),n(rt,{visible:F.value,records:N.value,"check-keys":c.value,onOk:e[13]||(e[13]=a=>{F.value=!1,d(),i(D).emit("refresh-monitor-object-left-tree-list",o)}),onCancel:e[14]||(e[14]=a=>F.value=!1)},null,8,["visible","records","check-keys"]),n(ct,{visible:$.value,records:N.value,"check-keys":c.value,onOk:e[15]||(e[15]=a=>{$.value=!1,d(),i(D).emit("refresh-monitor-object-left-tree-list",o)}),onCancel:e[16]||(e[16]=a=>$.value=!1)},null,8,["visible","records","check-keys"])])}}});const At=Qe(It,[["__scopeId","data-v-7ef09b37"]]),Et={class:"page-container"},ma=Q({__name:"index",setup(X){const h=y(),B=r=>{h.value.searchDataByBusinessId(r)},P=(r,A)=>{h.value.searchDataByAppKeyAndHostGroupId(r,A)},I=r=>{h.value.searchDataByTagId(r)},f=r=>{h.value.searchDataByCategoryCode(r)},V=r=>{h.value.searchDataByCategorySubtype(r)};return(r,A)=>(g(),S("div",Et,[n(ft,{"left-width":{xxl:4,xl:4,lg:8,md:8,sm:8,xs:8},mode:"space"},{left:s(()=>[n(bt,{onSearchDataByBusinessId:B,onSearchDataByAppKeyAndHostGroupId:P,onSearchDataByTagId:I,onSearchDataByCategorySubtype:V,onSearchDataByCategoryCode:f},null,8,["onSearchDataByAppKeyAndHostGroupId"])]),right:s(()=>[n(At,{ref_key:"monitorObjectTableRef",ref:h},null,512)]),_:1})]))}});export{ma as default};
