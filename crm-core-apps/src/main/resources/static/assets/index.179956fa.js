import{h as T,l as L,a as Q,q as tt,k as et,Z as at}from"./index.e9d54774.js";/* empty css                *//* empty css               *//* empty css               *//* empty css                *//* empty css                */import{d as $,f as m,c as G,w as O,n as W,aT as ot,D,E,aS as t,aI as i,u as _,bz as nt,G as it,bB as rt,H as st,aY as S,aW as lt,aZ as V,aH as q,aU as ct,aV as ut,bg as pt,aN as mt,bX as dt,a_ as gt,b0 as ft,c9 as vt,bt as _t,bK as ht,c3 as yt,c4 as bt}from"./arco.a97fe066.js";import{h as Dt}from"./vue.4eb70094.js";import{_ as xt}from"./index.vue_vue_type_script_setup_true_lang.dff799f7.js";import{i as wt,e as Ft,a as Ct,r as kt,g as Et}from"./common.067deda9.js";import{r as Rt}from"./date-time.3a778351.js";/* empty css                */import{p as Bt}from"./pagination.72a5f225.js";import{d as St}from"./global.90f51a62.js";import{v as N}from"./v4.cf9713fe.js";import"./chart.a235fbdf.js";import"./moment.a1678c09.js";function Tt(d){return T.post("/zabbixEventStatisticReportDetail/getReportDetail",d,{timeout:36e5})}function zt(d){return T.get(`/zabbixEventStatisticReportDetail/getReportDetailProgress/${d}`)}function Pt(d){return T.post("/zabbixEventStatisticReportDetail/exportReport",d,{responseType:"blob",timeout:36e5})}const It=$({__name:"event-statistic-table",props:{reportConfig:{},tableData:{},dimension:{}},setup(d){const s=d,{pagination:r,pageSizeOptions:k}=Bt(),x=m(),u=G(()=>s.tableData.slice((r.current-1)*r.pageSize,r.current*r.pageSize));let h=[];const w=()=>{const o={border:!0,height:"auto",align:null,size:"mini",columnConfig:{resizable:!0},data:u.value};let v="",p=[];if(s.reportConfig){const c=L.find(s.reportConfig.statisticDimensionList,{name:s.dimension});if(c){p=c.fields;const C=L.findLast(h,{value:c.eventAttribute});v=C==null?void 0:C.label}}const y=[{field:"dimensionValue",title:v,minWidth:150},{field:"dimensionEventTotal",title:"\u4E8B\u4EF6\u603B\u6570",minWidth:150},{field:"dimensionEventPct",title:"\u4E8B\u4EF6\u603B\u6570\u5360\u6BD4",minWidth:150}];return p.forEach(c=>{y.push({field:c,title:Ft[c]||Ct[c]||kt[c],minWidth:150})}),{...o,columns:y}},R=m(),g=async()=>{h=await wt(),R.value=w(),r.total=s.tableData.length;const o=x.value;o&&await o.loadData(u.value)},l=o=>{r.current=o,g()},F=o=>{r.pageSize=o,g()};return O(()=>s.tableData,()=>{W(()=>{g()})},{deep:!0,immediate:!0}),(o,v)=>{const p=rt,y=ot("vxe-grid");return D(),E("div",{style:it({height:"calc(100vh - 250px)"})},[t(y,nt({ref_key:"xGrid",ref:x},R.value),{pager:i(()=>[t(p,{ref:"xPagination",current:_(r).current,"page-size":_(r).pageSize,total:_(r).total,"page-size-options":_(k),style:{"padding-top":"10px"},"show-total":"","show-jumper":"","show-page-size":"",onChange:l,onPageSizeChange:F},null,8,["current","page-size","total","page-size-options"])]),_:1},16)],4)}}}),Mt={class:"page-container"},At={class:"page-panel",style:{height:"calc(100vh - 84px)"}},Lt={key:0,style:{width:"100%",height:"calc(100vh - 200px)",display:"flex","align-items":"center","justify-content":"center"}},ee=$({__name:"index",setup(d){const s=Dt(),r=()=>{window.parent.history.state.back?et.push({path:window.parent.history.state.back}):window.history.go(-1)},{loading:k,setLoading:x}=Q(!1),u=m(),h=m(),w=m(),g=m((()=>{const e=Date.now(),a=60*60*24*1e3;return[e-a,e]})()),l=m({workId:N(),reportConfigId:s.query["report-config-id"],timeFrom:0,timeTill:0});let F;const o=()=>{F&&clearInterval(F)},v=m(0),p=m(0),y=G(()=>p.value===0?0:Math.floor(v.value/p.value*100)),c=async()=>{if(l.value.workId)try{const{data:e}=await zt(l.value.workId),[a,n]=e;(a===n||n===0)&&o(),v.value=a,p.value=n}catch(e){console.error(e),o()}},C=()=>{o(),F=setInterval(c,1e3)},z=async()=>{if(h.value=[],s.query["report-config-id"])try{x(!0),v.value=0,p.value=0,u.value=(await Et(s.query["report-config-id"])).data;const[e,a]=g.value;C(),l.value.timeFrom=Math.floor(e/1e3),l.value.timeTill=Math.floor(a/1e3),l.value.workId=N();const{data:n}=await Tt(l.value);n&&(h.value=Object.keys(n),w.value=n)}catch(e){console.error(e)}finally{x(!1)}},P=()=>{z()},j=()=>{const[e,a]=g.value;l.value.timeFrom=Math.floor(e/1e3),l.value.timeTill=Math.floor(a/1e3),P()},I=tt(),H=async()=>{var e,a,n;pt.loading("\u5DF2\u521B\u5EFA\u4E0B\u8F7D\u4EFB\u52A1\uFF0C\u5B8C\u6210\u540E\u6D4F\u89C8\u5668\u5C06\u81EA\u52A8\u4E0B\u8F7D\uFF01");try{try{I.addDownloadItem((e=u.value)==null?void 0:e.name),St(await Pt(l.value),`${(a=u.value)==null?void 0:a.name}.xlsx`),I.delDownloadItem((n=u.value)==null?void 0:n.name)}catch(b){console.error(b)}}catch(b){console.error(b)}};return O(()=>s.query["report-config-id"],()=>{W(()=>{z()})},{deep:!0,immediate:!0}),(e,a)=>{const n=at,b=mt,U=dt,B=gt,M=ft,Z=vt,A=_t,K=ht,X=yt,Y=bt;return D(),E("div",Mt,[st("div",At,[t(M,{style:{width:"100%","border-bottom":"1px solid var(--color-border)","margin-bottom":"4px","padding-bottom":"4px"}},{default:i(()=>[t(B,{span:12},{default:i(()=>{var f;return[t(b,{type:"text",onClick:r},{icon:i(()=>[t(n)]),default:i(()=>[S("\u8FD4\u56DE")]),_:1}),t(U,{direction:"vertical"}),S(" "+lt((f=u.value)==null?void 0:f.name),1)]}),_:1})]),_:1}),t(M,{style:{"margin-bottom":"4px","padding-bottom":"4px"}},{default:i(()=>[t(B,{span:18},{default:i(()=>[t(A,null,{default:i(()=>[t(Z,{modelValue:g.value,"onUpdate:modelValue":a[0]||(a[0]=f=>g.value=f),"show-time":"","value-format":"timestamp",style:{width:"400px"},"shortcuts-position":"left",shortcuts:_(Rt),onChange:j},null,8,["modelValue","shortcuts"])]),_:1})]),_:1}),t(B,{span:6,style:{"text-align":"right"}},{default:i(()=>[t(A,null,{default:i(()=>[t(xt,{onClick:P}),t(b,{type:"primary",onClick:H},{default:i(()=>[S("\u5BFC\u51FA")]),_:1})]),_:1})]),_:1})]),_:1}),_(k)?(D(),E("div",Lt,[t(K,{tip:`\u52A0\u8F7D\u4E2D,\u8BF7\u7A0D\u5019 ${y.value}%`},null,8,["tip"])])):V("",!0),w.value&&!_(k)?(D(),q(Y,{key:1},{default:i(()=>[(D(!0),E(ct,null,ut(h.value,(f,J)=>(D(),q(X,{key:J,title:f},{default:i(()=>[t(It,{"report-config":u.value,dimension:f,"table-data":w.value[f]},null,8,["report-config","dimension","table-data"])]),_:2},1032,["title"]))),128))]),_:1})):V("",!0)])])}}});export{ee as default};
