import{a as we,l as h,a1 as At,_ as Ft,a8 as at,k as Dt,ab as Ot}from"./index.e9d54774.js";/* empty css              *//* empty css               *//* empty css               *//* empty css               *//* empty css                *//* empty css                *//* empty css                *//* empty css               *//* empty css               *//* empty css               */import{d as je,f as n,o as Ve,n as Fe,c as ie,aT as De,D as z,E as W,aS as t,aI as a,aY as y,H as R,aU as Oe,aV as Ee,aW as Y,G as Se,u as j,aH as be,aZ as de,bz as Be,bh as Et,cs as Bt,a_ as Ie,b0 as Ke,bt as Re,ct as jt,cm as Tt,aP as Pe,bB as Ne,bi as Te,bI as zt,bJ as Mt,w as ye,br as $t,aN as lt,aM as ot,bZ as nt,bN as Je,bO as Xe,bq as St,bg as et,ch as Vt,P as It,ag as Kt,bG as Rt,cx as Pt,cy as Nt,cz as Lt,bX as qt,bo as Gt,a$ as Ut,aO as Ht,cA as Qt,bp as Wt,c6 as Zt}from"./arco.a97fe066.js";import{d as Yt}from"./index.127a6572.js";import{p as Le}from"./pagination.72a5f225.js";import{g as Jt,q as Xt,d as tt,l as ea,r as ta,a as aa}from"./zabbix-monitor-object.93807a64.js";import{a as la}from"./category.8586a983.js";import{_ as oa}from"./setting-draw.vue_vue_type_script_setup_true_lang.1e66f128.js";/* empty css                *//* empty css                */import{c as na}from"./index.0f61770a.js";import{_ as ua,l as ut,f as sa}from"./detail.vue_vue_type_script_setup_true_lang.95eb4752.js";import{A as ia}from"./index.47ae1652.js";import"./chart.a235fbdf.js";import"./vue.4eb70094.js";import"./table.vue_vue_type_script_setup_true_lang.4e051305.js";/* empty css               *//* empty css                */import"./_commonjs-dynamic-modules.30ae7933.js";import"./vuedraggable.umd.d90dc502.js";/* empty css                *//* empty css                *//* empty css               *//* empty css                */const ra=Z=>(zt("data-v-bd0dcedb"),Z=Z(),Mt(),Z),ca=ra(()=>R("p",null,null,-1)),da={style:{display:"none"}},pa={style:{height:"calc(100vh - 176px)"}},ma={name:"MetricItemSelector"},va=je({...ma,props:{modelValue:{type:Object},monitors:{type:Array},metrics:{type:Array},reportForm:{type:Object}},emits:["update:modelValue","setMetricTagFilterKeys"],setup(Z,{expose:X,emit:P}){var fe;const m=Z,F=P,V=n([]),N=n(),I=n([]),w=n([]),K=n(""),C=n(!1),D=n([]),M=n({}),$=n(),b=n([]),g=()=>{const u=$.value;b.value.forEach(d=>{u.getRowById(d)&&u.setCheckboxRow(u.getRowById(d),!0)})},v=n(((fe=m.reportForm)==null?void 0:fe.metricTagsFilterKeys)||[]),ee=async u=>{if(M.value=u,T.current=1,K.value="",m.reportForm){C.value=!0,S(!0);try{const d=h.cloneDeep(m.reportForm);if(d.selectAll&&(d.monitorObjects=[]),u.children&&u.children.length>0){const k=[{tag:"UMOP_ITEM_TYPE",value:u.children[0].type}];u.children.forEach(p=>{k.push({tag:"UMOP_ITEM_NAME",value:p.title})}),Object.assign(d,{zabbixTags:k}),D.value=(await Xt(d)).data,pe(),await Fe(()=>{const p=u.children[0].type,L=h.find(d.metricTagsFilterKeys,{type:p});L&&(b.value=L.itemKeys,g())})}}catch(d){console.error(d)}finally{S(!1)}}else console.error("props.reportForm undefined")},te=(u,d)=>{const k=d.checkedNodes.filter(p=>!p.children);I.value=u,F("update:modelValue",k)},oe=u=>{w.value=u},{loading:re,setLoading:q}=we(),c=()=>N.value.getCheckedNodes().filter(u=>!u.children);Ve(()=>{q(!0),Fe(()=>{Jt(m.reportForm).then(u=>{var k;const d=(k=m.metrics)==null?void 0:k.map(p=>`${p.type}_${p.name}`);V.value=u.data,I.value=d,setTimeout(()=>{w.value=N.value.getCheckedNodes({checkedStrategy:"parent",includeHalfChecked:!0}).map(p=>p.key),N.value.getCheckedNodes().forEach(p=>{var L;(L=m.metrics)==null||L.forEach(l=>{`${l.type}_${l.name}`===p.key&&(p.filterDiscoveryItemKeys=l.filterDiscoveryItemKeys)})}),w.value.length===0&&(w.value=V.value.map(p=>p.key)),F("update:modelValue",c())},10)}).finally(()=>{q(!1)})})});const{loading:G,setLoading:S}=we(!1),ae=n({size:"mini",height:"auto",columnConfig:{resizable:!0},rowConfig:{keyField:"key",isHover:!0},checkboxConfig:{reserve:!0},showOverflow:"tooltip",columns:[{type:"checkbox",width:40},{title:"\u5173\u952E\u5B57",field:"key",minWidth:120}]}),ce=u=>{const{checked:d,row:k}=u;d?b.value.push(k.key):b.value=b.value.filter(p=>p!==k.key)},Ce=u=>{const{checked:d}=u,k=H.value.map(p=>p.key);if(d){const p=k.filter(L=>!b.value.includes(L));b.value.push(...p)}else b.value=b.value.filter(p=>!k.includes(p))},ne=ie(()=>D.value.map(u=>({key:u}))),{pagination:T,pageSizeOptions:ue}=Le(),H=ie(()=>{let u=ne.value;if(K.value!==""){const p=K.value.toLowerCase();u=u.filter(L=>L.key.toLowerCase().includes(p))}const d=(T.current-1)*T.pageSize,k=T.current*T.pageSize;return T.total=u.length,u.slice(d,k)}),pe=()=>{T.total=ne.value.length;const u=$.value;u&&(u.loadData(H.value),g())},ge=u=>{T.current=u,pe()},me=u=>{T.pageSize=u,pe()},_e=()=>{v.value||(v.value=[]);let u="";if(M.value.children&&(u=M.value.children[0].type),u){const d=h.find(v.value,{type:u}),k={type:u,itemKeys:b.value};d?Object.assign(d,k):v.value.push(k),F("setMetricTagFilterKeys",v.value)}C.value=!1},ve=u=>{const d=h.find(v.value,{type:u});return d?d.itemKeys&&d.itemKeys.length>0:!1};return X({getSelectedMetrics:c}),(u,d)=>{const k=At,p=Et,L=Bt,l=Ie,i=Ke,_=Re,A=jt,O=De("icon-font"),E=Tt,U=Pe,ke=Ne,he=De("vxe-grid"),xe=Te;return z(),W("div",null,[t(p,{type:"normal",banner:"","show-icon":!1},{default:a(()=>[t(k),y(" \u8BF4\u660E: \u9ED8\u8BA4\u5305\u542B\u6240\u6709\u53D1\u73B0\u6307\u6807\u3002 ")]),_:1}),ca,R("div",{style:Se({display:j(re)?"":"none"})},[t(A,{animation:!0},{default:a(()=>[(z(),W(Oe,null,Ee(4,x=>t(_,{key:x,direction:"vertical",style:{width:"60%"}},{default:a(()=>[(z(),W(Oe,null,Ee(4,se=>t(i,{key:se},{default:a(()=>[t(l,{span:24-se,offset:se},{default:a(()=>[t(L)]),_:2},1032,["span","offset"])]),_:2},1024)),64)),R("span",da,Y(x),1)]),_:2},1024)),64))]),_:1})],4),t(E,{ref_key:"metricTree",ref:N,data:V.value,style:{height:"calc(100vh - 302px)",overflow:"auto"},"checked-keys":I.value,"expanded-keys":w.value,checkable:!0,onCheck:te,onExpand:oe},{extra:a(x=>[x.children&&x.children.length>0&&x.children[0].discover==="true"?(z(),be(O,{key:0,style:Se({color:ve(x.children[0].type)?"green":""}),type:"icon-shaixuan",class:"filter-icon",onClick:se=>ee(x)},null,8,["style","onClick"])):de("",!0)]),_:1},8,["data","checked-keys","expanded-keys"]),t(xe,{visible:C.value,width:"40%",title:"\u5173\u952E\u5B57\u9009\u62E9","mask-closable":!1,"esc-to-close":!1,"unmount-on-close":"",onCancel:d[2]||(d[2]=x=>C.value=!1),onOk:_e},{default:a(()=>[R("div",pa,[t(U,{modelValue:K.value,"onUpdate:modelValue":d[0]||(d[0]=x=>K.value=x),style:{width:"200px","margin-bottom":"12px"},placeholder:"\u5173\u952E\u5B57",onInput:d[1]||(d[1]=x=>ge(1))},null,8,["modelValue"]),t(he,Be({ref_key:"xGrid",ref:$,loading:j(G)},ae.value,{data:H.value,onCheckboxChange:ce,onCheckboxAll:Ce}),{pager:a(()=>[t(ke,{ref:"xPagination",size:"mini",current:j(T).current,"page-size":j(T).pageSize,total:j(T).total,"page-size-options":j(ue),style:{"padding-top":"10px"},"show-total":"","show-jumper":"","show-page-size":"",onChange:ge,onPageSizeChange:me},null,8,["current","page-size","total","page-size-options"])]),_:1},16,["loading","data"])])]),_:1},8,["visible"])])}}});const fa=Ft(va,[["__scopeId","data-v-bd0dcedb"]]),ya={style:{display:"flex","justify-content":"space-between"}},ba={key:0},ga={class:"selected-count"},_a={style:{display:"flex",width:"100%","padding-top":"10px","justify-content":"space-between"}},ha=je({__name:"zabbix-monitor-object-table",props:{typeName:{},height:{default:"calc(100vh - 188px)"},modelValue:{},monitorObjectQueryParams:{},disableKeys:{},selectAllMode:{},useGlobalAccount:{type:Boolean}},emits:["update:modelValue","update:selectAllMode"],setup(Z,{expose:X,emit:P}){const m=n(),{pagination:F,pageSizeOptions:V}=Le(),N=n(),I=n([]),w=n(""),K=n(),C=n([]),D=n(!1),M=n([{type:"checkbox",width:60},{title:"\u540D\u79F0",field:"name",width:200,slots:{default:"name"}},{title:"\u4E3B\u673A\u540D",field:"host",width:200},{title:"\u6A21\u677F\u540D",field:"templateNames",width:300},{title:"\u4E3B\u673A\u7EC4",field:"groupNames",width:100},{title:"\u63A5\u53E3",field:"interfaceNames",width:100},{title:"\u4EE3\u7406",field:"proxyName",width:100},{title:"\u5E94\u7528",field:"appName",width:200},{title:"\u63CF\u8FF0",field:"description",width:200},{title:"\u72B6\u6001",field:"statusName",width:200}]),{loading:$,setLoading:b}=we(!1),g=Z,v=n({size:"mini",height:"auto",columnConfig:{resizable:!0},rowConfig:{keyField:"primaryKey",isHover:!0},checkboxConfig:{reserve:!0},showOverflow:"tooltip",columns:[]}),ee=ie(()=>{const l=m.value,i=[];return l&&(i.push(...l.getCheckboxRecords()),i.push(...l.getCheckboxReserveRecords())),i}),te=l=>`${l.primaryKey}`,oe=()=>I.value.slice((F.current-1)*F.pageSize,F.current*F.pageSize),re=()=>{Fe(()=>{var i;const l=oe();if(l){const _=m.value;l.forEach(A=>{var U;const O=te(A),E=C.value.indexOf(O)!==-1&&((U=g.disableKeys)==null?void 0:U.indexOf(O))===-1;_.getRowById(O)&&_.setCheckboxRow(_.getRowById(O),E)})}(i=g.disableKeys)!=null&&i.length&&v.value.checkboxConfig&&(v.value.checkboxConfig.checkMethod=({row:_})=>{var A;return((A=g.disableKeys)==null?void 0:A.indexOf(_.primaryKey))===-1})})},q=P,c=l=>{const{checked:i,row:_}=l;i?C.value.push(te(_)):(C.value=C.value.filter(A=>A!==te(_)),D.value=!1),q("update:modelValue",C.value)},G=ie(()=>h.reduce(oe(),(l,i)=>{var A;const _=te(i);return((A=g.disableKeys)==null?void 0:A.indexOf(_))===-1&&l.push(te(i)),l},[])),S=l=>{const{checked:i}=l;if(i){const _=G.value.filter(A=>!C.value.includes(A));C.value.push(..._)}else C.value=C.value.filter(_=>!G.value.includes(_)),D.value=!1;q("update:modelValue",C.value)},ae=n([{field:"",condition:"",value:"",values:[]}]),ce=l=>{var i;if(l.length>0&&w.value){const _=["interfaces","zbxHostInventory","hostid"],A=h.filter(Object.keys(l[0]),E=>_.indexOf(E)===-1),O=(i=K.value)==null?void 0:i.fields.map(E=>E.inventoryField);return h.filter(l,E=>h.some(A,U=>E[U]&&E[U].toString().toLowerCase().includes(w.value.toLowerCase()))||h.some(O,U=>E.zbxHostInventory&&E.zbxHostInventory[U]&&E.zbxHostInventory[U].toString().toLowerCase().includes(w.value.toLowerCase())))}return sa(l,ae.value)},Ce=()=>{w.value="",g.monitorObjectQueryParams&&(w.value=g.monitorObjectQueryParams.keyword,g.monitorObjectQueryParams.advanceFilterList&&(ae.value=g.monitorObjectQueryParams.advanceFilterList))},ne=ie(()=>ae.value.filter(l=>l.value||l.values&&l.values.length>0)),T=()=>{const l=m.value;l&&(l.clearCheckboxReserve(),l.clearCheckboxRow(),q("update:modelValue",[]),q("update:selectAllMode",{enabled:!0,selectAll:D.value,queryParams:{keyword:h.cloneDeep(w.value),advanceFilterList:h.cloneDeep(ne.value)}}))},ue=async()=>{var l;try{if(D.value=(l=g.selectAllMode)==null?void 0:l.selectAll,b(!0),g.typeName){const{data:i}=await ut(g.typeName,g.useGlobalAccount);I.value=ce(i),F.total=I.value.length,F.current=1,m.value&&await m.value.loadData(oe())}}catch(i){console.error(i)}finally{b(!1),setTimeout(()=>{var i,_,A,O;((i=g.selectAllMode)==null?void 0:i.enabled)&&D.value?((_=m.value)==null||_.clearCheckboxReserve(),(A=m.value)==null||A.clearCheckboxRow(),(O=m.value)==null||O.setAllCheckboxRow(!0)):re()},10)}},H=l=>{F.current=l,m.value&&m.value.loadData(oe())},pe=l=>{F.pageSize=l,m.value&&m.value.loadData(oe())},ge=async()=>{g.typeName&&(K.value=(await at(g.typeName)).data,M.value.push(...K.value.fields.map(l=>({title:l.fieldName,field:`zbxHostInventory.${l.inventoryField}`,width:200}))),v.value.columns=N.value.genActualColumnConfig(`zabbix_monitor_object_table_select_${g.typeName}`,M.value))},me=n(),_e=n(),ve=n(!1),fe=l=>{me.value=l.appKey,_e.value=l.hostId,ve.value=!0};Ve(()=>{v.value.columns=N.value.genActualColumnConfig(`zabbix_monitor_object_table_select_${g.typeName}`,M.value)});const u=l=>{v.value.columns=l};ye(()=>g.modelValue,l=>{l&&(C.value=h.cloneDeep(l),re())},{deep:!0,immediate:!0}),ye(()=>g.disableKeys,l=>{l&&re()},{deep:!0,immediate:!0}),ye(()=>D.value,l=>{var i,_,A,O;typeof l<"u"&&(l?((i=m.value)==null||i.clearCheckboxReserve(),(_=m.value)==null||_.clearCheckboxRow(),(A=m.value)==null||A.setAllCheckboxRow(!0),Object.assign(v.value,{checkboxConfig:{reserve:!0,checkMethod:()=>!1}}),C.value=ee.value.map(E=>E.primaryKey)):l||((O=m.value)==null||O.setAllCheckboxRow(!1),Object.assign(v.value,{checkboxConfig:{reserve:!0}}),C.value=[])),q("update:modelValue",C.value),q("update:selectAllMode",{enabled:!0,selectAll:l,queryParams:{keyword:h.cloneDeep(w.value),advanceFilterList:h.cloneDeep(ne.value)}})}),ye(()=>ae.value,()=>{q("update:selectAllMode",{enabled:!0,selectAll:D.value,queryParams:{keyword:h.cloneDeep(w.value),advanceFilterList:h.cloneDeep(ne.value)}})},{deep:!0}),ye(()=>w.value,l=>{q("update:selectAllMode",{enabled:!0,selectAll:D.value,queryParams:{keyword:h.cloneDeep(l),advanceFilterList:h.cloneDeep(ne.value)}})});const d=()=>{Ce(),ge(),ue()},k=()=>ee.value,p=ie(()=>M.value.filter(l=>l.title!=="\u64CD\u4F5C"&&l.title).map(l=>({title:l.title,field:l.field,valueType:"string"}))),L=()=>{ue()};return X({initData:d,getSelectRow:k}),(l,i)=>{const _=Pe,A=lt,O=Re,E=ot,U=nt,ke=Ne,he=De("vxe-grid"),xe=Te;return z(),W("div",null,[R("div",ya,[t(O,{style:{"margin-bottom":"5px"}},{default:a(()=>[t(_,{modelValue:w.value,"onUpdate:modelValue":i[0]||(i[0]=x=>w.value=x),style:{width:"200px"},placeholder:"\u5173\u952E\u8BCD","allow-clear":"",onKeyup:i[1]||(i[1]=$t(x=>ue(),["enter"]))},null,8,["modelValue"]),t(A,{type:"primary",onClick:i[2]||(i[2]=x=>ue())},{default:a(()=>[y("\u67E5\u8BE2")]),_:1}),t(ia,{modelValue:ae.value,"onUpdate:modelValue":i[3]||(i[3]=x=>ae.value=x),"field-options":p.value,onOk:L},null,8,["modelValue","field-options"])]),_:1}),t(O,null,{default:a(()=>{var x;return[k().length>0&&!D.value?(z(),W("span",ba,[R("span",ga," \u5DF2\u9009\u62E9\u4E86"+Y(k().length)+"\u6761 ",1),t(E,{onClick:T},{default:a(()=>[y("\u6E05\u7A7A")]),_:1})])):de("",!0),(x=l.selectAllMode)!=null&&x.enabled?(z(),be(U,{key:1,modelValue:D.value,"onUpdate:modelValue":i[4]||(i[4]=se=>D.value=se)},{default:a(()=>[y(" \u6309\u641C\u7D22\u6761\u4EF6\u52A8\u6001\u9009\u62E9\u5BF9\u8C61 ")]),_:1},8,["modelValue"])):de("",!0)]}),_:1})]),R("div",{style:Se({height:l.height})},[t(he,Be({ref_key:"gridRef",ref:m,loading:j($),style:{"margin-top":"6px"}},v.value,{onCheckboxChange:c,onCheckboxAll:S}),{name:a(({row:x})=>[t(E,{hoverable:!1,style:{"font-size":"12px"},onClick:se=>fe(x)},{default:a(()=>[y(Y(x.name),1)]),_:2},1032,["onClick"])]),pager:a(()=>[R("div",_a,[t(ke,{ref:"xPagination",current:j(F).current,"page-size":j(F).pageSize,total:j(F).total,"page-size-options":j(V),"show-total":"","show-jumper":"","show-page-size":"",onChange:H,onPageSizeChange:pe},null,8,["current","page-size","total","page-size-options"]),R("div",null,[t(na,{ref_key:"columnConfigRef",ref:N,"column-config":M.value,"config-id":`zabbix_monitor_object_table_select_${l.typeName}`,onSave:u},null,8,["column-config","config-id"])])])]),_:1},16,["loading"]),t(xe,{visible:ve.value,width:"100vw","title-align":"start","mask-closable":!1,"unmount-on-close":"",footer:!1,onCancel:i[5]||(i[5]=x=>ve.value=!1)},{default:a(()=>[t(ua,{"type-name":l.typeName,"app-key":me.value,"host-id":_e.value},null,8,["type-name","app-key","host-id"])]),_:1},8,["visible"])],4)])}}}),Ca=je({__name:"index",props:{modelValue:{},disableKeys:{default:()=>[]},visible:{type:Boolean,default:!1},monitorObjectQueryParams:{},selectAllMode:{},typeName:{},useGlobalAccount:{type:Boolean}},emits:["update:modelValue","update:selectAllMode","getCurrentSelectRow","ok","cancel"],setup(Z,{expose:X,emit:P}){const m=Z,F=n(null),V=n(void 0),N=n([...m.modelValue]),I=n(),w=P,K=()=>{w("cancel")},C=()=>{w("update:modelValue",N.value),w("update:selectAllMode",V.value),w("getCurrentSelectRow",I.value.getSelectRow()),w("ok")},D=()=>{N.value=[...m.modelValue],m.monitorObjectQueryParams&&(F.value=m.monitorObjectQueryParams),m.selectAllMode&&(V.value=h.assign(m.selectAllMode,{}),V.value.selectAll?F.value=m.selectAllMode.queryParams||[]:F.value={keyword:""}),Fe(()=>{I.value.initData()})};return X({getSelectedMonitorObjects:()=>I.value.getSelectRow()}),(M,$)=>{const b=Ie,g=Ke,v=Te;return z(),be(v,{width:"50%",title:"\u9009\u62E9\u76D1\u63A7\u5BF9\u8C61",visible:M.visible,"unmount-on-close":!0,onOk:C,onCancel:K,onBeforeOpen:D},{default:a(()=>[t(g,null,{default:a(()=>[t(b,{span:24},{default:a(()=>[t(ha,{ref_key:"monitorObjectTableRef",ref:I,"model-value":N.value,"onUpdate:modelValue":$[0]||($[0]=ee=>N.value=ee),"select-all-mode":V.value,"onUpdate:selectAllMode":$[1]||($[1]=ee=>V.value=ee),"type-name":M.typeName,"disable-keys":M.disableKeys,"use-global-account":M.useGlobalAccount,"monitor-object-query-params":F.value},null,8,["model-value","select-all-mode","type-name","disable-keys","use-global-account","monitor-object-query-params"])]),_:1})]),_:1})]),_:1},8,["visible"])}}}),ka={class:"page-container"},xa={class:"page-panel"},wa={key:0},Aa={class:"selected-count"},Fa={style:{height:"calc(100vh - 146px)"}},Da=["onClick"],Oa={key:0},Ea={key:0,style:{color:"#f56c6c"}},Ba={key:1},ja={style:{height:"calc(100vh - 380px)"}},Ta={key:0,style:{position:"relative",height:"calc(100vh - 200px)"}},za=R("span",{style:{color:"#f53f3f"}},"*",-1),ml=je({__name:"index",props:{reportType:{type:String,default:"generic"}},setup(Z){const X=Z,{pagination:P,pageSizeOptions:m}=Le(),F=n(),V=n(),N=n(),I=n(),w=n(),K=n({name:"",reportType:X.reportType}),C=n(!1),D=n(!1),M=n(!1),$=n([]),b=n({enabled:!0}),g=n([]),v=n([]),{loading:ee,setLoading:te}=we(!1),{loading:oe,setLoading:re}=we(!1),q={name:"",showDetail:!0,showDetailChart:!0,zabbixMonitorObjectType:"",monitorObjects:[],reportType:X.reportType},c=n(h.cloneDeep(q)),G=n([]),S=n(1),ae=n();let ce=[];const Ce=n({size:"mini",height:"auto",columnConfig:{resizable:!0},showOverflow:"tooltip",rowConfig:{isHover:!0,keyField:"id"},columns:[{type:"checkbox",width:40,resizable:!1},{title:"\u62A5\u8868\u540D",field:"name",slots:{default:"name"},minWidth:120},{title:"\u5BF9\u8C61\u7C7B\u578B",field:"zabbixMonitorObjectType",minWidth:120},{title:"\u6307\u6807\u7C7B\u578B",field:"metricTags",minWidth:160,slots:{default:"metricTags"}},{title:"\u521B\u5EFA\u4EBA",field:"createUserName",minWidth:60},{title:"\u521B\u5EFA\u65F6\u95F4",field:"createTime",minWidth:60},{title:"\u64CD\u4F5C",width:120,resizable:!1,slots:{default:"action"}}]}),ne=n({size:"mini",height:"auto",columnConfig:{resizable:!0},showOverflow:"tooltip",rowConfig:{isHover:!0,keyField:"primaryKey"},scrollY:{enabled:!0},columns:[{type:"checkbox",width:40,resizable:!1},{title:"\u5BF9\u8C61\u540D\u79F0",field:"name",minWidth:120},{title:"\u63A5\u53E3",field:"interfaceNames",minWidth:120},{title:"\u64CD\u4F5C",width:60,resizable:!1,slots:{default:"action"}}]}),T=n(tt),ue=()=>{const o=F.value;ce.forEach(e=>{const r=e.id,f=v.value.indexOf(r)!==-1;o.getRowById(r)&&o.setCheckboxRow(o.getRowById(r),f)})},H=async()=>{te(!0);const o=F.value;try{K.value.reportType=X.reportType;const{data:e}=await ea({...K.value,page:P});ce=e.content,P.total=e.totalElements,o&&await o.reloadData(ce)}catch(e){console.error(e)}finally{te(!1),ue()}},pe=o=>{P.current=o,H()},ge=o=>{P.pageSize=o,H()},me=Yt(async()=>{await H()},500),_e=()=>{H()},ve=o=>{const{checked:e,row:r}=o;e?v.value.push(r.id):v.value=v.value.filter(f=>f!==r.id)},fe=ie(()=>ce.map(o=>o.id)),u=o=>{const{checked:e}=o;if(e){const r=fe.value.filter(f=>!v.value.includes(f));v.value.push(...r)}else v.value=v.value.filter(r=>!fe.value.includes(r))},d=()=>{v.value=[],ue()},k=o=>{T.value=[],T.value.push(...tt),at(o).then(e=>{if(e.data&&e.data.fields){const{fields:r}=e.data,f=r.map(B=>({label:B.fieldName,value:`zbxHostInventory_${B.inventoryField}`}));T.value.push(...f)}})},p=n(),L=async()=>{var B;const o=(B=p.value.monitorObjects)==null?void 0:B.map(Q=>`${Q.appKey}/${Q.hostId}`);re(!0);const{zabbixMonitorObjectType:e}=p.value;let{data:r}=await ut(e,!0);r=r.filter(Q=>o&&o.indexOf(`${Q.appKey}/${Q.hostId}`)!==-1),Object.assign(c.value,{monitorObjects:r}),Object.assign(b.value,{enabled:!0,selectAll:p.value.selectAll,queryParams:p.value.monitorQueryParam});const f=V.value;f&&(await f.reloadData(r),re(!1)),$.value=o,k(e)},l=async()=>{const o=[],e=V.value;e&&(await e.reloadData(o),c.value.selectAll=!1,c.value.monitorQueryParam={keyword:""},c.value.monitorObjects=o),$.value=[],b.value={enabled:!0},g.value=[],c.value.metricTags=[]},i=o=>{k(o),l()},_=async o=>{p.value=o,Object.assign(c.value,{...p.value}),C.value=!0,D.value=!0,await L()},A=o=>{const e=V.value;if(e){e.remove(o);const r=e.getTableData().fullData;c.value.monitorObjects=r,$.value=r.map(f=>`${f.appKey}/${f.hostId}`)}},O=n(!1),E=n(void 0),U=o=>{E.value=o,O.value=!0},ke=()=>{D.value=!0,C.value=!1,T.value=[]},he=o=>{let e,r;o?(e=[o.id],r=`\u6B64\u64CD\u4F5C\u5C06\u6C38\u4E45\u5220\u9664'${o.name}'\u53CA\u5176\u8BA2\u9605\u8BB0\u5F55, \u662F\u5426\u7EE7\u7EED?`):(e=v.value,r=`\u6B64\u64CD\u4F5C\u5C06\u6C38\u4E45\u5220\u9664\u60A8\u6240\u9009\u7684${e.length}\u6761\u62A5\u8868\u53CA\u5176\u8BA2\u9605\u8BB0\u5F55, \u662F\u5426\u7EE7\u7EED?`),St.warning({title:"\u63D0\u793A",titleAlign:"start",hideCancel:!1,content:r,onOk:async()=>{await ta(e),et.success("\u5220\u9664\u62A5\u8868\u6210\u529F"),o?v.value=v.value.filter(f=>f!==o.id):v.value=[],await H()}})},xe=async()=>{M.value=!1;let o=w.value.getSelectedMonitorObjects();const e=V.value;if(e&&(o==null?void 0:o.length)){if(!b.value.selectAll){const r=h.concat(o,c.value.monitorObjects);o=h.uniqBy(r,"primaryKey"),o=o.filter(f=>$.value.indexOf(f==null?void 0:f.primaryKey)!==-1)}await e.reloadData(o),c.value.selectAll=b.value.selectAll,c.value.monitorQueryParam=b.value.queryParams,c.value.monitorObjects=o}I.value.validate()},x=()=>{S.value-=1},se=()=>{I.value.validate(o=>{o||(S.value+=1)})},st=async()=>{const o=V.value;if(o){await o.removeCheckboxRow();const e=o.getTableData().fullData;c.value.monitorObjects=e,$.value=e.map(r=>`${r.appKey}/${r.hostId}`)}},it=()=>{I.value.validate(async o=>{var e;if(!o){if(S.value===1){let r=(e=c.value.monitorObjects)==null?void 0:e.map(B=>({appKey:B.appKey,hostId:B.hostId}));const f=b.value;f.selectAll&&(r=h.slice(r,0,100)),Object.assign(c.value,{monitorObjects:r,selectAll:f.selectAll,monitorQueryParam:f.queryParams})}if(S.value===2){const r=g.value.map(J=>({type:J.type,name:J.title,discover:J.discover,valueType:J.valueType}));if(r.length===0){et.warning("\u8BF7\u81F3\u5C11\u9009\u62E9\u4E00\u4E2A\u6307\u6807\u9879!");return}const f=h.includes(G.value,"max"),B=h.includes(G.value,"min"),Q=h.includes(G.value,"avg");Object.assign(c.value,{metricTags:r,statsMax:f,statsMin:B,statsAvg:Q})}D.value=!1,await aa(c.value),await H()}})},rt=o=>{let e="ZabbixGenericReportDetail";X.reportType==="PERIOD_COMPARE_GENERIC_REPORT"&&(e="ZabbixPeriodCompareGenericReportDetail"),Dt.push({name:e,query:{"report-config-id":o.id}})};ye(D,o=>{o||(c.value=h.cloneDeep(q),$.value=[],b.value={enabled:!0})}),ye(S,o=>{if(o===2)if(C.value){const{statsMax:e,statsMin:r,statsAvg:f}=c.value,B=[];e&&B.push("max"),r&&B.push("min"),f&&B.push("avg"),G.value=B}else G.value=["max","min","avg"]},{immediate:!0});const ze=ie(()=>o=>G.value.length===1&&G.value[0]===o),ct=ie(()=>b.value.selectAll?[]:c.value.monitorObjects),qe=n([]),dt=()=>{S.value=1,Ot().then(o=>{qe.value=o.data})},pt=async()=>{await I.value.validateField("zabbixMonitorObjectType")||(M.value=!0)},mt=o=>{c.value.metricTagsFilterKeys=o};return Ve(async()=>{const{data:o}=await la(),e=new Map;o.forEach(r=>{e.set(r.code,r.name)}),ae.value=e,await H()}),(o,e)=>{var Ze,Ye;const r=Vt,f=Re,B=Ie,Q=ot,J=lt,vt=It,ft=Kt,yt=Rt,bt=Pt,Me=Ke,gt=Ne,Ge=De("vxe-grid"),Ue=Nt,_t=Lt,He=qt,ht=Pe,Ae=Gt,Qe=Ut,We=Ht,Ct=Qt,kt=Wt,$e=nt,xt=Zt,wt=Te;return z(),W("div",ka,[R("div",xa,[t(Me,null,{default:a(()=>[t(B,{span:14},{default:a(()=>[t(f,{style:{"margin-bottom":"5px"}},{default:a(()=>[t(r,{modelValue:K.value.name,"onUpdate:modelValue":e[0]||(e[0]=s=>K.value.name=s),style:{width:"320px"},placeholder:"\u62A5\u8868\u540D\u79F0","allow-clear":"",onSearch:_e,onInput:j(me),onClear:j(me)},null,8,["modelValue","onInput","onClear"])]),_:1})]),_:1}),t(B,{span:10,style:{"text-align":"right"}},{default:a(()=>[t(f,{style:{"margin-bottom":"5px"}},{default:a(()=>[v.value.length>0?(z(),W("span",wa,[R("span",Aa," \u5DF2\u9009\u62E9\u4E86"+Y(v.value.length)+"\u6761 ",1),t(Q,{onClick:d},{default:a(()=>[y("\u6E05\u7A7A")]),_:1})])):de("",!0),t(J,{type:"primary",size:"medium",onClick:ke},{default:a(()=>[y(" \u65B0\u5EFA ")]),_:1}),t(bt,null,{icon:a(()=>[t(vt)]),content:a(()=>[t(yt,{disabled:v.value.length===0,onClick:e[1]||(e[1]=s=>he())},{default:a(()=>[t(ft),y(" \u6279\u91CF\u5220\u9664 ")]),_:1},8,["disabled"])]),default:a(()=>[y(" \u7BA1\u7406 ")]),_:1})]),_:1})]),_:1})]),_:1}),R("div",Fa,[t(Ge,Be({ref_key:"xGrid",ref:F,loading:j(ee)},Ce.value,{onCheckboxChange:ve,onCheckboxAll:u}),{index:a(({rowIndex:s})=>[y(Y(s+1+(j(P).current-1)*j(P).pageSize),1)]),name:a(({row:s})=>[R("div",{class:"table-link",onClick:le=>rt(s)},Y(s.name),9,Da)]),metricTags:a(({row:s})=>[y(Y(j(h).uniq(s.metricTags.map(le=>le.type)).join(", ")),1)]),action:a(({row:s})=>[t(f,null,{default:a(()=>[t(Q,{style:{"font-size":"12px"},hoverable:!1,type:"text",onClick:le=>_(s)},{default:a(()=>[y(" \u7F16\u8F91 ")]),_:2},1032,["onClick"]),t(Q,{style:{"font-size":"12px"},hoverable:!1,type:"text",onClick:le=>U(s)},{default:a(()=>[y(" \u8BA2\u9605 ")]),_:2},1032,["onClick"]),t(Q,{style:{"font-size":"12px"},hoverable:!1,type:"text",onClick:le=>he(s)},{default:a(()=>[y(" \u5220\u9664 ")]),_:2},1032,["onClick"])]),_:2},1024)]),pager:a(()=>[t(gt,{ref_key:"xPagination",ref:N,current:j(P).current,"page-size":j(P).pageSize,total:j(P).total,"page-size-options":j(m),style:{"padding-top":"10px"},"show-total":"","show-jumper":"","show-page-size":"",onChange:pe,onPageSizeChange:ge},null,8,["current","page-size","total","page-size-options"])]),_:1},16,["loading"]),t(wt,{width:"50%",visible:D.value,"drawer-style":{padding:0},"mask-closable":!1,"unmount-on-close":"",onBeforeOpen:dt,onCancel:e[10]||(e[10]=s=>D.value=!1)},{title:a(()=>[y(Y(C.value?"\u7F16\u8F91":"\u65B0\u5EFA")+"\u62A5\u8868",1)]),footer:a(()=>[t(f,null,{default:a(()=>[t(J,{type:"primary",disabled:S.value===1,style:{"margin-left":"0"},onClick:e[7]||(e[7]=s=>x())},{default:a(()=>[y(" \u4E0A\u4E00\u6B65 ")]),_:1},8,["disabled"]),S.value===1?(z(),be(J,{key:0,type:"primary",style:{"margin-left":"0"},onClick:e[8]||(e[8]=s=>se())},{default:a(()=>[y(" \u4E0B\u4E00\u6B65 ")]),_:1})):de("",!0),S.value===2||C.value?(z(),be(J,{key:1,type:"primary",style:{"margin-left":"0"},onClick:e[9]||(e[9]=s=>it())},{default:a(()=>[y(" \u5B8C\u6210 ")]),_:1})):de("",!0)]),_:1})]),default:a(()=>[t(_t,{current:S.value},{default:a(()=>[t(Ue,null,{default:a(()=>[y("\u5BF9\u8C61\u4FE1\u606F")]),_:1}),t(Ue,null,{default:a(()=>[y("\u7B5B\u9009\u6307\u6807")]),_:1})]),_:1},8,["current"]),t(He),t(Me,null,{default:a(()=>[t(B,{span:16},{default:a(()=>[t(kt,{ref_key:"reportFormRef",ref:I,"label-align":"left",model:c.value,"label-col-props":{span:5},"wrapper-col-props":{span:19},onSubmit:s=>{}},{default:a(()=>[S.value===1?(z(),W("div",Oa,[t(Ae,{field:"name",label:"\u62A5\u8868\u540D\u79F0",rules:[{required:!0,message:"\u62A5\u8868\u540D\u4E0D\u80FD\u4E3A\u7A7A"},{maxLength:64,message:"\u62A5\u8868\u540D\u957F\u5EA6\u6700\u5927\u4E0D\u80FD\u8D85\u8FC764"}],"validate-trigger":["change","input","blur"]},{default:a(()=>[t(ht,{modelValue:c.value.name,"onUpdate:modelValue":e[2]||(e[2]=s=>c.value.name=s),placeholder:"\u8BF7\u8F93\u5165\u62A5\u8868\u540D..."},null,8,["modelValue"])]),_:1}),t(Ae,{field:"zabbixMonitorObjectType",label:"\u5BF9\u8C61\u7C7B\u578B",rules:[{required:!0,message:"\u5BF9\u8C61\u7C7B\u578B\u4E0D\u80FD\u4E3A\u7A7A"}]},{default:a(()=>[t(We,{modelValue:c.value.zabbixMonitorObjectType,"onUpdate:modelValue":e[3]||(e[3]=s=>c.value.zabbixMonitorObjectType=s),"allow-search":"",onChange:i},{default:a(()=>[(z(!0),W(Oe,null,Ee(qe.value,(s,le)=>(z(),be(Qe,{key:le,value:s.name},{default:a(()=>[y(Y(s.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(Ae,{field:"monitorObjectTypeAttrs",label:"\u5BF9\u8C61\u5C5E\u6027",rules:[{required:!0,message:"\u5BF9\u8C61\u5C5E\u6027\u4E0D\u80FD\u4E3A\u7A7A"}]},{default:a(()=>[t(We,{modelValue:c.value.monitorObjectTypeAttrs,"onUpdate:modelValue":e[4]||(e[4]=s=>c.value.monitorObjectTypeAttrs=s),"allow-search":"",multiple:"","max-tag-count":3},{default:a(()=>[(z(!0),W(Oe,null,Ee(T.value,(s,le)=>(z(),be(Qe,{key:le,value:s.value},{default:a(()=>[y(Y(s.label),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(Ae,{field:"monitorObjects",label:"\u7EDF\u8BA1\u6E05\u5355",rules:[{required:!0,message:"\u7EDF\u8BA1\u6E05\u5355\u5217\u8868\u4E0D\u80FD\u4E3A\u7A7A"}]},{default:a(()=>[t(Ct,{code:""},{default:a(()=>[b.value.selectAll?(z(),W("span",Ea," \u5F53\u524D\u5904\u4E8E\u6309\u641C\u7D22\u6761\u4EF6\u52A8\u6001\u9009\u62E9\u5BF9\u8C61\u6A21\u5F0F, \u7EDF\u8BA1\u6E05\u5355\u53EA\u663E\u793A\u9884\u89C8\u6548\u679C ")):(z(),W("span",Ba," \u5171\u8BA1"+Y(c.value.monitorObjects&&c.value.monitorObjects.length?c.value.monitorObjects.length:0)+"\u6761 ",1))]),_:1})]),_:1})])):de("",!0)]),_:1},8,["model"])]),_:1}),Je(t(B,{span:8},{default:a(()=>[t(f,{style:{marginTop:"12em",float:"right"}},{default:a(()=>[t(J,{type:"primary",onClick:pt},{default:a(()=>[y(" \u6DFB\u52A0 ")]),_:1}),t(J,{disabled:b.value.selectAll,onClick:st},{default:a(()=>[y(" \u79FB\u9664 ")]),_:1},8,["disabled"])]),_:1})]),_:1},512),[[Xe,S.value===1]])]),_:1}),Je(R("div",ja,[t(Ge,Be({ref_key:"monitorGrid",ref:V,loading:j(oe)},ne.value),{index:a(({rowIndex:s})=>[y(Y(s+1),1)]),action:a(({row:s})=>[t(f,null,{default:a(()=>[t(Q,{type:"text",style:{"font-size":"1em"},disabled:b.value.selectAll,onClick:le=>A(s)},{default:a(()=>[y(" \u79FB\u9664 ")]),_:2},1032,["disabled","onClick"])]),_:2},1024)]),_:1},16,["loading"])],512),[[Xe,S.value===1]]),S.value===2?(z(),W("div",Ta,[t(fa,{modelValue:g.value,"onUpdate:modelValue":e[5]||(e[5]=s=>g.value=s),monitors:ct.value,metrics:c.value.metricTags,"report-form":c.value,onSetMetricTagFilterKeys:mt},null,8,["modelValue","monitors","metrics","report-form"]),R("div",null,[t(Me,{style:{position:"absolute",bottom:"10px",width:"100%"}},{default:a(()=>[t(He),t(B,{span:4},{default:a(()=>[za,y(" \u7EDF\u8BA1\u65B9\u5F0F: ")]),_:1}),t(B,{span:20},{default:a(()=>[t(xt,{modelValue:G.value,"onUpdate:modelValue":e[6]||(e[6]=s=>G.value=s)},{default:a(()=>[t($e,{value:"max",disabled:ze.value("max")},{default:a(()=>[y(" \u6700\u5927\u503C ")]),_:1},8,["disabled"]),t($e,{value:"min",disabled:ze.value("min")},{default:a(()=>[y(" \u6700\u5C0F\u503C ")]),_:1},8,["disabled"]),t($e,{value:"avg",disabled:ze.value("avg")},{default:a(()=>[y(" \u5E73\u5747\u503C ")]),_:1},8,["disabled"])]),_:1},8,["modelValue"])]),_:1})]),_:1})])])):de("",!0)]),_:1},8,["visible"]),t(Ca,{ref_key:"monitorObjectSelectRef",ref:w,modelValue:$.value,"onUpdate:modelValue":e[11]||(e[11]=s=>$.value=s),"select-all-mode":b.value,"onUpdate:selectAllMode":e[12]||(e[12]=s=>b.value=s),visible:M.value,"type-name":c.value.zabbixMonitorObjectType,"use-global-account":!0,onCancel:e[13]||(e[13]=s=>M.value=!1),onOk:e[14]||(e[14]=s=>xe())},null,8,["modelValue","select-all-mode","visible","type-name"]),t(oa,{visible:O.value,name:(Ze=E.value)==null?void 0:Ze.name,"report-config-id":(Ye=E.value)==null?void 0:Ye.id,"report-type":Z.reportType,onOk:e[15]||(e[15]=s=>O.value=!1),onCancel:e[16]||(e[16]=s=>O.value=!1)},null,8,["visible","name","report-config-id","report-type"])])])])}}});export{ml as default};
