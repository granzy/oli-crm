import{l as W,h as U,a as H}from"./index.e9d54774.js";/* empty css                *//* empty css               *//* empty css               */import{d as M,f as B,cv as re,c as w,D as m,aH as F,aI as e,aS as a,aY as o,aZ as A,E as V,aU as Y,aV as G,aW as h,H as oe,c7 as ie,c8 as ne,bo as se,cC as de,bZ as pe,c6 as fe,a$ as ce,aO as me,bf as ve,bp as Ee,u as T,bg as q,bi as _e,r as ge,aT as Ae,bz as Fe,G as ye,bq as Re,aM as Ce,bt as be,bB as Be}from"./arco.a97fe066.js";import{p as De}from"./pagination.72a5f225.js";/* empty css              *//* empty css               *//* empty css                */const Te=oe("div",null," \u8BF4\u660E:\u4E0D\u9009\u62E9\u4EFB\u4F55\u53D1\u9001\u65B9\u5F0F\u5219\u53EA\u4F1A\u5F52\u6863,\u53EF\u5728\u8BA2\u9605\u53D1\u9001\u8BB0\u5F55\u4E0B\u8F7D\u67E5\u770B\u62A5\u8868\u9644\u4EF6 ",-1),he=M({__name:"form",props:{modelValue:{default:()=>W.cloneDeep({})},modelModifiers:{}},emits:["update:modelValue"],setup(_,{expose:x}){const R=B(),u=re(_,"modelValue"),C=w(()=>{const{period:D}=u.value;switch(D){case"DAY":return"\u5F53\u5929";case"WEEK":return"\u5F53\u5468";case"MONTH":return"\u5F53\u6708";case"QUARTER":return"\u5F53\u5B63\u5EA6";case"YEAR":return"\u5F53\u5E74";default:return""}}),v=w(()=>{const{period:D}=u.value;switch(D){case"DAY":return"\u6628\u5929";case"WEEK":return"\u4E0A\u5468";case"MONTH":return"\u4E0A\u6708";case"QUARTER":return"\u4E0A\u5B63\u5EA6";case"YEAR":return"\u53BB\u5E74";default:return""}}),p=()=>{u.value.generateDateArray=[],u.value.monthsOfYearArray=[],u.value.reportType==="PERIOD_COMPARE_GENERIC_REPORT"&&(u.value.period==="DAY"?u.value.periodCompareType="WEEK":u.value.period!=="YEAR"?u.value.periodCompareType="YEAR":u.value.periodCompareType=void 0)};return x({validateForm:()=>R.value.validate()}),(D,l)=>{const s=ie,f=ne,d=se,E=de,c=pe,k=fe,b=ce,N=me,S=ve,P=Ee;return m(),F(P,{ref_key:"submitFormRef",ref:R,model:u.value,"label-col-props":{span:3},"wrapper-col-props":{span:21}},{default:e(()=>[a(d,{field:"period",label:"\u8BA2\u9605\u5468\u671F","validate-trigger":"blur",required:""},{default:e(()=>[a(f,{modelValue:u.value.period,"onUpdate:modelValue":l[0]||(l[0]=r=>u.value.period=r),onChange:p},{default:e(()=>[a(s,{value:"DAY"},{default:e(()=>[o("\u6309\u5929")]),_:1}),a(s,{value:"WEEK"},{default:e(()=>[o("\u6309\u5468")]),_:1}),a(s,{value:"MONTH"},{default:e(()=>[o("\u6309\u6708")]),_:1}),a(s,{value:"QUARTER"},{default:e(()=>[o("\u6309\u5B63\u5EA6")]),_:1}),a(s,{value:"YEAR"},{default:e(()=>[o("\u6309\u5E74")]),_:1})]),_:1},8,["modelValue"])]),_:1}),a(d,{field:"generateTime",label:"\u751F\u6210\u65F6\u95F4","validate-trigger":"blur",required:""},{default:e(()=>[a(E,{modelValue:u.value.generateTime,"onUpdate:modelValue":l[1]||(l[1]=r=>u.value.generateTime=r),"allow-clear":!1,format:"HH:mm"},null,8,["modelValue"])]),_:1}),u.value.period==="WEEK"?(m(),F(d,{key:0,field:"generateDateArray",label:"\u751F\u6210\u65E5\u671F","validate-trigger":"blur",required:"",rules:[{required:!0,message:"\u8BF7\u9009\u62E9\u751F\u6210\u65E5\u671F"}]},{default:e(()=>[a(k,{modelValue:u.value.generateDateArray,"onUpdate:modelValue":l[2]||(l[2]=r=>u.value.generateDateArray=r)},{default:e(()=>[a(c,{value:"2"},{default:e(()=>[o("\u661F\u671F\u4E00")]),_:1}),a(c,{value:"3"},{default:e(()=>[o("\u661F\u671F\u4E8C")]),_:1}),a(c,{value:"4"},{default:e(()=>[o("\u661F\u671F\u4E09")]),_:1}),a(c,{value:"5"},{default:e(()=>[o("\u661F\u671F\u56DB")]),_:1}),a(c,{value:"6"},{default:e(()=>[o("\u661F\u671F\u4E94")]),_:1}),a(c,{value:"7"},{default:e(()=>[o("\u661F\u671F\u516D")]),_:1}),a(c,{value:"1"},{default:e(()=>[o("\u661F\u671F\u65E5")]),_:1})]),_:1},8,["modelValue"])]),_:1})):A("",!0),u.value.period==="QUARTER"||u.value.period==="YEAR"?(m(),F(d,{key:1,field:"monthsOfYearArray",label:"\u751F\u6210\u6708\u4EFD","validate-trigger":"change",required:"",rules:[{required:!0,message:"\u8BF7\u9009\u62E9\u751F\u6210\u6708\u4EFD"}]},{default:e(()=>[a(k,{modelValue:u.value.monthsOfYearArray,"onUpdate:modelValue":l[3]||(l[3]=r=>u.value.monthsOfYearArray=r)},{default:e(()=>[(m(),V(Y,null,G(12,r=>a(c,{key:r,value:String(r)},{default:e(()=>[o(h(r)+"\u6708 ",1)]),_:2},1032,["value"])),64))]),_:1},8,["modelValue"])]),_:1})):A("",!0),u.value.period==="MONTH"||u.value.period==="QUARTER"||u.value.period==="YEAR"?(m(),F(d,{key:2,field:"generateDateArray",label:"\u751F\u6210\u65E5\u671F","validate-trigger":"change",required:"",rules:[{required:!0,message:"\u8BF7\u9009\u62E9\u751F\u6210\u65E5\u671F"}]},{default:e(()=>[a(k,{modelValue:u.value.generateDateArray,"onUpdate:modelValue":l[4]||(l[4]=r=>u.value.generateDateArray=r)},{default:e(()=>[(m(),V(Y,null,G(31,r=>a(c,{key:r,value:String(r)},{default:e(()=>[o(h(r)+"\u65E5 ",1)]),_:2},1032,["value"])),64)),a(c,{value:"L"},{default:e(()=>[o("\u6700\u540E\u4E00\u5929")]),_:1})]),_:1},8,["modelValue"])]),_:1})):A("",!0),u.value.reportType==="ZABBIX_GENERIC_REPORT"||u.value.reportType==="PERIOD_COMPARE_GENERIC_REPORT"||u.value.reportType==="EVENT_STATISTIC_REPORT"?(m(),F(d,{key:3,field:"statistics",label:"\u8BA2\u9605\u5185\u5BB9","validate-trigger":"blur",required:""},{default:e(()=>[a(f,{modelValue:u.value.statistics,"onUpdate:modelValue":l[5]||(l[5]=r=>u.value.statistics=r)},{default:e(()=>[a(s,{value:"LAST"},{default:e(()=>[o(h(v.value),1)]),_:1}),a(s,{value:"CURRENT"},{default:e(()=>[o(h(C.value),1)]),_:1})]),_:1},8,["modelValue"])]),_:1})):A("",!0),u.value.reportType==="PERIOD_COMPARE_GENERIC_REPORT"&&u.value.period!=="YEAR"?(m(),F(d,{key:4,label:"\u540C\u6BD4"},{default:e(()=>[a(N,{modelValue:u.value.periodCompareType,"onUpdate:modelValue":l[6]||(l[6]=r=>u.value.periodCompareType=r),placeholder:"\u8BF7\u9009\u62E9",style:{width:"120px"},"allow-clear":""},{default:e(()=>[u.value.period==="DAY"?(m(),V(Y,{key:0},[a(b,{value:"WEEK"},{default:e(()=>[o("\u5468\u540C\u6BD4")]),_:1}),a(b,{value:"MONTH"},{default:e(()=>[o("\u6708\u540C\u6BD4")]),_:1}),a(b,{value:"YEAR"},{default:e(()=>[o("\u5E74\u540C\u6BD4")]),_:1})],64)):A("",!0),u.value.period==="WEEK"?(m(),V(Y,{key:1},[a(b,{value:"MONTH"},{default:e(()=>[o("\u6708\u540C\u6BD4")]),_:1}),a(b,{value:"YEAR"},{default:e(()=>[o("\u5E74\u540C\u6BD4")]),_:1})],64)):A("",!0),u.value.period==="MONTH"||u.value.period==="QUARTER"?(m(),F(b,{key:2,value:"YEAR"},{default:e(()=>[o("\u5E74\u540C\u6BD4")]),_:1})):A("",!0)]),_:1},8,["modelValue"])]),_:1})):A("",!0),u.value.reportType==="ZABBIX_GENERIC_REPORT"||u.value.reportType==="PERIOD_COMPARE_GENERIC_REPORT"?(m(),F(d,{key:5,field:"hoursPeriod",label:"\u8BA2\u9605\u65F6\u95F4\u6BB5","validate-trigger":"blur",required:""},{default:e(()=>[a(f,{modelValue:u.value.hoursPeriod,"onUpdate:modelValue":l[7]||(l[7]=r=>u.value.hoursPeriod=r)},{default:e(()=>[a(s,{value:"ALL_DAY"},{default:e(()=>[o("\u5168\u5929")]),_:1}),a(s,{value:"WORK_HOURS"},{default:e(()=>[o("\u5DE5\u4F5C\u65F6\u95F4\u6BB5")]),_:1}),a(s,{value:"NOT_WORK_HOURS"},{default:e(()=>[o("\u975E\u5DE5\u4F5C\u65F6\u95F4\u6BB5")]),_:1})]),_:1},8,["modelValue"])]),_:1})):A("",!0),u.value.reportType==="ZABBIX_GENERIC_REPORT"?(m(),F(d,{key:6,field:"exportDetail",label:"\u8BA2\u9605\u660E\u7EC6",required:""},{default:e(()=>[a(S,{modelValue:u.value.exportDetail,"onUpdate:modelValue":l[8]||(l[8]=r=>u.value.exportDetail=r),size:"small"},null,8,["modelValue"])]),_:1})):A("",!0),u.value.reportType==="ZABBIX_GENERIC_REPORT"&&u.value.exportDetail?(m(),F(d,{key:7,field:"detailGraininess",label:"\u660E\u7EC6\u9897\u7C92\u5EA6",required:""},{default:e(()=>[a(f,{modelValue:u.value.detailGraininess,"onUpdate:modelValue":l[9]||(l[9]=r=>u.value.detailGraininess=r)},{default:e(()=>[a(s,{value:"HISTORY"},{default:e(()=>[o("\u539F\u59CB\u6570\u636E")]),_:1}),a(s,{value:"HOUR"},{default:e(()=>[o("\u6309\u5C0F\u65F6")]),_:1}),a(s,{value:"DAY"},{default:e(()=>[o("\u6309\u5929")]),_:1})]),_:1},8,["modelValue"])]),_:1})):A("",!0),u.value.reportType==="ZABBIX_GENERIC_REPORT"&&u.value.exportDetail?(m(),F(d,{key:8,field:"exportDetailChart",label:"\u660E\u7EC6\u56FE\u8868"},{default:e(()=>[a(S,{modelValue:u.value.exportDetailChart,"onUpdate:modelValue":l[10]||(l[10]=r=>u.value.exportDetailChart=r),size:"small"},null,8,["modelValue"])]),_:1})):A("",!0),a(d,{field:"sendType",label:"\u53D1\u9001\u65B9\u5F0F"},{extra:e(()=>[Te]),default:e(()=>[a(k,{modelValue:u.value.sendType,"onUpdate:modelValue":l[11]||(l[11]=r=>u.value.sendType=r)},{default:e(()=>[a(c,{value:"MAIL"},{default:e(()=>[o("\u90AE\u4EF6")]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])}}});function Oe(_){return U.post("/zabbixReportSubscribeSetting/pageList",_)}function ke(_){return U.post("/zabbixReportSubscribeSetting",_)}function xe(_){return U.post("/zabbixReportSubscribeSetting/deleteAllByIds",{ids:_})}const Ve=M({__name:"update-setting-draw",props:{visible:{type:Boolean},row:{}},emits:["ok","cancel"],setup(_,{emit:x}){const{loading:R,setLoading:u}=H(!1),C=_,v=x,p=B(),O=B(),D=async()=>{var s,f;if(p.value&&(p.value.period!=="DAY"&&(p.value.generateDate=(s=p.value.generateDateArray)==null?void 0:s.join(",")),(p.value.period==="QUARTER"||p.value.period==="YEAR")&&(p.value.monthsOfYear=(f=p.value.monthsOfYearArray)==null?void 0:f.join(",")),!await O.value.validateForm()))try{u(!0),await ke(p.value),q.success("\u8BA2\u9605\u6210\u529F"),v("ok")}catch(E){console.log(E)}finally{u(!1)}},l=()=>{var s,f,d,E;C.row&&(p.value=W.cloneDeep(C.row),p.value.generateDateArray=((f=(s=p.value)==null?void 0:s.generateDate)==null?void 0:f.split(","))||[],p.value.monthsOfYearArray=((E=(d=p.value)==null?void 0:d.monthsOfYear)==null?void 0:E.split(","))||[])};return(s,f)=>{var E;const d=_e;return m(),F(d,{title:`\u8BA2\u9605\u8BBE\u7F6E(${(E=C.row)==null?void 0:E.reportName})`,width:"50%",visible:C.visible,"mask-closable":!1,"unmount-on-close":"","ok-loading":T(R),onOk:D,onCancel:f[1]||(f[1]=c=>v("cancel")),onOpen:l},{default:e(()=>[a(he,{ref_key:"subscribeSettingFormRef",ref:O,modelValue:p.value,"onUpdate:modelValue":f[0]||(f[0]=c=>p.value=c)},null,8,["modelValue"])]),_:1},8,["title","visible","ok-loading"])}}}),Ge=M({__name:"table",props:{height:{type:String,default:"calc(100vh - 146px)"},reportConfigId:{type:String,required:!1},reportType:{type:String,required:!1}},setup(_,{expose:x}){const R=_,{loading:u,setLoading:C}=H(!1),{pagination:v,pageSizeOptions:p}=De(),O=B(),D=B(),l=B([]),s=[{type:"checkbox",width:40},{title:"\u62A5\u8868\u540D\u79F0",field:"reportName",minWidth:120},{title:"\u8BA2\u9605\u4EBA",field:"subscribeUserName",minWidth:120},{title:"\u8BA2\u9605\u65F6\u95F4",slots:{default:"subscribeTime"},minWidth:150},{title:"\u53D1\u9001\u65B9\u5F0F",slots:{default:"sendType"},minWidth:150},{title:"\u64CD\u4F5C",width:160,slots:{default:"action"},fixed:"right"}];R.reportConfigId||s.splice(2,0,{title:"\u62A5\u8868\u7C7B\u578B",field:"reportTypeName",minWidth:120}),R.reportType==="ZABBIX_GENERIC_REPORT"&&(s.splice(4,0,{title:"\u8BA2\u9605\u65F6\u95F4\u6BB5",field:"hoursPeriodName",minWidth:120}),s.splice(5,0,{title:"\u8BA2\u9605\u660E\u7EC6",field:"exportDetail",slots:{default:"exportDetail"},minWidth:120}));const f=B({size:"mini",height:"auto",columnConfig:{resizable:!0},showOverflow:"tooltip",rowConfig:{isHover:!0,keyField:"id"},columns:s}),d=ge({name:"",reportConfigId:R.reportConfigId,reportType:R.reportType});let E=[];const c=()=>{const t=O.value;E.forEach(n=>{const i=n.id,y=l.value.indexOf(i)!==-1;t.getRowById(i)&&t.setCheckboxRow(t.getRowById(i),y)})},k=t=>{const{checked:n,row:i}=t;n?l.value.push(i.id):l.value=l.value.filter(y=>y!==i.id)},b=w(()=>E.map(t=>t.id)),N=t=>{const{checked:n}=t;if(n){const i=b.value.filter(y=>!l.value.includes(y));l.value.push(...i)}else l.value=l.value.filter(i=>!b.value.includes(i))},S=()=>{l.value=[],c()},P=()=>l.value,r=async(t={...d,page:v})=>{C(!0);const n=O.value;try{const{data:i}=await Oe(t);v.total=i.totalElements,n&&(await n.reloadData(i.content),E=i.content)}catch(i){console.error(i)}finally{C(!1),c()}},L=t=>{t.name?d.name=t.name:d.name="",r()},$=t=>{v.current=t,r()},K=t=>{v.pageSize=t,r()},Q={DAY:"\u6BCF\u5929",WEEK:"\u6BCF\u5468",MONTH:"\u6BCF\u6708",QUARTER:"\u6309\u5B63\u5EA6",YEAR:"\u6309\u5E74"},Z={2:"\u5468\u4E00",3:"\u5468\u4E8C",4:"\u5468\u4E09",5:"\u5468\u56DB",6:"\u5468\u4E94",7:"\u5468\u516D",1:"\u5468\u65E5"},X=t=>{let n=Q[t.period];return t.monthsOfYear&&t.monthsOfYear.split(",").forEach(i=>{n+=` ${i}\u6708`}),t.generateDate&&t.generateDate.split(",").sort((i,y)=>i==="L"?1:y==="L"?-1:i-y).forEach(i=>{t.period==="WEEK"?n+=` ${Z[i]}`||"":(t.period==="MONTH"||t.period==="QUARTER"||t.period==="YEAR")&&(i==="L"?n+=" \u6700\u540E\u4E00\u5929":n+=` ${i}\u53F7`)}),n+=` ${t.generateTime}`,n},j=t=>{let n="";return t.sendType&&t.sendType.length>0&&t.sendType.forEach(i=>{n+=i==="MAIL"?"\u90AE\u4EF6":""}),n},J=t=>{let n="";const{exportDetail:i}=t;return i?(n+=t.detailGraininessName,t.exportDetailChart&&(n+="\u3001\u56FE\u8868")):n="\u5426",n},ee=async t=>{Re.warning({title:"\u63D0\u793A",titleAlign:"start",hideCancel:!1,content:`\u6B64\u64CD\u4F5C\u5C06\u6C38\u4E45\u5220\u9664\u8BA2\u9605'${t.reportName}'\uFF0C\u662F\u5426\u7EE7\u7EED?`,onOk:async()=>{await xe([t.id]),q.success("\u53D6\u6D88\u8BA2\u9605\u6210\u529F"),await r(),l.value=l.value.filter(n=>n!==t.id)}})},I=B(!1),z=B(),ue=t=>{z.value=t,I.value=!0};return x({fetchData:r,queryData:L,getSelectedRowKeys:P,clearAllChecked:S}),(t,n)=>{const i=Ce,y=be,ae=Be,te=Ae("vxe-grid");return m(),V("div",{style:ye({height:_.height})},[a(te,Fe({ref_key:"xGrid",ref:O,loading:T(u)},f.value,{onCheckboxChange:k,onCheckboxAll:N}),{index:e(({rowIndex:g})=>[o(h(g+1+(T(v).current-1)*T(v).pageSize),1)]),subscribeTime:e(({row:g})=>[o(h(X(g)),1)]),sendType:e(({row:g})=>[o(h(j(g)),1)]),exportDetail:e(({row:g})=>[o(h(J(g)),1)]),action:e(({row:g})=>[a(y,null,{default:e(()=>[a(i,{style:{"font-size":"12px"},hoverable:!1,type:"text",onClick:le=>ee(g)},{default:e(()=>[o(" \u53D6\u6D88\u8BA2\u9605 ")]),_:2},1032,["onClick"]),a(i,{style:{"font-size":"12px"},hoverable:!1,type:"text",onClick:le=>ue(g)},{default:e(()=>[o(" \u4FEE\u6539\u8BA2\u9605\u65F6\u95F4 ")]),_:2},1032,["onClick"])]),_:2},1024)]),pager:e(()=>[a(ae,{ref_key:"xPagination",ref:D,current:T(v).current,"page-size":T(v).pageSize,total:T(v).total,"page-size-options":T(p),style:{"padding-top":"10px"},"show-total":"","show-jumper":"","show-page-size":"",onChange:$,onPageSizeChange:K},null,8,["current","page-size","total","page-size-options"])]),_:1},16,["loading"]),a(Ve,{visible:I.value,row:z.value,onOk:n[0]||(n[0]=g=>{I.value=!1,r()}),onCancel:n[1]||(n[1]=g=>I.value=!1)},null,8,["visible","row"])],4)}}});export{he as _,Ge as a,xe as d,ke as s};
