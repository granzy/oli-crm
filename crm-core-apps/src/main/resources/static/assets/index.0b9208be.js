import{q as A,k as I,Z as S}from"./index.e9d54774.js";/* empty css                *//* empty css               *//* empty css                */import{d as q,f as g,w as H,n as T,D as u,E as w,H as h,aS as o,aI as r,aY as d,aW as N,aU as V,aV as L,aH as P,bg as v,aN as $,bX as j,a_ as M,bt as U,b0 as W,c3 as X,c4 as Y}from"./arco.a97fe066.js";import{P as Z,g as z,a as G,b as y,e as J}from"./report-dataset.d2c16129.js";import{h as K}from"./vue.4eb70094.js";import{_ as O}from"./index.vue_vue_type_script_setup_true_lang.dff799f7.js";import{p as Q}from"./pagination.72a5f225.js";import{d as ee}from"./global.90f51a62.js";import"./chart.a235fbdf.js";const ae={class:"page-container"},oe={class:"page-panel",style:{height:"calc(100vh - 84px)"}},te={style:{"border-bottom":"1px solid var(--color-border)","margin-bottom":"4px","padding-bottom":"4px",display:"flex","justify-content":"space-between","align-items":"center"}},we=q({__name:"index",setup(ne){const l=K(),b=()=>{window.parent.history.state.back?I.push({path:window.parent.history.state.back}):window.history.go(-1)},s=g(),c=g(),_=async()=>{var a;c.value=[],l.query["report-config-id"]&&(s.value=(await z(l.query["report-config-id"])).data,c.value=(await G(l.query["report-config-id"])).data,(a=c.value)==null||a.forEach(e=>{e.loading=!0;const{pagination:t}=Q();e.page=t,y({datasetReportConfigId:e.id,page:t}).then(n=>{n&&n.data&&(e.previewHeaders=n.data.headers,e.previewRows=n.data.rows,e.loading=!1)}).finally(()=>{e.loading=!1})}))},x=a=>{a.page&&(a.page.current+=1,a.loading=!0,y({datasetReportConfigId:a.id,page:a.page}).then(e=>{var t;e&&e.data&&(a.previewHeaders=e.data.headers,(t=a.previewRows)==null||t.push(...e.data.rows),a.loading=!1,e.data.rows&&e.data.rows.length===0&&v.warning("\u6CA1\u6709\u66F4\u591A\u6570\u636E\u4E86~~"))}).finally(()=>{a.loading=!1}))},B=()=>{_()},m=A(),C=async()=>{var a,e,t,n;v.loading("\u5DF2\u521B\u5EFA\u4E0B\u8F7D\u4EFB\u52A1\uFF0C\u5B8C\u6210\u540E\u6D4F\u89C8\u5668\u5C06\u81EA\u52A8\u4E0B\u8F7D\uFF01");try{m.addDownloadItem((a=s.value)==null?void 0:a.name),ee(await J((e=s.value)==null?void 0:e.id),`${(t=s.value)==null?void 0:t.name}.xlsx`),m.delDownloadItem((n=s.value)==null?void 0:n.name)}catch(p){console.error(p)}};return H(()=>l.query["report-config-id"],()=>{T(()=>{_()})},{deep:!0,immediate:!0}),(a,e)=>{const t=S,n=$,p=j,f=M,R=U,D=W,F=X,E=Y;return u(),w("div",ae,[h("div",oe,[h("div",te,[o(D,{style:{width:"100%"}},{default:r(()=>[o(f,{span:12},{default:r(()=>{var i;return[o(n,{type:"text",onClick:b},{icon:r(()=>[o(t)]),default:r(()=>[d("\u8FD4\u56DE")]),_:1}),o(p,{direction:"vertical"}),d(" "+N((i=s.value)==null?void 0:i.name),1)]}),_:1}),o(f,{span:12,style:{"text-align":"right"}},{default:r(()=>[o(R,null,{default:r(()=>[o(O,{onClick:B}),o(n,{type:"primary",onClick:C},{default:r(()=>[d("\u5BFC\u51FA")]),_:1})]),_:1})]),_:1})]),_:1})]),o(E,null,{default:r(()=>[(u(!0),w(V,null,L(c.value,(i,k)=>(u(),P(F,{key:k,title:i.name},{default:r(()=>[o(Z,{headers:i.previewHeaders,rows:i.previewRows,loading:i.loading,height:"76vh","empty-text":"\u6682\u65E0\u6570\u636E",onScrollReachBottom:re=>x(i)},null,8,["headers","rows","loading","onScrollReachBottom"])]),_:2},1032,["title"]))),128))]),_:1})])])}}});export{we as default};
