import{h as K,a as re,W as ue,_ as de}from"./index.e9d54774.js";/* empty css                *//* empty css               */import{f as d,d as pe,c as P,o as fe,aT as $,D as r,E as w,H as f,aS as o,aI as t,u as n,aU as N,aV as V,aH as C,G as x,aY as s,aW as u,bz as me,aZ as _e,ch as he,bY as ge,bt as ve,a_ as ye,b0 as ke,aM as we,bB as Ce,aN as be,bh as xe,a1 as Ee,a3 as Be,aX as Fe,aR as ze,bi as Se}from"./arco.a97fe066.js";import{d as Ie}from"./index.127a6572.js";import{f as De}from"./unit-util.2cbd6bbc.js";import{c as Ae}from"./index.0f61770a.js";import{p as Te}from"./pagination.72a5f225.js";import{c as m}from"./color.562bf6e9.js";import{l as Pe}from"./app-instance.ab836c4c.js";import"./chart.a235fbdf.js";import"./vue.4eb70094.js";import"./moment.a1678c09.js";import"./vuedraggable.umd.d90dc502.js";const L="/active-event",W=d([{type:"checkbox",width:40,resizable:!1},{title:"\u7EA7\u522B",field:"severity",width:65,slots:{default:"severity"}},{title:"\u4E8B\u4EF6\u63CF\u8FF0",field:"summary",minWidth:300,slots:{default:"summary"}},{title:"\u4E3B\u673A\u540D",field:"nodeAlias",minWidth:120},{title:"IP",field:"node",minWidth:120},{title:"\u53D1\u751F\u65F6\u95F4",field:"firstOccurrence",width:160},{title:"\u6301\u7EED\u65F6\u957F",field:"duration",width:130,slots:{default:"duration"}},{title:"\u5E94\u7528\u6E90",field:"appKey",width:120,slots:{default:"appKey"}},{title:"\u53D1\u751F\u6B21\u6570",field:"tally",width:80},{title:"\u786E\u8BA4\u72B6\u6001",field:"acknowledged",width:80,slots:{default:"acknowledged"}},{title:"\u64CD\u4F5C",fixed:"right",width:120,resizable:!1,slots:{default:"action"}}]),O=d({size:"mini",height:"auto",columnConfig:{resizable:!0},rowConfig:{keyField:"serial",isHover:!0},checkboxConfig:{reserve:!0},showOverflow:"tooltip",columns:W.value}),E=[{label:"\u4FE1\u606F",checked:!1,color:m("info-6")},{label:"\u8B66\u544A",checked:!1,color:m("warn-6")},{label:"\u4E00\u822C",checked:!1,color:m("average-6")},{label:"\u4E25\u91CD",checked:!1,color:m("high-6")},{label:"\u707E\u96BE",checked:!1,color:m("disaster-6")}],_=d({keyword:void 0,severities:E});function $e(h){return K.post(`${L}/list`,h)}function Ne(h){return K.get(`${L}/get-origin-record/${h}`)}const Ve={class:"page-container"},Oe={class:"page-panel"},Ke={style:{height:"calc(100vh - 147px)"}},Le={style:{display:"flex",width:"100%","padding-top":"10px","justify-content":"space-between"}},We={key:0},He=pe({__name:"index",setup(h){const g=d(!1),B={},{loading:H,setLoading:F}=re(!1),{pageSizeOptions:M,pagination:i}=Te(),b=d(),R=d(),U=d(),z=d(),G=P(()=>"active-event-list"),S=P(()=>z.value),p=async()=>{F(!0);const l=[];_.value.severities.forEach((c,v)=>{c.checked&&l.push(v+1)});const a=b.value;try{const{data:c}=await $e({keywords:_.value.keyword||"",severities:l,page:i});i.total=c.totalElements,a&&await a.loadData(c.content)}catch(c){console.error(c)}finally{F(!1)}},I=Ie(async()=>{await p()},500),j=l=>{i.current=l,setTimeout(()=>p(),1)},J=l=>{i.current=1,i.pageSize=l,setTimeout(()=>p(),1)},Y=l=>{O.value.columns=l;const a=b.value;a&&a.refreshColumn()},X=async l=>{const{data:a}=await Ne(l.serial);z.value=a,g.value=!0};return fe(async()=>{console.log("Lifecycle hook: mounted");const{data:l}=await Pe();l.filter(a=>a.enable&&!a.deleteTime).forEach(a=>{B[a.id||""]=a.name}),await p()}),(l,a)=>{const c=he,v=ge,y=ve,D=ye,Z=$("auto-refresh"),q=ke,A=we,Q=Ce,ee=be,te=$("vxe-grid"),oe=ue,T=xe,ae=Ee,ne=Be,le=Fe,se=ze,ie=Se;return r(),w("div",Ve,[f("div",Oe,[o(q,{style:{"margin-bottom":"6px"}},{default:t(()=>[o(D,{span:16},{default:t(()=>[o(y,null,{default:t(()=>[o(c,{modelValue:n(_).keyword,"onUpdate:modelValue":a[0]||(a[0]=e=>n(_).keyword=e),modelModifiers:{trim:!0},style:{width:"260px"},placeholder:"\u5173\u952E\u5B57",onSearch:p,onInput:n(I),onClear:n(I)},null,8,["modelValue","onInput","onClear"]),(r(!0),w(N,null,V(n(_).severities,(e,k)=>(r(),C(v,{key:k,checked:e.checked,"onUpdate:checked":ce=>e.checked=ce,style:x({border:"1px solid "+e.color}),color:e.checked?e.color:"",checkable:"",bordered:"",onClick:p},{default:t(()=>[s(u(e.label),1)]),_:2},1032,["checked","onUpdate:checked","style","color"]))),128))]),_:1})]),_:1}),o(D,{span:8,style:{"text-align":"right"}},{default:t(()=>[o(y,null,{default:t(()=>[o(Z,{refresh:p})]),_:1})]),_:1})]),_:1}),f("div",Ke,[o(te,me({ref_key:"xGrid",ref:b},n(O),{loading:n(H)}),{severity:t(({row:e})=>[o(v,{color:n(E)[e.severity-1].color},{default:t(()=>[s(u(n(E)[e.severity-1].label),1)]),_:2},1032,["color"])]),summary:t(({row:e})=>[o(A,{hoverable:!1,style:{"font-size":"12px"}},{default:t(()=>[s(u(e.summary),1)]),_:2},1024)]),duration:t(({row:e})=>[s(u(n(De)(e.duration,"s")),1)]),appKey:t(({row:e})=>[s(u(B[e.appKey]),1)]),action:t(({row:e})=>[o(A,{style:{"font-size":"12px"},onClick:k=>X(e)},{default:t(()=>[s(" \u67E5\u770B ")]),_:2},1032,["onClick"])]),pager:t(()=>[f("div",Le,[o(Q,{ref_key:"xPagination",ref:R,total:n(i).total,current:n(i).current,"page-size":n(i).pageSize,"page-size-options":n(M),"show-total":"","show-jumper":"","show-page-size":"",onChange:j,onPageSizeChange:J},null,8,["total","current","page-size","page-size-options"]),f("div",null,[o(y,null,{default:t(()=>[o(ee,null,{default:t(()=>[s("\u5BFC\u51FA")]),_:1}),o(Ae,{ref_key:"columnConfigRef",ref:U,"column-config":n(W),"config-id":G.value,onSave:Y},null,8,["column-config","config-id"])]),_:1})])])]),_:1},16,["loading"])])]),o(ie,{visible:g.value,"unmount-on-close":"",width:"40vw",onOk:a[1]||(a[1]=e=>g.value=!1),onCancel:a[2]||(a[2]=e=>g.value=!1)},{title:t(()=>[o(oe),s(" \u4E8B\u4EF6\u56DE\u6EAF ")]),default:t(()=>[o(y,{direction:"vertical",fill:""},{default:t(()=>[o(T,{"show-icon":!1},{default:t(()=>[s("\u5904\u7406\u8FC7\u7A0B\u72B6\u6001")]),_:1}),o(se,{"label-position":"relative"},{default:t(()=>[(r(!0),w(N,null,V(S.value.procInfos,(e,k)=>(r(),C(le,{key:k,label:e.startTime},{dot:t(()=>[e.succeed?(r(),C(ae,{key:0,style:x({backgroundColor:"var(--color-success-light-2)"}),class:"proc-status"},null,8,["style"])):(r(),C(ne,{key:1,style:x({backgroundColor:"var(--color-danger-light-2)"}),class:"proc-status"},null,8,["style"]))]),default:t(()=>[s(" "+u(e.stepName)+" ",1),e.succeed?_e("",!0):(r(),w("div",We,u(e.details),1))]),_:2},1032,["label"]))),128))]),_:1}),o(T,{"show-icon":!1},{default:t(()=>[s("\u539F\u59CB\u62A5\u6587")]),_:1}),f("pre",null,u(JSON.stringify(JSON.parse(S.value.payload),null,2)),1)]),_:1})]),_:1},8,["visible"])])}}});const at=de(He,[["__scopeId","data-v-394827de"]]);export{at as default};
