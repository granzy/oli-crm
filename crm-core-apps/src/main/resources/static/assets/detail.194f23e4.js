import{h as K,l as y,_ as Ae,a as De,Z as xe}from"./index.e9d54774.js";/* empty css                *//* empty css                *//* empty css               *//* empty css                */import{d as ee,f as F,c as P,o as ie,w as ae,D as i,aH as E,aI as e,aS as u,aY as p,E as x,aU as N,aV as R,aW as D,aZ as U,u as Y,aP as oe,bo as me,a$ as Be,aO as Fe,cn as he,bZ as Ve,bt as se,bp as ce,aN as ue,bi as ke,aT as pe,H as V,bz as ge,bg as Q,a1 as we,aM as ne,c5 as ye,co as Me,a_ as fe,aQ as $e,bq as re,ch as Ge,b0 as be,cg as Oe,bX as Ne,bE as qe,c1 as Te,c2 as Ue,c3 as Le,b_ as Se,c4 as Ie}from"./arco.a97fe066.js";import{g as de,l as Re}from"./model.9705abc9.js";import{_ as ze}from"./model-drawer.vue_vue_type_script_setup_true_lang.50cde151.js";/* empty css                *//* empty css               */import{_ as je,s as We,c as Je,a as Pe,b as Ze,d as He}from"./model-common-attr.vue_vue_type_script_setup_true_lang.2c2234f1.js";/* empty css              */import{d as X}from"./index.127a6572.js";/* empty css               */import{D as _e}from"./vuedraggable.umd.d90dc502.js";import{v as Qe}from"./v4.cf9713fe.js";import"./chart.a235fbdf.js";import"./vue.4eb70094.js";/* empty css               */import"./model-group.e81e15b0.js";/* empty css               *//* empty css                */function Xe(){return K.get("/modelAttrType/findAll")}const Ye=ee({__name:"model-attr-drawer",props:{visible:{type:Boolean},model:{type:Object,default:()=>({}),required:!0},data:{type:Object,required:!1}},emits:["close"],setup(b,{emit:z}){const m=b,c=z,k={name:"",code:"",modelCode:"",groupId:"",regex:"",format:"",defaultValue:void 0,attrType:"string",extraMeta:void 0,readonly:!1,required:!1,uniquely:!1,visible:!0},o=F(y.cloneDeep(k)),v=P(()=>m.data?"\u7F16\u8F91\u5B57\u6BB5":"\u65B0\u5EFA\u5B57\u6BB5"),q=P(()=>{var n;return(n=m.model.modelAttrGroups)==null?void 0:n.map(t=>({label:t.name,value:t.id}))}),M=F([]),g=async()=>{M.value=(await Xe()).data};ie(()=>{g()});const a=F({regex:{display:!0,disable:!1},format:{display:!1,disable:!0},enumOptions:{display:!1,disable:!0}}),T=P({get:()=>{let n;return o.value.extraMeta?(n=JSON.parse(o.value.extraMeta),n.enumOptions||[]):[]},set:n=>{o.value.extraMeta=JSON.stringify({enumOptions:n})}}),L=n=>{const t=M.value.find(_=>_.type===n);t&&(o.value={...o.value,regex:"",format:"",defaultValue:void 0},o.value.regex=t.defaultRegex,o.value.format=t.defaultFormat,a.value.regex.display=!1,a.value.regex.disable=!1,a.value.format.display=!1,a.value.format.disable=!1,a.value.enumOptions.display=!1,a.value.enumOptions.disable=!1,t.type==="ip"?(a.value.regex.display=!0,a.value.regex.disable=!0):t.type==="date"||t.type==="datetime"?(a.value.format.display=!0,a.value.format.disable=!0):t.type==="enum"||t.type==="boolean"?(a.value.regex.display=!1,a.value.regex.disable=!1,a.value.format.display=!1,a.value.format.disable=!1,t.type==="enum"&&(a.value.enumOptions.display=!0,a.value.enumOptions.disable=!1,T.value=[])):(a.value.regex.display=!0,a.value.regex.disable=!1))},C=P(()=>{const n=y.cloneDeep(o.value);return n.modelCode=m.model.code,n.preset=!1,n}),A=F(),O=async()=>{if(A.value&&!await A.value.validate())try{await We(C.value),c("close",!0)}catch(t){console.error(t)}};ae(()=>m.visible,n=>{if(n){const{data:t}=m;t?(L(t.attrType||"string"),o.value=y.cloneDeep(t)):(L("string"),o.value=y.cloneDeep(k),o.value.modelCode=m.model.code)}},{immediate:!0});const w=n=>{o.value.defaultValue&&n.indexOf(o.value.defaultValue)===-1&&(o.value.defaultValue=void 0)},h={name:[{required:!0,message:"\u8BF7\u8F93\u5165\u5B57\u6BB5\u540D\u79F0"},{maxLength:255,message:"\u957F\u5EA6\u4E0D\u80FD\u8D85\u8FC7255\u4E2A\u5B57\u7B26"},{validator:X(async(n,t)=>{const{data:_}=await Je(o.value);_&&t("\u5B57\u6BB5\u540D\u79F0\u5DF2\u5B58\u5728")},300),message:"\u5B57\u6BB5\u540D\u79F0\u5DF2\u5B58\u5728"}],code:[{required:!0,message:"\u8BF7\u8F93\u5165\u5B57\u6BB5\u7F16\u7801"},{match:/^[a-zA-Z_]+$/,message:"\u53EA\u80FD\u8F93\u5165\u5B57\u6BCD\u3001\u4E0B\u5212\u7EBF"},{maxLength:64,message:"\u957F\u5EA6\u4E0D\u80FD\u8D85\u8FC764\u4E2A\u5B57\u7B26"},{validator:X(async(n,t)=>{const{data:_}=await Pe(o.value);_&&t("\u5B57\u6BB5\u7F16\u7801\u5DF2\u5B58\u5728")},300),message:"\u5B57\u6BB5\u7F16\u7801\u5DF2\u5B58\u5728"}],defaultValue:[{validator:(n,t)=>{o.value.regex&&o.value.defaultValue&&(new RegExp(o.value.regex).test(n)||t("\u683C\u5F0F\u4E0D\u6B63\u786E"))},message:"\u683C\u5F0F\u4E0D\u6B63\u786E"}],attrType:[{required:!0,message:"\u8BF7\u9009\u62E9\u5B57\u6BB5\u7C7B\u578B"}],groupId:[{required:!0,message:"\u8BF7\u9009\u62E9\u5B57\u6BB5\u5206\u7C7B"}]};return(n,t)=>{const _=oe,s=me,l=Be,f=Fe,B=he,G=Ve,j=se,W=ce,S=ue,Z=ke;return i(),E(Z,{width:"30vw",visible:b.visible,title:v.value,"unmount-on-close":"","mask-closable":!1,onCancel:t[13]||(t[13]=r=>c("close",!1)),onClose:t[14]||(t[14]=r=>o.value=Y(y).cloneDeep(k))},{footer:e(()=>[u(j,null,{default:e(()=>[u(S,{onClick:t[12]||(t[12]=r=>c("close",!1))},{default:e(()=>[p("\u53D6\u6D88")]),_:1}),u(S,{type:"primary",onClick:O},{default:e(()=>[p("\u4FDD\u5B58")]),_:1})]),_:1})]),default:e(()=>[u(W,{ref_key:"formRef",ref:A,model:o.value,rules:h},{default:e(()=>[u(s,{field:"name",label:"\u5B57\u6BB5\u540D\u79F0"},{default:e(()=>[u(_,{modelValue:o.value.name,"onUpdate:modelValue":t[0]||(t[0]=r=>o.value.name=r),placeholder:"\u8BF7\u8F93\u5165\u5B57\u6BB5\u540D\u79F0"},null,8,["modelValue"])]),_:1}),u(s,{field:"code",label:"\u5B57\u6BB5\u7F16\u7801"},{default:e(()=>[u(_,{modelValue:o.value.code,"onUpdate:modelValue":t[1]||(t[1]=r=>o.value.code=r),placeholder:"\u8BF7\u8F93\u5165\u5B57\u6BB5\u7F16\u7801",disabled:!!m.data},null,8,["modelValue","disabled"])]),_:1}),u(s,{field:"attrType",label:"\u5B57\u6BB5\u7C7B\u578B"},{default:e(()=>[u(f,{modelValue:o.value.attrType,"onUpdate:modelValue":t[2]||(t[2]=r=>o.value.attrType=r),placeholder:"\u8BF7\u9009\u62E9\u5B57\u6BB5\u7C7B\u578B",onChange:L},{default:e(()=>[(i(!0),x(N,null,R(M.value,(r,$)=>(i(),E(l,{key:$,value:r.type},{default:e(()=>[p(D(r.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),_:1}),u(s,{field:"groupId",label:"\u5B57\u6BB5\u5206\u7C7B"},{default:e(()=>[u(f,{modelValue:o.value.groupId,"onUpdate:modelValue":t[3]||(t[3]=r=>o.value.groupId=r),placeholder:"\u8BF7\u9009\u62E9\u5B57\u6BB5\u5206\u7C7B"},{default:e(()=>[(i(!0),x(N,null,R(q.value,(r,$)=>(i(),E(l,{key:$,value:r.value},{default:e(()=>[p(D(r.label),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a.value.enumOptions.display?(i(),E(s,{key:0,label:"\u679A\u4E3E\u9879"},{default:e(()=>[u(B,{modelValue:T.value,"onUpdate:modelValue":t[4]||(t[4]=r=>T.value=r),placeholder:"\u8BF7\u8F93\u5165\u679A\u4E3E\u9879","allow-clear":"",onChange:w},null,8,["modelValue"])]),_:1})):U("",!0),a.value.regex.display?(i(),E(s,{key:1,field:"regex",label:"\u6B63\u5219\u8868\u8FBE\u5F0F"},{default:e(()=>[u(_,{modelValue:o.value.regex,"onUpdate:modelValue":t[5]||(t[5]=r=>o.value.regex=r),disabled:a.value.regex.disable,placeholder:"\u8BF7\u8F93\u5165\u6B63\u5219\u8868\u8FBE\u5F0F"},null,8,["modelValue","disabled"])]),_:1})):U("",!0),a.value.format.display?(i(),E(s,{key:2,field:"format",label:"\u683C\u5F0F"},{default:e(()=>[u(_,{modelValue:o.value.format,"onUpdate:modelValue":t[6]||(t[6]=r=>o.value.format=r),disabled:a.value.format.disable},null,8,["modelValue","disabled"])]),_:1})):U("",!0),u(s,{field:"defaultValue",label:"\u9ED8\u8BA4\u503C"},{default:e(()=>[u(je,{modelValue:o.value.defaultValue,"onUpdate:modelValue":t[7]||(t[7]=r=>o.value.defaultValue=r),type:o.value.attrType,"extra-meta":T.value,placeholder:"\u8BF7\u8F93\u5165\u9ED8\u8BA4\u503C"},null,8,["modelValue","type","extra-meta"])]),_:1}),u(s,{label:"\u5C5E\u6027"},{default:e(()=>[u(j,null,{default:e(()=>[u(G,{modelValue:o.value.readonly,"onUpdate:modelValue":t[8]||(t[8]=r=>o.value.readonly=r)},{default:e(()=>[p("\u53EA\u8BFB")]),_:1},8,["modelValue"]),u(G,{modelValue:o.value.required,"onUpdate:modelValue":t[9]||(t[9]=r=>o.value.required=r)},{default:e(()=>[p("\u5FC5\u586B")]),_:1},8,["modelValue"]),u(G,{modelValue:o.value.uniquely,"onUpdate:modelValue":t[10]||(t[10]=r=>o.value.uniquely=r)},{default:e(()=>[p("\u552F\u4E00")]),_:1},8,["modelValue"]),u(G,{modelValue:o.value.visible,"onUpdate:modelValue":t[11]||(t[11]=r=>o.value.visible=r)},{default:e(()=>[p("\u542F\u7528")]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["visible","title"])}}}),Ke={style:{"margin-bottom":"6px",display:"flex","justify-content":"space-between"}},eu={key:0},uu={key:1},tu={key:2},lu={key:0},au=ee({__name:"model-attr-list",props:{model:{type:Object,default:()=>({})},loading:{type:Boolean,default:!1}},emits:["refresh"],setup(b,{emit:z}){const m=b,c=z,k=F(),o=F(!1),v=F(""),q=()=>{o.value=!0,k.value=void 0},M=async C=>{k.value=(await Ze(C)).data,o.value=!0},g=async C=>{try{await He(C),c("refresh",!0),Q.success("\u5220\u9664\u6210\u529F")}catch(A){console.error(A)}},a=C=>{c("refresh",C),o.value=!1},T=P(()=>{var A;const C=[];return(A=m.model.modelAttrGroups)==null||A.forEach(O=>{var w;(w=O.modelAttrs)==null||w.forEach(h=>{var n,t,_,s,l;v.value?(((t=(n=h.name)==null?void 0:n.toLowerCase())==null?void 0:t.includes(v.value.toLowerCase()))||((_=h.code)==null?void 0:_.toLowerCase().includes(v.value.toLowerCase()))||((l=(s=h.attrTypeName)==null?void 0:s.toLowerCase())==null?void 0:l.includes(v.value.toLowerCase())))&&C.push(h):C.push(h)})}),y.sortBy(C,O=>new Date(O.createTime||0))}),L=F({size:"mini",height:"auto",showOverflow:"tooltip",columnConfig:{resizable:!0},columns:[{field:"name",title:"\u5B57\u6BB5\u540D\u79F0",width:100},{field:"code",title:"\u5B57\u6BB5\u7F16\u7801",width:100},{field:"attrTypeName",title:"\u5B57\u6BB5\u7C7B\u578B",width:100},{title:"\u6B63\u5219\u3001\u679A\u4E3E\u503C\u548C\u683C\u5F0F",slots:{default:"config"}},{field:"defaultValue",title:"\u5B57\u6BB5\u9ED8\u8BA4\u503C",width:200},{field:"groupName",title:"\u5B57\u6BB5\u5206\u7C7B",width:100},{field:"required",title:"\u5FC5\u586B",width:100,slots:{default:"required"}},{field:"uniquely",title:"\u552F\u4E00",width:100,slots:{default:"uniquely"}},{field:"visible",title:"\u542F\u7528",width:100,slots:{default:"visible"}},{field:"action",title:"\u64CD\u4F5C",width:150,slots:{default:"action"}}]});return(C,A)=>{const O=oe,w=ue,h=se,n=we,t=ne,_=ye,s=pe("vxe-grid");return i(),x(N,null,[V("div",Ke,[u(O,{modelValue:v.value,"onUpdate:modelValue":A[0]||(A[0]=l=>v.value=l),style:{width:"250px"},placeholder:"\u5B57\u6BB5\u540D\u79F0/\u5B57\u6BB5\u7F16\u7801/\u5B57\u6BB5\u7C7B\u578B"},null,8,["modelValue"]),u(h,null,{default:e(()=>[u(w,{onClick:A[1]||(A[1]=l=>c("refresh",!0))},{default:e(()=>[p("\u5237\u65B0")]),_:1}),u(w,{type:"primary",onClick:q},{default:e(()=>[p("\u65B0\u5EFA")]),_:1})]),_:1})]),u(s,ge({loading:b.loading,data:T.value},L.value),{config:e(({row:l})=>[l.regex?(i(),x("span",eu,D(l.regex),1)):l.format?(i(),x("span",uu,D(l.format),1)):l.attrType==="enum"?(i(),x("span",tu,[u(h,null,{default:e(()=>[(i(!0),x(N,null,R(JSON.parse(l.extraMeta).enumOptions,(f,B)=>(i(),x("span",{key:B,color:"blue"},[p(D(f)+" ",1),B!==JSON.parse(l.extraMeta).enumOptions.length-1?(i(),x("span",lu," , ")):U("",!0)]))),128))]),_:2},1024)])):U("",!0)]),required:e(({row:l})=>[l.required?(i(),E(n,{key:0})):U("",!0)]),uniquely:e(({row:l})=>[l.uniquely?(i(),E(n,{key:0})):U("",!0)]),visible:e(({row:l})=>[l.visible?(i(),E(n,{key:0})):U("",!0)]),action:e(({row:l})=>[l.preset?U("",!0):(i(),E(h,{key:0},{default:e(()=>[u(t,{hoverable:!1,style:{"font-size":"12px"},onClick:f=>M(l.id)},{default:e(()=>[p(" \u7F16\u8F91 ")]),_:2},1032,["onClick"]),u(_,{content:"\u786E\u8BA4\u5220\u9664?",type:"warning",onOk:f=>g(l.id)},{default:e(()=>[u(t,{hoverable:!1,style:{"font-size":"12px"}},{default:e(()=>[p("\u5220\u9664")]),_:1})]),_:2},1032,["onOk"])]),_:2},1024))]),_:1},16,["loading","data"]),u(Ye,{visible:o.value,model:b.model,data:k.value,onClose:a},null,8,["visible","model","data"])],64)}}});function ou(b){return K.post("/modelAttrGroup/batchSave",b)}const su={style:{"margin-bottom":"6px",display:"flex","justify-content":"space-between"}},nu={style:{cursor:"move"}},ru={class:"drag-attr"},du=ee({__name:"model-attr-group",props:{model:{type:Object,default:()=>({})}},emits:["refresh"],setup(b,{emit:z}){const m=b,c=F(y.cloneDeep(m.model)),k=F(!1),o=F("\u65B0\u589E\u5B57\u6BB5\u5206\u7C7B"),v=F(),q=F([]),M=z,g=F({name:"",modelCode:c.value.code,modelAttrs:[]}),a=async n=>{g.value=y.cloneDeep(n),o.value="\u7F16\u8F91\u5B57\u6BB5\u5206\u7C7B",k.value=!0},T=async n=>{if(c.value.modelAttrGroups){const t=y.find(c.value.modelAttrGroups,s=>s.id===n),_=y.find(c.value.modelAttrGroups,s=>s.name==="\u57FA\u7840\u5B57\u6BB5");t&&(_.modelAttrs.push(...t.modelAttrs),y.remove(c.value.modelAttrGroups,l=>l.id===n).forEach(l=>{l.forCreate||q.value.push(l)}))}},L=()=>{k.value=!0,g.value={id:Qe(),name:"",modelCode:c.value.code,modelAttrs:[],forCreate:!0}},C=async()=>{if(v.value&&!await v.value.validate()&&c.value.modelAttrGroups){const t=y.find(c.value.modelAttrGroups,{id:g.value.id});t?y.assign(t,g.value):c.value.modelAttrGroups.push(y.cloneDeep(g.value)),k.value=!1}},A={name:[{required:!0,message:"\u5206\u7C7B\u540D\u79F0\u4E3A\u5FC5\u586B\u9879"},{validator:async(n,t)=>{n&&y.find(c.value.modelAttrGroups,s=>s.name===n&&s.id!==g.value.id)&&t("\u5206\u7C7B\u540D\u79F0\u5DF2\u5B58\u5728")},message:"\u5206\u7C7B\u540D\u79F0\u5DF2\u5B58\u5728"}]},O=()=>{c.value=y.cloneDeep(m.model)},w=async()=>{try{c.value.modelAttrGroups&&(await ou({modelAttrGroupForDelete:q.value,modelAttrGroupForSave:c.value.modelAttrGroups}),M("refresh",!0),Q.success("\u4FDD\u5B58\u6210\u529F"))}catch(n){console.error(n)}},h=P(()=>!y.isEqual(c.value,m.model));return ae(()=>m.model,n=>{c.value=y.cloneDeep(n)}),(n,t)=>{const _=ue,s=se,l=ne,f=ye,B=fe,G=$e,j=oe,W=me,S=ce,Z=re;return i(),x(N,null,[V("div",su,[V("div",null,[h.value?(i(),E(s,{key:0},{default:e(()=>[u(_,{type:"primary",onClick:w},{default:e(()=>[p("\u4FDD\u5B58")]),_:1}),u(_,{onClick:O},{default:e(()=>[p("\u91CD\u7F6E")]),_:1})]),_:1})):U("",!0)]),u(s,null,{default:e(()=>[u(_,{type:"primary",onClick:L},{default:e(()=>[p("\u65B0\u5EFA")]),_:1})]),_:1})]),u(Y(_e),{modelValue:c.value.modelAttrGroups,"onUpdate:modelValue":t[0]||(t[0]=r=>c.value.modelAttrGroups=r),draggable:".drag","item-key":"id"},{item:e(({element:r})=>[u(G,{class:"drag attr-cards",size:"mini",style:{"min-height":"100px","margin-bottom":"6px",background:"var(--color-bg-6)"}},Me({title:e(()=>[V("div",nu,D(r.name),1)]),default:e(()=>[u(Y(_e),{modelValue:r.modelAttrs,"onUpdate:modelValue":$=>r.modelAttrs=$,draggable:".drag",tag:"a-row",group:"attr","component-data":{gutter:5,style:{width:"100%",minHeight:"30px"}},"item-key":"id"},{item:e($=>[u(B,{class:"drag",span:2},{default:e(()=>[V("span",ru,D($.element.name),1)]),_:2},1024)]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},[r.name!="\u57FA\u7840\u5B57\u6BB5"?{name:"extra",fn:e(()=>[u(s,null,{default:e(()=>[u(f,{content:"\u786E\u8BA4\u5220\u9664?",type:"warning",onOk:$=>T(r.id)},{default:e(()=>[u(l,{hoverable:!1,style:{"font-size":"12px"}},{default:e(()=>[p("\u5220\u9664")]),_:1})]),_:2},1032,["onOk"]),u(l,{hoverable:!1,style:{"font-size":"12px"},onClick:$=>a(r)},{default:e(()=>[p(" \u7F16\u8F91 ")]),_:2},1032,["onClick"])]),_:2},1024)]),key:"0"}:void 0]),1024)]),_:1},8,["modelValue"]),u(Z,{visible:k.value,title:o.value,"title-align":"start",top:"20vh","align-center":!1,"ok-text":"\u4FDD\u5B58",draggable:"",onOk:C,onCancel:t[2]||(t[2]=r=>k.value=!1)},{default:e(()=>[u(S,{ref_key:"modelGroupFormRef",ref:v,model:g.value,rules:A},{default:e(()=>[u(W,{label:"\u5206\u7C7B\u540D\u79F0",field:"name"},{default:e(()=>[u(j,{modelValue:g.value.name,"onUpdate:modelValue":t[1]||(t[1]=r=>g.value.name=r)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["visible","title"])],64)}}});const iu=Ae(du,[["__scopeId","data-v-05a8bda1"]]);function mu(b){return K.post("/modelLink/save",b)}function cu(b){return K.post("/modelLink/checkNameExist",b)}function pu(b){return K.delete(`/modelLink/${b}`)}const fu=ee({__name:"model-link",props:{model:{type:Object,default:()=>({})}},emits:["refresh"],setup(b,{emit:z}){const m=b,c=z,k=F(),o=F({size:"mini",height:"auto",columnConfig:{resizable:!0},showOverflow:"tooltip",columns:[{title:"\u5173\u7CFB\u540D\u79F0",field:"name",minWidth:120},{title:"\u6E90\u6A21\u578B",slots:{default:"sourceModelName"},minWidth:120},{title:"\u6E90\u5B57\u6BB5",slots:{default:"sourceFieldName"},minWidth:120},{title:"\u76EE\u6807\u6A21\u578B",slots:{default:"targetModelName"},minWidth:120},{title:"\u76EE\u6807\u5730\u5740",slots:{default:"targetFieldName"},minWidth:120},{title:"\u521B\u5EFA\u65F6\u95F4",field:"createTime",width:200},{title:"\u64CD\u4F5C",width:120,slots:{default:"action"}}]}),v=F(""),q=P(()=>{var l;const s=[];return(l=m.model.modelLinks)==null||l.forEach(f=>{var B,G,j,W,S;v.value?(((G=(B=f.name)==null?void 0:B.toLowerCase())==null?void 0:G.includes(v.value.toLowerCase()))||`${f.sourceModel}(${f.sourceModelName})`.toLowerCase().includes(v.value.toLowerCase())||((j=`${f.targetModel}(${f.targetModelName})`.toLowerCase())==null?void 0:j.includes(v.value.toLowerCase()))||((W=`${f.sourceField}(${f.sourceFieldName})`.toLowerCase())==null?void 0:W.includes(v.value.toLowerCase()))||((S=`${f.targetField}(${f.targetFieldName})`.toLowerCase())==null?void 0:S.includes(v.value.toLowerCase())))&&s.push(f):s.push(f)}),y.sortBy(s,f=>new Date(f.createTime||0))}),M=F(!1),g=F(),a=F({id:"",name:"",sourceModel:m.model.code,sourceField:"",targetModel:"",targetField:""}),T={name:[{required:!0,message:"\u8BF7\u8F93\u5165\u6A21\u578B\u5173\u8054\u5173\u7CFB\u540D\u79F0"},{maxLength:255,message:"\u957F\u5EA6\u987B\u5728255\u4EE5\u5185"},{validator:X(async(s,l)=>{const{data:f}=await cu(a.value);f&&l("\u6A21\u578B\u5173\u8054\u5173\u7CFB\u540D\u79F0\u5DF2\u5B58\u5728")},300),message:"\u6A21\u578B\u5173\u8054\u5173\u7CFB\u540D\u79F0\u5DF2\u5B58\u5728"}],sourceModel:[{required:!0,message:"\u8BF7\u9009\u62E9\u6E90\u6A21\u578B"},{validator:X(async(s,l)=>{s===a.value.targetModel&&l("\u6E90\u6A21\u578B\u548C\u76EE\u6807\u6A21\u578B\u4E0D\u53EF\u76F8\u540C")},300),message:"\u6E90\u6A21\u578B\u548C\u76EE\u6807\u6A21\u578B\u4E0D\u53EF\u76F8\u540C"}],sourceField:[{required:!0,message:"\u8BF7\u9009\u62E9\u6E90\u5B57\u6BB5"}],targetModel:[{required:!0,message:"\u8BF7\u9009\u62E9\u76EE\u6807\u6A21\u578B"},{validator:X(async(s,l)=>{s===a.value.sourceModel&&l("\u6E90\u6A21\u578B\u548C\u76EE\u6807\u6A21\u578B\u4E0D\u53EF\u76F8\u540C")},300),message:"\u6E90\u6A21\u578B\u548C\u76EE\u6807\u6A21\u578B\u4E0D\u53EF\u76F8\u540C"}],targetField:[{required:!0,message:"\u8BF7\u9009\u62E9\u76EE\u6807\u5B57\u6BB5"}]},L=async()=>{if(a.value.sourceModel!==m.model.code&&a.value.targetModel!==m.model.code){Q.error("\u6E90\u6A21\u578B\u6216\u76EE\u6807\u6A21\u578B\u5FC5\u987B\u5305\u542B\u5F53\u524D\u6A21\u578B");return}await g.value.validate()?console.warn("\u9A8C\u8BC1\u4E0D\u901A\u8FC7"):(await mu(a.value),c("refresh",!0),Q.success("\u63D0\u4EA4\u6210\u529F"),M.value=!1)},C=()=>{M.value=!0},A=s=>{M.value=!0,y.assign(a.value,s),g.value.validate()},O=s=>{re.warning({title:"\u63D0\u793A",titleAlign:"start",hideCancel:!1,content:`\u6B64\u64CD\u4F5C\u5C06\u6C38\u4E45\u8BE5\u6A21\u578B\u5173\u8054\u5173\u7CFB'${s.name}'\uFF0C\u662F\u5426\u7EE7\u7EED?`,onOk:async()=>{await pu(s.id),c("refresh",!0),Q.success("\u5220\u9664\u6210\u529F")}})},w=F(),h=F(),n=F(),t=async()=>{const{data:s}=await Re();w.value=s},_=()=>{t()};return ae(()=>a.value.sourceModel,s=>{s&&de(s).then(l=>{h.value=l.data.modelAttrGroups})},{deep:!0,immediate:!0}),ae(()=>a.value.targetModel,s=>{s&&de(s).then(l=>{n.value=l.data.modelAttrGroups})},{deep:!0,immediate:!0}),ie(()=>{_()}),(s,l)=>{const f=Ge,B=se,G=fe,j=ue,W=be,S=ne,Z=pe("vxe-grid"),r=oe,$=me,te=Be,le=Fe,ve=Oe,Ee=ce,Ce=re;return i(),x(N,null,[u(W,null,{default:e(()=>[u(G,{span:14},{default:e(()=>[u(B,{style:{"margin-bottom":"5px"}},{default:e(()=>[u(f,{modelValue:v.value,"onUpdate:modelValue":l[0]||(l[0]=d=>v.value=d),style:{width:"320px"},placeholder:"\u5173\u7CFB\u540D\u79F0/\u6E90\u6A21\u578B/\u6E90\u5B57\u6BB5/\u76EE\u6807\u6A21\u578B/\u76EE\u6807\u5B57\u6BB5","allow-clear":""},null,8,["modelValue"])]),_:1})]),_:1}),u(G,{span:10,style:{"text-align":"right"}},{default:e(()=>[u(B,{style:{"margin-bottom":"5px"}},{default:e(()=>[u(j,{type:"primary",size:"medium",onClick:C},{default:e(()=>[p(D(s.$t("button.create")),1)]),_:1})]),_:1})]),_:1})]),_:1}),u(Z,ge({ref_key:"xGrid",ref:k,data:q.value},o.value),{sourceModelName:e(({row:d})=>[V("span",null,D(d.sourceModelName+"("+d.sourceModel+")"),1)]),targetModelName:e(({row:d})=>[V("span",null,D(d.targetModelName+"("+d.targetModel+")"),1)]),sourceFieldName:e(({row:d})=>[V("span",null,D(d.sourceFieldName+"("+d.sourceField+")"),1)]),targetFieldName:e(({row:d})=>[V("span",null,D(d.targetFieldName+"("+d.targetField+")"),1)]),action:e(({row:d})=>[u(B,null,{default:e(()=>{var I,J;return[((I=m.model)==null?void 0:I.code)===d.sourceModel?(i(),E(S,{key:0,onClick:H=>A(d)},{default:e(()=>[p(" \u7F16\u8F91 ")]),_:2},1032,["onClick"])):U("",!0),((J=m.model)==null?void 0:J.code)===d.sourceModel?(i(),E(S,{key:1,type:"text",onClick:H=>O(d)},{default:e(()=>[p(" \u5220\u9664 ")]),_:2},1032,["onClick"])):U("",!0)]}),_:2},1024)]),_:1},16,["data"]),u(Ce,{visible:M.value,width:"auto","title-align":"start","mask-closable":!1,draggable:"",onOk:L,onCancel:l[6]||(l[6]=d=>M.value=!1)},{title:e(()=>[p(D(a.value.id?"\u7F16\u8F91\u6A21\u578B\u5173\u7CFB":"\u65B0\u5EFA\u6A21\u578B\u5173\u7CFB"),1)]),default:e(()=>[V("div",null,[u(Ee,{ref_key:"submitFormRef",ref:g,model:a.value,style:{width:"600px"},rules:T},{default:e(()=>[u($,{field:"name",label:"\u6A21\u578B\u5173\u7CFB\u540D\u79F0","validate-trigger":"blur"},{default:e(()=>[u(r,{modelValue:a.value.name,"onUpdate:modelValue":l[1]||(l[1]=d=>a.value.name=d)},null,8,["modelValue"])]),_:1}),u($,{field:"sourceModel",label:"\u6E90\u6A21\u578B"},{default:e(()=>[u(le,{modelValue:a.value.sourceModel,"onUpdate:modelValue":l[2]||(l[2]=d=>a.value.sourceModel=d),disabled:"",placeholder:"\u8BF7\u9009\u62E9\u6E90\u6A21\u578B","allow-clear":""},{default:e(()=>[(i(!0),x(N,null,R(w.value,(d,I)=>(i(),E(te,{key:I,value:d.code},{default:e(()=>[p(D(d.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),_:1}),u($,{field:"sourceField",label:"\u6E90\u5B57\u6BB5"},{default:e(()=>[u(le,{modelValue:a.value.sourceField,"onUpdate:modelValue":l[3]||(l[3]=d=>a.value.sourceField=d),placeholder:"\u8BF7\u9009\u62E9\u6E90\u5B57\u6BB5","allow-clear":""},{default:e(()=>[(i(!0),x(N,null,R(h.value,(d,I)=>(i(),E(ve,{key:I,label:d.name},{default:e(()=>[(i(!0),x(N,null,R(d.modelAttrs,(J,H)=>(i(),E(te,{key:H,value:J.code},{default:e(()=>[p(D(J.name),1)]),_:2},1032,["value"]))),128))]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"])]),_:1}),u($,{field:"targetModel",label:"\u76EE\u6807\u6A21\u578B"},{default:e(()=>[u(le,{modelValue:a.value.targetModel,"onUpdate:modelValue":l[4]||(l[4]=d=>a.value.targetModel=d),placeholder:"\u8BF7\u9009\u62E9\u76EE\u6807\u6A21\u578B","allow-clear":""},{default:e(()=>[(i(!0),x(N,null,R(w.value,(d,I)=>(i(),E(te,{key:I,value:d.code},{default:e(()=>[p(D(d.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),_:1}),u($,{field:"targetField",label:"\u76EE\u6807\u5B57\u6BB5"},{default:e(()=>[u(le,{modelValue:a.value.targetField,"onUpdate:modelValue":l[5]||(l[5]=d=>a.value.targetField=d),placeholder:"\u8BF7\u9009\u62E9\u6E90\u5B57\u6BB5","allow-clear":""},{default:e(()=>[(i(!0),x(N,null,R(n.value,(d,I)=>(i(),E(ve,{key:I,label:d.name},{default:e(()=>[(i(!0),x(N,null,R(d.modelAttrs,(J,H)=>(i(),E(te,{key:H,value:J.code},{default:e(()=>[p(D(J.name),1)]),_:2},1032,["value"]))),128))]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])])]),_:1},8,["visible"])],64)}}}),vu={class:"page-container"},_u={class:"page-panel",style:{height:"180px"}},Bu={style:{display:"flex","justify-content":"space-between"}},Fu={style:{display:"block","white-space":"nowrap","text-overflow":"ellipsis",width:"20vw",overflow:"hidden"}},gu={class:"page-panel",style:{height:"calc(100vh - 90px - 180px)","margin-top":"6px"}},yu={style:{height:"calc(100vh - 90px - 180px - 80px)"}},bu={style:{height:"calc(100vh - 90px - 180px - 80px)"}},ju=ee({__name:"detail",props:{code:{type:String,default:""}},setup(b){const z=b,m=F({}),c=P(()=>[{label:"\u6A21\u578B\u540D\u79F0",value:m.value.name},{label:"\u4E00\u7EA7\u5206\u7EC4",value:m.value.firstGroupName},{label:"\u4E8C\u7EA7\u5206\u7EC4",value:m.value.secondGroupName},{label:"\u6A21\u578B\u63CF\u8FF0",value:m.value.description},{label:"\u521B\u5EFA\u4EBA",value:m.value.createUserName},{label:"\u521B\u5EFA\u65F6\u95F4",value:m.value.createTime},{label:"\u66F4\u65B0\u65F6\u95F4",value:m.value.updateTime}]),{loading:k,setLoading:o}=De(!1),v=async()=>{try{o(!0),m.value=(await de(z.code)).data}catch(g){console.error(g)}finally{o(!1)}};ie(()=>{v()});const q=F(!1),M=g=>{g&&v(),q.value=!1};return(g,a)=>{const T=xe,L=ue,C=Ne,A=ne,O=pe("icon-font"),w=fe,h=qe,n=Te,t=Ue,_=be,s=Le,l=Se,f=Ie;return i(),x("div",vu,[V("div",_u,[V("div",Bu,[V("div",null,[u(L,{type:"text",onClick:a[0]||(a[0]=B=>g.$router.back())},{icon:e(()=>[u(T)]),default:e(()=>[p(" \u8FD4\u56DE ")]),_:1}),u(C,{direction:"vertical"}),p(" "+D(m.value.name),1)]),V("div",null,[u(A,{hoverable:!1,onClick:a[1]||(a[1]=B=>q.value=!0)},{default:e(()=>[p(" \u7F16\u8F91\u6A21\u578B ")]),_:1})])]),u(C),u(_,null,{default:e(()=>[u(w,{span:2},{default:e(()=>[u(O,{type:m.value.icon,size:100,style:{"margin-top":"-10px"}},null,8,["type"])]),_:1}),u(w,{span:22},{default:e(()=>[u(t,{data:c.value,align:{label:"right"},layout:"horizontal",column:3},{default:e(()=>[(i(!0),x(N,null,R(c.value,(B,G)=>(i(),E(n,{key:G,label:B.label},{default:e(()=>[u(h,{position:"lt",content:B.value},{default:e(()=>[V("span",Fu,D(B.value),1)]),_:2},1032,["content"])]),_:2},1032,["label"]))),128))]),_:1},8,["data"])]),_:1})]),_:1})]),V("div",gu,[u(f,{"destroy-on-hide":"","lazy-load":""},{default:e(()=>[u(s,{key:"1",title:"\u5B57\u6BB5\u4FE1\u606F"},{default:e(()=>[V("div",yu,[u(au,{model:m.value,loading:Y(k),onRefresh:a[2]||(a[2]=B=>B?v():"")},null,8,["model","loading"])])]),_:1}),u(s,{key:"2",title:"\u5B57\u6BB5\u5206\u7C7B"},{default:e(()=>[u(l,{style:{height:"calc(100vh - 90px - 180px - 80px)","overflow-y":"auto"},class:"attr-cards"},{default:e(()=>[u(iu,{model:m.value,onRefresh:a[3]||(a[3]=B=>B?v():"")},null,8,["model"])]),_:1})]),_:1}),u(s,{key:"3",title:"\u6A21\u578B\u5173\u8054"},{default:e(()=>[V("div",bu,[u(fu,{model:m.value,onRefresh:a[4]||(a[4]=B=>B?v():"")},null,8,["model"])])]),_:1})]),_:1})]),u(ze,{visible:q.value,type:"update",data:Y(y).cloneDeep(m.value),onClose:M},null,8,["visible","data"])])}}});export{ju as default};
