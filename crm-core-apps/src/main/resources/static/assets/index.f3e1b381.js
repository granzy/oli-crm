import{a as L,k as ne,l as q}from"./index.e9d54774.js";/* empty css               */import{d as O,f as n,c as le,o as K,D as z,E as W,u as r,aH as Y,aZ as se,aS as e,aI as a,H as h,aW as Z,aU as ue,n as B,bK as ie,cm as ce,aT as H,aY as E,bz as re,bq as de,h as _,aP as Q,bg as J,aM as pe,bt as X,bB as me,aN as ee,bA as fe,ch as _e,b_ as ge,a_ as ve,b0 as he}from"./arco.a97fe066.js";/* empty css                */import{a as ye}from"./model-group.e81e15b0.js";import{s as xe}from"./tree-util.a8ddc3e6.js";/* empty css               *//* empty css                *//* empty css              *//* empty css                *//* empty css               */import{p as be,d as Ce,e as Fe,i as we}from"./model.9705abc9.js";import{p as Be}from"./pagination.72a5f225.js";import{d as Ee}from"./global.90f51a62.js";import{_ as ke}from"./model-drawer.vue_vue_type_script_setup_true_lang.50cde151.js";import{S as De}from"./index.d4fbf381.js";import"./chart.a235fbdf.js";import"./vue.4eb70094.js";/* empty css              *//* empty css               */import"./index.127a6572.js";const Ae=O({__name:"model-group-tree",props:{searchText:{type:String,default:""}},emits:["select"],setup(G,{expose:y,emit:d}){const i=d,{loading:o,setLoading:p}=L(),x=n([]),g=G,v=n(),b=le(()=>xe(g.searchText,x.value)),l=async()=>{p(!0);const{data:F}=await ye();x.value=F,await B(()=>{var m;(m=v.value)==null||m.expandAll()}),p(!1)};return K(()=>{l()}),y({fetchTree:l}),(F,m)=>{const k=ie,D=ce;return z(),W(ue,null,[r(o)?(z(),Y(k,{key:0,style:{width:"100%",height:"100%"},loading:r(o),tip:"\u6B63\u5728\u52A0\u8F7D..."},null,8,["loading"])):se("",!0),e(D,{ref_key:"tree",ref:v,data:b.value,onSelect:m[0]||(m[0]=u=>{i("select",u)})},{title:a(u=>[h("div",null,Z(u.title+"("+u.data.count+")"),1)]),_:1},8,["data"])],64)}}}),Te={style:{display:"flex",width:"100%","padding-top":"10px","justify-content":"space-between"}},Le=O({__name:"model-list",props:{params:{}},emits:["edit","delete"],setup(G,{expose:y,emit:d}){const i=n(),{pagination:o,pageSizeOptions:p}=Be(),{loading:x,setLoading:g}=L(!1),v=G,b=d,l=async t=>{try{t&&(o.current=t);const f=i.value;g(!0);const{data:c}=await be({...v.params,page:o});o.total=c.totalElements,f&&await f.loadData(c.content)}catch(f){console.error(f)}finally{g(!1)}},F=n({height:"auto",size:"mini",columnConfig:{resizable:!0},rowConfig:{keyField:"id",isHover:!0},checkboxConfig:{reserve:!0},showOverflow:"tooltip",columns:[{type:"checkbox",width:40},{field:"icon",title:"\u56FE\u6807",width:100,align:"center",slots:{default:"icon"}},{field:"name",title:"\u6A21\u578B\u540D\u79F0",width:150,slots:{default:"name"}},{field:"firstGroupName",title:"\u4E00\u7EA7\u5206\u7EC4",width:150},{field:"secondGroupName",title:"\u4E8C\u7EA7\u5206\u7EC4",width:150},{field:"createUserName",title:"\u521B\u5EFA\u4EBA",width:150},{field:"createTime",title:"\u521B\u5EFA\u65F6\u95F4",width:200},{field:"description",title:"\u8BF4\u660E"},{field:"action",title:"\u64CD\u4F5C",width:120,slots:{default:"action"}}]});K(()=>{l()});const m=t=>{l(t)},k=t=>{o.pageSize=t,l(1)},D=t=>{b("edit",t)},u=n(""),{loading:w,setLoading:s}=L(!1),M=t=>{const f=de.confirm({title:()=>_("div",["\u662F\u5426\u5220\u9664\u6A21\u578B\u201C",_("span",{style:"color: rgb(var(--primary-6))"},t.name),"\u201D\uFF1F"]),simple:!1,draggable:!0,closable:!1,titleAlign:"start",okText:"\u5220\u9664",okLoading:w.value,okButtonProps:{disabled:!0,status:"danger"},content:()=>_("div",["\u8BE5\u6A21\u578B\u4EE5\u53CA\u6A21\u578B\u4E0B\u7684\u8D44\u4EA7\u5C06",_("span",{style:"color: rgb(var(--danger-6))"},"\u65E0\u6CD5\u6062\u590D"),"!",_("br"),_("br"),_("div","\u5982\u679C\u786E\u5B9A\u5220\u9664\uFF0C\u8BF7\u5728\u4E0B\u65B9\u8F93\u5165\u6846\u4E2D\u8F93\u5165\u6A21\u578B\u540D\u79F0\u4EE5\u786E\u8BA4\u3002"),_("br"),_(Q,{"model-value":u.value,onInput:c=>{u.value=c,f.update({okButtonProps:{disabled:u.value!==t.name,status:"danger"}})},placeholder:t.name})]),onOk:async()=>{try{t.code&&(s(!0),await Ce(t.code),J.success("\u5220\u9664\u6210\u529F"))}catch(c){console.error(c)}finally{s(!1),u.value="",await l()}}})},V=t=>{ne.push({path:"/cmdb/cmdbModel/cmdbModelDetail",query:{code:t.code}})},{loading:I,setLoading:A}=L(!1),{loading:N,setLoading:S}=L(!1),$=async()=>{A(!0);try{Ee(await Fe())}catch(t){console.error(t)}finally{A(!1)}},T=async t=>{const{fileItem:f}=t;S(!0);try{await we(f.file),await l(),J.success("\u5BFC\u5165\u6210\u529F")}catch(c){console.error(c)}finally{S(!1)}};return y({fetchData:l}),(t,f)=>{const c=H("icon-font"),P=pe,R=X,te=me,U=ee,ae=fe,oe=H("vxe-grid");return z(),Y(oe,re({ref_key:"xGrid",ref:i},F.value,{loading:r(x)}),{icon:a(({row:C})=>[e(c,{type:C.icon,size:24},null,8,["type"])]),name:a(({row:C})=>[e(P,{hoverable:!1,style:{"font-size":"12px"},onClick:j=>V(C)},{default:a(()=>[E(Z(C.name),1)]),_:2},1032,["onClick"])]),action:a(({row:C})=>[e(R,null,{default:a(()=>[e(P,{hoverable:!1,onClick:j=>D(C)},{default:a(()=>[E("\u7F16\u8F91")]),_:2},1032,["onClick"]),e(P,{hoverable:!1,onClick:j=>M(C)},{default:a(()=>[E("\u5220\u9664")]),_:2},1032,["onClick"])]),_:2},1024)]),pager:a(()=>[h("div",Te,[e(te,{ref:"xPagination",current:r(o).current,"page-size":r(o).pageSize,total:r(o).total,"page-size-options":r(p),"show-total":"","show-jumper":"","show-page-size":"",onChange:m,onPageSizeChange:k},null,8,["current","page-size","total","page-size-options"]),h("div",null,[e(R,null,{default:a(()=>[e(U,{loading:r(I),onClick:$},{default:a(()=>[E(" \u5BFC\u51FA ")]),_:1},8,["loading"]),e(ae,{name:"file",accept:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","show-file-list":!1,"custom-request":T},{"upload-button":a(()=>[e(U,{loading:r(N)},{default:a(()=>[E("\u5BFC\u5165")]),_:1},8,["loading"])]),_:1})]),_:1})])])]),_:1},16,["loading"])}}}),Ge={class:"page-container"},Se={class:"page-panel-no-padding"},ze={class:"page-panel"},Me={class:"page-panel"},Ve={style:{display:"flex","justify-content":"space-between","margin-bottom":"5px"}},Ie={style:{height:"calc(100vh - 145px)"}},lt=O({__name:"index",setup(G){const y=n(""),d=n(""),i=n(""),o=n(""),p=n(),x=n(),g=n(),v=n("create"),b=n({keyword:d.value,firstGroup:"",secondGroup:""}),l=n(!1),F=()=>{g.value=void 0,v.value="create",B(()=>{l.value=!0})},m=w=>{g.value=q.cloneDeep(w),v.value="update",B(()=>{l.value=!0})},k=q.debounce(()=>{b.value={keyword:d.value,firstGroup:i.value,secondGroup:o.value},B(()=>{p.value.fetchData()})},300),D=w=>{const s=w[0];s==="all"?(i.value="",o.value=""):s.indexOf(",")>-1?[i.value,o.value]=s.split(","):(i.value=s,o.value=""),b.value={keyword:d.value,firstGroup:i.value,secondGroup:o.value},B(()=>{p.value.fetchData()})},u=()=>{l.value=!1,B(()=>{p.value.fetchData(),x.value.fetchTree()})};return(w,s)=>{const M=_e,V=ge,I=Q,A=X,N=ee,S=ve,$=he;return z(),W("div",Ge,[e(De,{"left-width":{xxl:4,xl:4,lg:8,md:8,sm:8,xs:8},mode:"space"},{left:a(()=>[h("div",Se,[h("div",ze,[e(M,{modelValue:y.value,"onUpdate:modelValue":s[0]||(s[0]=T=>y.value=T),"allow-clear":!0,placeholder:"\u8BF7\u8F93\u5165\u6A21\u578B\u7EC4\u540D\u79F0\u67E5\u8BE2"},null,8,["modelValue"])]),e(V,{class:"page-panel",style:{height:"calc(100vh - 141px)","padding-top":"0"}},{default:a(()=>[e(Ae,{ref_key:"modelGroupTreeRef",ref:x,"search-text":y.value,onSelect:D},null,8,["search-text"])]),_:1})])]),right:a(()=>[h("div",Me,[e($,null,{default:a(()=>[e(S,{span:24},{default:a(()=>[h("div",Ve,[e(A,null,{default:a(()=>[e(I,{modelValue:d.value,"onUpdate:modelValue":s[1]||(s[1]=T=>d.value=T),style:{width:"320px"},placeholder:"\u6A21\u578B\u540D\u79F0/\u8BF4\u660E",onInput:r(k)},null,8,["modelValue","onInput"])]),_:1}),e(A,null,{default:a(()=>[e(N,{type:"primary",onClick:F},{default:a(()=>[E("\u65B0\u5EFA")]),_:1})]),_:1})])]),_:1})]),_:1}),h("div",Ie,[e(Le,{ref_key:"modelListRef",ref:p,params:b.value,onEdit:m},null,8,["params"])])])]),_:1}),e(ke,{visible:l.value,type:v.value,data:g.value,onClose:u},null,8,["visible","type","data"])])}}});export{lt as default};
