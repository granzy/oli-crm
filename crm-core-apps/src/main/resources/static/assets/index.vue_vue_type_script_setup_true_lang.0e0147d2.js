import{l as M,T as we,a as ye}from"./index.e9d54774.js";/* empty css               *//* empty css               *//* empty css               *//* empty css               *//* empty css                */import{d as ie,f,c as re,w as Be,o as be,D as b,E as N,aS as a,aI as e,aY as n,aW as m,G as te,u as g,aU as se,aV as ne,aH as $,H as I,aZ as pe,bX as Ue,bY as ve,bt as me,a$ as Ee,aO as Ae,aP as xe,a_ as De,aM as ke,b0 as Se,aN as fe,c9 as $e,bp as Re,aT as Ve,bz as ze,bE as Le,bB as Te,c3 as Oe,c4 as Ke,bi as Ne,bN as Me,bO as Ge,bq as de,h as K,bv as he,bh as ge,bg as ee}from"./arco.a97fe066.js";import{S as We}from"./index.d4fbf381.js";import{t as ce,g as je,s as Ce,p as He,e as qe,z as Xe,d as Fe,b as Ye,c as Ze}from"./problem.b594769f.js";import{c as S}from"./color.562bf6e9.js";import{r as Ie,c as Je}from"./date-time.3a778351.js";/* empty css              *//* empty css                */import{f as Qe}from"./app-instance.ab836c4c.js";import{_ as et}from"./index.vue_vue_type_script_setup_true_lang.6079a524.js";import{_ as tt}from"./index.vue_vue_type_script_setup_true_lang.a54811bd.js";import{_ as at}from"./index.vue_vue_type_script_setup_true_lang.dff799f7.js";/* empty css                */import{p as Pe}from"./pagination.72a5f225.js";import{c as ot}from"./index.0f61770a.js";/* empty css                */import{_ as lt}from"./zabbix-acknowledge-list.vue_vue_type_script_setup_true_lang.78b8bb2a.js";/* empty css               */import{a as ut,e as st}from"./alert.327f26ca.js";import{d as nt}from"./global.90f51a62.js";import{_ as rt}from"./performance-data.vue_vue_type_script_setup_true_lang.419c45ec.js";const it={style:{"margin-top":"10px"}},dt=ie({__name:"search-form",props:{searchParam:{type:Object,default:()=>({})},isProblem:{type:Boolean,default:!0}},emits:["update:searchParam","search"],setup(P,{emit:ae}){const V={appKeys:[],appKey:void 0,keyword:void 0,name:void 0,severities:[!1,!1,!1,!1,!1,!1],timeFrom:void 0,timeTill:void 0,hostGroups:[],hosts:[],hostInventories:[{label:"",code:"",value:""}],evalType:"0",tags:[{tag:"",operator:ce[0].value,value:""}]},A=P,C=S("info-6"),G=S("warn-6"),O=S("average-6"),w=S("high-6"),x=S("disaster-6"),D=f(),r=ae,o=f(M.cloneDeep(V)),v=()=>{r("update:searchParam",o.value)},H=()=>{o.value.hostGroups=[],o.value.hosts=[],v()},X=f([]),F=async()=>{const{data:i}=await we("\u544A\u8B66\u901A\u7528\u5B57\u6BB5\u914D\u7F6E");X.value=i.filter(u=>u.enable).map(u=>({value:u.code,label:u.name}))},_=()=>{D.value&&(o.value=M.cloneDeep(V),v())},Y=()=>{v(),r("search",o.value)},oe=f([]),z=async()=>{try{const{data:i}=await Qe("ZABBIX");oe.value=i.map(u=>({value:u.id,label:u.name}))}catch(i){console.error(i)}},U=()=>{var i;(i=o.value.hostInventories)==null||i.push({label:"",code:"",value:""})},Z=i=>{var u;(u=o.value.hostInventories)==null||u.splice(i,1)},E=()=>{var i;(i=o.value.tags)==null||i.push({tag:"",operator:ce[0].value,value:""})},le=i=>{var u;(u=o.value.tags)==null||u.splice(i,1)},J=re({get:()=>{if(o.value.timeFrom&&o.value.timeTill)return[o.value.timeFrom*1e3,o.value.timeTill*1e3]},set:i=>{i&&i[0]&&i[1]?(o.value.timeFrom=Math.floor(i[0]/1e3),o.value.timeTill=Math.floor(i[1]/1e3)):(o.value.timeFrom=void 0,o.value.timeTill=void 0)}}),Q=()=>{v()};return Be(()=>A.searchParam,i=>{o.value=M.cloneDeep(i),o.value.timeFrom&&o.value.timeTill&&(J.value=[o.value.timeFrom*1e3,o.value.timeTill*1e3])},{deep:!0}),be(()=>{z(),F()}),(i,u)=>{const W=Ue,l=ve,t=me,B=Ee,j=Ae,ue=xe,d=De,k=ke,h=Se,y=fe,T=$e,q=Re;return b(),N("div",null,[a(q,{ref_key:"formRef",ref:D,model:o.value,layout:"vertical",size:"medium"},{default:e(()=>[a(W,{direction:"horizontal",orientation:"left"},{default:e(()=>[n(m(i.$t("problem.searchForm.title")),1)]),_:1}),a(t,{direction:"vertical",fill:""},{default:e(()=>[a(t,null,{default:e(()=>[a(l,{checked:o.value.severities[5],"onUpdate:checked":u[0]||(u[0]=p=>o.value.severities[5]=p),style:te({border:"1px solid "+g(x)}),color:"red",checkable:"",bordered:"",onCheck:v},{default:e(()=>[n(m(i.$t("problem.searchForm.eventDisasterTag")),1)]),_:1},8,["checked","style"]),a(l,{checked:o.value.severities[4],"onUpdate:checked":u[1]||(u[1]=p=>o.value.severities[4]=p),style:te({border:"1px solid "+g(w)}),color:"orangered",checkable:"",bordered:"",onCheck:v},{default:e(()=>[n(m(i.$t("problem.searchForm.eventHighTag")),1)]),_:1},8,["checked","style"]),a(l,{checked:o.value.severities[3],"onUpdate:checked":u[2]||(u[2]=p=>o.value.severities[3]=p),style:te({border:"1px solid "+g(O)}),color:"orange",checkable:"",bordered:"",onCheck:v},{default:e(()=>[n(m(i.$t("problem.searchForm.eventAverageTag")),1)]),_:1},8,["checked","style"]),a(l,{checked:o.value.severities[2],"onUpdate:checked":u[3]||(u[3]=p=>o.value.severities[2]=p),style:te({border:"1px solid "+g(G)}),color:"gold",checkable:"",bordered:"",onCheck:v},{default:e(()=>[n(m(i.$t("problem.searchForm.eventWarnTag")),1)]),_:1},8,["checked","style"]),a(l,{checked:o.value.severities[1],"onUpdate:checked":u[4]||(u[4]=p=>o.value.severities[1]=p),style:te({border:"1px solid "+g(C)}),color:"blue",checkable:"",bordered:"",onCheck:v},{default:e(()=>[n(m(i.$t("problem.searchForm.eventInfoTag")),1)]),_:1},8,["checked","style"]),a(l,{checked:o.value.severities[0],"onUpdate:checked":u[5]||(u[5]=p=>o.value.severities[0]=p),checkable:"",bordered:"",onCheck:v},{default:e(()=>[n(m(i.$t("problem.searchForm.eventNoClassTag")),1)]),_:1},8,["checked"])]),_:1}),a(j,{modelValue:o.value.appKeys,"onUpdate:modelValue":u[6]||(u[6]=p=>o.value.appKeys=p),placeholder:i.$t("problem.searchForm.appName"),"allow-clear":"",multiple:"",onChange:H},{default:e(()=>[(b(!0),N(se,null,ne(oe.value,(p,R)=>(b(),$(B,{key:R,value:p.value},{default:e(()=>[n(m(p.label),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue","placeholder"]),a(et,{modelValue:o.value.hostGroups,"onUpdate:modelValue":[u[7]||(u[7]=p=>o.value.hostGroups=p),v],"app-keys":o.value.appKeys?o.value.appKeys:[],multiple:""},null,8,["modelValue","app-keys"]),a(tt,{modelValue:o.value.hosts,"onUpdate:modelValue":[u[8]||(u[8]=p=>o.value.hosts=p),v],"app-keys":o.value.appKeys?o.value.appKeys:[],"app-key-host-group-ids":o.value.hostGroups?o.value.hostGroups:[],multiple:""},null,8,["modelValue","app-keys","app-key-host-group-ids"]),a(ue,{modelValue:o.value.name,"onUpdate:modelValue":u[9]||(u[9]=p=>o.value.name=p),modelModifiers:{trim:!0},placeholder:i.$t("problem.searchForm.name"),onInput:v},null,8,["modelValue","placeholder"]),(b(!0),N(se,null,ne(o.value.hostInventories,(p,R)=>(b(),$(h,{key:R,style:{"align-items":"center"},gutter:8},{default:e(()=>[a(d,{span:10},{default:e(()=>[a(j,{modelValue:p.code,"onUpdate:modelValue":c=>p.code=c,"trigger-props":{updateAtScroll:!0},placeholder:i.$t("problem.searchForm.inventoryField"),"allow-clear":"",onChange:v},{default:e(()=>[(b(!0),N(se,null,ne(X.value,(c,L)=>(b(),$(B,{key:L,value:c.value},{default:e(()=>[n(m(c.label),1)]),_:2},1032,["value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder"])]),_:2},1024),a(d,{span:11},{default:e(()=>[a(ue,{modelValue:p.value,"onUpdate:modelValue":c=>p.value=c,modelModifiers:{trim:!0},placeholder:i.$t("problem.searchForm.inventoryValue"),"allow-clear":"",onInput:v},null,8,["modelValue","onUpdate:modelValue","placeholder"])]),_:2},1024),a(d,{span:3},{default:e(()=>[a(k,{style:{"font-size":"12px"},hoverable:!1,onClick:c=>Z(R)},{default:e(()=>[n(" \u79FB\u9664 ")]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024))),128)),I("div",null,[a(y,{type:"text",style:{"text-align":"left"},size:"mini",onClick:U},{default:e(()=>[n(" \u6DFB\u52A0\u8D44\u4EA7\u67E5\u8BE2 ")]),_:1})]),(b(!0),N(se,null,ne(o.value.tags,(p,R)=>(b(),$(h,{key:"tag"+R,style:{"align-items":"center"},gutter:8},{default:e(()=>[a(d,{span:7},{default:e(()=>[a(ue,{modelValue:p.tag,"onUpdate:modelValue":c=>p.tag=c,modelModifiers:{trim:!0},placeholder:i.$t("problem.searchForm.tags"),onInput:v},null,8,["modelValue","onUpdate:modelValue","placeholder"])]),_:2},1024),a(d,{span:6},{default:e(()=>[a(j,{modelValue:p.operator,"onUpdate:modelValue":c=>p.operator=c,"trigger-props":{updateAtScroll:!0},onChange:v},{default:e(()=>[(b(!0),N(se,null,ne(g(ce),(c,L)=>(b(),$(B,{key:L,value:c.value},{default:e(()=>[n(m(c.label),1)]),_:2},1032,["value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1024),a(d,{span:8},{default:e(()=>[a(ue,{modelValue:p.value,"onUpdate:modelValue":c=>p.value=c,modelModifiers:{trim:!0},placeholder:i.$t("problem.searchForm.tagValue"),onInput:v},null,8,["modelValue","onUpdate:modelValue","placeholder"])]),_:2},1024),a(d,{span:3},{default:e(()=>[a(k,{style:{"font-size":"12px"},hoverable:!1,onClick:c=>le(R)},{default:e(()=>[n(" \u79FB\u9664 ")]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024))),128)),I("div",null,[a(y,{type:"text",size:"mini",style:{"text-align":"left"},onClick:E},{default:e(()=>[n(" \u6DFB\u52A0\u6807\u7B7E\u67E5\u8BE2 ")]),_:1})]),a(ue,{modelValue:o.value.keyword,"onUpdate:modelValue":u[10]||(u[10]=p=>o.value.keyword=p),placeholder:i.$t("problem.searchForm.keyword"),onInput:v},null,8,["modelValue","placeholder"]),A.isProblem?pe("",!0):(b(),$(T,{key:0,modelValue:J.value,"onUpdate:modelValue":u[11]||(u[11]=p=>J.value=p),"show-time":"","value-format":"timestamp","shortcuts-position":"left",shortcuts:g(Ie),onOk:Q,onChange:Q},null,8,["modelValue","shortcuts"]))]),_:1})]),_:1},8,["model"]),I("div",it,[a(t,null,{default:e(()=>[a(y,{type:"primary",onClick:Y},{default:e(()=>[n(m(i.$t("problem.searchForm.search")),1)]),_:1}),a(y,{onClick:_},{default:e(()=>[n(m(i.$t("problem.searchForm.reset")),1)]),_:1})]),_:1})])])}}}),ct={style:{display:"flex",width:"100%","padding-top":"10px","justify-content":"space-between"}},pt=ie({__name:"zabbix-alert-list-for-detail",props:{searchParam:{type:Object,default:()=>({})}},setup(P,{expose:ae}){const{loading:V,setLoading:A}=ye(!1),{pageSizeOptions:C,pagination:G}=Pe(),O=f(G.current),w=f(G.pageSize),x=f(),D=f(),r=P,o=f({size:"mini",height:"auto",columnConfig:{resizable:!0},rowConfig:{keyField:"alertid",isHover:!0},showOverflow:"tooltip",columns:[{title:"\u52A8\u4F5C",field:"actionName",width:120},{title:"\u63A5\u6536\u8005",field:"sendtoStr",width:180},{title:"\u6D88\u606F\u5185\u5BB9",field:"message",width:180},{title:"\u901A\u77E5\u72B6\u6001",field:"statusStr",width:180,slots:{default:"statusStr"}},{title:"\u7C7B\u578B",field:"mediaTypeNames",minWidth:160},{title:"\u65F6\u95F4",field:"clock",width:160,slots:{default:"clock"}}]}),v=f([]),H=f([]),X=f([]),F=()=>{const E=(O.value-1)*w.value,le=E+w.value;H.value=M.cloneDeep(v.value.slice(E,le))},_=async()=>{A(!0);try{v.value=(await ut(r.searchParam)).data,X.value=M.cloneDeep(v.value),F()}catch{}finally{A(!1)}},Y=E=>{O.value=E,F()},oe=E=>{O.value=1,w.value=E,F()};be(()=>{_()});const{loading:z,setLoading:U}=ye(),Z=async()=>{try{U(!0),nt(await st(r.searchParam))}catch(E){console.error(E)}finally{U(!1)}};return ae({fetchData:_}),(E,le)=>{const J=ve,Q=Le,i=Te,u=fe,W=me,l=Ve("vxe-grid");return b(),$(l,ze({ref_key:"xGrid",ref:x},o.value,{loading:g(V),data:H.value}),{statusStr:e(({row:t})=>[t.status==="1"?(b(),$(J,{key:0,bordered:"",color:"green",style:{cursor:"pointer"}},{default:e(()=>[n(m(t.statusStr),1)]),_:2},1024)):(b(),$(Q,{key:1,content:t.error},{default:e(()=>[a(J,{color:"red",bordered:""},{default:e(()=>[n(m(t.statusStr),1)]),_:2},1024)]),_:2},1032,["content"]))]),clock:e(({row:t})=>[n(m(g(Je)(t.clock)),1)]),pager:e(()=>[I("div",ct,[a(i,{ref_key:"xPagination",ref:D,total:v.value.length,current:O.value,"page-size":w.value,"page-size-options":g(C),"show-total":"","show-jumper":"","show-page-size":"",onChange:Y,onPageSizeChange:oe},null,8,["total","current","page-size","page-size-options"]),I("div",null,[a(W,null,{default:e(()=>[a(u,{loading:g(z),onClick:Z},{default:e(()=>[n(" \u5BFC\u51FA ")]),_:1},8,["loading"])]),_:1})])])]),_:1},16,["loading","data"])}}}),vt={style:{height:"calc(100vh - 140px)"}},mt={style:{height:"calc(100vh - 140px)"}},ft=ie({__name:"zabbix-problem-detail-drawer",props:{visible:{type:Boolean,default:!1},appKey:{type:String,required:!0},eventId:{type:String,required:!0}},emits:["update:visible"],setup(P,{emit:ae}){const V=P,A=ae,C=re({get:()=>V.visible,set:w=>{A("update:visible",w)}}),G=f([]),O=()=>{G.value=[],je([{appKey:V.appKey,eventId:V.eventId}]).then(w=>{Object.keys(w.data).forEach(x=>{Object.keys(w.data[x]).forEach(D=>{w.data[x][D].forEach(o=>{G.value.push({appKey:x,itemId:o})})})})})};return(w,x)=>{const D=Oe,r=Ke,o=Ne;return b(),$(o,{visible:P.visible,width:"50vw",title:"\u544A\u8B66\u8BE6\u60C5",footer:!1,"unmount-on-close":"",onBeforeOpen:O,onCancel:x[0]||(x[0]=v=>C.value=!1)},{default:e(()=>[a(r,{type:"card","default-active-key":"1","lazy-load":"","destroy-on-hide":""},{default:e(()=>[a(D,{key:"1",style:{padding:"4px"},title:"\u6307\u6807\u8BE6\u60C5"},{default:e(()=>[a(rt,{"app-key-item-ids":G.value,height:"calc(100vh - 200px)"},null,8,["app-key-item-ids"])]),_:1}),a(D,{key:"2",style:{padding:"4px"},title:"\u5904\u7406\u8BB0\u5F55"},{default:e(()=>[I("div",vt,[a(lt,{"app-key":P.appKey,"event-id":P.eventId},null,8,["app-key","event-id"])])]),_:1}),a(D,{key:"3",style:{padding:"4px"},title:"\u901A\u77E5\u8BB0\u5F55"},{default:e(()=>[I("div",mt,[a(pt,{"search-param":{eventId:P.eventId}},null,8,["search-param"])])]),_:1})]),_:1})]),_:1},8,["visible"])}}}),ht={style:{color:"var(--color-bg-5)"}},gt={style:{display:"flex",width:"100%","padding-top":"10px","justify-content":"space-between"}},yt=ie({__name:"zabbix-problem-record-list",props:{searchParam:{type:Object,default:()=>({})},checkedRecords:{type:Array,default:()=>[]},showAll:{type:Boolean,default:!0},showSelected:{type:Boolean,default:!0},showCondition:{type:Boolean,default:!0},configKey:{type:String,required:!0,default:""}},emits:["update:checkedRecords","confirm","cancelConfirm","close","changeSeverity"],setup(P,{expose:ae,emit:V}){const{loading:A,setLoading:C}=ye(!1),{pageSizeOptions:G,pagination:O}=Pe(),w=f(O.current),x=f(O.pageSize),D=f(),r=f(),o=P,v=V,H=f(),X=re(()=>`zabbix-alert-record-list-${o.configKey}`),F=f([{type:"checkbox",width:40},{title:"\u7EA7\u522B",field:"severityStr",width:65,slots:{default:"severity"},visible:!0},{title:"\u544A\u8B66\u6807\u9898",field:"name",minWidth:300,slots:{default:"name"},visible:!0},{title:"\u4E3B\u673A\u540D",field:"hosts.name",minWidth:100,visible:!0},{title:"\u4E3B\u673A\u7EC4",minWidth:100,slots:{default:"groups"},visible:!0},{title:"\u544A\u8B66\u65F6\u95F4",field:"clock",width:160,visible:!0},{title:"\u6062\u590D\u65F6\u95F4",field:"r_clock",width:160,visible:!0},{title:"\u544A\u8B66\u65F6\u957F",field:"durationStr",width:135,visible:!0},{title:"\u5E94\u7528",field:"appName",width:135,visible:!0},{title:"\u6807\u7B7E",field:"tagsStr",width:200,visible:!0},{title:"\u6062\u590D\u72B6\u6001",field:"recoveryStatus",width:150,minWidth:50,visible:!0,slots:{default:"recoveryStatus"}},{title:"\u786E\u8BA4\u72B6\u6001",field:"acknowledgedStr",width:150,minWidth:50,visible:!0,slots:{default:"acknowledged"}}]),_=f({size:"mini",height:"auto",columnConfig:{resizable:!0},rowConfig:{keyField:"eventid",isHover:!0},checkboxConfig:{reserve:!0},showOverflow:"tooltip"}),Y=f([]),oe=async()=>{const{data:d}=await we("\u544A\u8B66\u901A\u7528\u5B57\u6BB5\u914D\u7F6E");Y.value=d.filter(k=>k.enable),Y.value.forEach(k=>{F.value.push({title:k.name,field:`hosts.inventory.${k.code}`,width:160,visible:!0})})};Be(()=>H.value,async d=>{await oe(),F.value.push({title:"\u64CD\u4F5C",field:"action",fixed:"right",width:140,visible:!0,slots:{default:"action"}}),_.value.columns=d.genActualColumnConfig(X.value,F.value)});let z=[];const U=()=>{var h;const d=(w.value-1)*x.value,k=d+x.value;(h=D.value)==null||h.loadData(z.slice(d,k))},Z=(d,k)=>{if(d.keyword){const h=d.keyword.trim().toLowerCase();z=k.filter(y=>{var T,q,p,R,c;return((T=y.name)==null?void 0:T.toLowerCase().includes(h))||((q=y.appName)==null?void 0:q.toLowerCase().includes(h))||((p=y.acknowledgedStr)==null?void 0:p.toLowerCase().includes(h))||((R=y.severityStr)==null?void 0:R.toLowerCase().includes(h))||((c=y.tagsStr)==null?void 0:c.toLowerCase().includes(h))||M.some(Y.value,L=>{var s;return(s=y.hosts)!=null&&s.inventory?y.hosts.inventory[L.code].toLowerCase().includes(h):!1})})}if(d.severities){const h=[];d.severities.forEach((y,T)=>{y&&h.push(T)}),h.length!==0&&(z=z.filter(y=>M.some(h,T=>T===parseInt(String(y.severity),10))))}U()},E=async d=>{C(!0);try{z=(await He(d)).data,Z(o.searchParam,z)}catch(k){console.error(k)}finally{C(!1)}},le=d=>{w.value=d,U()},J=d=>{w.value=1,x.value=d,U()},Q=()=>{const d=D.value;if(d){const k=d.getCheckboxRecords();k.push(...d.getCheckboxReserveRecords()),v("update:checkedRecords",k)}},i=Q,u=Q,W=()=>{const d=D.value;d&&(d.clearCheckboxReserve(),d.clearCheckboxRow(),v("update:checkedRecords",[]))},l=async()=>{var k;const d=(k=_.value.columns)==null?void 0:k.filter(h=>h.field!=="action").map(h=>({header:h.title,key:h.field,width:40}));if(d){const h=[];z.forEach(y=>{const T={};d.forEach(q=>{T[q.key]=M.get(y,q.key)}),h.push(T)}),qe(d,h)}},t=f(!1),B=f({appKey:"",eventId:""}),j=d=>{B.value.appKey=d.appKey,B.value.eventId=d.eventid,t.value=!0};ae({fetchData:E,clearAllChecked:W});const ue=d=>{_.value.columns=d};return(d,k)=>{const h=ve,y=ke,T=Te,q=fe,p=me,R=Ve("vxe-grid");return b(),N(se,null,[a(R,ze({ref_key:"xGrid",ref:D},_.value,{loading:g(A),onCheckboxChange:g(i),onCheckboxAll:g(u)}),{severity:e(({row:c})=>[a(h,{color:`rgb(var(--${(g(Ce)[c.severity]?g(Ce)[c.severity]:"").toLowerCase()}-6))`},{default:e(()=>[I("span",ht,m(c.severityStr),1)]),_:2},1032,["color"])]),recoveryStatus:e(({row:c})=>[c.recoveryStatus==="\u5DF2\u6062\u590D"?(b(),$(h,{key:0,bordered:"",color:"green",style:{cursor:"pointer"}},{default:e(()=>[n(m(c.recoveryStatus),1)]),_:2},1024)):(b(),$(h,{key:1,color:"red",bordered:""},{default:e(()=>[n(m(c.recoveryStatus),1)]),_:2},1024))]),acknowledged:e(({row:c})=>[c.acknowledged==="1"?(b(),$(h,{key:0,bordered:"",color:"green",style:{cursor:"pointer"}},{default:e(()=>[n(m(c.acknowledgedStr),1)]),_:2},1024)):(b(),$(h,{key:1,bordered:""},{default:e(()=>[n(m(c.acknowledgedStr),1)]),_:2},1024))]),name:e(({row:c})=>[a(y,{hoverable:!1,style:{"font-size":"12px"},onClick:L=>j(c)},{default:e(()=>[n(m(c.name),1)]),_:2},1032,["onClick"])]),groups:e(({row:c})=>[(b(!0),N(se,null,ne(c.hosts.groups,(L,s)=>(b(),N("span",{key:s},[s!==0?(b(),N(se,{key:0},[n(",")],64)):pe("",!0),n(" "+m(L.name),1)]))),128))]),action:e(({row:c})=>[a(y,{style:{"font-size":"12px"},hoverable:!1,onClick:L=>v("confirm",c)},{default:e(()=>[n(" \u786E\u8BA4 ")]),_:2},1032,["onClick"]),a(y,{style:{"font-size":"12px"},hoverable:!1,onClick:L=>v("cancelConfirm",c)},{default:e(()=>[n(" \u53D6\u6D88 ")]),_:2},1032,["onClick"]),a(y,{style:{"font-size":"12px"},hoverable:!1,onClick:L=>v("close",c)},{default:e(()=>[n(" \u5173\u95ED ")]),_:2},1032,["onClick"]),a(y,{style:{"font-size":"12px"},hoverable:!1,onClick:L=>v("changeSeverity",c)},{default:e(()=>[n(" \u5347\u964D\u7EA7 ")]),_:2},1032,["onClick"])]),pager:e(()=>[I("div",gt,[a(T,{ref_key:"xPagination",ref:r,total:g(z).length,current:w.value,"page-size":x.value,"page-size-options":g(G),"show-total":"","show-jumper":"","show-page-size":"",onChange:le,onPageSizeChange:J},null,8,["total","current","page-size","page-size-options"]),I("div",null,[a(p,null,{default:e(()=>[a(q,{onClick:l},{default:e(()=>[n("\u5BFC\u51FA")]),_:1}),a(ot,{ref_key:"columnConfigRef",ref:H,"column-config":F.value,"config-id":X.value,onSave:ue},null,8,["column-config","config-id"])]),_:1})])])]),_:1},16,["loading","onCheckboxChange","onCheckboxAll"]),a(ft,{visible:t.value,"onUpdate:visible":k[0]||(k[0]=c=>t.value=c),"app-key":B.value.appKey,"event-id":B.value.eventId},null,8,["visible","app-key","event-id"])],64)}}}),bt={class:"page-container"},kt={class:"page-panel"},_t={key:0},Ct={class:"selected-count"},Ft={style:{height:"calc(100vh - 155px)"}},wt={style:{"font-size":"20px","font-weight":"bolder",color:"rgb(var(--danger-6))"}},Zt=ie({__name:"index",props:{isProblem:{type:Boolean,default:!0}},setup(P){const ae=f(),V=f(!1),A=f(),C=f([]),G=S("info-6"),O=S("warn-6"),w=S("average-6"),x=S("high-6"),D=S("disaster-6"),r=f({appKeys:void 0,keyword:void 0,name:void 0,severities:[!1,!1,!1,!1,!1,!1],timeFrom:void 0,timeTill:void 0,hostGroups:[],hosts:[],hostInventories:[{label:"",code:"",value:""}],evalType:"0",tags:[{tag:"",operator:ce[0].value,value:""}]}),o=()=>{const l=Date.now(),t=60*60*24*1e3,B=l-t;r.value.timeFrom=Math.floor(B/1e3),r.value.timeTill=Math.floor(l/1e3)},v=re({get:()=>{if(r.value.timeFrom&&r.value.timeTill)return[r.value.timeFrom*1e3,r.value.timeTill*1e3]},set:l=>{l?(r.value.timeFrom=Math.floor(l[0]/1e3),r.value.timeTill=Math.floor(l[1]/1e3)):(r.value.timeFrom=void 0,r.value.timeTill=void 0)}}),H=P,X=re(()=>{const l={isProblem:H.isProblem,keyword:r.value.keyword,severities:r.value.severities};return H.isProblem||(l.timeFrom=r.value.timeFrom,l.timeTill=r.value.timeTill),V.value&&(l.appKeys=r.value.appKeys,l.hostGroups=r.value.hostGroups,l.hosts=r.value.hosts,l.hostInventories=r.value.hostInventories,l.tags=r.value.tags,l.name=r.value.name),l}),F=async()=>{A.value.clearAllChecked(),await A.value.fetchData(X.value)},_=f(""),Y=l=>{const t=f([]);l?t.value.push(l):t.value=M.cloneDeep(C.value),t.value.length!==0?(_.value="",de.confirm({title:"\u63D0\u793A",simple:!1,draggable:!0,titleAlign:"start",content:()=>K("div",{},[K("span",{},["\u662F\u5426\u786E\u8BA4\u8FD9",K("span",{style:`font-size: 20px;font-weight: bolder;color: ${S("danger-6")}`},t.value.length),"\u6761\u544A\u8B66\uFF1F"]),K(he,{"model-value":_.value,onInput:B=>{_.value=B},placeholder:"\u786E\u8BA4\u4FE1\u606F"}),K(ge,{style:"margin-top: 10px;font-size:13px",type:"normal"},()=>["\u5F53\u786E\u8BA4\u6210\u529F\u540E\uFF0C\u60A8\u53EF\u4EE5\u70B9\u51FB\u544A\u8B66\u6807\u9898\uFF0C\u6253\u5F00\u3010\u5904\u7406\u8BB0\u5F55\u3011\u6807\u7B7E\u9875\u67E5\u770B\u786E\u8BA4\u5386\u53F2\u3002"])]),okText:"\u786E\u8BA4",async onOk(){try{await Fe(t.value,_.value,"ACKNOWLEDGE"),A.value.clearAllChecked(),ee.success("\u786E\u8BA4\u6210\u529F"),await F()}catch{ee.error("\u786E\u8BA4\u5931\u8D25")}}})):ee.warning("\u8FD8\u672A\u9009\u62E9\u544A\u8B66")},oe=l=>{let t=[];l?t=[l]:t=M.cloneDeep(C.value),de.confirm({title:"\u63D0\u793A",simple:!1,draggable:!0,titleAlign:"start",content:`\u786E\u8BA4\u53D6\u6D88\u786E\u8BA4\u8FD9${t.length}\u6761\u544A\u8B66\uFF1F`,okText:"\u786E\u8BA4",async onOk(){try{await Fe(t,"","UNACKNOWLEDGE"),ee.success("\u53D6\u6D88\u786E\u8BA4\u6210\u529F"),await F()}catch{ee.error("\u53D6\u6D88\u786E\u8BA4\u5931\u8D25")}}})},z=l=>{const t=f([]);l?t.value.push(l):t.value=M.cloneDeep(C.value),t.value.length!==0?(_.value="",de.confirm({title:"\u63D0\u793A",simple:!1,draggable:!0,titleAlign:"start",content:()=>K("div",{},[K("span",{},["\u662F\u5426\u5173\u95ED\u8FD9",K("span",{style:`font-size: 20px;font-weight: bolder;color: ${S("danger-6")}`},t.value.length),"\u6761\u544A\u8B66\uFF1F"]),K(he,{"model-value":_.value,onInput:B=>{_.value=B},placeholder:"\u786E\u8BA4\u4FE1\u606F"}),K(ge,{style:"margin-top: 10px;font-size:13px",type:"normal"},()=>[K("span",{},["\u5F53\u5173\u95ED\u6210\u529F\u540E\uFF0C\u8BE5\u544A\u8B66\u7684\u72B6\u6001\u5C06\u81EA\u52A8\u8C03\u6574\u4E3A\u5DF2\u6062\u590D\u3002"]),K("br",{},[]),K("span",{},["\u60A8\u53EF\u4EE5\u70B9\u51FB\u544A\u8B66\u6807\u9898\uFF0C\u6253\u5F00\u3010\u5904\u7406\u8BB0\u5F55\u3011\u6807\u7B7E\u9875\u67E5\u770B\u5173\u95ED\u8BB0\u5F55\u3002"])])]),okText:"\u5173\u95ED",async onOk(){try{await Ye(t.value,_.value),A.value.clearAllChecked(),ee.success("\u5173\u95ED\u6210\u529F"),await F()}catch{ee.error("\u5173\u95ED\u5931\u8D25")}}})):ee.warning("\u8FD8\u672A\u9009\u62E9\u544A\u8B66")},U=f([]),Z=f("1"),E=f(!1),le=l=>{U.value=[],_.value="",Z.value="1",E.value=!0,l?U.value.push(l):U.value=M.cloneDeep(C.value)},J=async()=>{try{await Ze(U.value,_.value,Z.value),A.value.clearAllChecked(),ee.success("\u5347\u964D\u7EA7\u6210\u529F"),await F()}catch{ee.error("\u5347\u964D\u7EA7\u5931\u8D25")}},Q=["red","orangered","orange","gold","blue",""],i=[S("disaster-6"),S("high-6"),S("average-6"),S("warn-6"),S("info-6"),"#86909c",""],u=M.clone(Q),W=(l,t)=>{t?u[l]=i[l]:u[l]=Q[l],F()};return be(()=>{o(),F()}),(l,t)=>{const B=xe,j=ve,ue=$e,d=me,k=De,h=ke,y=fe,T=Se,q=Ee,p=Ae,R=he,c=ge,L=de;return b(),N("div",bt,[I("div",kt,[a(We,{ref_key:"splitLayoutRef",ref:ae,"left-is-show":V.value,"onUpdate:leftIsShow":t[20]||(t[20]=s=>V.value=s),"left-width":{xxl:5,xl:5,lg:7,md:7,sm:7,xs:7},height:"calc(100vh - 110px)"},{left:e(()=>[a(dt,{searchParam:r.value,"onUpdate:searchParam":t[0]||(t[0]=s=>r.value=s),"is-problem":P.isProblem,style:{"padding-right":"13px"},onSearch:F},null,8,["searchParam","is-problem"])]),right:e(()=>[a(T,{style:{"margin-bottom":"5px"}},{default:e(()=>[a(k,{span:16},{default:e(()=>[Me(a(d,null,{default:e(()=>[a(B,{modelValue:r.value.keyword,"onUpdate:modelValue":t[1]||(t[1]=s=>r.value.keyword=s),modelModifiers:{trim:!0},style:{width:"260px"},placeholder:l.$t("problem.searchForm.keyword"),onPressEnter:F},null,8,["modelValue","placeholder"]),a(j,{checked:r.value.severities[5],"onUpdate:checked":t[2]||(t[2]=s=>r.value.severities[5]=s),style:te({border:"1px solid "+g(D)}),color:g(u)[0],checkable:"",bordered:"",onCheck:t[3]||(t[3]=s=>W(0,s))},{default:e(()=>[n(m(l.$t("problem.searchForm.eventDisasterTag")),1)]),_:1},8,["checked","style","color"]),a(j,{checked:r.value.severities[4],"onUpdate:checked":t[4]||(t[4]=s=>r.value.severities[4]=s),style:te({border:"1px solid "+g(x)}),color:g(u)[1],checkable:"",bordered:"",onCheck:t[5]||(t[5]=s=>W(1,s))},{default:e(()=>[n(m(l.$t("problem.searchForm.eventHighTag")),1)]),_:1},8,["checked","style","color"]),a(j,{checked:r.value.severities[3],"onUpdate:checked":t[6]||(t[6]=s=>r.value.severities[3]=s),style:te({border:"1px solid "+g(w)}),color:g(u)[2],checkable:"",bordered:"",onCheck:t[7]||(t[7]=s=>W(2,s))},{default:e(()=>[n(m(l.$t("problem.searchForm.eventAverageTag")),1)]),_:1},8,["checked","style","color"]),a(j,{checked:r.value.severities[2],"onUpdate:checked":t[8]||(t[8]=s=>r.value.severities[2]=s),style:te({border:"1px solid "+g(O)}),color:g(u)[3],checkable:"",bordered:"",onCheck:t[9]||(t[9]=s=>W(3,s))},{default:e(()=>[n(m(l.$t("problem.searchForm.eventWarnTag")),1)]),_:1},8,["checked","style","color"]),a(j,{checked:r.value.severities[1],"onUpdate:checked":t[10]||(t[10]=s=>r.value.severities[1]=s),style:te({border:"1px solid "+g(G)}),color:g(u)[4],checkable:"",bordered:"",onCheck:t[11]||(t[11]=s=>W(4,s))},{default:e(()=>[n(m(l.$t("problem.searchForm.eventInfoTag")),1)]),_:1},8,["checked","style","color"]),a(j,{checked:r.value.severities[0],"onUpdate:checked":t[12]||(t[12]=s=>r.value.severities[0]=s),color:g(u)[5],checkable:"",bordered:"",onCheck:t[13]||(t[13]=s=>W(5,s))},{default:e(()=>[n(m(l.$t("problem.searchForm.eventNoClassTag")),1)]),_:1},8,["checked","color"]),H.isProblem?pe("",!0):(b(),$(ue,{key:0,modelValue:v.value,"onUpdate:modelValue":t[14]||(t[14]=s=>v.value=s),"show-time":"","value-format":"timestamp",style:{width:"400px"},"shortcuts-position":"left",shortcuts:g(Ie),onChange:F},null,8,["modelValue","shortcuts"]))]),_:1},512),[[Ge,!V.value]])]),_:1}),a(k,{span:8,style:{"text-align":"right"}},{default:e(()=>[a(d,{style:{"margin-bottom":"5px"}},{default:e(()=>[C.value.length>0?(b(),N("span",_t,[I("span",Ct," \u5DF2\u9009\u62E9\u4E86"+m(C.value.length)+"\u6761 ",1),a(h,{onClick:A.value.clearAllChecked},{default:e(()=>[n("\u6E05\u7A7A")]),_:1},8,["onClick"])])):pe("",!0),a(at,{onClick:F}),a(y,{disabled:C.value.length===0,type:"primary",size:"medium",onClick:t[15]||(t[15]=s=>Y())},{default:e(()=>[n(m(l.$t("alertManage.button.confirm")),1)]),_:1},8,["disabled"]),a(y,{disabled:C.value.length===0,type:"primary",size:"medium",onClick:t[16]||(t[16]=s=>oe())},{default:e(()=>[n(m(l.$t("alertManage.button.cancel")),1)]),_:1},8,["disabled"]),a(y,{disabled:C.value.length===0,type:"primary",size:"medium",onClick:t[17]||(t[17]=s=>z())},{default:e(()=>[n(m(l.$t("alertManage.button.close")),1)]),_:1},8,["disabled"]),a(y,{disabled:C.value.length===0,type:"primary",size:"medium",onClick:t[18]||(t[18]=s=>le())},{default:e(()=>[n(m(l.$t("alertManage.button.changePriority")),1)]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1}),I("div",Ft,[a(yt,{ref_key:"problemListRef",ref:A,"checked-records":C.value,"onUpdate:checkedRecords":t[19]||(t[19]=s=>C.value=s),"search-param":X.value,"config-key":"zabbixProblem",onConfirm:Y,onCancelConfirm:oe,onClose:z,onChangeSeverity:le},null,8,["checked-records","search-param"])])]),_:1},8,["left-is-show"])]),a(L,{visible:E.value,"onUpdate:visible":t[23]||(t[23]=s=>E.value=s),"title-align":"start",draggable:"",onOk:J},{title:e(()=>[n("\u5347\u964D\u7EA7")]),default:e(()=>[I("span",null,[n(" \u60A8\u9009\u62E9\u7684 "),I("span",wt,m(U.value.length),1),n(" \u6761\u5C06\u4F1A\u8C03\u6574\u5230 ")]),a(p,{modelValue:Z.value,"onUpdate:modelValue":t[21]||(t[21]=s=>Z.value=s)},{default:e(()=>[(b(!0),N(se,null,ne(g(Xe),(s,_e)=>(b(),$(q,{key:_e,value:_e},{default:e(()=>[n(m(s),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"]),a(R,{modelValue:_.value,"onUpdate:modelValue":t[22]||(t[22]=s=>_.value=s),placeholder:"\u786E\u8BA4\u4FE1\u606F",style:{"margin-top":"16px"}},null,8,["modelValue"]),a(c,{style:{"margin-top":"10px","font-size":"13px"},type:"normal"},{default:e(()=>[n(" \u5F53\u5347\u964D\u7EA7\u6210\u529F\u540E\uFF0C\u60A8\u53EF\u4EE5\u70B9\u51FB\u544A\u8B66\u6807\u9898\uFF0C\u6253\u5F00\u3010\u5904\u7406\u8BB0\u5F55\u3011\u6807\u7B7E\u9875\u67E5\u770B\u5347\u964D\u7EA7\u5386\u53F2\u3002 ")]),_:1})]),_:1},8,["visible"])])}}});export{Zt as _};
