import{h as We,a as _e,l as C,aC as je,U as Ke,_ as Xe}from"./index.e9d54774.js";/* empty css                *//* empty css                */import{d as Q,f as d,r as K,w as ee,aT as he,D as x,E as q,aS as t,aI as e,aY as f,aZ as oe,aH as X,bz as De,u as P,aU as se,bq as Z,bg as j,ch as Ge,a_ as te,aN as ve,bt as Fe,b0 as ue,aM as Ae,aP as we,bo as ge,a$ as ke,aO as xe,bv as me,bp as Be,aW as Y,H as v,n as Je,h as He,bi as ye,o as Ve,bK as Ye,bY as Ze,bf as Ie,aV as $e,bB as Qe,be as et,c as Ce,F as pe,c3 as tt,c4 as ut,bX as at}from"./arco.a97fe066.js";import{f as lt,s as nt}from"./app-model.480d8620.js";/* empty css               *//* empty css              *//* empty css               *//* empty css               */import{v as ot}from"./v4.cf9713fe.js";/* empty css                */import{d as st}from"./index.127a6572.js";import{c as it,s as be,d as dt,q as ct}from"./app-instance.ab836c4c.js";import{q as rt}from"./datasource.5313e56a.js";import{s as pt,g as Te,c as mt,e as ft,b as _t,d as vt}from"./executable-script.a4963186.js";import{s as Ft,p as gt,a as Bt,b as yt}from"./index.adfe86d2.js";import{p as Et}from"./pagination.72a5f225.js";import{_ as fe}from"./index.vue_vue_type_script_setup_true_lang.a6146e11.js";import{u as Ct}from"./use-interval.90cad3f2.js";import{g as bt}from"./assets.d172e35e.js";import"./chart.a235fbdf.js";import"./vue.4eb70094.js";import"./logo.d5f33f3a.js";import"./download.430d1db4.js";function ht(T){return We.get(`/appModelField/findFullAppModelFieldsByModelId/${T}`)}const Dt={key:0},At={key:1},wt={key:0},kt={key:1},xt={key:2},Vt={key:1},It=Q({__name:"app-model-field",props:{modelValue:{}},emits:["update:modelValue"],setup(T,{expose:A,emit:b}){const O=T,E=b,{loading:o,setLoading:B}=_e(!1),h=d(),V=d(!1),F=d(!1),w=K({queryStr:""}),_=d([]),y=d([]),L=d(),M=()=>{E("update:modelValue",y.value)},k=d({size:"mini",height:500,columnConfig:{resizable:!0},showOverflow:"tooltip",columns:[{type:"seq",width:50},{title:"\u5B57\u6BB5\u540D\u79F0",field:"name",width:120},{title:"\u5B57\u6BB5\u7C7B\u578B",field:"fieldType",width:100,slots:{default:"fieldType"}},{title:"\u5B57\u6BB5code",field:"code",width:100},{title:"\u5B57\u6BB5\u5206\u7C7B",field:"groupType",minWidth:80,slots:{default:"groupType"}},{title:"\u64CD\u4F5C",minWidth:120,slots:{default:"action"}}]}),n=d(),s=K({id:"",modelId:"",name:"",fieldType:"text",code:"",groupType:"EXTEND"}),m=()=>{V.value=!0,n.value.resetFields(),F.value=!1},I=a=>{F.value=!0,L.value=a,C.assign(s,a),n.value.validate(),V.value=!0},D=a=>{Z.warning({title:"\u63D0\u793A",titleAlign:"start",hideCancel:!1,content:`\u6B64\u64CD\u4F5C\u5C06\u6C38\u4E45\u5220\u9664\u5B57\u6BB5'${a.name}'\uFF0C\u662F\u5426\u7EE7\u7EED?`,onOk:async()=>{const u=h.value;if(u){await u.remove(a);const c=C.find(y.value,a);c&&(C.pull(y.value,c),M())}j.success("\u5220\u9664\u6210\u529F")}})},N=async()=>{const a=h.value;try{if(!await n.value.validate()){V.value=!1;const c=C.cloneDeep(s);if(!F.value)c.id=ot(),_.value.push(c),y.value.push(c);else{const R=C.find(_.value,L.value);R&&(C.pull(_.value,R),_.value.push(c),C.pull(y.value,R),y.value.push(c))}a&&await a.reloadData(_.value),M()}}catch{}},p=async()=>{const a=w.queryStr.toLowerCase(),u=C.cloneDeep(_);u.value=C.filter(_.value,R=>R.name.toLowerCase().indexOf(a)>-1||R.code.toLowerCase().indexOf(a)>-1);const c=h.value;c&&await c.reloadData(u.value)},z=async a=>{B(!0);const u=h.value;try{const{data:c}=await ht(a);y.value=c.EXTEND,_.value=C.flattenDeep([c.BASE,c.EXTEND]),u&&await u.reloadData(_.value)}catch{}finally{B(!1)}},$=(a,u)=>{C.some(_.value,c=>c.code===a&&c.id!==s.id)&&F.value&&u("\u5B57\u6BB5\u552F\u4E00\u6807\u8BC6\u5DF2\u5B58\u5728"),C.some(_.value,{code:a})&&!F.value&&u("\u5B57\u6BB5\u552F\u4E00\u6807\u8BC6\u5DF2\u5B58\u5728")};return ee(()=>O.modelValue,a=>{y.value=a},{deep:!0,immediate:!0}),A({initData:z}),(a,u)=>{const c=Ge,R=te,ie=ve,ae=Fe,de=ue,le=Ae,ce=he("vxe-grid"),ne=we,U=ge,G=ke,l=xe,i=me,S=Be,W=Z;return x(),q(se,null,[t(de,null,{default:e(()=>[t(R,{span:16},{default:e(()=>[t(c,{modelValue:w.queryStr,"onUpdate:modelValue":u[0]||(u[0]=g=>w.queryStr=g),style:{width:"100%"},placeholder:"\u641C\u7D22\u5B57\u6BB5\u540D\u79F0\u6216\u5B57\u6BB5code","allow-clear":"",onSearch:p,onInput:p,onClear:p},null,8,["modelValue"])]),_:1}),t(R,{span:8,style:{"text-align":"right"}},{default:e(()=>[t(ae,{style:{"margin-bottom":"5px"}},{default:e(()=>[t(ie,{type:"primary",size:"medium",onClick:m},{default:e(()=>[f(" \u65B0\u5EFA\u5B57\u6BB5 ")]),_:1})]),_:1})]),_:1})]),_:1}),t(ce,De({ref_key:"xGrid",ref:h,loading:P(o)},k.value),{groupType:e(({row:g})=>[g.groupType==="BASE"?(x(),q("span",Dt,"\u57FA\u7840\u5B57\u6BB5")):(x(),q("span",At,"\u6269\u5C55\u5B57\u6BB5"))]),fieldType:e(({row:g})=>[g.fieldType==="text"?(x(),q("span",wt,"\u6587\u672C")):oe("",!0),g.fieldType==="number"?(x(),q("span",kt,"\u6570\u5B57")):oe("",!0),g.fieldType==="date"?(x(),q("span",xt,"\u65F6\u95F4\u6233")):oe("",!0)]),action:e(({row:g})=>[g.groupType==="EXTEND"?(x(),X(ae,{key:0},{default:e(()=>[t(le,{onClick:re=>I(g)},{default:e(()=>[f("\u7F16\u8F91")]),_:2},1032,["onClick"]),t(le,{type:"text",onClick:re=>D(g)},{default:e(()=>[f("\u5220\u9664")]),_:2},1032,["onClick"])]),_:2},1024)):(x(),q("span",Vt,"--"))]),_:1},16,["loading"]),t(W,{"title-align":"start",draggable:"",visible:V.value,title:F.value?"\u7F16\u8F91\u5B57\u6BB5":"\u65B0\u5EFA\u5B57\u6BB5",width:"auto",onCancel:u[5]||(u[5]=g=>V.value=!1),onOk:N},{default:e(()=>[t(S,{ref_key:"submitFormRef",ref:n,model:s,style:{width:"600px"}},{default:e(()=>[t(U,{field:"name",label:"\u5B57\u6BB5\u540D\u79F0",rules:[{required:!0,message:"\u5B57\u6BB5\u540D\u79F0\u5FC5\u586B"},{maxLength:64,message:"\u540D\u79F0\u957F\u5EA6\u6700\u5927\u4E0D\u80FD\u8D85\u8FC764"}],"validate-trigger":"blur",required:""},{default:e(()=>[t(ne,{modelValue:s.name,"onUpdate:modelValue":u[1]||(u[1]=g=>s.name=g),placeholder:"\u8BF7\u8F93\u5165\u5B57\u6BB5\u540D\u79F0"},null,8,["modelValue"])]),_:1}),t(U,{field:"code",label:"\u5B57\u6BB5\u552F\u4E00\u6807\u8BC6",rules:[{required:!0,message:"\u5B57\u6BB5\u552F\u4E00\u6807\u8BC6\u5FC5\u586B"},{match:/^[a-zA-Z0-9_]+$/,message:"\u5B57\u6BB5\u552F\u4E00\u6807\u8BC6\u53EA\u80FD\u7531\u5B57\u6BCD\u82F1\u6587\u4E0B\u5212\u7EBF\u7EC4\u6210"},{validator:$}],"validate-trigger":"blur",required:""},{default:e(()=>[t(ne,{modelValue:s.code,"onUpdate:modelValue":u[2]||(u[2]=g=>s.code=g),placeholder:"\u8BF7\u8F93\u5165\u5B57\u6BB5\u552F\u4E00\u6807\u8BC6"},null,8,["modelValue"])]),_:1},8,["rules"]),t(U,{field:"fieldType",label:"\u5B57\u6BB5\u7C7B\u578B",rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u5B57\u6BB5\u7C7B\u578B"}]},{default:e(()=>[t(l,{modelValue:s.fieldType,"onUpdate:modelValue":u[3]||(u[3]=g=>s.fieldType=g),placeholder:"\u8BF7\u9009\u62E9\u5B57\u6BB5\u7C7B\u578B","allow-clear":""},{default:e(()=>[t(G,{value:"text"},{default:e(()=>[f("\u6587\u672C")]),_:1}),t(G,{value:"number"},{default:e(()=>[f("\u6570\u5B57")]),_:1}),t(G,{value:"date"},{default:e(()=>[f("\u65F6\u95F4\u6233")]),_:1})]),_:1},8,["modelValue"])]),_:1}),t(U,{field:"description",label:"\u5907\u6CE8"},{default:e(()=>[t(i,{modelValue:s.description,"onUpdate:modelValue":u[4]||(u[4]=g=>s.description=g),placeholder:"\u5907\u6CE8","show-word-limit":"","max-length":500},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["visible","title"])],64)}}}),$t={style:{float:"right","margin-bottom":"4px"}},Tt=Q({__name:"index",props:{visible:{type:Boolean,default:!1},initForm:{}},emits:["ok","cancel"],setup(T,{emit:A}){const b=T,O=A,E=d(),o=K({name:"",content:"",language:"javascript",comments:""}),B=d(),h=d(),V=d(),F=d(""),w=async()=>{var m;await E.value.validate()?console.warn("\u9A8C\u8BC1\u4E0D\u901A\u8FC7"):(o.content=((m=B.value.getEditor())==null?void 0:m.getValue())||"",await pt(o),j.success("\u63D0\u4EA4\u6210\u529F"),await Ft(o.name),O("ok"))},_=()=>{o.id="",o.name="",o.content="",o.comments=""},y=async()=>{if(b.initForm){const{data:s}=await Te(b.initForm.name);s?C.assign(o,s):(_(),C.assign(o,b.initForm)),E.value&&E.value.validate()}else await Je(()=>{_()})},L=()=>{O("cancel")},M=async()=>{var I;const s={name:"run-script",content:((I=B.value.getEditor())==null?void 0:I.getValue())||"",language:"javascript",inputJson:V.value.computedValue};await ft(s);const{data:m}=await _t(s.name);F.value=m.map(D=>D.log).join("")},k=async()=>{F.value="",await mt("run-script")},n=()=>{Z.info({title:"\u8BF7\u8F93\u5165\u539F\u59CB\u62A5\u6587JSON",titleAlign:"start",width:640,footer:!0,modalStyle:{padding:"8px",margin:0},bodyStyle:{padding:0,margin:"-20px 0 -28px 0"},onOk:M,content:()=>He(me,{ref:V,autoSize:{minRows:15,maxRows:15},allowClear:!0})})};return ee(()=>b.visible,s=>{s||(F.value="")}),(s,m)=>{const I=ve,D=ge,N=me,p=Be,z=te,$=ue,a=ye;return x(),X(a,{visible:s.visible,width:"100vw","title-align":"start","mask-closable":!1,"unmount-on-close":"",onOk:w,onCancel:L,onBeforeOpen:y},{title:e(()=>[f(Y(o.id?"\u7F16\u8F91\u811A\u672C":"\u65B0\u5EFA\u811A\u672C"),1)]),default:e(()=>[t($,null,{default:e(()=>[t(z,{span:14},{default:e(()=>[v("div",$t,[t(I,{type:"primary",status:"success",style:{"margin-left":"10px"},onClick:n},{default:e(()=>[f(" \u8FD0\u884C\u4EE3\u7801 ")]),_:1}),t(I,{type:"primary",status:"warning",style:{"margin-left":"10px"},disabled:!F.value,onClick:m[0]||(m[0]=u=>k())},{default:e(()=>[f(" \u6E05\u9664\u65E5\u5FD7 ")]),_:1},8,["disabled"])]),t(p,{ref_key:"submitFormRef",ref:E,model:o,"label-col-props":{span:3,offset:0},"wrapper-col-props":{span:21,offset:0}},{default:e(()=>[t(D,{field:"content",label:"\u811A\u672C\u5185\u5BB9","validate-trigger":"blur"},{default:e(()=>[t(fe,{ref_key:"MonacoEditRef",ref:B,modelValue:o.content,"onUpdate:modelValue":m[1]||(m[1]=u=>o.content=u),"editor-option":{readOnly:!1,minimap:{enabled:!1},lineNumbersMinChars:3,contextmenu:!1,suggest:{preview:!0}},style:{border:"1px solid var(--color-border-3)"},height:600,language:"javascript"},null,8,["modelValue"])]),_:1}),t(D,{field:"comments",label:"\u5907\u6CE8","validate-trigger":"blur"},{default:e(()=>[t(N,{modelValue:o.comments,"onUpdate:modelValue":m[2]||(m[2]=u=>o.comments=u),"auto-size":{minRows:2,maxRows:3}},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1}),t(z,{span:10},{default:e(()=>[t(fe,{ref_key:"MonacoLogRef",ref:h,modelValue:F.value,"onUpdate:modelValue":m[3]||(m[3]=u=>F.value=u),"editor-option":{readOnly:!0,minimap:{enabled:!1},lineNumbers:"off",contextmenu:!1},style:{border:"1px solid var(--color-border-3)","margin-left":"1em"},height:"85vh",language:"log"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["visible"])}}}),St={style:{height:"calc(100vh - 116px)"}},Ot=Q({__name:"app-preprocess-logs",props:{visible:{type:Boolean,default:!1},appName:{type:String,default:""},appKey:{type:String,default:""}},emits:["cancel"],setup(T,{emit:A}){const b=T,O=A,E=d(""),{loading:o,setLoading:B}=_e(),h=async()=>{if(b.appKey){console.log("poll...."),B(!0);const{data:_}=await gt(b.appKey);E.value=_.join(`
`),setTimeout(()=>B(!1),1e3)}},{start:V,stop:F}=Ct(async()=>{await h()},5e3),w=_=>{_?V():F()};return ee(()=>b.visible,_=>{_||F()}),Ve(()=>{b.visible||F()}),(_,y)=>{const L=te,M=Ye,k=Ze,n=Ie,s=Fe,m=ue,I=ye;return x(),X(I,{width:"55vw",visible:T.visible,"mask-closable":!0,footer:null,"destroy-on-close":!0,title:T.appName+" \u9884\u5904\u7406\u65E5\u5FD7",onCancel:y[1]||(y[1]=D=>O("cancel")),onOpen:h},{default:e(()=>[v("div",null,[t(m,null,{default:e(()=>[t(L,{span:14}),t(L,{span:10,style:{"text-align":"right"}},{default:e(()=>[t(s,{style:{"margin-bottom":"5px"}},{default:e(()=>[t(M,{loading:P(o)},{default:e(()=>[f("\xA0")]),_:1},8,["loading"]),t(k,null,{default:e(()=>[f("\u81EA\u52A8\u5237\u65B0:")]),_:1}),t(n,{onChange:w},{checked:e(()=>[f("\u5F00")]),unchecked:e(()=>[f("\u5173")]),_:1})]),_:1})]),_:1})]),_:1}),v("div",St,[t(fe,{ref:"MonacoLogRef",modelValue:E.value,"onUpdate:modelValue":y[0]||(y[0]=D=>E.value=D),"editor-option":{readOnly:!0,minimap:{enabled:!1},lineNumbers:"on",contextmenu:!1},style:{border:"1px solid var(--color-border-3)","margin-left":"1em"},height:"85vh",language:"log"},null,8,["modelValue"])])])]),_:1},8,["visible","title"])}}}),Lt=v("span",{style:{"margin-left":"12px"}},"\u5206\u949F",-1),Mt=v("div",null," \u9488\u5BF9\u672A\u6062\u590D\u7684\u544A\u8B66\uFF0C\u4EE5\u76D1\u63A7\u5DE5\u5177\u6700\u540E\u4E00\u6B21\u53D1\u51FA\u544A\u8B66\u65F6\u95F4\u4E3A\u51C6\uFF0C\u5982\u679C\u8BBE\u5B9A\u7684\u65F6\u95F4\u5185\u672A\u8FDB\u884C\u624B\u52A8\u5173\u95ED\u544A\u8B66\uFF0C \u7CFB\u7EDF\u5C06\u81EA\u52A8\u4E3A\u60A8\u5173\u95ED\u544A\u8B66\uFF1B\u81EA\u5B9A\u4E49\u533A\u95F4\u8303\u56F4\uFF1A0-1440\u5206\u949F,0\u8868\u793A\u6C38\u4E0D\u5173\u95ED\uFF0C1440\u5206\u949F\u5373\u4E3A24\u5C0F\u65F6\u3002 ",-1),Rt=v("div",null," \u89C4\u5219\u8BF4\u660E\uFF1A\u540C\u4E00\u4E2A\u5E94\u7528\u4E14EVENT_ID\u76F8\u540C\u4E14\u7EA7\u522B\u76F8\u540C\uFF1B\u540C\u4E00\u4E2A\u5E94\u7528\u4E14\u544A\u8B66\u540D\u79F0\u76F8\u540C\u7EA7\u522B\u76F8\u540C\u7684\u544A\u8B66\u6570\u636E\u4F1A\u88AB\u5B9E\u65F6\u538B\u7F29\u6210\u4E00\u6761\u6570\u636E\u3002 \u6700\u65B0\u7684\u6570\u636E\u4F1A\u8986\u76D6\u5386\u53F2\u6570\u636E\uFF0C\u8BB0\u5F55\u6700\u65B0\u544A\u8B66\u53D1\u751F\u65F6\u95F4\u3002 ",-1),qt=Q({__name:"app-instance-list",props:{modelId:{},modelType:{}},emits:["deleteInstance"],setup(T,{expose:A,emit:b}){const{loading:O,setLoading:E}=_e(!1),o=d(),B=d(!1),h=d(!1),V=d(!1),F=d(""),w=d(""),_=b,y=()=>{_("deleteInstance")},L=d({size:"mini",height:"auto",columnConfig:{resizable:!0},showOverflow:"tooltip",columns:[{title:"\u5B9E\u4F8B\u540D\u79F0",field:"name",width:160},{title:"\u72B6\u6001",field:"enable",minWidth:80,slots:{default:"enable"}},{title:"appKey",field:"id",minWidth:300},{title:"\u81EA\u52A8\u6062\u590D(\u5206\u949F)",field:"autoRecoverTime",width:120},{title:"\u81EA\u52A8\u53BB\u91CD",field:"notOnly",width:100,slots:{default:"notOnly"}},{title:"\u6570\u636E\u6E90",field:"datasourceName",minWidth:100},{title:"\u64CD\u4F5C",minWidth:140,slots:{default:"action"}}]}),M=T,k=K({modelId:M.modelId}),{pagination:n,pageSizeOptions:s}=Et(),m=d(!1),I=d(),D=d(""),N=d(),p=K({enable:!0,modelId:"",name:"",autoRecoverTime:0,datasourceId:"",notOnly:!0,createTime:"",modelType:""}),z=l=>{N.value.resetFields(),B.value=!0,p.id="",p.modelId=l.id,p.modelType=l.type,h.value=!1},$={name:[{required:!0,message:"\u5E94\u7528\u540D\u79F0\u5FC5\u586B"},{validator:st(async(l,i)=>{const{data:S}=await it(p);S&&i("\u5E94\u7528\u540D\u79F0\u5DF2\u5B58\u5728")},300),message:"\u5E94\u7528\u540D\u79F0\u5DF2\u5B58\u5728"}]},a=d(),u=async()=>{a.value=(await rt(void 0)).data,a.value=a.value.filter(l=>l.type===M.modelType)},c=async(l={page:n,...k})=>{E(!0),await u();const i=o.value;try{const{data:S}=await ct(l);n.total=S.totalElements,i&&await i.reloadData(S.content)}catch{}finally{E(!1)}},R=l=>{n.current=l,c()},ie=l=>{n.pageSize=l,c()},ae=async()=>{await N.value.validate()||(await be(p),j.success("\u63D0\u4EA4\u6210\u529F"),B.value=!1,await c(),y())},de=async l=>{h.value=!0,B.value=!0,C.assign(p,l),C.find(a.value,{id:p.datasourceId})||(p.datasourceId=""),N.value.validate(),I.value={name:p.id},await U()},le=async l=>{Z.warning({title:"\u63D0\u793A",titleAlign:"start",hideCancel:!1,content:`\u6B64\u64CD\u4F5C\u5C06\u5220\u9664\u5E94\u7528'${l.name}',\u5E76\u5F71\u54CD\u544A\u8B66\u76F8\u5173\u914D\u7F6E\uFF0C\u662F\u5426\u7EE7\u7EED?`,onOk:async()=>{await dt(l.id),j.success("\u5220\u9664\u6210\u529F"),await c(),y()}})},ce=async l=>{if(await be(l),await Bt(l.id,!l.enable),l.enable){const i=`event-origin-${l.id}`,S={listenerId:`${i}-default-listener`,groupId:l.id,topicName:i};await yt("origin",S)}j.success("\u63D0\u4EA4\u6210\u529F")},ne=l=>{k.modelId=l,c()},U=async()=>{if(p.id){const{data:l}=await Te(p.id);D.value=l?l.id:""}else D.value=""},G=l=>{V.value=!0,F.value=l.name||"",w.value=l.id||""};return ee(B,l=>{l||(D.value="")}),A({createInstanceModel:z,queryAppInstance:ne}),(l,i)=>{const S=Ie,W=Ae,g=Fe,re=Qe,Se=he("vxe-grid"),Oe=we,J=ge,Le=et,Ee=te,Me=ue,Re=ke,qe=xe,Ne=je,Pe=Ke,ze=Be,Ue=Z;return x(),q(se,null,[t(Se,De({ref_key:"xGrid",ref:o,loading:P(O)},L.value),{enable:e(({row:r})=>[t(S,{modelValue:r.enable,"onUpdate:modelValue":H=>r.enable=H,onChange:H=>ce(r)},{checked:e(()=>[f("\u63A5\u6536\u544A\u8B66")]),unchecked:e(()=>[f("\u62D2\u6536\u544A\u8B66")]),_:2},1032,["modelValue","onUpdate:modelValue","onChange"])]),notOnly:e(({row:r})=>[v("span",null,Y(r.notOnly?"\u662F":"\u5426"),1)]),action:e(({row:r})=>[t(g,null,{default:e(()=>[t(W,{onClick:H=>de(r)},{default:e(()=>[f("\u7F16\u8F91")]),_:2},1032,["onClick"]),t(W,{type:"text",onClick:H=>le(r)},{default:e(()=>[f("\u5220\u9664")]),_:2},1032,["onClick"]),t(W,{type:"text",onClick:H=>G(r)},{default:e(()=>[f("\u65E5\u5FD7")]),_:2},1032,["onClick"])]),_:2},1024)]),pager:e(()=>[t(re,{ref:"xPagination",current:P(n).current,"page-size":P(n).pageSize,total:P(n).total,"page-size-options":P(s),style:{"padding-top":"10px"},"show-total":"","show-jumper":"","show-page-size":"",onChange:R,onPageSizeChange:ie},null,8,["current","page-size","total","page-size-options"])]),_:1},16,["loading"]),t(Ue,{"title-align":"start",draggable:!0,visible:B.value,title:h.value?"\u7F16\u8F91\u5E94\u7528":"\u65B0\u5EFA\u5E94\u7528","mask-closable":!1,width:"auto",onCancel:i[6]||(i[6]=r=>B.value=!1),onOk:ae},{default:e(()=>[t(ze,{ref_key:"submitFormRef",ref:N,model:p,rules:$,style:{width:"500px"}},{default:e(()=>[t(J,{field:"name",label:"\u5E94\u7528\u540D\u79F0","validate-trigger":"blur",required:"",rules:[{maxLength:64,message:"\u5E94\u7528\u540D\u79F0\u957F\u5EA6\u6700\u5927\u4E0D\u80FD\u8D85\u8FC764"}]},{default:e(()=>[t(Oe,{modelValue:p.name,"onUpdate:modelValue":i[0]||(i[0]=r=>p.name=r),placeholder:"\u8BF7\u8F93\u5165\u5E94\u7528\u540D\u79F0"},null,8,["modelValue"])]),_:1}),t(J,{field:"autoRecoverTime",label:"\u81EA\u52A8\u6062\u590D"},{extra:e(()=>[Mt]),default:e(()=>[t(Me,null,{default:e(()=>[t(Ee,{span:18},{default:e(()=>[t(Le,{modelValue:p.autoRecoverTime,"onUpdate:modelValue":i[1]||(i[1]=r=>p.autoRecoverTime=r),min:0,max:1440,placeholder:"\u8BF7\u8F93\u5165\u81EA\u52A8\u6062\u590D\u65F6\u95F4"},null,8,["modelValue"])]),_:1}),t(Ee,{span:6},{default:e(()=>[Lt]),_:1})]),_:1})]),_:1}),t(J,{field:"notOnly",label:"\u81EA\u52A8\u53BB\u91CD"},{extra:e(()=>[Rt]),default:e(()=>[t(S,{modelValue:p.notOnly,"onUpdate:modelValue":i[2]||(i[2]=r=>p.notOnly=r)},{checked:e(()=>[f("\u662F")]),unchecked:e(()=>[f("\u5426")]),_:1},8,["modelValue"])]),_:1}),t(J,{field:"datasourceId",label:"\u6570\u636E\u6E90"},{default:e(()=>[t(qe,{modelValue:p.datasourceId,"onUpdate:modelValue":i[3]||(i[3]=r=>p.datasourceId=r),placeholder:"\u8BF7\u9009\u62E9\u6570\u636E\u6E90","allow-clear":""},{default:e(()=>[(x(!0),q(se,null,$e(a.value,r=>(x(),X(Re,{key:r.id,value:r.id},{default:e(()=>[f(Y(r.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(J,{field:"script",label:"\u9884\u5904\u7406\u811A\u672C"},{default:e(()=>[t(W,{onClick:i[4]||(i[4]=r=>m.value=!0)},{icon:e(()=>[t(Ne)]),default:e(()=>[f(" \u70B9\u6211"+Y(D.value?"\u7F16\u8F91":"\u6DFB\u52A0"),1)]),_:1}),D.value?(x(),X(W,{key:0,status:"danger",onClick:i[5]||(i[5]=r=>{P(vt)(D.value).then(()=>{U()})})},{icon:e(()=>[t(Pe)]),default:e(()=>[f(" \u79FB\u9664 ")]),_:1})):oe("",!0)]),_:1})]),_:1},8,["model"])]),_:1},8,["visible","title"]),t(Tt,{visible:m.value,"onUpdate:visible":i[7]||(i[7]=r=>m.value=r),"init-form":I.value,onOk:i[8]||(i[8]=r=>{m.value=!1,U()}),onCancel:i[9]||(i[9]=r=>m.value=!1)},null,8,["visible","init-form"]),t(Ot,{visible:V.value,"app-name":F.value,"app-key":w.value,onCancel:i[10]||(i[10]=r=>V.value=!1)},null,8,["visible","app-name","app-key"])],64)}}}),Nt={class:"page-container"},Pt={class:"page-panel",style:{height:"calc(100vh - 85px)"}},zt={class:"panel-chart-hover"},Ut={class:"panel-chart"},Wt={class:"panel-footer"},jt={class:"panel-jiao"},Kt={class:"panel-body"},Xt={class:"chart-logo"},Gt=["src"],Jt={class:"button-bottom button-eye"},Ht={class:"button-bottom button-add"},Yt={class:"page-panel",style:{height:"calc(100vh - 85px)"}},Zt=Q({__name:"index",setup(T){const A=d([]),b=d(!1),O=d(),E=d(),o=d(0),B=d(),h=async()=>{A.value=(await lt()).data,A.value.length>0&&E.value.queryAppInstance(A.value[o.value].id)},V=Ce(()=>A.value.length>0?A.value[o.value].id:""),F=Ce(()=>A.value.length>0?A.value[o.value].type:""),w=K({id:"",type:"",icon:"0",fields:[]}),_=async()=>{await nt(w),j.success("\u63D0\u4EA4\u6210\u529F"),b.value=!1,await h()},y=async(k,n)=>{o.value=k,E.value.queryAppInstance(n.id),b.value=!0,B.value=n,C.assign(w,n),O.value.initData(w.id)};ee(()=>A,k=>{var n;(n=B.value)!=null&&n.id&&(B.value=C.find(k.value,s=>s.id===B.value.id))},{deep:!0,immediate:!0});const L=(k,n)=>{o.value=k,E.value.createInstanceModel(C.cloneDeep(n))},M=(k,n)=>{E.value.queryAppInstance(n.id),o.value=k};return Ve(()=>{h()}),(k,n)=>{const s=ve,m=te,I=ue,D=tt,N=ut,p=at,z=ye;return x(),q("div",Nt,[t(I,{gutter:24},{default:e(()=>[t(m,{span:4},{default:e(()=>[v("div",Pt,[t(N,{"default-active-key":"1"},{default:e(()=>[t(D,{key:"1"},{title:e(()=>[f("\u5E94\u7528\u7C7B\u578B")]),default:e(()=>[t(I,{gutter:20},{default:e(()=>[(x(!0),q(se,null,$e(A.value,($,a)=>(x(),X(m,{key:a,span:24,onClick:u=>M(a,$)},{default:e(()=>{var u;return[v("div",zt,[v("div",{class:pe({"panel-chart-active":a===o.value,"panel-chart-none-active":a!==o.value})},null,2)]),v("div",Ut,[v("div",null,[v("div",Wt,[v("div",jt,[v("span",null,Y((u=$.appInstances)==null?void 0:u.length),1)])]),v("div",Kt,[v("div",Xt,[v("img",{src:P(bt)("system/"+$.icon),style:{width:"100%"}},null,8,Gt)])]),v("div",Jt,[v("div",{class:pe(a===o.value?"button-active":"")},[t(s,{type:"text",size:"small",onClick:c=>y(a,$)},{default:e(()=>[f(" \u7F16\u8F91\u5E94\u7528 ")]),_:2},1032,["onClick"])],2)]),v("div",Ht,[v("div",{class:pe(a===o.value?"button-active":"")},[t(s,{type:"text",size:"small",onClick:c=>L(a,$)},{default:e(()=>[f(" \u6DFB\u52A0\u5B9E\u4F8B ")]),_:2},1032,["onClick"])],2)])])])]}),_:2},1032,["onClick"]))),128))]),_:1})]),_:1})]),_:1})])]),_:1}),t(m,{span:20,style:{"padding-left":"0"}},{default:e(()=>[v("div",Yt,[t(qt,{ref_key:"appInstanceList",ref:E,"model-id":V.value,"model-type":F.value,onDeleteInstance:n[0]||(n[0]=$=>h())},null,8,["model-id","model-type"])])]),_:1})]),_:1}),t(z,{visible:b.value,title:"\u7F16\u8F91\u5E94\u7528\u7C7B\u578B("+w.type+")",width:"auto","mask-closable":!1,onCancel:n[2]||(n[2]=$=>b.value=!1),onOk:_},{default:e(()=>[f(" \u5B57\u6BB5\u4FE1\u606F "),t(p),t(It,{ref_key:"appModelField",ref:O,modelValue:w.fields,"onUpdate:modelValue":n[1]||(n[1]=$=>w.fields=$)},null,8,["modelValue"])]),_:1},8,["visible","title"])])}}});const bu=Xe(Zt,[["__scopeId","data-v-8f6e024a"]]);export{bu as default};
