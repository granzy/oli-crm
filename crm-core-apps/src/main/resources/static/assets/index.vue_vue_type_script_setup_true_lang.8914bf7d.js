import{_ as $e,a as J,l as ee,J as Ne}from"./index.e9d54774.js";/* empty css                */import{d as le,f as v,D as f,E as R,aS as t,aI as a,F as Ve,aY as S,aW as U,bz as Ge,bV as Me,bW as Re,c as M,w as fe,aH as L,aZ as E,u as q,bg as _e,aP as Ke,bo as je,cJ as ze,a0 as He,bE as Ue,aN as ge,bt as he,bp as qe,bi as We,r as be,o as Ee,aT as Qe,ce as Ze,G as Je,H as te,bN as ae,bL as re,bO as Fe,bq as Xe,h as ce,a7 as Ye,ah as Pe,ag as et,cm as Be,ca as ke,b_ as xe,bK as Ce,ch as tt,a_ as at,b0 as lt,a$ as ut,aO as st,bZ as ot}from"./arco.a97fe066.js";/* empty css                *//* empty css                */import{c as nt,t as it}from"./host-group.ed397ed1.js";import{s as X,f as Y,a as rt}from"./tree-util.a8ddc3e6.js";import{l as ct}from"./monitor-object-tag.71c4a187.js";import{f as dt}from"./app-instance.ab836c4c.js";import{g as pt,t as vt}from"./category.8586a983.js";/* empty css               *//* empty css               */import{q as we,s as ft,d as yt}from"./business.22e8b088.js";/* empty css              *//* empty css               */import"./batch-assign-business.vue_vue_type_script_setup_true_lang.92520241.js";import{b as Le}from"./bus.4c102fb6.js";const mt=le({__name:"index",props:{data:{},fieldNames:{default:()=>({label:"label"})}},emits:["select"],setup(j,{expose:z,emit:F}){const A=F,n=v(-1),g=v(-1),B=(c,x)=>{n.value=x,A("select",c)},k=c=>{n.value=c},m=c=>{g.value=c},u=()=>{g.value=-1};return z({setSelectIndex:k}),(c,x)=>{const D=Me,_=Re;return f(),R("div",null,[t(_,Ge({class:"list-item-action-layout",bordered:!1,data:c.data},c.$attrs),{item:a(({item:I,index:i})=>[t(D,{class:Ve(["list-item",{selected:n.value===i,"non-selected":n.value!==i}]),"action-layout":"vertical",onMouseover:y=>m(i),onMouseleave:x[0]||(x[0]=y=>u()),onClick:y=>B(I,i)},{default:a(()=>[S(U(I[c.fieldNames.label]),1)]),_:2},1032,["class","onMouseover","onClick"])]),_:1},16,["data"])])}}});const ye=$e(mt,[["__scopeId","data-v-90317fd5"]]),me=le({__name:"business-save-drawer",props:{visible:{type:Boolean},business:{}},emits:["ok","closeDrawer","openFolderDrawer"],setup(j,{expose:z,emit:F}){const{loading:A,setLoading:n}=J(),g=j,B=F,k=v([]),m=v(),u=v({name:"",id:"",pid:"",parentLabelText:"",sortIndex:0,type:"",createTime:"",createUser:""}),c=M(()=>{let i="";return u.value.id?i="\u7F16\u8F91":i="\u521B\u5EFA",u.value.type==="FOLDER"?i+="\u6587\u4EF6\u5939":u.value.type==="NODE"&&(i+="\u8282\u70B9"),i}),x=i=>{const y=[];return i.forEach(h=>{h.key!=="0"&&h.key!=="-1"&&h.key!==u.value.id&&(h.children&&(h.children=x(h.children)),y.push({...h}))}),y},D=async()=>{n(!0);const i=(await we({onlyFolder:!0})).data;i.length>0&&(k.value=x(i)),n(!1)},_=async()=>{if(!await m.value.validate()){n(!0),u.value.pid||(u.value.pid="");try{await ft(u.value),_e.success("\u4FDD\u5B58\u6210\u529F"),B("ok")}finally{n(!1)}n(!1)}},I=()=>{B("closeDrawer")};return fe(()=>g.business,i=>{u.value=i},{deep:!0,immediate:!0}),fe(()=>g.visible,()=>{D()},{deep:!0,immediate:!0}),z({fetchData:D}),(i,y)=>{const h=Ke,$=je,W=ze,V=He,H=Ue,Q=ge,r=he,s=qe,l=We;return f(),R("div",null,[t(l,{title:c.value,visible:g.visible,width:700,"ok-loading":q(A),onCancel:I,onOk:_},{default:a(()=>[t(s,{ref_key:"formRef",ref:m,model:u.value},{default:a(()=>[t($,{field:"name",label:(i.business.type==="FOLDER"?"\u6587\u4EF6\u5939":"\u8282\u70B9")+"\u540D\u79F0",rules:[{required:!0,message:(i.business.type==="FOLDER"?"\u6587\u4EF6\u5939":"\u8282\u70B9")+"\u540D\u79F0\u4E0D\u80FD\u4E3A\u7A7A"}]},{default:a(()=>[t(h,{modelValue:u.value.name,"onUpdate:modelValue":y[0]||(y[0]=T=>u.value.name=T),placeholder:"\u8BF7\u8F93\u5165"+(i.business.type==="FOLDER"?"\u6587\u4EF6\u5939":"\u8282\u70B9")+"\u540D\u79F0",style:{width:"300px"},"max-length":64},null,8,["modelValue","placeholder"])]),_:1},8,["label","rules"]),t($,{label:"\u6240\u5C5E\u6587\u4EF6\u5939"},{default:a(()=>[t(r,null,{default:a(()=>[t(W,{modelValue:u.value.pid,"onUpdate:modelValue":y[1]||(y[1]=T=>u.value.pid=T),data:k.value,placeholder:"\u8BF7\u9009\u62E9\u6587\u4EF6\u5939",style:{width:"300px"},"allow-clear":""},null,8,["modelValue","data"]),t(H,{content:"\u4E0D\u9009\u62E9\u6587\u4EF6\u5939\u65F6\uFF0C\u4F1A\u88AB\u521B\u5EFA\u5728\u7B2C\u4E00\u7EA7"},{default:a(()=>[t(V)]),_:1}),u.value.type==="NODE"?(f(),L(Q,{key:0,type:"text",onClick:y[2]||(y[2]=T=>B("openFolderDrawer"))},{default:a(()=>[S(" \u65B0\u5EFA\u6587\u4EF6\u5939 ")]),_:1})):E("",!0)]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["title","visible","ok-loading"])])}}}),_t={style:{height:"calc(100vh - 174px)"}},gt=["onMouseenter","onMouseleave"],ht={style:{"white-space":"nowrap"}},bt={key:0,style:{"white-space":"nowrap"}},Et={style:{position:"absolute",bottom:"0",width:"100%","text-align":"center","border-top":"var(--color-border) 1px solid",padding:"16px 0 6px 0"}},Ft=le({__name:"business-view",props:{searchText:{type:String,required:!0},filterEmpty:{type:Boolean,default:!1},category:{type:String,default:"",required:!1}},emits:["search"],setup(j,{emit:z}){const F=j,A=z,{loading:n,setLoading:g}=J(),B={pid:"",name:"",parentLabelText:"",sortIndex:0,type:"FOLDER",monitorObjects:[]},k={pid:"",name:"",parentLabelText:"",sortIndex:0,type:"NODE",monitorObjects:[]},m=v([]),u=v(ee.cloneDeep(B)),c=v(ee.cloneDeep(k)),x=v(""),D=v(!1),_=v(!1),I=v(),i=(r,s)=>{A("search",s.node.id==="0"?"":r[0])},y=be({queryStr:"",enable:void 0,available:void 0,priorityList:[]}),h=async()=>{g(!0),m.value=(await we({category:F.category,...y})).data,g(!1)},$=(r,s,l)=>{if(s==="FOLDER"&&l){const T=rt(m.value,l.key).map(P=>P.title);r==="add"?(x.value="\u521B\u5EFA",u.value=ee.cloneDeep(B),u.value.pid=l.key&&l.key!=="0"?l.key:""):r==="edit"&&l&&(u.value.id=l.key,u.value.pid=l.pid,u.value.name=l.title,u.value.createTime=l.data.createTime,u.value.createUser=l.data.createUser,x.value="\u7F16\u8F91"),u.value.type="FOLDER",u.value.parentLabelText=T.join("/"),D.value=!0}else s==="NODE"&&(r==="add"?(x.value="\u521B\u5EFA",c.value=ee.cloneDeep(k)):r==="edit"&&l&&(c.value.id=l.key,c.value.pid=l.pid,c.value.name=l.title,c.value.sortIndex=l.data.sortIndex,c.value.createTime=l.data.createTime,c.value.createUser=l.data.createUser,c.value.monitorObjects=l.data.monitorObjects,x.value="\u7F16\u8F91"),_.value=!0)},W=async r=>{let s="",l="";r.data.type==="FOLDER"?(l="\u6587\u4EF6\u5939",s="\u8BE5\u6587\u4EF6\u5939\u4E0B\u7684\u6240\u6709\u8282\u70B9\u5C06\u4F1A\u4E00\u5E76\u5220\u9664\uFF0C\u5173\u8054\u7684\u76D1\u63A7\u4E3B\u673A\u5C06\u81EA\u52A8\u79FB\u52A8\u81F3\u201C\u672A\u5206\u7C7B\u201D\u8282\u70B9\uFF0C\u662F\u5426\u7EE7\u7EED\uFF1F"):(l="\u8282\u70B9",s="\u8BE5\u8282\u70B9\u4E0B\u672A\u5173\u8054\u5176\u4ED6\u8282\u70B9\u7684\u76D1\u63A7\u4E3B\u673A\u5C06\u81EA\u52A8\u79FB\u52A8\u81F3\u201C\u672A\u5206\u7C7B\u201D\u8282\u70B9\uFF0C\u662F\u5426\u7EE7\u7EED\uFF1F"),Xe.confirm({title:"\u63D0\u793A",simple:!1,draggable:!0,closable:!1,titleAlign:"start",content:()=>ce("div",["\u6B64\u64CD\u4F5C\u5C06\u6C38\u4E45",ce("span",{style:"color: rgb(var(--danger-6))"},"\u5220\u9664"),`${l}"`,ce("span",{style:"color: rgb(var(--primary-6))"},r.title),`",${s}`]),onOk:async()=>{await yt(r.key),_e.success("\u5220\u9664\u6210\u529F"),await h()}})},V=r=>{h(),r==="FOLDER"?(D.value=!1,I.value&&I.value.fetchData()):r==="NODE"&&(_.value=!1)},H=(r,s)=>{r.showExtra=s},Q=M(()=>F.searchText!==""?F.filterEmpty?X(F.searchText,Y("data",m.value)):X(F.searchText,m.value):F.filterEmpty?Y("data.count",m.value):m.value);return Le.on("refresh-monitor-object-left-tree-list",r=>{r&&(y.queryStr=r.queryStr,y.enable=r.enable,y.available=r.available,y.priorityList=r.priorityList),h()}),Ee(()=>{h()}),(r,s)=>{const l=Qe("icon-font"),T=he,P=Ye,K=ge,ue=Pe,se=et,oe=Be,ne=ke,ie=xe,b=Ce,C=Ze("read-only");return f(),R("div",_t,[t(b,{loading:q(n),tip:"\u6B63\u5728\u52A0\u8F7D...",style:{width:"100%",position:"relative",height:"100%"}},{default:a(()=>[t(ie,{style:Je({height:q(Ne)()?"calc(100vh - 174px)":"calc(100vh - 220px)",overflow:"auto",paddingBottom:"20px"})},{default:a(()=>[m.value.length>0?(f(),L(oe,{key:0,ref:"treeRef",size:"mini",data:Q.value,onSelect:i},{title:a(d=>[te("div",{style:{height:"24px",width:"58vw",display:"flex","align-items":"center"},onMouseenter:Z=>H(d,!0),onMouseleave:Z=>H(d,!1)},[t(T,null,{default:a(()=>[d.id!=="0"?(f(),L(l,{key:0,type:d.data.type==="FOLDER"?"icon-folder":"icon-cube",size:16,style:{color:"var(--color-text-2)"}},null,8,["type"])):E("",!0),te("div",ht,U(d.title+"("+d.data.count+")"),1)]),_:2},1024),d.showExtra&&d.id!=="-1"?ae((f(),R("div",bt,[d.data.type==="FOLDER"&&d.title!=="\u5168\u90E8"?(f(),L(K,{key:0,type:"text",size:"mini",onClick:re(Z=>$("add","FOLDER",d),["stop"])},{icon:a(()=>[t(P)]),_:2},1032,["onClick"])):E("",!0),d.title!=="\u5168\u90E8"?(f(),L(K,{key:1,type:"text",size:"mini",onClick:re(Z=>$("edit",d.data.type,d),["stop"])},{icon:a(()=>[t(ue)]),_:2},1032,["onClick"])):E("",!0),d.title!=="\u5168\u90E8"?(f(),L(K,{key:2,type:"text",size:"mini",onClick:re(Z=>W(d),["stop"])},{icon:a(()=>[t(se)]),_:2},1032,["onClick"])):E("",!0)])),[[C]]):E("",!0)],40,gt)]),_:1},8,["data"])):E("",!0),ae(t(ne,null,null,512),[[Fe,Q.value.length===0]])]),_:1},8,["style"]),ae((f(),R("div",Et,[t(T,null,{default:a(()=>[t(K,{size:"mini",onClick:s[0]||(s[0]=d=>$("add","FOLDER",{key:""}))},{icon:a(()=>[t(l,{type:"icon-folder",size:12})]),default:a(()=>[S(" \u65B0\u5EFA\u6587\u4EF6\u5939 ")]),_:1}),t(K,{size:"mini",onClick:s[1]||(s[1]=d=>$("add","NODE",{}))},{icon:a(()=>[t(l,{type:"icon-cube",size:12})]),default:a(()=>[S(" \u65B0\u5EFA\u8282\u70B9 ")]),_:1})]),_:1})])),[[C]])]),_:1},8,["loading"]),D.value?(f(),L(me,{key:0,ref:"folderBusinessSaveDrawer",business:u.value,visible:D.value,onOk:s[2]||(s[2]=d=>V("FOLDER")),onCloseDrawer:s[3]||(s[3]=d=>D.value=!1)},null,8,["business","visible"])):E("",!0),_.value?(f(),L(me,{key:1,ref_key:"nodeBusinessSaveDrawer",ref:I,business:c.value,visible:_.value,onOk:s[4]||(s[4]=d=>V("NODE")),onOpenFolderDrawer:s[5]||(s[5]=d=>$("add","FOLDER",{key:""})),onCloseDrawer:s[6]||(s[6]=d=>_.value=!1)},null,8,["business","visible"])):E("",!0)])}}}),Bt={class:"page-panel-no-radius",style:{height:"calc(100vh - 84px)","overflow-y":"auto"}},kt={style:{display:"flex","justify-content":"space-between","align-items":"center","margin-bottom":"6px","margin-top":"6px"}},xt={key:0,style:{"margin-top":"6px"}},Ct={key:1,style:{"margin-top":"6px"}},wt={key:2,style:{"margin-top":"6px"}},Ut=le({__name:"index",props:{category:{type:String,required:!1,default:""}},emits:["searchDataByAppKeyAndHostGroupId","searchDataByTagId","searchDataByBusinessId","searchDataByCategoryCode","searchDataByCategorySubtype"],setup(j,{emit:z}){const F=j,A=z,n=v("business"),g=v([]),B=v([]),k=v([]),m=v([]),u=v(["0"]),c=v([]),x=M(()=>c.value.length===1),D=v("\u76D1\u63A7\u5217\u8868"),_=be({queryStr:"",enable:void 0,available:void 0,priorityList:[]}),{loading:I,setLoading:i}=J(),{loading:y,setLoading:h}=J(),{loading:$,setLoading:W}=J(),V=M(()=>({queryStr:_.queryStr,enable:_.enable,available:_.available,priorityList:_.priorityList,countMonitorObject:!0,category:F.category,filterSubtypeBlack:!0})),H=()=>{x.value?(h(!0),g.value=[],nt(V.value).then(e=>{const o=e.data;let p=0;const w=[];o.forEach(N=>{p+=N.data,N.children&&N.children.forEach(G=>{w.push({label:`${G.label}(${G.data})`,value:G.value,data:G.data})})}),g.value=[{label:`\u5168\u90E8(${p})`,value:"-1",data:p}],g.value.push(...w),h(!1)})):(W(!0),B.value=[],it(V.value).then(e=>{e.data&&B.value.push(...e.data),W(!1)}))},{loading:Q,setLoading:r}=J(),s=()=>{r(!0),k.value=[],vt(V.value).then(e=>{if(e.data&&(k.value.push(...e.data),F.category)){let o=e.data.filter(p=>p.key===F.category);o&&o.length===1&&o[0].children&&o[0].children.length>0&&(o=o[0].children),k.value=ee.concat(e.data[0],...o)}r(!1)})},l=()=>{i(!0),m.value=[];let e=[];ct(V.value).then(o=>{e=o.data.map(p=>({name:`${p.name}(${p.hostNumber})`,id:p.id,hostNumber:p.hostNumber})),m.value.push(...e),i(!1)})},T=async()=>{const{data:e}=await dt("ZABBIX");c.value=e.map(o=>o.id)},P=async()=>{if(await T(),F.category){const e=(await pt(F.category)).data;e&&(D.value=e.name)}n.value==="group"?H():n.value==="tag"?l():n.value==="category"&&s()},K=e=>{e==="group"?H():e==="tag"?l():e==="category"&&s()},ue=e=>{const o=e.value;let p,w;o==="-1"?(p=c.value[0],w=void 0):[p,w]=o.split("/"),A("searchDataByAppKeyAndHostGroupId",p,w)},se=e=>{const o=e.id;A("searchDataByTagId",o)},oe=e=>{A("searchDataByBusinessId",e)},ne=(e,o)=>{const p=o.node.key;o.node.isLeaf?A("searchDataByCategorySubtype",p):A("searchDataByCategoryCode",p)},ie=(e,o)=>{const p=o.node;let w,N;p.key==="0"?(w=void 0,N=void 0):p.pid==="0"?(w=p.key,N=void 0):[w,N]=p.key.split("/"),A("searchDataByAppKeyAndHostGroupId",w,N)},b=v(""),C=v(!0),d=M(()=>b.value!==""?C.value?X(b.value,Y("data",B.value)):X(b.value,B.value):C.value?Y("data",B.value):B.value),Z=M(()=>b.value!==""?C.value?g.value.filter(e=>e.data!==0&&e.label.indexOf(b.value)>-1):g.value.filter(e=>e.label.indexOf(b.value)>-1):C.value?g.value.filter(e=>e.data!==0):g.value),Ae=M(()=>b.value!==""?C.value?m.value.filter(e=>e.hostNumber!==0&&e.name.indexOf(b.value)>-1):m.value.filter(e=>e.name.indexOf(b.value)>-1):C.value?m.value.filter(e=>e.hostNumber!==0):m.value),de=M(()=>b.value!==""?C.value?X(b.value,Y("data",k.value)):X(b.value,k.value):C.value?Y("data",k.value):k.value);Le.on("refresh-monitor-object-left-tree-list",e=>{e&&(_.queryStr=e.queryStr,_.enable=e.enable,_.available=e.available,_.priorityList=e.priorityList),K(n.value)});const pe=M(()=>({business:"\u76EE\u5F55",group:"\u5206\u7EC4",tag:"\u6807\u7B7E",category:"\u5206\u7C7B"})[n.value]);return Ee(()=>{P()}),(e,o)=>{const p=tt,w=at,N=lt,G=ut,De=st,Te=ot,ve=Be,Oe=ke,Se=xe,Ie=Ce;return f(),R("div",Bt,[t(N,null,{default:a(()=>[t(w,{span:24},{default:a(()=>[t(p,{modelValue:b.value,"onUpdate:modelValue":o[0]||(o[0]=O=>b.value=O),"allow-clear":!0,placeholder:`\u8F93\u5165${pe.value}\u540D\u79F0\u641C\u7D22`},null,8,["modelValue","placeholder"])]),_:1})]),_:1}),te("div",kt,[te("div",null,[t(De,{modelValue:n.value,"onUpdate:modelValue":o[1]||(o[1]=O=>n.value=O),size:"mini",bordered:!1,onChange:K},{default:a(()=>[t(G,{value:"business"},{default:a(()=>[S("\u76EE\u5F55\u89C6\u56FE")]),_:1}),t(G,{value:"group"},{default:a(()=>[S("\u5206\u7EC4\u89C6\u56FE")]),_:1}),t(G,{value:"category"},{default:a(()=>[S("\u5206\u7C7B\u89C6\u56FE")]),_:1}),t(G,{value:"tag"},{default:a(()=>[S("\u6807\u7B7E\u89C6\u56FE")]),_:1})]),_:1},8,["modelValue"])]),te("div",null,[t(Te,{modelValue:C.value,"onUpdate:modelValue":o[2]||(o[2]=O=>C.value=O)},{default:a(()=>[S("\u8FC7\u6EE4\u7A7A"+U(pe.value),1)]),_:1},8,["modelValue"])])]),n.value==="business"?(f(),L(Ft,{key:0,"search-text":b.value,"filter-empty":C.value,category:j.category,onSearch:oe},null,8,["search-text","filter-empty","category"])):E("",!0),n.value==="group"||n.value==="tag"||n.value==="category"?(f(),L(Ie,{key:1,loading:q($)||q(y)||q(I)||q(Q),tip:"\u6B63\u5728\u52A0\u8F7D...",style:{width:"100%",height:"calc(100vh - 230px)"}},{default:a(()=>[n.value==="group"?(f(),R("div",xt,[x.value?(f(),L(ye,{key:0,data:Z.value,split:!0,"virtual-list-props":{height:"calc(100vh - 230px)",buffer:20},onSelect:ue},null,8,["data","virtual-list-props"])):E("",!0),!x.value&&B.value.length>0?(f(),L(ve,{key:1,ref:"treeRef",style:{height:"calc(100vh - 230px)","overflow-y":"auto"},"block-node":"",data:d.value,"default-expanded-keys":u.value,"virtual-list-props":{height:"calc(100vh - 230px)"},onSelect:ie},{title:a(O=>[S(U(O.title)+" ("+U(O.data)+")",1)]),_:1},8,["data","default-expanded-keys","virtual-list-props"])):E("",!0)])):E("",!0),n.value==="category"?(f(),R("div",Ct,[t(Se,{style:{height:"calc(100vh - 194px)",overflow:"auto"}},{default:a(()=>[k.value.length>0?(f(),L(ve,{key:0,ref:"treeRef","block-node":"",data:de.value,"default-expanded-keys":u.value,onSelect:ne},{title:a(O=>[S(U(O.title)+" ("+U(O.data)+") ",1)]),_:1},8,["data","default-expanded-keys"])):E("",!0),ae(t(Oe,null,null,512),[[Fe,de.value.length===0]])]),_:1})])):E("",!0),n.value==="tag"?(f(),R("div",wt,[t(ye,{data:Ae.value,split:!0,"field-names":{label:"name"},"virtual-list-props":{height:"calc(100vh - 230px)",buffer:20},onSelect:se},null,8,["data","virtual-list-props"])])):E("",!0)]),_:1},8,["loading"])):E("",!0)])}}});export{Ut as _};
