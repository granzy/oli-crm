import{a as P,l as N,ad as Ee}from"./index.e9d54774.js";/* empty css               *//* empty css              *//* empty css               *//* empty css                *//* empty css               *//* empty css               */import{d as Fe,f as p,r as ke,c as xe,o as De,aT as Ae,D as g,E as y,H as v,aS as t,aI as a,u as i,aW as h,aY as c,aZ as $,bz as Be,aU as Ie,aV as ze,aH as Se,bq as A,bg as B,ch as Ve,bt as Ge,a_ as Ke,aM as He,aN as Oe,P as Pe,ag as Ne,bG as $e,cx as Le,b0 as Re,bB as qe,bE as Me,a$ as Te,aO as Ue,bo as We,aP as Ze,bp as je}from"./arco.a97fe066.js";import{p as Qe}from"./pagination.72a5f225.js";import{d as L}from"./index.127a6572.js";import{p as Xe,d as R,u as Ye,e as Je,f as ea}from"./host-group.ed397ed1.js";import{f as aa}from"./app-instance.ab836c4c.js";import"./chart.a235fbdf.js";import"./vue.4eb70094.js";const ta={class:"page-container"},oa={class:"page-panel"},na={key:0},ua={class:"selected-count"},la={style:{height:"calc(100vh - 146px)"}},sa={key:0},Ea=Fe({__name:"index",setup(ia){const{pagination:d,pageSizeOptions:q}=Qe(),b=p(),M=p(),T=p({size:"mini",height:"auto",columnConfig:{resizable:!0},showOverflow:"tooltip",rowConfig:{isHover:!0,keyField:"id"},columns:[{type:"checkbox",width:40},{title:"\u5E94\u7528",field:"appName",minWidth:120},{title:"\u5BF9\u8C61\u5206\u7EC4\u540D\u79F0",field:"name",minWidth:120},{title:"\u4E3B\u673A\u6570\u91CF",field:"hostNumber",minWidth:120},{title:"\u64CD\u4F5C",width:120,slots:{default:"action"}}]}),w=ke({keywords:""}),{loading:U,setLoading:I}=P(!1),{loading:W,setLoading:E}=P(!1),l=p([]);let F=[];const z=()=>{const e=b.value;F.forEach(o=>{const n=o.id,r=l.value.indexOf(n)!==-1;e.getRowById(n)&&e.setCheckboxRow(e.getRowById(n),r)})},m=async(e={...w,page:d})=>{I(!0);const o=b.value;try{const{data:n}=await Xe(e);F=n.content,d.total=n.totalElements,o&&await o.reloadData(n.content)}catch(n){console.error(n)}finally{I(!1),z()}},Z=e=>{d.current=e,m()},j=e=>{d.pageSize=e,m()},S=L(async()=>{await m()},500),Q=()=>{m()},_=p(!1),f=p(),s=p({id:"",name:"",zabbixHostGroupId:""}),C=p(),X=()=>{_.value=!0,f.value.resetFields(),s.value.id="",C.value=""},Y=e=>{_.value=!0,N.assign(s.value,e),C.value=N.cloneDeep(s.value.name),f.value.validate()},J=async e=>{A.warning({title:"\u63D0\u793A",titleAlign:"start",hideCancel:!1,content:`\u6B64\u64CD\u4F5C\u5C06\u6C38\u4E45\u5220\u9664\u5BF9\u8C61\u5206\u7EC4'${e.name}'\uFF0C\u662F\u5426\u7EE7\u7EED?`,onOk:async()=>{await R([e.id]),B.success("\u5220\u9664\u6210\u529F"),await m(),l.value=l.value.filter(o=>o!==e.id)}})},ee=async()=>{try{E(!0),await f.value.validate()?console.warn("\u9A8C\u8BC1\u4E0D\u901A\u8FC7"):(s.value.id?await Ye(s.value):await Je(s.value),B.success("\u63D0\u4EA4\u6210\u529F"),_.value=!1,await m())}catch(e){console.error(e),E(!1)}finally{E(!1)}};let k=!1;const ae=e=>{k=k||!!e},te=e=>{e!==C.value&&k&&s.value.name&&f.value.validateField("name")},oe=L(async(e,o)=>{try{if(e!==C.value&&s.value.appKey){const{data:n}=await ea({appKey:s.value.appKey,name:e});n&&o("\u5206\u7EC4\u5DF2\u5B58\u5728")}}catch(n){console.error(n),o("\u6821\u9A8C\u5931\u8D25")}},500),ne=e=>{const{checked:o,row:n}=e;o?l.value.push(n.id):l.value=l.value.filter(r=>r!==n.id)},V=xe(()=>F.map(e=>e.id)),ue=e=>{const{checked:o}=e;if(o){const n=V.value.filter(r=>!l.value.includes(r));l.value.push(...n)}else l.value=l.value.filter(n=>!V.value.includes(n))},G=()=>{l.value=[],z()},le=()=>{A.warning({title:"\u63D0\u793A",titleAlign:"start",hideCancel:!1,content:`\u6B64\u64CD\u4F5C\u5C06\u6C38\u4E45\u5220\u9664\u60A8\u6240\u9009\u7684${l.value.length}\u6761\u5206\u7EC4\uFF0C\u662F\u5426\u7EE7\u7EED?`,onOk:async()=>{await R(l.value),B.success("\u5220\u9664\u6210\u529F"),G(),await m()}})},K=p([]),se=async()=>{const{data:e}=await aa("ZABBIX");K.value=e.map(o=>({label:o.name,value:o.id,datasourceId:o.datasourceId}))};return De(()=>{m()}),(e,o)=>{const n=Ve,r=Ge,H=Ke,x=He,D=Oe,ie=Pe,ce=Ne,de=$e,re=Le,pe=Re,me=qe,_e=Ae("vxe-grid"),fe=Ee,ge=Me,ve=Te,he=Ue,O=We,Ce=Ze,ye=je,be=A;return g(),y("div",ta,[v("div",oa,[t(pe,null,{default:a(()=>[t(H,{span:14},{default:a(()=>[t(r,{style:{"margin-bottom":"5px"}},{default:a(()=>[t(n,{modelValue:w.keywords,"onUpdate:modelValue":o[0]||(o[0]=u=>w.keywords=u),style:{width:"320px"},placeholder:"\u5206\u7EC4\u540D\u79F0","allow-clear":"",onSearch:Q,onInput:i(S),onClear:i(S)},null,8,["modelValue","onInput","onClear"])]),_:1})]),_:1}),t(H,{span:10,style:{"text-align":"right"}},{default:a(()=>[t(r,{style:{"margin-bottom":"5px"}},{default:a(()=>[l.value.length>0?(g(),y("span",na,[v("span",ua," \u5DF2\u9009\u62E9\u4E86"+h(l.value.length)+"\u6761 ",1),t(x,{onClick:G},{default:a(()=>[c("\u6E05\u7A7A")]),_:1})])):$("",!0),t(D,{type:"primary",size:"medium",onClick:X},{default:a(()=>[c(h(e.$t("button.create")),1)]),_:1}),t(re,null,{icon:a(()=>[t(ie)]),content:a(()=>[t(de,{disabled:l.value.length===0,onClick:le},{default:a(()=>[t(ce),c(" \u5220\u9664 ")]),_:1},8,["disabled"])]),default:a(()=>[c(" \u7BA1\u7406 ")]),_:1})]),_:1})]),_:1})]),_:1}),v("div",la,[t(_e,Be({ref_key:"xGrid",ref:b,loading:i(U)},T.value,{onCheckboxChange:ne,onCheckboxAll:ue}),{index:a(({rowIndex:u})=>[c(h(u+1+(i(d).current-1)*i(d).pageSize),1)]),action:a(({row:u})=>[t(r,null,{default:a(()=>[t(x,{onClick:we=>Y(u)},{default:a(()=>[c("\u7F16\u8F91")]),_:2},1032,["onClick"]),t(x,{type:"text",onClick:we=>J(u)},{default:a(()=>[c("\u5220\u9664")]),_:2},1032,["onClick"])]),_:2},1024)]),pager:a(()=>[t(me,{ref_key:"xPagination",ref:M,current:i(d).current,"page-size":i(d).pageSize,total:i(d).total,"page-size-options":i(q),style:{"padding-top":"10px"},"show-total":"","show-jumper":"","show-page-size":"",onChange:Z,onPageSizeChange:j},null,8,["current","page-size","total","page-size-options"])]),_:1},16,["loading"])])]),t(be,{visible:_.value,width:"auto","title-align":"start","mask-closable":!1,draggable:"",onBeforeOpen:se},{title:a(()=>[c(h(s.value.id?"\u7F16\u8F91\u5206\u7EC4":"\u65B0\u5EFA\u5206\u7EC4"),1)]),footer:a(()=>[t(D,{onClick:o[3]||(o[3]=u=>_.value=!1)},{default:a(()=>[c("\u53D6\u6D88")]),_:1}),t(D,{type:"primary",loading:i(W),onClick:ee},{default:a(()=>[c(" \u786E\u5B9A ")]),_:1},8,["loading"])]),default:a(()=>[v("div",null,[t(ye,{ref_key:"submitFormRef",ref:f,model:s.value,style:{width:"540px"}},{default:a(()=>[t(O,{field:"appKey",label:"\u5E94\u7528",rules:[{required:!0,message:"\u8BF7\u9009\u62E9\u5E94\u7528"},{validator:te}],"validate-trigger":"change"},{default:a(()=>[t(he,{modelValue:s.value.appKey,"onUpdate:modelValue":o[1]||(o[1]=u=>s.value.appKey=u),disabled:s.value.id!=="",onChange:ae},{default:a(()=>[(g(!0),y(Ie,null,ze(K.value,u=>(g(),Se(ve,{key:u.value,value:u.value,disabled:u.datasourceId==""},{default:a(()=>[v("div",null,[c(h(u.label)+" ",1),u.datasourceId==""?(g(),y("span",sa,[t(ge,{content:"\u5E94\u7528\u672A\u5173\u8054\u6570\u636E\u6E90",placement:"top",trigger:"hover"},{default:a(()=>[t(fe)]),_:1})])):$("",!0)])]),_:2},1032,["value","disabled"]))),128))]),_:1},8,["modelValue","disabled"])]),_:1},8,["rules"]),t(O,{field:"name",label:"\u5206\u7EC4\u540D\u79F0",rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u5206\u7EC4\u540D\u79F0"},{validator:i(oe)}],"validate-trigger":"blur"},{default:a(()=>[t(Ce,{modelValue:s.value.name,"onUpdate:modelValue":o[2]||(o[2]=u=>s.value.name=u)},null,8,["modelValue"])]),_:1},8,["rules"])]),_:1},8,["model"])])]),_:1},8,["visible"])])}}});export{Ea as default};
