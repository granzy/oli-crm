import{a as se,l as T,as as O,N as Ge,at as $e,au as ze,av as Me}from"./index.e9d54774.js";/* empty css              *//* empty css               *//* empty css                *//* empty css               *//* empty css                *//* empty css                *//* empty css               */import{d as We,f as A,r as qe,c as Ne,o as Te,aT as Oe,D as o,E as D,H as J,aS as i,aI as s,u as n,aU as R,aV as x,aH as g,aY as c,aW as _,G as C,bz as je,aZ as b,bg as ie,n as He,bq as Ze,ch as Ye,cf as Je,a$ as Ke,cg as Qe,aO as Xe,bt as et,a_ as tt,aN as ut,b0 as at,aM as lt,bB as st,aP as it,bo as ot,bs as nt,bZ as dt,bv as rt,bp as ct,bi as pt}from"./arco.a97fe066.js";import{v as mt,a as K,b as Q}from"./validate.dea67cb4.js";import{p as gt}from"./pagination.72a5f225.js";import{c as vt,a as ft}from"./role.255dbbaf.js";import{d as oe}from"./index.127a6572.js";import{c as ne}from"./color.562bf6e9.js";import"./chart.a235fbdf.js";import"./vue.4eb70094.js";const Lt={class:"page-container"},ht={class:"page-panel"},Ft={style:{height:"calc(100vh - 146px)"}},Gt=We({__name:"index",setup(wt){const{loading:de,setLoading:X}=se(!1),re=ne("success-6"),ce=ne("danger-6"),{loading:pe,setLoading:ee}=se(!1),{pagination:E,pageSizeOptions:me}=gt(),te=A(),ge=A(),ve=A({size:"mini",height:"auto",columnConfig:{resizable:!0},showOverflow:"tooltip",columns:[{title:"\u7528\u6237\u540D\u79F0",field:"username",minWidth:120},{title:"\u767B\u5F55\u540D\u79F0",field:"account",minWidth:120},{title:"\u90E8\u95E8",minWidth:120,slots:{default:"orgGroupList"}},{title:"\u89D2\u8272",minWidth:120,slots:{default:"userRoleList"}},{title:"\u5141\u8BB8\u767B\u5F55",field:"status",minWidth:120,slots:{default:"status"}},{title:"\u90AE\u7BB1",minWidth:120,slots:{default:"mailList"}},{title:"\u624B\u673A",minWidth:120,slots:{default:"phoneList"}},{title:"\u4F01\u4E1A\u5FAE\u4FE1",minWidth:120,slots:{default:"wechatList"}},{title:"\u9489\u9489",minWidth:120,slots:{default:"dingdingList"}},{title:"\u63CF\u8FF0",field:"description",minWidth:120},{title:"\u521B\u5EFA\u65F6\u95F4",field:"createTime",width:200},{title:"\u64CD\u4F5C",width:120,fixed:"right",slots:{default:"action"}}]}),V=qe({queryStr:"",orgGroupIds:[],userRoleId:""}),I=async(t={...V,page:E})=>{X(!0);const u=te.value;try{const{data:d}=await Ge(t);E.total=d.totalElements,u&&await u.reloadData(d.content)}catch(d){console.error(d)}finally{X(!1)}},fe=t=>{E.current=t,I()},Le=t=>{E.pageSize=t,I()},he=()=>{I()},U=oe(async()=>{await I()},500),G=A(!1),$=A(),k=t=>[{account:"",type:t,sortIndex:0}],e=A({id:"",account:"",username:"",password:"",confirmPassword:"",description:"",status:!0,phoneList:k("phone"),mailList:k("mail"),wechatList:k("wechat"),dingdingList:k("dingding"),mediasList:[],orgGroupList:[],orgGroupIdList:[],userRoleList:[],userRoleIdList:[]}),Fe=Ne(()=>{const t=T.cloneDeep(e);return t.value.status=e.value.status?O.ENABLED:O.DISABLED,t.value.mediasList=[],e.value.phoneList&&(t.value.mediasList=t.value.mediasList.concat(e.value.phoneList.filter(u=>u.account!==""))),e.value.mailList&&(t.value.mediasList=t.value.mediasList.concat(e.value.mailList.filter(u=>u.account!==""))),e.value.wechatList&&(t.value.mediasList=t.value.mediasList.concat(e.value.wechatList.filter(u=>u.account!==""))),e.value.dingdingList&&(t.value.mediasList=t.value.mediasList.concat(e.value.dingdingList.filter(u=>u.account!==""))),e.value.orgGroupIdList&&(t.value.orgGroupList=e.value.orgGroupIdList.map(u=>({id:u}))),e.value.userRoleIdList&&(t.value.userRoleList=e.value.userRoleIdList.map(u=>({id:u}))),delete t.value.phoneList,delete t.value.mailList,delete t.value.wechatList,delete t.value.dingdingList,t.value}),ue=()=>{e.value.phoneList=k("phone"),e.value.mailList=k("mail"),e.value.wechatList=k("wechat"),e.value.dingdingList=k("dingding")},we=async()=>{ee(!0),await $.value.validate()?console.warn("\u9A8C\u8BC1\u4E0D\u901A\u8FC7"):(await $e(Fe.value),ie.success(e.value.id?"\u7528\u6237\u66F4\u65B0\u6210\u529F":"\u7528\u6237\u4FDD\u5B58\u6210\u529F"),G.value=!1,await I()),ee(!1)};let j;const Be=()=>{e.value.id="",j="",G.value=!0,He(()=>{$.value.resetFields(),ue()})},M=t=>t.length===1?t:t.filter(u=>u.account!==""),_e=t=>{t.phoneList&&(t.phoneList=M(t.phoneList)),t.mailList&&(t.mailList=M(t.mailList)),t.wechatList&&(t.wechatList=M(t.wechatList)),t.dingdingList&&(t.dingdingList=M(t.dingdingList))},Ce=t=>{var u,d,m,h,F,S;G.value=!0,ue(),T.assign(e.value,T.cloneDeep(t)),j=T.cloneDeep(e.value.account),e.value.status=t.status===O.ENABLED,(u=e.value.mediasList)==null||u.forEach(r=>{var p;r.type==="phone"&&((p=e.value.phoneList)==null||p.push(r))}),(d=e.value.mediasList)==null||d.forEach(r=>{var p;r.type==="mail"&&((p=e.value.mailList)==null||p.push(r))}),(m=e.value.mediasList)==null||m.forEach(r=>{var p;r.type==="wechat"&&((p=e.value.wechatList)==null||p.push(r))}),(h=e.value.mediasList)==null||h.forEach(r=>{var p;r.type==="dingding"&&((p=e.value.dingdingList)==null||p.push(r))}),e.value.mediasList=[],_e(e.value),e.value.orgGroupIdList=(F=e.value.orgGroupList)==null?void 0:F.map(r=>r.id),e.value.userRoleIdList=(S=e.value.userRoleList)==null?void 0:S.map(r=>r.id),$.value.validate()},be=async t=>{Ze.warning({title:"\u63D0\u793A",titleAlign:"start",hideCancel:!1,content:`\u7528\u6237${t.username}\u5220\u9664\u540E\uFF0C\u6240\u6709\u5173\u8054\u8BE5\u7528\u6237\u7684\u7B56\u7565\u5C06\u81EA\u52A8\u79FB\u9664\u8BE5\u7528\u6237\uFF0C\u8BF7\u8C28\u614E\u64CD\u4F5C\u3002\u662F\u5426\u786E\u8BA4\u5220\u9664\u64CD\u4F5C\uFF1F`,onOk:async()=>{await ze(t.id),ie.success("\u5220\u9664\u6210\u529F"),await I()}})},W=t=>{var u,d,m,h,F,S,r,p;if(t==="phone"){const y=(u=e.value.phoneList)==null?void 0:u.length;(d=e.value.phoneList)==null||d.push({account:"",type:t,sortIndex:y})}else if(t==="mail"){const y=(m=e.value.mailList)==null?void 0:m.length;(h=e.value.mailList)==null||h.push({account:"",type:t,sortIndex:y})}else if(t==="wechat"){const y=(F=e.value.mailList)==null?void 0:F.length;(S=e.value.wechatList)==null||S.push({account:"",type:t,sortIndex:y})}else if(t==="dingding"){const y=(r=e.value.mailList)==null?void 0:r.length;(p=e.value.dingdingList)==null||p.push({account:"",type:t,sortIndex:y})}},q=(t,u)=>{var d,m,h,F;t==="phone"?(d=e.value.phoneList)==null||d.splice(u,1):t==="mail"?(m=e.value.mailList)==null||m.splice(u,1):t==="wechat"?(h=e.value.wechatList)==null||h.splice(u,1):t==="dingding"&&((F=e.value.dingdingList)==null||F.splice(u,1))},N=(t,u)=>{var d;return(d=t.mediasList)==null?void 0:d.filter(m=>m.type===u).map(m=>m.account).join(",")},z=A([]),H=A([]),Ee=async()=>{z.value=(await vt()).data,z.value=z.value.filter(t=>t.value!=="0"),H.value=(await ft()).data};Te(()=>{Ee(),I()});const ye=oe(async(t,u)=>{if(t!==j){const{data:d}=await Me(t);d&&u("\u8D26\u6237\u5DF2\u5B58\u5728")}},500);let Z=!1;const De=t=>{const{value:u}=t.target;Z=Z||!!u},ke=(t,u)=>{const d=e.value.confirmPassword;t&&Z&&d&&$.value.validateField("confirmPassword"),u()},Ae=(t,u)=>{t&&t!==e.value.password&&u("\u60A8\u8F93\u5165\u7684\u4E24\u4E2A\u5BC6\u7801\u4E0D\u4E00\u81F4!")};return(t,u)=>{const d=Ye,m=Je,h=Ke,F=Qe,S=Xe,r=et,p=tt,y=ut,Ve=at,w=lt,Ie=st,Se=Oe("vxe-grid"),P=it,L=ot,ae=nt,Ue=dt,Pe=rt,Re=ct,xe=pt;return o(),D("div",Lt,[J("div",ht,[i(Ve,null,{default:s(()=>[i(p,{span:14},{default:s(()=>[i(r,{style:{"margin-bottom":"5px"}},{default:s(()=>[i(d,{modelValue:V.queryStr,"onUpdate:modelValue":u[0]||(u[0]=a=>V.queryStr=a),style:{width:"320px"},placeholder:"\u7528\u6237\u540D\u79F0/\u767B\u5F55\u540D\u79F0","allow-clear":"",onSearch:he,onInput:n(U),onClear:n(U)},null,8,["modelValue","onInput","onClear"]),i(m,{modelValue:V.orgGroupIds,"onUpdate:modelValue":u[1]||(u[1]=a=>V.orgGroupIds=a),style:{minWidth:"200px"},placeholder:"\u90E8\u95E8",options:z.value,"max-tag-count":1,multiple:"","allow-clear":"","check-strictly":"",onChange:n(U),onClear:n(U)},null,8,["modelValue","options","onChange","onClear"]),i(S,{modelValue:V.userRoleId,"onUpdate:modelValue":u[2]||(u[2]=a=>V.userRoleId=a),style:{minWidth:"200px"},placeholder:"\u89D2\u8272","allow-clear":"",onChange:n(U),onClear:n(U)},{default:s(()=>[(o(!0),D(R,null,x(H.value,(a,l)=>(o(),g(F,{key:l,label:a.label},{default:s(()=>[(o(!0),D(R,null,x(a.children,(v,f)=>(o(),g(h,{key:f,value:v.value},{default:s(()=>[c(_(v.label),1)]),_:2},1032,["value"]))),128))]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue","onChange","onClear"])]),_:1})]),_:1}),i(p,{span:10,style:{"text-align":"right"}},{default:s(()=>[i(r,{style:{"margin-bottom":"5px"}},{default:s(()=>[i(y,{type:"primary",size:"medium",onClick:Be},{default:s(()=>[c(_(t.$t("button.create")),1)]),_:1})]),_:1})]),_:1})]),_:1}),J("div",Ft,[i(Se,je({ref_key:"xGrid",ref:te,loading:n(de)},ve.value),{index:s(({rowIndex:a})=>[c(_(a+1+(n(E).current-1)*n(E).pageSize),1)]),phoneList:s(({row:a})=>[c(_(N(a,"phone")),1)]),wechatList:s(({row:a})=>[c(_(N(a,"wechat")),1)]),dingdingList:s(({row:a})=>[c(_(N(a,"dingding")),1)]),mailList:s(({row:a})=>[c(_(N(a,"mail")),1)]),orgGroupList:s(({row:a})=>[c(_(a.orgGroupList.map(l=>l.name).join(",")),1)]),userRoleList:s(({row:a})=>[c(_(a.userRoleList.map(l=>l.name).join(",")),1)]),status:s(({row:a})=>[a.status===n(O).ENABLED?(o(),D("span",{key:0,style:C({color:n(re)})}," \u5141\u8BB8 ",4)):(o(),D("span",{key:1,style:C({color:n(ce)})},"\u7981\u6B62",4))]),action:s(({row:a})=>[i(r,null,{default:s(()=>[i(w,{onClick:l=>Ce(a)},{default:s(()=>[c("\u7F16\u8F91")]),_:2},1032,["onClick"]),i(w,{type:"text",onClick:l=>be(a)},{default:s(()=>[c("\u5220\u9664")]),_:2},1032,["onClick"])]),_:2},1024)]),pager:s(()=>[i(Ie,{ref_key:"xPagination",ref:ge,current:n(E).current,"page-size":n(E).pageSize,total:n(E).total,"page-size-options":n(me),style:{"padding-top":"10px"},"show-total":"","show-jumper":"","show-page-size":"",onChange:fe,onPageSizeChange:Le},null,8,["current","page-size","total","page-size-options"])]),_:1},16,["loading"])])]),i(xe,{visible:G.value,width:"50%","title-align":"start","ok-loading":n(pe),"mask-closable":!1,onOk:we,onCancel:u[15]||(u[15]=a=>G.value=!1)},{title:s(()=>[c(_(e.value.id?"\u7F16\u8F91\u7528\u6237":"\u65B0\u5EFA\u7528\u6237"),1)]),default:s(()=>[J("div",null,[i(Re,{ref_key:"submitFormRef",ref:$,autocomplete:"off",model:e.value,style:{width:"90%"}},{default:s(()=>[i(L,{field:"username",label:"\u7528\u6237\u540D\u79F0",rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u540D\u79F0"},{maxLength:64,message:"\u540D\u79F0\u957F\u5EA6\u6700\u5927\u4E0D\u80FD\u8D85\u8FC764"}],"validate-trigger":"blur"},{default:s(()=>[i(P,{modelValue:e.value.username,"onUpdate:modelValue":u[3]||(u[3]=a=>e.value.username=a),autocomplete:"off"},null,8,["modelValue"])]),_:1}),i(L,{field:"account",label:"\u767B\u5F55\u8D26\u53F7",rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u767B\u5F55\u8D26\u6237"},{maxLength:64,message:"\u767B\u5F55\u8D26\u6237\u957F\u5EA6\u6700\u5927\u4E0D\u80FD\u8D85\u8FC764"},{validator:n(ye)}],"validate-trigger":"blur"},{default:s(()=>[i(P,{modelValue:e.value.account,"onUpdate:modelValue":u[4]||(u[4]=a=>e.value.account=a),autocomplete:"off"},null,8,["modelValue"])]),_:1},8,["rules"]),e.value.id?b("",!0):(o(),g(L,{key:0,field:"password",label:"\u5BC6\u7801",rules:[{required:!e.value.id,message:"\u8BF7\u8F93\u5165\u5BC6\u7801"},{match:n(mt),message:"\u5BC6\u7801\u5FC5\u987B\u5305\u542B\u5927\u5C0F\u5199\u5B57\u6BCD,\u6570\u5B57,\u7279\u6B8A\u5B57\u7B26,\u81F3\u5C118\u4E2A\u5B57\u7B26\uFF0C\u6700\u591A30\u4E2A\u5B57\u7B26"},{validator:ke}],"validate-trigger":"blur"},{default:s(()=>[i(ae,{modelValue:e.value.password,"onUpdate:modelValue":u[5]||(u[5]=a=>e.value.password=a),modelModifiers:{trim:!0},autocomplete:"new-password",onBlur:De},null,8,["modelValue"])]),_:1},8,["rules"])),e.value.id?b("",!0):(o(),g(L,{key:1,field:"confirmPassword",label:"\u786E\u8BA4\u5BC6\u7801",rules:[{required:!e.value.id,message:"\u8BF7\u8F93\u5165\u786E\u8BA4\u5BC6\u7801"},{validator:Ae,message:"\u60A8\u8F93\u5165\u7684\u4E24\u4E2A\u5BC6\u7801\u4E0D\u4E00\u81F4"}],"validate-trigger":"blur"},{default:s(()=>[i(ae,{modelValue:e.value.confirmPassword,"onUpdate:modelValue":u[6]||(u[6]=a=>e.value.confirmPassword=a),modelModifiers:{trim:!0},autocomplete:"new-password"},null,8,["modelValue"])]),_:1},8,["rules"])),(o(!0),D(R,null,x(e.value.phoneList,(a,l)=>(o(),g(L,{key:l,field:`phoneList[${l}].value`,label:l===0?"\u624B\u673A":"\u624B\u673A"+l},{default:s(()=>{var v,f,B,le;return[i(P,{modelValue:a.account,"onUpdate:modelValue":Y=>a.account=Y},null,8,["modelValue","onUpdate:modelValue"]),n(K)(a.account)&&e.value.phoneList&&l===((v=e.value.phoneList)==null?void 0:v.length)-1||l===0&&((f=e.value.phoneList)==null?void 0:f.length)===1?(o(),g(w,{key:0,style:C([{width:"40px"},{marginLeft:"10px"}]),disabled:!n(K)(a.account),onClick:u[7]||(u[7]=Y=>W("phone"))},{default:s(()=>[c(" \u6DFB\u52A0 ")]),_:2},1032,["disabled"])):b("",!0),!(n(K)(a.account)&&e.value.phoneList&&l===((B=e.value.phoneList)==null?void 0:B.length)-1)&&(l>0||e.value.phoneList&&((le=e.value.phoneList)==null?void 0:le.length)>1)?(o(),g(w,{key:1,style:C([{width:"40px"},{marginLeft:"10px"}]),onClick:Y=>q("phone",l)},{default:s(()=>[c(" \u79FB\u9664 ")]),_:2},1032,["onClick"])):b("",!0)]}),_:2},1032,["field","label"]))),128)),(o(!0),D(R,null,x(e.value.mailList,(a,l)=>(o(),g(L,{key:l,field:`mailList[${l}].value`,label:l===0?"\u90AE\u7BB1":"\u90AE\u7BB1"+l},{default:s(()=>{var v,f;return[i(P,{modelValue:a.account,"onUpdate:modelValue":B=>a.account=B},null,8,["modelValue","onUpdate:modelValue"]),n(Q)(a.account)&&e.value.mailList&&l===((v=e.value.mailList)==null?void 0:v.length)-1||l===0&&((f=e.value.mailList)==null?void 0:f.length)===1?(o(),g(w,{key:0,style:C([{width:"40px"},{marginLeft:"10px"}]),disabled:!n(Q)(a.account),onClick:u[8]||(u[8]=B=>W("mail"))},{default:s(()=>[c(" \u6DFB\u52A0 ")]),_:2},1032,["disabled"])):b("",!0),!(n(Q)(a.account)&&e.value.mailList&&l===e.value.mailList.length-1)&&(l>0||e.value.mailList&&e.value.mailList.length>1)?(o(),g(w,{key:1,style:C([{width:"40px"},{marginLeft:"10px"}]),onClick:B=>q("mail",l)},{default:s(()=>[c(" \u79FB\u9664 ")]),_:2},1032,["onClick"])):b("",!0)]}),_:2},1032,["field","label"]))),128)),(o(!0),D(R,null,x(e.value.wechatList,(a,l)=>(o(),g(L,{key:l,field:`wechatList[${l}].value`,label:l===0?"\u4F01\u4E1A\u5FAE\u4FE1":"\u4F01\u4E1A\u5FAE\u4FE1"+l},{default:s(()=>{var v,f;return[i(P,{modelValue:a.account,"onUpdate:modelValue":B=>a.account=B},null,8,["modelValue","onUpdate:modelValue"]),a.account!==""&&e.value.wechatList&&l===e.value.wechatList.length-1||l===0&&((v=e.value.wechatList)==null?void 0:v.length)===1?(o(),g(w,{key:0,style:C([{width:"40px"},{marginLeft:"10px"}]),disabled:a.account==="",onClick:u[9]||(u[9]=B=>W("wechat"))},{default:s(()=>[c(" \u6DFB\u52A0 ")]),_:2},1032,["disabled"])):b("",!0),!(a.account!==""&&e.value.wechatList&&l===e.value.wechatList.length-1)&&(l>0||e.value.wechatList&&((f=e.value.wechatList)==null?void 0:f.length)>1)?(o(),g(w,{key:1,style:C([{width:"40px"},{marginLeft:"10px"}]),onClick:B=>q("wechat",l)},{default:s(()=>[c(" \u79FB\u9664 ")]),_:2},1032,["onClick"])):b("",!0)]}),_:2},1032,["field","label"]))),128)),(o(!0),D(R,null,x(e.value.dingdingList,(a,l)=>(o(),g(L,{key:l,field:`dingdingList[${l}].value`,label:l===0?"\u9489\u9489":"\u9489\u9489"+l},{default:s(()=>{var v;return[i(P,{modelValue:a.account,"onUpdate:modelValue":f=>a.account=f},null,8,["modelValue","onUpdate:modelValue"]),a.account!==""&&e.value.dingdingList&&l===e.value.dingdingList.length-1||l===0&&((v=e.value.dingdingList)==null?void 0:v.length)===1?(o(),g(w,{key:0,style:C([{width:"40px"},{marginLeft:"10px"}]),disabled:a.account==="",onClick:u[10]||(u[10]=f=>W("dingding"))},{default:s(()=>[c(" \u6DFB\u52A0 ")]),_:2},1032,["disabled"])):b("",!0),!(a.account!==""&&e.value.dingdingList&&l===e.value.dingdingList.length-1)&&(l>0||e.value.dingdingList&&e.value.dingdingList.length>1)?(o(),g(w,{key:1,style:C([{width:"40px"},{marginLeft:"10px"}]),onClick:f=>q("dingding",l)},{default:s(()=>[c(" \u79FB\u9664 ")]),_:2},1032,["onClick"])):b("",!0)]}),_:2},1032,["field","label"]))),128)),i(L,{field:"status",label:"\u7528\u6237\u72B6\u6001","validate-trigger":"blur"},{default:s(()=>[i(Ue,{modelValue:e.value.status,"onUpdate:modelValue":u[11]||(u[11]=a=>e.value.status=a),"default-value":!0},{default:s(()=>[c(" \u5141\u8BB8\u767B\u5F55 ")]),_:1},8,["modelValue"])]),_:1}),i(L,{field:"orgGroupIdList",label:"\u90E8\u95E8"},{default:s(()=>[i(m,{modelValue:e.value.orgGroupIdList,"onUpdate:modelValue":u[12]||(u[12]=a=>e.value.orgGroupIdList=a),options:z.value,multiple:"","check-strictly":""},null,8,["modelValue","options"])]),_:1}),i(L,{field:"userRoleIdList",label:"\u89D2\u8272",rules:[{required:!0,message:"\u8BF7\u81F3\u5C11\u9009\u62E9\u4E00\u4E2A\u89D2\u8272"}]},{default:s(()=>[i(m,{modelValue:e.value.userRoleIdList,"onUpdate:modelValue":u[13]||(u[13]=a=>e.value.userRoleIdList=a),options:H.value,multiple:""},null,8,["modelValue","options"])]),_:1}),i(L,{field:"description",label:"\u63CF\u8FF0","validate-trigger":"blur",rules:[{maxLength:500,message:"\u63CF\u8FF0\u957F\u5EA6\u6700\u5927\u4E0D\u80FD\u8D85\u8FC7500"}]},{default:s(()=>[i(Pe,{modelValue:e.value.description,"onUpdate:modelValue":u[14]||(u[14]=a=>e.value.description=a),"show-word-limit":"","max-length":500},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])])]),_:1},8,["visible","ok-loading"])])}}});export{Gt as default};
