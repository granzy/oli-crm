import{l as ae,a as K}from"./index.e9d54774.js";/* empty css                */import{d as Z,f as d,c as W,w as re,D as v,aH as M,aI as u,aY as p,aW as h,aS as a,u as g,H as w,E as z,aZ as ee,aU as Ke,aV as Ze,bg as H,aP as X,bo as de,bv as pe,bX as ce,c7 as Je,c8 as He,bs as me,aj as be,aN as J,a3 as ve,bh as _e,a$ as Xe,aO as Ye,be as Qe,bE as ue,bp as fe,bi as Fe,r as ge,o as Ee,aT as De,bz as Be,bq as ye,bt as Ce,a_ as Ve,b0 as xe,aM as Ae,bK as we,bY as he,bB as ze,c3 as ea,c4 as aa}from"./arco.a97fe066.js";/* empty css              *//* empty css               *//* empty css                *//* empty css                *//* empty css               */import{s as ke,t as Ue,g as Pe,a as ua,b as Le,c as Te,d as $e}from"./datasource.5313e56a.js";import{f as Se}from"./dict.7add4266.js";import{d as Ie}from"./index.127a6572.js";/* empty css                *//* empty css               *//* empty css               */import{p as Oe}from"./pagination.72a5f225.js";import"./chart.a235fbdf.js";import"./vue.4eb70094.js";const ta=w("div",null,[w("div",null,[w("b",null,"\u5168\u5C40\u8D26\u6237\u6A21\u5F0F:"),p(" \u6240\u6709\u7528\u6237\u90FD\u4F1A\u4F7F\u7528\u4E0B\u65B9\u7684\u8D26\u6237\u5BF9zabbix\u8FDB\u884C\u64CD\u4F5C; ")]),w("div",null,[w("b",null,"\u7EDF\u4E00\u5BC6\u7801\u6A21\u5F0F:"),p(" \u7528\u6237\u5C06\u4F7F\u7528\u5176\u81EA\u5DF1\u7684zabbix\u8D26\u6237\u8FDB\u884C\u64CD\u4F5C(\u7528\u6237zabbix\u8D26\u6237\u5728\u7528\u6237\u7BA1\u7406\u4E2D\u914D\u7F6E); ")]),w("div",null,[w("b",null,"TOKEN\u8BA4\u8BC1\u6A21\u5F0F:"),p(" \u5C06\u4F7F\u7528\u4E0B\u65B9\u8D26\u6237\u5728zabbix\u521B\u5EFA\u4E0E\u5F53\u524D\u767B\u5F55\u8D26\u6237\u540C\u540D\u7684zabbix\u8D26\u6237\u7684API TOKEN\u8FDB\u884C\u64CD\u4F5C; ")]),p(" \u7CFB\u7EDF\u4EFB\u52A1\u5C06\u59CB\u7EC8\u4F7F\u7528\u4E0B\u65B9\u7684\u8D26\u6237\u8FDB\u884C\u64CD\u4F5C; ")],-1),la={key:0},oa={key:1},sa={key:0},na={key:1},ie="useUnicode=true&characterEncoding=utf-8&useSSL=false&serverTimezone=GMT&allowMultiQueries=true",ia=Z({__name:"datasource-draw-form",props:{modelValue:{},visible:{type:Boolean,default:!1}},emits:["ok","cancel"],setup(j,{emit:k}){const T=k,E=j,e=d({id:"",name:"",description:"",zabbixApi:{url:"",username:"",password:"",useGlobal:!0,tokenGenerateType:"GLOBAL"},database:{name:"",type:"mysql",host:"",port:3306,username:"",password:"",url:"",extra:ie}}),r=W(()=>`${e.value.zabbixApi.url}/api_jsonrpc.php`),A=W(()=>{let l=`jdbc:${e.value.database.type}`;return e.value.database.host&&(l+=`://${e.value.database.host}`),e.value.database.port&&(l+=`:${e.value.database.port}`),e.value.database.name&&(l+=`/${e.value.database.name}`),e.value.database.extra&&(l+=`?${e.value.database.extra}`),l}),$=W({get(){const l=ae.cloneDeep(e.value.database);return l.url=A.value,{id:e.value.id,name:e.value.name,url:r.value,createUser:e.value.createUser,createTime:e.value.createTime,username:e.value.zabbixApi.username,password:e.value.zabbixApi.password,useGlobal:e.value.zabbixApi.useGlobal,type:"ZABBIX",extension:JSON.stringify({database:l,tokenGenerateType:e.value.zabbixApi.tokenGenerateType}),description:e.value.description}},set(l){e.value.id=l.id,e.value.name=l.name,e.value.description=l.description,e.value.createUser=l.createUser,e.value.createTime=l.createTime,e.value.zabbixApi.url=l.url.replace("/api_jsonrpc.php",""),e.value.zabbixApi.username=l.username,e.value.zabbixApi.password=l.password,e.value.zabbixApi.useGlobal=l.useGlobal;const{tokenGenerateType:t}=JSON.parse(l.extension);e.value.zabbixApi.tokenGenerateType=t||"GLOBAL",e.value.database=JSON.parse(l.extension).database}}),B=d([]),D=d(),U=l=>{l==="mysql"?e.value.database.extra=ie:e.value.database.extra=""},m=async()=>{await D.value.validate()?console.warn("\u9A8C\u8BC1\u4E0D\u901A\u8FC7"):(await ke($.value),H.success("\u63D0\u4EA4\u6210\u529F"),T("ok"))},S=()=>{T("cancel")},V=d(),b=d(),I=d(),x=d(!1),{loading:O,setLoading:o}=K(!1),F=async()=>{if(o(!0),!await D.value.validateField("zabbixApi.url","zabbixApi.username","zabbixApi.password")){const{data:t}=await Ue({url:`${e.value.zabbixApi.url}/api_jsonrpc.php`,username:e.value.zabbixApi.username,password:e.value.zabbixApi.password});V.value=t.result,b.value=t.version,I.value=t.errorMessage,x.value=!0}o(!1)},c=d(""),_=Ie(async(l,t)=>{if(l!==c.value){const{data:f}=await Pe(l);f&&f.length>0&&t("\u6570\u636E\u6E90\u540D\u79F0\u5DF2\u5B58\u5728")}},500),n=d(),s=d(),y=d(!1),{loading:P,setLoading:q}=K(!1),R=async()=>{if(q(!0),!await D.value.validateField(["database.name","database.host","database.port","database.username","database.password"])){const t={jdbcUrl:A.value,username:e.value.database.username,password:e.value.database.password},{data:f}=await ua(t);n.value=f.result,s.value=f.errorMessage,y.value=!0}q(!1)},G=()=>{E.modelValue?D.value.clearValidate():(D.value.resetFields(),e.value.id=""),x.value=!1,y.value=!1},N=async()=>{B.value=(await Se("\u6570\u636E\u5E93\u7C7B\u578B")).data,G()};return re(()=>E.modelValue,l=>{l&&($.value=l,c.value=l.name)},{deep:!0,immediate:!0}),(l,t)=>{const f=X,C=de,Y=pe,L=ce,Q=Je,Re=He,te=me,le=be,oe=J,se=ve,ne=_e,qe=Xe,Me=Ye,Ge=Qe,Ne=ue,je=fe,We=Fe;return v(),M(We,{visible:l.visible,width:"50%","title-align":"start","mask-closable":!1,onOk:m,onBeforeOpen:N,onCancel:S},{title:u(()=>[p(h(E.modelValue?"\u7F16\u8F91":"\u65B0\u5EFA")+"zabbix\u6570\u636E\u6E90 ",1)]),default:u(()=>[a(je,{ref_key:"submitFormRef",ref:D,model:e.value},{default:u(()=>[a(C,{field:"name",label:"\u540D\u79F0",rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u540D\u79F0"},{maxLength:64,message:"\u540D\u79F0\u957F\u5EA6\u6700\u5927\u4E0D\u80FD\u8D85\u8FC764"},{validator:g(_)}],"validate-trigger":"blur"},{default:u(()=>[a(f,{modelValue:e.value.name,"onUpdate:modelValue":t[0]||(t[0]=i=>e.value.name=i),placeholder:"\u8BF7\u8F93\u5165\u540D\u79F0"},null,8,["modelValue"])]),_:1},8,["rules"]),a(C,{field:"description",label:"\u63CF\u8FF0","validate-trigger":"blur"},{default:u(()=>[a(Y,{modelValue:e.value.description,"onUpdate:modelValue":t[1]||(t[1]=i=>e.value.description=i),placeholder:"\u8BF7\u8F93\u5165\u63CF\u8FF0","show-word-limit":"","max-length":500},null,8,["modelValue"])]),_:1}),a(L,{orientation:"left"},{default:u(()=>[p("API")]),_:1}),a(C,{field:"zabbixApi.url",rules:[{required:!0,message:"\u8BF7\u8F93\u5165zabbix api url"}],"validate-trigger":"blur",label:"URL"},{default:u(()=>[a(f,{modelValue:e.value.zabbixApi.url,"onUpdate:modelValue":t[2]||(t[2]=i=>e.value.zabbixApi.url=i)},{append:u(()=>[p("/api_jsonrpc.php")]),_:1},8,["modelValue"])]),_:1}),a(C,{field:"database.useGlobal",label:"\u8BA4\u8BC1\u65B9\u5F0F"},{extra:u(()=>[ta]),default:u(()=>[a(Re,{modelValue:e.value.zabbixApi.tokenGenerateType,"onUpdate:modelValue":t[3]||(t[3]=i=>e.value.zabbixApi.tokenGenerateType=i),type:"button"},{default:u(()=>[a(Q,{value:"GLOBAL"},{default:u(()=>[p("\u5168\u5C40\u8D26\u6237\u6A21\u5F0F")]),_:1}),a(Q,{value:"UNIFIED_PASSWORD"},{default:u(()=>[p("\u7EDF\u4E00\u5BC6\u7801\u6A21\u5F0F")]),_:1}),a(Q,{value:"TOKEN"},{default:u(()=>[p("TOKEN\u8BA4\u8BC1\u6A21\u5F0F")]),_:1})]),_:1},8,["modelValue"])]),_:1}),a(C,{field:"zabbixApi.username",label:"\u7528\u6237\u540D",rules:[{required:!0,message:"\u8BF7\u8F93\u5165API\u8BBF\u95EE\u7528\u6237\u540D"}],"validate-trigger":"blur"},{default:u(()=>[a(f,{modelValue:e.value.zabbixApi.username,"onUpdate:modelValue":t[4]||(t[4]=i=>e.value.zabbixApi.username=i),placeholder:"\u8BF7\u8F93\u5165API\u8BBF\u95EE\u7528\u6237\u540D"},null,8,["modelValue"])]),_:1}),a(C,{field:"zabbixApi.password",label:"\u5BC6\u7801",rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u5BC6\u7801"}],"validate-trigger":"blur"},{default:u(()=>[a(te,{modelValue:e.value.zabbixApi.password,"onUpdate:modelValue":t[5]||(t[5]=i=>e.value.zabbixApi.password=i),autocomplete:"new-password",placeholder:"\u8BF7\u8F93\u5165API\u8BBF\u95EE\u5BC6\u7801"},null,8,["modelValue"])]),_:1}),w("div",null,[a(oe,{type:"text",loading:g(O),onClick:F},{icon:u(()=>[a(le)]),default:u(()=>[p(" \u6D4B\u8BD5API\u8FDE\u901A\u6027 ")]),_:1},8,["loading"]),x.value?(v(),M(ne,{key:0,type:V.value?"success":"error"},{action:u(()=>[a(se,{style:{cursor:"pointer"},onClick:t[6]||(t[6]=i=>x.value=!1)})]),default:u(()=>[V.value?(v(),z("span",la," \u8FDE\u63A5\u6210\u529F,zabbix api\u7248\u672C:"+h(b.value),1)):(v(),z("span",oa,h(I.value),1))]),_:1},8,["type"])):ee("",!0)]),a(L,{orientation:"left"},{default:u(()=>[p("\u6570\u636E\u5E93")]),_:1}),a(C,{field:"database.type",label:"\u6570\u636E\u5E93\u7C7B\u578B",rules:[{required:!0,message:"\u8BF7\u9009\u62E9\u6570\u636E\u5E93\u7C7B\u578B"}],"validate-trigger":"blur"},{default:u(()=>[a(Me,{modelValue:e.value.database.type,"onUpdate:modelValue":t[7]||(t[7]=i=>e.value.database.type=i),placeholder:"\u8BF7\u9009\u62E9\u6570\u636E\u5E93\u7C7B\u578B",onChange:U},{default:u(()=>[(v(!0),z(Ke,null,Ze(B.value,i=>(v(),M(qe,{key:i.code,value:i.code},{default:u(()=>[p(h(i.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(C,{field:"database.name",label:"\u6570\u636E\u5E93\u540D",rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u6570\u636E\u5E93\u540D"}],"validate-trigger":"blur"},{default:u(()=>[a(f,{modelValue:e.value.database.name,"onUpdate:modelValue":t[8]||(t[8]=i=>e.value.database.name=i),placeholder:"\u8BF7\u8F93\u5165\u6570\u636E\u5E93\u540D"},null,8,["modelValue"])]),_:1}),a(C,{field:"database.host",label:"IP/\u4E3B\u673A\u540D",rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u6570\u636E\u5E93IP\u5730\u5740/\u4E3B\u673A\u540D"}],"validate-trigger":"blur"},{default:u(()=>[a(f,{modelValue:e.value.database.host,"onUpdate:modelValue":t[9]||(t[9]=i=>e.value.database.host=i),placeholder:"\u8BF7\u8F93\u5165\u6570\u636E\u5E93IP\u5730\u5740/\u4E3B\u673A\u540D"},null,8,["modelValue"])]),_:1}),a(C,{field:"database.port",label:"\u6570\u636E\u5E93\u7AEF\u53E3",rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u6570\u636E\u5E93\u7AEF\u53E3"}],"validate-trigger":"blur"},{default:u(()=>[a(Ge,{modelValue:e.value.database.port,"onUpdate:modelValue":t[10]||(t[10]=i=>e.value.database.port=i),placeholder:"\u8BF7\u8F93\u5165\u6570\u636E\u5E93\u7AEF\u53E3"},null,8,["modelValue"])]),_:1}),a(C,{field:"database.username",label:"\u7528\u6237\u540D",rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u6570\u636E\u5E93\u8BBF\u95EE\u7528\u6237\u540D"}],"validate-trigger":"blur"},{default:u(()=>[a(f,{modelValue:e.value.database.username,"onUpdate:modelValue":t[11]||(t[11]=i=>e.value.database.username=i),placeholder:"\u8BF7\u8F93\u5165\u6570\u636E\u5E93\u8BBF\u95EE\u7528\u6237\u540D"},null,8,["modelValue"])]),_:1}),a(C,{field:"database.password",label:"\u6570\u636E\u5E93\u5BC6\u7801",rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u6570\u636E\u5E93\u5BC6\u7801"}],"validate-trigger":"blur"},{default:u(()=>[a(te,{modelValue:e.value.database.password,"onUpdate:modelValue":t[12]||(t[12]=i=>e.value.database.password=i),autocomplete:"new-password",placeholder:"\u8BF7\u8F93\u5165\u6570\u636E\u5E93\u8BBF\u95EE\u5BC6\u7801"},null,8,["modelValue"])]),_:1}),a(C,{field:"database.extra",label:"\u989D\u5916\u5B57\u7B26\u4E32","validate-trigger":"blur"},{default:u(()=>[a(f,{modelValue:e.value.database.extra,"onUpdate:modelValue":t[13]||(t[13]=i=>e.value.database.extra=i),placeholder:"\u8BF7\u8F93\u5165\u989D\u5916JDBC\u5B57\u7B26\u4E32"},null,8,["modelValue"])]),_:1}),a(C,{field:"database.url",label:"JDBC URL","validate-trigger":"blur"},{default:u(()=>[a(Ne,{content:A.value},{default:u(()=>[a(f,{modelValue:A.value,"onUpdate:modelValue":t[14]||(t[14]=i=>A.value=i),disabled:""},null,8,["modelValue"])]),_:1},8,["content"])]),_:1}),w("div",null,[a(oe,{type:"text",loading:g(P),onClick:R},{icon:u(()=>[a(le)]),default:u(()=>[p(" \u6D4B\u8BD5\u6570\u636E\u5E93\u8FDE\u901A\u6027 ")]),_:1},8,["loading"]),y.value?(v(),M(ne,{key:0,type:n.value?"success":"error"},{action:u(()=>[a(se,{style:{cursor:"pointer"},onClick:t[15]||(t[15]=i=>y.value=!1)})]),default:u(()=>[n.value?(v(),z("span",sa,"\u8FDE\u63A5\u6210\u529F")):(v(),z("span",na,h(s.value),1))]),_:1},8,["type"])):ee("",!0)])]),_:1},8,["model"])]),_:1},8,["visible"])}}}),ra={key:0},da={key:1},pa=Z({__name:"datasource-draw-form",props:{modelValue:{},visible:{type:Boolean,default:!1}},emits:["ok","cancel"],setup(j,{emit:k}){const T=k,E=j,e=d({id:"",name:"",description:"",url:"",username:"",password:""}),r=W(()=>`${e.value.url}/api/v1`),A=W({get(){return{id:e.value.id,name:e.value.name,url:r.value,createUser:e.value.createUser,createTime:e.value.createTime,username:e.value.username,password:e.value.password,type:"PROMETHEUS",description:e.value.description}},set(n){e.value.id=n.id,e.value.name=n.name,e.value.description=n.description,e.value.createUser=n.createUser,e.value.createTime=n.createTime,e.value.url=n.url.replace("/api/v1",""),e.value.username=n.username,e.value.password=n.password}}),$=d([]),B=d(),D=async()=>{await B.value.validate()?console.warn("\u9A8C\u8BC1\u4E0D\u901A\u8FC7"):(await ke(A.value),H.success("\u63D0\u4EA4\u6210\u529F"),T("ok"))},U=()=>{T("cancel")},m=d(),S=d(),V=d(),b=d(!1),{loading:I,setLoading:x}=K(!1),O=async()=>{if(x(!0),!await B.value.validateField("url"))try{const{data:s}=await Le(`${e.value.url}/api/v1/status/buildinfo`);m.value=s.status==="success",m.value?S.value=s.data.version:V.value=s.errorMessage,b.value=!0}catch(s){console.error(s)}finally{x(!1)}x(!1)},o=d(""),F=Ie(async(n,s)=>{if(n!==o.value){const{data:y}=await Pe(n);y&&y.length>0&&s("\u6570\u636E\u6E90\u540D\u79F0\u5DF2\u5B58\u5728")}},500),c=()=>{E.modelValue?B.value.clearValidate():(B.value.resetFields(),e.value.id=""),b.value=!1},_=async()=>{$.value=(await Se("\u6570\u636E\u5E93\u7C7B\u578B")).data,c()};return re(()=>E.modelValue,n=>{n&&(A.value=n,o.value=n.name)},{deep:!0,immediate:!0}),(n,s)=>{const y=X,P=de,q=pe,R=ce,G=me,N=be,l=J,t=ve,f=_e,C=fe,Y=Fe;return v(),M(Y,{visible:n.visible,width:"50%","title-align":"start","mask-closable":!1,onOk:D,onBeforeOpen:_,onCancel:U},{title:u(()=>[p(h(E.modelValue?"\u7F16\u8F91":"\u65B0\u5EFA")+"prometheus\u6570\u636E\u6E90 ",1)]),default:u(()=>[a(C,{ref_key:"submitFormRef",ref:B,model:e.value},{default:u(()=>[a(P,{field:"name",label:"\u540D\u79F0",rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u540D\u79F0"},{validator:g(F)}],"validate-trigger":"blur"},{default:u(()=>[a(y,{modelValue:e.value.name,"onUpdate:modelValue":s[0]||(s[0]=L=>e.value.name=L),placeholder:"\u8BF7\u8F93\u5165\u540D\u79F0"},null,8,["modelValue"])]),_:1},8,["rules"]),a(P,{field:"description",label:"\u63CF\u8FF0","validate-trigger":"blur"},{default:u(()=>[a(q,{modelValue:e.value.description,"onUpdate:modelValue":s[1]||(s[1]=L=>e.value.description=L),placeholder:"\u8BF7\u8F93\u5165\u63CF\u8FF0"},null,8,["modelValue"])]),_:1}),a(R,{orientation:"left"},{default:u(()=>[p("API")]),_:1}),a(P,{field:"url",rules:[{required:!0,message:"\u8BF7\u8F93\u5165prometheus url"}],"validate-trigger":"blur",label:"URL"},{default:u(()=>[a(y,{modelValue:e.value.url,"onUpdate:modelValue":s[2]||(s[2]=L=>e.value.url=L)},{append:u(()=>[p("/api/v1")]),_:1},8,["modelValue"])]),_:1}),a(P,{field:"username",label:"\u7528\u6237\u540D","validate-trigger":"blur"},{default:u(()=>[a(y,{modelValue:e.value.username,"onUpdate:modelValue":s[3]||(s[3]=L=>e.value.username=L),placeholder:"\u8BF7\u8F93\u5165API\u8BBF\u95EE\u7528\u6237\u540D"},null,8,["modelValue"])]),_:1}),a(P,{field:"password",label:"\u5BC6\u7801","validate-trigger":"blur"},{default:u(()=>[a(G,{modelValue:e.value.password,"onUpdate:modelValue":s[4]||(s[4]=L=>e.value.password=L),autocomplete:"new-password",placeholder:"\u8BF7\u8F93\u5165API\u8BBF\u95EE\u5BC6\u7801"},null,8,["modelValue"])]),_:1}),w("div",null,[a(l,{type:"text",loading:g(I),onClick:O},{icon:u(()=>[a(N)]),default:u(()=>[p(" \u6D4B\u8BD5API\u8FDE\u901A\u6027 ")]),_:1},8,["loading"]),b.value?(v(),M(f,{key:0,type:m.value?"success":"error"},{action:u(()=>[a(t,{style:{cursor:"pointer"},onClick:s[5]||(s[5]=L=>b.value=!1)})]),default:u(()=>[m.value?(v(),z("span",ra," \u8FDE\u63A5\u6210\u529F,Prometheus\u7248\u672C:"+h(S.value),1)):(v(),z("span",da,h(V.value),1))]),_:1},8,["type"])):ee("",!0)])]),_:1},8,["model"])]),_:1},8,["visible"])}}}),ca={style:{height:"calc(100vh - 204px)"}},ma={key:1},ba={key:2},va=Z({__name:"datasource-table-list",emits:["edit"],setup(j,{expose:k,emit:T}){const{loading:E,setLoading:e}=K(!1),{pagination:r,pageSizeOptions:A}=Oe(),$=d(),B=d(),D=d({size:"mini",height:"auto",columnConfig:{resizable:!0},showOverflow:"tooltip",columns:[{title:"\u6570\u636E\u6E90\u540D\u79F0",field:"name",minWidth:120},{title:"API URL",field:"url",minWidth:300},{title:"zabbix\u8FDE\u901A\u6027",minWidth:40,slots:{default:"zabbixVersion"}},{title:"\u63CF\u8FF0",field:"description",minWidth:120},{title:"\u521B\u5EFA\u65F6\u95F4",field:"createTime",width:200},{title:"\u64CD\u4F5C",width:120,slots:{default:"action"}}]}),U=ge({queryStr:"",type:"ZABBIX"}),m=async(o={...U,page:r})=>{e(!0);const F=$.value;try{const{data:c}=await Te(o);r.total=c.totalElements,F&&(await F.reloadData(c.content),c.content.forEach(_=>{const n=ae.cloneDeep(r.current);_.apiVersionLoading=!0,F.reloadData(c.content),Ue({url:_.url,username:_.username,password:_.password}).then(s=>{s.data.result?_.apiVersion=s.data.version:_.apiVersionErrorMessage=s.data.errorMessage,n===r.current&&F.reloadData(c.content)}).finally(()=>{_.apiVersionLoading=!1})}))}catch(c){console.error(c)}finally{e(!1)}},S=o=>{r.current=o,m()},V=o=>{r.pageSize=o,m()},b=()=>{m()};Ee(()=>{m()});const I=T,x=o=>{I("edit",o)},O=async o=>{ye.warning({title:"\u63D0\u793A",titleAlign:"start",hideCancel:!1,content:`\u6B64\u64CD\u4F5C\u5C06\u6C38\u4E45\u5220\u9664\u6570\u636E\u6E90'${o.name}'\uFF0C\u662F\u5426\u7EE7\u7EED?`,onOk:async()=>{await $e(o.id),H.success("\u5220\u9664\u6210\u529F"),await m()}})};return k({fetchData:m}),(o,F)=>{const c=X,_=J,n=Ce,s=Ve,y=xe,P=Ae,q=we,R=he,G=ue,N=ze,l=De("vxe-grid");return v(),z("div",null,[a(y,null,{default:u(()=>[a(s,{span:14},{default:u(()=>[a(n,{style:{"margin-bottom":"5px"}},{default:u(()=>[a(c,{modelValue:U.queryStr,"onUpdate:modelValue":F[0]||(F[0]=t=>U.queryStr=t),style:{width:"320px"},placeholder:"\u6570\u636E\u6E90\u540D\u79F0/API URL","allow-clear":""},null,8,["modelValue"]),a(_,{type:"primary",size:"medium",onClick:b},{default:u(()=>[p(h(o.$t("button.search")),1)]),_:1})]),_:1})]),_:1})]),_:1}),w("div",ca,[a(l,Be({ref_key:"xGrid",ref:$,loading:g(E)},D.value),{index:u(({rowIndex:t})=>[p(h(t+1+(g(r).current-1)*g(r).pageSize),1)]),action:u(({row:t})=>[a(n,null,{default:u(()=>[a(P,{onClick:f=>x(t)},{default:u(()=>[p("\u7F16\u8F91")]),_:2},1032,["onClick"]),a(P,{onClick:f=>O(t)},{default:u(()=>[p("\u5220\u9664")]),_:2},1032,["onClick"])]),_:2},1024)]),zabbixVersion:u(({row:t})=>[t.apiVersionLoading?(v(),M(q,{key:0,loading:t.apiVersionLoading},null,8,["loading"])):t.apiVersionErrorMessage?(v(),z("span",ma,[a(G,{content:t.apiVersionErrorMessage},{default:u(()=>[a(R,{color:"red"},{default:u(()=>[p("\u8FDE\u901A\u6027\u5F02\u5E38")]),_:1})]),_:2},1032,["content"])])):(v(),z("span",ba,[a(R,{color:"green"},{default:u(()=>[p(h(t.apiVersion),1)]),_:2},1024)]))]),pager:u(()=>[a(N,{ref_key:"xPagination",ref:B,current:g(r).current,"page-size":g(r).pageSize,total:g(r).total,"page-size-options":g(A),style:{"padding-top":"10px"},"show-total":"","show-jumper":"","show-page-size":"",onChange:S,onPageSizeChange:V},null,8,["current","page-size","total","page-size-options"])]),_:1},16,["loading"])])])}}}),_a={style:{height:"calc(100vh - 204px)"}},fa={key:1},Fa={key:2},ga=Z({__name:"datasource-table-list",emits:["edit"],setup(j,{expose:k,emit:T}){const{loading:E,setLoading:e}=K(!1),{pagination:r,pageSizeOptions:A}=Oe(),$=d(),B=d(),D=d({size:"mini",height:"auto",columnConfig:{resizable:!0},showOverflow:"tooltip",columns:[{title:"\u6570\u636E\u6E90\u540D\u79F0",field:"name",minWidth:120},{title:"API URL",field:"url",minWidth:300},{title:"prometheus\u7248\u672C",minWidth:40,slots:{default:"prometheusVersion"}},{title:"\u63CF\u8FF0",field:"description",minWidth:120},{title:"\u521B\u5EFA\u65F6\u95F4",field:"createTime",width:200},{title:"\u64CD\u4F5C",width:120,slots:{default:"action"}}]}),U=ge({queryStr:"",type:"PROMETHEUS"}),m=async(o={...U,page:r})=>{e(!0);const F=$.value;try{const{data:c}=await Te(o);r.total=c.totalElements,F&&(await F.reloadData(c.content),c.content.forEach(_=>{const n=ae.cloneDeep(r.current);_.apiVersionLoading=!0,F.reloadData(c.content),Le(`${_.url}/status/buildinfo`).then(s=>{s.data.status==="success"?_.apiVersion=s.data.data.version:_.apiVersionErrorMessage=s.data.errorMessage,n===r.current&&F.reloadData(c.content)}).finally(()=>{_.apiVersionLoading=!1})}))}catch(c){console.error(c)}finally{e(!1)}},S=o=>{r.current=o,m()},V=o=>{r.pageSize=o,m()},b=()=>{m()};Ee(()=>{m()});const I=T,x=o=>{I("edit",o)},O=async o=>{ye.warning({title:"\u63D0\u793A",titleAlign:"start",hideCancel:!1,content:`\u6B64\u64CD\u4F5C\u5C06\u6C38\u4E45\u5220\u9664\u6570\u636E\u6E90'${o.name}'\uFF0C\u662F\u5426\u7EE7\u7EED?`,onOk:async()=>{await $e(o.id),H.success("\u5220\u9664\u6210\u529F"),await m()}})};return k({fetchData:m}),(o,F)=>{const c=X,_=J,n=Ce,s=Ve,y=xe,P=Ae,q=we,R=he,G=ue,N=ze,l=De("vxe-grid");return v(),z("div",null,[a(y,null,{default:u(()=>[a(s,{span:14},{default:u(()=>[a(n,{style:{"margin-bottom":"5px"}},{default:u(()=>[a(c,{modelValue:U.queryStr,"onUpdate:modelValue":F[0]||(F[0]=t=>U.queryStr=t),style:{width:"320px"},placeholder:"\u6570\u636E\u6E90\u540D\u79F0/API URL","allow-clear":""},null,8,["modelValue"]),a(_,{type:"primary",size:"medium",onClick:b},{default:u(()=>[p(h(o.$t("button.search")),1)]),_:1})]),_:1})]),_:1})]),_:1}),w("div",_a,[a(l,Be({ref_key:"xGrid",ref:$,loading:g(E)},D.value),{index:u(({rowIndex:t})=>[p(h(t+1+(g(r).current-1)*g(r).pageSize),1)]),action:u(({row:t})=>[a(n,null,{default:u(()=>[a(P,{onClick:f=>x(t)},{default:u(()=>[p("\u7F16\u8F91")]),_:2},1032,["onClick"]),a(P,{onClick:f=>O(t)},{default:u(()=>[p("\u5220\u9664")]),_:2},1032,["onClick"])]),_:2},1024)]),prometheusVersion:u(({row:t})=>[t.apiVersionLoading?(v(),M(q,{key:0,loading:t.apiVersionLoading},null,8,["loading"])):t.apiVersionErrorMessage?(v(),z("span",fa,[a(G,{content:t.apiVersionErrorMessage},{default:u(()=>[a(R,{color:"red"},{default:u(()=>[p("\u83B7\u53D6\u5931\u8D25")]),_:1})]),_:2},1032,["content"])])):(v(),z("span",Fa,[a(R,{color:"green"},{default:u(()=>[p(h(t.apiVersion),1)]),_:2},1024)]))]),pager:u(()=>[a(N,{ref_key:"xPagination",ref:B,current:g(r).current,"page-size":g(r).pageSize,total:g(r).total,"page-size-options":g(A),style:{"padding-top":"10px"},"show-total":"","show-jumper":"","show-page-size":"",onChange:S,onPageSizeChange:V},null,8,["current","page-size","total","page-size-options"])]),_:1},16,["loading"])])])}}}),Ea={class:"page-container"},Da={class:"page-panel"},Ba=w("div",{style:{display:"flex","flex-direction":"row","justify-content":"center","align-items":"center"}}," Zabbix ",-1),Ra=Z({__name:"index",setup(j){const k=d(!1),T=d(),E=d(!1),e=d(),r=d("zabbix"),A=()=>{k.value=!1,T.value.fetchData()},$=()=>{E.value=!1,e.value.fetchData()},B=d(),D=d(),U=()=>{r.value==="zabbix"?(B.value=void 0,k.value=!0):r.value==="prometheus"&&(D.value=void 0,E.value=!0,console.log("prometheus",D.value,E.value))},m=V=>{B.value=V,k.value=!0},S=V=>{D.value=V,E.value=!0};return(V,b)=>{const I=J,x=ea,O=aa;return v(),z("div",Ea,[w("div",Da,[a(O,{"active-key":r.value,"onUpdate:activeKey":b[0]||(b[0]=o=>r.value=o)},{extra:u(()=>[a(I,{type:"primary",onClick:U},{default:u(()=>[p("\u65B0\u5EFA")]),_:1})]),default:u(()=>[a(x,{key:"zabbix"},{title:u(()=>[Ba]),default:u(()=>[a(va,{ref_key:"zabbixDatasourceTableListRef",ref:T,onEdit:m},null,512)]),_:1}),a(x,{key:"prometheus",title:"Prometheus"},{default:u(()=>[a(ga,{ref_key:"prometheusDatasourceTableListRef",ref:e,onEdit:S},null,512)]),_:1})]),_:1},8,["active-key"])]),a(ia,{modelValue:B.value,"onUpdate:modelValue":b[1]||(b[1]=o=>B.value=o),visible:k.value,onCancel:b[2]||(b[2]=o=>k.value=!1),onOk:A},null,8,["modelValue","visible"]),a(pa,{modelValue:D.value,"onUpdate:modelValue":b[3]||(b[3]=o=>D.value=o),visible:E.value,onCancel:b[4]||(b[4]=o=>E.value=!1),onOk:$},null,8,["modelValue","visible"])])}}});export{Ra as default};
