import{h as q,b as ce,l as w,a as Z,S as me}from"./index.e9d54774.js";/* empty css                *//* empty css               *//* empty css               *//* empty css               */import{d as te,f as _,c as fe,w as _e,o as ae,aT as ue,D as s,E as U,aS as u,aI as e,aU as j,aV as J,aH as p,aY as i,aW as $,H as v,bX as ge,aP as le,bo as ye,a$ as ve,cg as Fe,aO as Ee,bp as Be,r as Ce,br as he,aZ as A,u as b,bz as be,bg as C,bq as Le,h as G,aN as ke,bt as De,a_ as Ae,b0 as we,bf as Ie,bY as Ve,bD as xe,aM as Se,bB as Ke,bi as ze}from"./arco.a97fe066.js";import{p as Ue}from"./pagination.72a5f225.js";/* empty css              *//* empty css                */import{_ as $e}from"./index.vue_vue_type_script_setup_true_lang.365d06f6.js";import{f as qe}from"./app-model.480d8620.js";import{f as Ne}from"./dict.7add4266.js";import"./chart.a235fbdf.js";import"./vue.4eb70094.js";function Oe(c){return q.post("/assignStrategy/pageList",c)}function Q(c){return q.post("/assignStrategy",c)}function Pe(c){return q.delete(`/assignStrategy/${c}`)}function ee(c){return q.get(`/assignStrategy/${c}`)}const Me=v("p",{style:{}},"\u57FA\u672C\u4FE1\u606F",-1),Te=v("div",{style:{display:"flex"}},[v("span",null,"\u5206\u6D3E\u6761\u4EF6"),v("span",{style:{"margin-left":"16px","font-size":"12px",color:"var(--color-text-3)","align-self":"flex-end"}}," \u9488\u5BF9\u3010\u5168\u90E8\u544A\u8B66\u3011\u8FDB\u884C\u7B5B\u9009\uFF0C\u5C06\u7B26\u5408\u6761\u4EF6\u7684\u544A\u8B66\u5206\u6D3E\u7ED9\u5E72\u7CFB\u4EBA\u3002 ")],-1),He=te({__name:"assign-strategy-save",props:{modelValue:{}},emits:["update:modelValue"],setup(c,{emit:N}){const{userInfo:I}=ce(),V=c,g=_([]),m=_([]),O=N,a=_({name:"",enable:!0,appKeys:"",appKeysIdList:[],userContactList:[],userIdList:[],ruleFilterList:[],recordEditable:!0}),f=_([]),L=fe({get(){const t=w.cloneDeep(a.value);return a.value.userIdList&&(t.userContactList=[],a.value.userIdList.forEach(n=>{t.userContactList.push({contactId:n,type:"USER"})})),a.value.appKeysIdList&&(t.appKeys=a.value.appKeysIdList.join(",")),t},set(t){a.value=w.cloneDeep(t),a.value.userIdList=t.userContactList.filter(n=>n.type==="USER").map(n=>n.contactId),t.appKeys&&(a.value.appKeysIdList=t.appKeys.split(","))}}),E=()=>{O("update:modelValue",L.value)},x=async()=>{g.value=(await qe()).data,g.value.forEach(t=>{var n;(n=t.appInstances)==null||n.forEach(y=>{y.deleteTime||m.value.push(y.id)})}),a.value.appKeysIdList=a.value.appKeysIdList.filter(t=>m.value.indexOf(t)>-1),f.value=[{fieldName:"\u544A\u8B66\u6807\u9898",fieldCode:"information",operators:["eq","ne","like","notLike"],placeHolder:"\u8BF7\u8F93\u5165\u544A\u8B66\u6807\u9898"},{fieldName:"IP\u5730\u5740",fieldCode:"ip",operators:["eq","ne","like","notLike"],placeHolder:"\u8BF7\u8F93\u5165ip\u5730\u5740"},{fieldName:"\u7EA7\u522B",fieldCode:"priority",operators:["in","notIn"],placeHolder:"\u8BF7\u9009\u62E9\u544A\u8B66\u7EA7\u522B",meta:{type:"dict",options:(await Ne("\u544A\u8B66\u7EA7\u522B")).data}},{fieldName:"\u76D1\u63A7\u5BF9\u8C61\u540D\u79F0",fieldCode:"displayName",operators:["eq","ne","like","notLike"],placeHolder:"\u8BF7\u8F93\u5165\u76D1\u63A7\u5BF9\u8C61\u540D\u79F0"}]};return _e(()=>V.modelValue,t=>{L.value=t},{deep:!0,immediate:!0}),ae(async()=>{V.modelValue.id||(a.value.userIdList=[I.id]),await x()}),(t,n)=>{const y=ge,F=le,h=ye,P=ve,M=Fe,T=Ee,H=Be,W=ue("Rule-Filter");return s(),U(j,null,[Me,u(y),u(H,{model:a.value},{default:e(()=>[u(h,{field:"name",label:"\u7B56\u7565\u540D\u79F0",required:""},{default:e(()=>[u(F,{modelValue:a.value.name,"onUpdate:modelValue":n[0]||(n[0]=r=>a.value.name=r),placeholder:"\u8BF7\u8F93\u5165\u7B56\u7565\u540D\u79F0",style:{width:"420px"},"max-length":64,"show-word-limit":"",onInput:E},null,8,["modelValue"])]),_:1}),u(h,{field:"appKeys",label:"\u5E94\u7528",rules:[{required:!0,message:"\u5E94\u7528"}],"validate-trigger":"input",required:""},{default:e(()=>[u(T,{modelValue:a.value.appKeysIdList,"onUpdate:modelValue":n[1]||(n[1]=r=>a.value.appKeysIdList=r),placeholder:"\u8BF7\u9009\u62E9\u5E94\u7528",multiple:"",style:{width:"420px"},onChange:E},{default:e(()=>[(s(!0),U(j,null,J(g.value,(r,k)=>(s(),p(M,{key:k,label:r.name},{default:e(()=>[(s(!0),U(j,null,J(r.appInstances,(S,o)=>(s(),p(P,{key:o,value:S.id},{default:e(()=>[i($(S.name),1)]),_:2},1032,["value"]))),128))]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"])]),_:1}),u(h,{field:"concat",label:"\u88AB\u5206\u6D3E\u4EBA",rules:[{required:!0,validator:async(r,k)=>{k()}}]},{default:e(()=>[u($e,{modelValue:a.value.userIdList,"onUpdate:modelValue":n[2]||(n[2]=r=>a.value.userIdList=r),onOk:E,onClose:E},null,8,["modelValue"])]),_:1},8,["rules"])]),_:1},8,["model"]),Te,u(y),u(W,{modelValue:a.value.ruleFilterList,"onUpdate:modelValue":n[3]||(n[3]=r=>a.value.ruleFilterList=r),"field-meta":f.value,onChange:E},null,8,["modelValue","field-meta"])],64)}}}),We={class:"page-container"},Re={class:"page-panel"},je={style:{height:"calc(100vh - 146px)"}},Ge={style:{width:"20px"}},Ye=v("span",null,"\u67E5\u770B",-1),dt=te({__name:"index",setup(c){const{loading:N,setLoading:I}=Z(!1),{loading:V,setLoading:g}=Z(!1),{pagination:m,pageSizeOptions:O}=Ue(),a=_("\u65B0\u5EFA\u7B56\u7565"),f=_(!1),L=_(),E=_(),x={name:"",enable:!0,appKeys:"",appKeysIdList:[],userContactList:[],userIdList:[],ruleFilterList:[],recordEditable:!0},t=_(w.cloneDeep(x)),n=_({size:"mini",height:"auto",columnConfig:{resizable:!0},showOverflow:"tooltip",columns:[{title:"\u7B56\u7565\u540D\u79F0",field:"name",minWidth:120},{title:"\u542F\u7528\u72B6\u6001",minWidth:120,slots:{default:"enable"}},{title:"\u5E94\u7528",field:"appKeys",minWidth:120,slots:{default:"appKeys"}},{title:"\u521B\u5EFA\u8005",field:"createUserName",minWidth:120},{title:"\u521B\u5EFA\u65F6\u95F4",field:"createTime",width:200},{title:"\u88AB\u5206\u6D3E\u4EBA",field:"userContactList",slots:{default:"userContactList"},width:200},{title:"\u64CD\u4F5C",width:120,slots:{default:"action"}}]}),y=Ce({queryStr:""}),F=async(o={...y,page:m})=>{I(!0);const d=L.value;try{const{data:D}=await Oe(o);m.total=D.totalElements,d&&await d.reloadData(D.content)}catch{}finally{I(!1)}},h=()=>{F()},P=o=>{m.current=o,F()},M=o=>{m.pageSize=o,F()},T=()=>{t.value=w.cloneDeep(x),g(!1),a.value="\u65B0\u5EFA\u7B56\u7565",f.value=!0},H=async o=>{t.value=(await ee(o.id)).data,g(!1),a.value="\u7B56\u7565\u8BE6\u60C5",f.value=!0},W=async o=>{t.value=(await ee(o.id)).data,g(!1),a.value="\u7F16\u8F91\u7B56\u7565",f.value=!0},r=async o=>{o.onlyEnableUpdate=!0,await Q(o),o.enable?C.success("\u542F\u7528\u6210\u529F"):C.success("\u7981\u7528\u6210\u529F")},k=o=>{Le.confirm({title:"\u63D0\u793A",simple:!1,draggable:!0,closable:!1,titleAlign:"start",content:()=>G("div",["\u6B64\u64CD\u4F5C\u5C06\u6C38\u4E45",G("span",{style:"color: rgb(var(--danger-6))"},"\u5220\u9664"),'\u5206\u6D3E\u7B56\u7565"',G("span",{style:"color: rgb(var(--primary-6))"},o.name),'"\uFF0C\u662F\u5426\u7EE7\u7EED\uFF1F']),onOk:async()=>{await Pe(o.id),C.success("\u5220\u9664\u6210\u529F"),await F()}})},S=async()=>{if(!t.value.name){C.warning("\u540D\u79F0\u4E0D\u53EF\u4E3A\u7A7A\uFF01");return}if(!t.value.appKeys){C.warning("\u5E94\u7528\u5B9E\u4F8B\u4E0D\u53EF\u4E3A\u7A7A\uFF01");return}if(t.value.userContactList.length===0){C.warning("\u88AB\u5206\u6D3E\u4EBA\u4E0D\u53EF\u4E3A\u7A7A\uFF01");return}g(!0);const o=w.cloneDeep(t.value);await Q(o),C.success("\u63D0\u4EA4\u6210\u529F"),g(!1),f.value=!1,await F()};return ae(()=>{F()}),(o,d)=>{const D=le,K=ke,z=De,Y=Ae,oe=we,ne=Ie,X=Ve,se=me,ie=xe,R=Se,re=Ke,de=ue("vxe-grid"),pe=ze;return s(),U("div",We,[v("div",Re,[u(oe,null,{default:e(()=>[u(Y,{span:14},{default:e(()=>[u(z,{style:{"margin-bottom":"5px"}},{default:e(()=>[u(D,{modelValue:y.queryStr,"onUpdate:modelValue":d[0]||(d[0]=l=>y.queryStr=l),style:{width:"320px"},placeholder:"\u7B56\u7565\u540D\u79F0","allow-clear":"",onKeyup:he(h,["enter"])},null,8,["modelValue"]),u(K,{type:"primary",onClick:h},{default:e(()=>[i("\u67E5\u8BE2")]),_:1})]),_:1})]),_:1}),u(Y,{span:10,style:{"text-align":"right"}},{default:e(()=>[u(K,{type:"primary",onClick:T},{default:e(()=>[i("\u65B0\u5EFA")]),_:1})]),_:1})]),_:1}),v("div",je,[u(de,be({ref_key:"xGrid",ref:L,loading:b(N)},n.value),{enable:e(({row:l})=>[l.recordEditable?(s(),p(ne,{key:0,modelValue:l.enable,"onUpdate:modelValue":B=>l.enable=B,type:"line",size:"small",onChange:B=>r(l)},{checked:e(()=>[i("\u542F\u7528")]),unchecked:e(()=>[i("\u7981\u7528")]),_:2},1032,["modelValue","onUpdate:modelValue","onChange"])):(s(),p(z,{key:1},{default:e(()=>[l.enable?(s(),p(X,{key:0,color:"green"},{default:e(()=>[i("\u542F\u7528")]),_:1})):(s(),p(X,{key:1,color:"red"},{default:e(()=>[i("\u7981\u7528")]),_:1}))]),_:2},1024))]),appKeys:e(({row:l})=>[i($(l.appKeyNameList.join("\uFF0C")),1)]),userContactList:e(({row:l})=>[u(ie,null,{content:e(()=>[v("span",null,$("\u7528\u6237:"+l.userContactList.map(B=>B.name)),1)]),default:e(()=>[v("div",Ge,[u(se),Ye])]),_:2},1024)]),action:e(({row:l})=>[u(z,null,{default:e(()=>[l.recordEditable?A("",!0):(s(),p(R,{key:0,onClick:B=>H(l)},{default:e(()=>[i(" \u8BE6\u60C5 ")]),_:2},1032,["onClick"])),l.recordEditable?(s(),p(R,{key:1,onClick:B=>W(l)},{default:e(()=>[i(" \u7F16\u8F91 ")]),_:2},1032,["onClick"])):A("",!0),l.recordEditable?(s(),p(R,{key:2,type:"text",onClick:B=>k(l)},{default:e(()=>[i(" \u5220\u9664 ")]),_:2},1032,["onClick"])):A("",!0)]),_:2},1024)]),pager:e(()=>[u(re,{ref_key:"xPagination",ref:E,current:b(m).current,"page-size":b(m).pageSize,total:b(m).total,"page-size-options":b(O),style:{"padding-top":"10px"},"show-total":"","show-jumper":"","show-page-size":"",onChange:P,onPageSizeChange:M},null,8,["current","page-size","total","page-size-options"])]),_:1},16,["loading"])]),u(pe,{width:720,visible:f.value,"ok-loading":b(V),"unmount-on-close":"","mask-closable":!1,onCancel:d[3]||(d[3]=l=>f.value=!1)},{title:e(()=>[i($(a.value),1)]),footer:e(()=>[u(z,null,{default:e(()=>[t.value.recordEditable?(s(),p(K,{key:0,type:"primary",onClick:S},{default:e(()=>[i(" \u786E\u8BA4 ")]),_:1})):A("",!0),t.value.recordEditable?(s(),p(K,{key:1,onClick:d[2]||(d[2]=l=>f.value=!1)},{default:e(()=>[i(" \u53D6\u6D88 ")]),_:1})):A("",!0)]),_:1})]),default:e(()=>[u(He,{modelValue:t.value,"onUpdate:modelValue":d[1]||(d[1]=l=>t.value=l)},null,8,["modelValue"])]),_:1},8,["visible","ok-loading"])])])}}});export{dt as default};
