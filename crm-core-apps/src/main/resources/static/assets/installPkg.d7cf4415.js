import{a as O,q as $,a0 as y,l as B}from"./index.e9d54774.js";/* empty css                *//* empty css               *//* empty css                *//* empty css              *//* empty css               *//* empty css               */import{d as G,f as r,o as L,aT as R,D as V,E as q,H as m,aS as a,aI as o,aY as _,u as d,bz as H,bg as h,bq as j,a_ as U,aN as W,bt as Y,bA as J,b0 as K,aM as Q,bB as X}from"./arco.a97fe066.js";import{d as Z}from"./global.90f51a62.js";import{p as ee}from"./pagination.72a5f225.js";import{g as te,u as ae,d as oe,a as ne}from"./attach-file.ee7f1d15.js";import"./chart.a235fbdf.js";import"./vue.4eb70094.js";const ie={class:"page-container"},se={class:"page-panel"},le={style:{height:"calc(100vh - 145px)"}},xe=G({__name:"installPkg",setup(ue){const{loading:D,setLoading:C}=O(!1),F=$(),f=r([]),{pagination:i,pageSizeOptions:E}=ee(),w=r(),k=r(),v=r(),z=r({size:"mini",height:"auto",columnConfig:{resizable:!0},rowConfig:{keyField:"id",isHover:!0},checkboxConfig:{reserve:!0},showOverflow:"tooltip",columns:[{title:"\u9644\u4EF6\u540D\u79F0",field:"fileName",minWidth:120},{title:"\u4E0A\u4F20\u65F6\u95F4",field:"createTime",width:150},{title:"\u64CD\u4F5C",width:120,fixed:"right",resizable:!1,slots:{default:"action"}}]}),u=async()=>{C(!0);const e=w.value;try{const{data:t}=await te(y);if(v.value=t,i.total=t.length,e){const{current:s,pageSize:l,total:n}=i,c=(s-1)*l,g=c+l>n?n:c+l,p=B.slice(t,c,g);await e.reloadData(p)}}catch(t){console.error(t)}finally{C(!1)}},b=e=>{i.current=e,u()},A=e=>{i.pageSize=e,u()},N=async e=>{f.value=e;const t=e.find(s=>s.status==="init");t!=null&&t.file&&(B.find(v.value,l=>{var n;return l.fileName===((n=t==null?void 0:t.file)==null?void 0:n.name)})?h.warning("\u8BE5\u9644\u4EF6\u5DF2\u5B58\u5728\uFF01"):await ae({module:y},t==null?void 0:t.file),await u()),f.value=[]},S=e=>{j.warning({title:"\u63D0\u793A",titleAlign:"start",hideCancel:!1,content:`\u786E\u5B9A\u5220\u9664${e.fileName}\u5417?`,onOk:async()=>{await oe(e.id),h.success("\u5220\u9664\u6210\u529F"),await u()}})},P=async e=>{h.loading("\u5DF2\u521B\u5EFA\u4E0B\u8F7D\u4EFB\u52A1\uFF0C\u5B8C\u6210\u540E\u6D4F\u89C8\u5668\u5C06\u81EA\u52A8\u4E0B\u8F7D\uFF01"),F.addDownloadItem(e.fileName),Z(await ne(e.id),e.fileName),F.delDownloadItem(e.fileName)};return L(()=>{u()}),(e,t)=>{const s=U,l=W,n=Y,c=J,g=K,p=Q,M=X,T=R("vxe-grid");return V(),q("div",ie,[m("div",se,[m("div",null,[a(g,null,{default:o(()=>[a(s,{span:14}),a(s,{span:10,style:{"text-align":"right"}},{default:o(()=>[a(n,{style:{"margin-bottom":"5px"}},{default:o(()=>[a(c,{"file-list":f.value,"auto-upload":!1,"show-file-list":!1,onChange:N},{"upload-button":o(()=>[a(n,null,{default:o(()=>[a(l,{type:"primary"},{default:o(()=>[_("\u6DFB\u52A0\u9644\u4EF6")]),_:1})]),_:1})]),_:1},8,["file-list"])]),_:1})]),_:1})]),_:1}),m("div",le,[a(T,H({ref_key:"xGrid",ref:w,loading:d(D)},z.value),{action:o(({row:x})=>[a(n,null,{default:o(()=>[a(p,{type:"text",onClick:I=>P(x)},{default:o(()=>[_("\u4E0B\u8F7D")]),_:2},1032,["onClick"]),a(p,{type:"text",onClick:I=>S(x)},{default:o(()=>[_("\u5220\u9664")]),_:2},1032,["onClick"])]),_:2},1024)]),pager:o(()=>[a(M,{ref_key:"xPagination",ref:k,current:d(i).current,"page-size":d(i).pageSize,total:d(i).total,"page-size-options":d(E),style:{"padding-top":"10px"},"show-total":"","show-jumper":"","show-page-size":"",onChange:b,onPageSizeChange:A},null,8,["current","page-size","total","page-size-options"])]),_:1},16,["loading"])])])])])}}});export{xe as default};
