import{a as I,l as M}from"./index.e9d54774.js";/* empty css               *//* empty css               *//* empty css                */import{d as O,f as u,w as G,aT as U,D,aH as z,aI as s,aY as B,aW as P,aS as n,u as h,H as N,bz as Y,bY as J,bE as Q,bB as X,aN as Z,bt as $,o as ee,E as te,aP as ae,a_ as oe,c9 as se,b0 as ne}from"./arco.a97fe066.js";import{c as le,r as ie}from"./date-time.3a778351.js";/* empty css                *//* empty css               */import{a as re,e as ce}from"./alert.327f26ca.js";import{p as ue}from"./pagination.72a5f225.js";import{d as de}from"./global.90f51a62.js";import{_ as pe}from"./index.vue_vue_type_script_setup_true_lang.dff799f7.js";import{h as me}from"./vue.4eb70094.js";import"./chart.a235fbdf.js";import"./moment.a1678c09.js";const fe={style:{display:"flex",width:"100%","padding-top":"10px","justify-content":"space-between"}},ge=O({__name:"zabbix-alert-list",props:{searchParam:{type:Object,default:()=>({})}},setup(F,{expose:v}){const{loading:y,setLoading:w}=I(!1),{pageSizeOptions:i,pagination:g}=ue(),r=u(g.current),d=u(g.pageSize),p=u(),o=u(),f=F,x=u({size:"mini",height:"auto",columnConfig:{resizable:!0},rowConfig:{keyField:"alertid",isHover:!0},showOverflow:"tooltip",columns:[{title:"\u4E3B\u673A",field:"hostName",width:200},{title:"\u4E8B\u4EF6",field:"eventName",minWidth:400},{title:"\u52A8\u4F5C",field:"actionName",width:120},{title:"\u63A5\u6536\u8005",field:"sendtoStr",width:180},{title:"\u6D88\u606F\u5185\u5BB9",field:"message",width:180},{title:"\u901A\u77E5\u72B6\u6001",field:"statusStr",width:180,slots:{default:"statusStr"}},{title:"\u7C7B\u578B",field:"mediaTypeNames",minWidth:160},{title:"\u65F6\u95F4",field:"clock",width:160,slots:{default:"clock"}},{title:"\u5E94\u7528",field:"appName",width:120}]});let m=[],_=[];const C=u(0),c=()=>{var t;const e=(r.value-1)*d.value,a=e+d.value;C.value=m.length,(t=p.value)==null||t.loadData(m.slice(e,a))},E=e=>{if(e){const a=e.trim().toLowerCase();m=_.filter(t=>{var k,b,L,S,T,l,R,A;return((k=t.subject)==null?void 0:k.toLowerCase().includes(a))||((b=t.hostName)==null?void 0:b.toLowerCase().includes(a))||((L=t.mediaTypeNames)==null?void 0:L.toLowerCase().includes(a))||((S=t.actionName)==null?void 0:S.toLowerCase().includes(a))||((T=t.message)==null?void 0:T.toLowerCase().includes(a))||((l=t.sendtoStr)==null?void 0:l.toLowerCase().includes(a))||((R=t.eventName)==null?void 0:R.toLowerCase().includes(a))||((A=t.statusStr)==null?void 0:A.toLowerCase().includes(a))}),c()}else m=M.cloneDeep(_),c()},j=async()=>{w(!0);try{m=(await re(f.searchParam)).data,_=M.cloneDeep(m),E(f.searchParam.keyword)}catch{}finally{w(!1)}};G(()=>f.searchParam.keyword,e=>{E(e)});const H=e=>{r.value=e,c()},K=e=>{r.value=1,d.value=e,c()},{loading:W,setLoading:V}=I(),q=async()=>{try{V(!0),de(await ce(f.searchParam))}catch(e){console.error(e)}finally{V(!1)}};return v({fetchData:j}),(e,a)=>{const t=J,k=Q,b=X,L=Z,S=$,T=U("vxe-grid");return D(),z(T,Y({ref_key:"xGrid",ref:p},x.value,{loading:h(y)}),{statusStr:s(({row:l})=>[l.status==="1"?(D(),z(t,{key:0,bordered:"",color:"green",style:{cursor:"pointer"}},{default:s(()=>[B(P(l.statusStr),1)]),_:2},1024)):(D(),z(k,{key:1,content:l.error},{default:s(()=>[n(t,{color:"red",bordered:""},{default:s(()=>[B(P(l.statusStr),1)]),_:2},1024)]),_:2},1032,["content"]))]),clock:s(({row:l})=>[B(P(h(le)(l.clock)),1)]),pager:s(()=>[N("div",fe,[n(b,{ref_key:"xPagination",ref:o,total:C.value,current:r.value,"page-size":d.value,"page-size-options":h(i),"show-total":"","show-jumper":"","show-page-size":"",onChange:H,onPageSizeChange:K},null,8,["total","current","page-size","page-size-options"]),N("div",null,[n(S,null,{default:s(()=>[n(L,{loading:h(W),onClick:a[0]||(a[0]=l=>q())},{default:s(()=>[B(" \u5BFC\u51FA ")]),_:1},8,["loading"])]),_:1})])])]),_:1},16,["loading"])}}}),_e={class:"page-container"},he={class:"page-panel"},ve={style:{height:"calc(100vh - 147px)"}},Ee=O({__name:"index",setup(F){const v=me(),y=u(),w=()=>{const p=Date.now(),o=60*60*24*1e3*7;return[p-o,p]},i=u({timeFrom:0,timeTill:0,keyword:"",eventId:v.query.eventId,appKey:v.query.appKey}),g=()=>{y.value.fetchData()},r=u(w()),d=()=>{if(r.value){const[p,o]=r.value;i.value.timeFrom=Math.floor(p/1e3),i.value.timeTill=Math.floor(o/1e3)}else i.value.timeFrom=void 0,i.value.timeTill=void 0;g()};return ee(()=>{d()}),(p,o)=>{const f=ae,x=oe,m=se,_=$,C=ne;return D(),te("div",_e,[N("div",he,[n(C,null,{default:s(()=>[n(x,{span:6},{default:s(()=>[n(f,{modelValue:i.value.keyword,"onUpdate:modelValue":o[0]||(o[0]=c=>i.value.keyword=c),modelModifiers:{trim:!0},placeholder:"\u5173\u952E\u5B57"},null,8,["modelValue"])]),_:1}),n(x,{span:18,style:{"text-align":"right"}},{default:s(()=>[n(_,{style:{"margin-bottom":"5px"}},{default:s(()=>[n(pe,{onClick:o[1]||(o[1]=c=>g())}),n(m,{modelValue:r.value,"onUpdate:modelValue":o[2]||(o[2]=c=>r.value=c),"show-time":"","value-format":"timestamp",style:{width:"400px"},"shortcuts-position":"left",shortcuts:h(ie),onOk:d,onChange:d},null,8,["modelValue","shortcuts"])]),_:1})]),_:1})]),_:1}),N("div",ve,[n(ge,{ref_key:"alertListRef",ref:y,"search-param":i.value,"config-key":"all"},null,8,["search-param"])])])])}}});export{Ee as default};
