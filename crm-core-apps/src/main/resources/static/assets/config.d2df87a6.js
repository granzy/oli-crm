import{l as c,a6 as X,a7 as _e,$ as ve,a8 as me,_ as Y,a9 as fe,a as Fe,c as be,aa as Be,ab as Ee}from"./index.e9d54774.js";/* empty css               *//* empty css              *//* empty css                *//* empty css               */import{d as z,f as p,c as Ce,o as Q,D as f,aH as x,aI as u,aS as a,E as w,aU as P,aV as V,aY as E,aW as K,H as g,u as I,bg as W,bq as ee,h as q,a$ as ye,aO as ge,bo as ue,cg as De,a_ as Ae,aP as ae,b0 as he,aN as j,bt as le,bp as te,bI as oe,bJ as se,bi as we,n as Oe,c3 as ke,c4 as Pe}from"./arco.a97fe066.js";import{a as Se}from"./host-group.ed397ed1.js";import{f as xe}from"./app-instance.ab836c4c.js";import{D as Ve}from"./vuedraggable.umd.d90dc502.js";import"./chart.a235fbdf.js";import"./vue.4eb70094.js";const ne=F=>(oe("data-v-3d208f50"),F=F(),se(),F),Ie=ne(()=>g("div",{class:"form-attr-group-name"},"\u5BF9\u8C61\u914D\u7F6E",-1)),$e={style:{width:"100%"}},Ne=ne(()=>g("div",{class:"form-attr-group-name"},"\u8D44\u4EA7\u5B57\u6BB5\u914D\u7F6E",-1)),Ue={style:{width:"100%"}},Ke=z({__name:"config-form",props:{config:{type:Object,required:!0,default:()=>({})}},emits:["refresh"],setup(F,{emit:_}){const v=F,i=p([]),r=p(v.config),b=p(),s=p({appKeys:[],groups:[],fields:[]}),D=p([{label:"\u7C7B\u578B[Type]",value:"type"},{label:"\u7C7B\u578B(\u5168\u7EC6\u8282)[Type (Full details)]",value:"type_full"},{label:"\u540D\u79F0[Name]",value:"name"},{label:"\u522B\u540D[Alias]",value:"alias"},{label:"\u64CD\u4F5C\u7CFB\u7EDF[OS]",value:"os"},{label:"\u64CD\u4F5C\u7CFB\u7EDF(\u6240\u6709\u7EC6\u8282)[OS (Full details)]",value:"os_full"},{label:"\u64CD\u4F5C\u7CFB\u7EDF( \u7B80\u77ED)[OS (Short)]",value:"os_short"},{label:"\u5E8F\u5217\u53F7A[Serial number A]",value:"serialno_a"},{label:"\u5E8F\u5217\u53F7B[Serial number B]",value:"serialno_b"},{label:"\u6807\u7B7E[Tag]",value:"tag"},{label:"\u8D44\u4EA7\u6807\u7B7E[Asset tag]",value:"asset_tag"},{label:"Mac \u5730\u5740 A[MAC address A]",value:"macaddress_a"},{label:"Mac \u5730\u5740 B[MAC address B]",value:"macaddress_b"},{label:"\u786C\u4EF6[Hardware]",value:"hardware"},{label:"\u786C\u4EF6(\u5168\u7EC6\u8282)[Hardware (Full details)]",value:"hardware_full"},{label:"\u8F6F\u4EF6[Software]",value:"software"},{label:"\u8F6F\u4EF6(\u5168\u7EC6\u8282)[Software (Full details)]",value:"software_full"},{label:"\u8F6F\u4EF6\u5E94\u7528\u7A0B\u5E8FA[Software application A]",value:"software_app_a"},{label:"\u8F6F\u4EF6\u5E94\u7528\u7A0B\u5E8FB[Software application B]",value:"software_app_b"},{label:"\u8F6F\u4EF6\u5E94\u7528\u7A0B\u5E8FC[Software application C]",value:"software_app_c"},{label:"\u8F6F\u4EF6\u5E94\u7528\u7A0B\u5E8FD[Software application D]",value:"software_app_d"},{label:"\u8F6F\u4EF6\u5E94\u7528\u7A0B\u5E8FE[Software application E]",value:"software_app_e"},{label:"\u8054\u7CFB[Contact]",value:"contact"},{label:"\u4F4D\u7F6E[Location]",value:"location"},{label:"\u4F4D\u7F6E\u7EAC\u5EA6[Location latitude]",value:"location_lat"},{label:"\u4F4D\u7F6E\u7ECF\u5EA6[Location longitude]",value:"location_lon"},{label:"\u5907\u6CE8[Notes]",value:"notes"},{label:"\u673A\u58F3[Chassis]",value:"chassis"},{label:"\u6A21\u578B[Model]",value:"model"},{label:"\u786C\u4EF6\u67B6\u6784[HW architecture]",value:"hw_arch"},{label:"\u63D0\u4F9B\u8005[Vendor]",value:"vendor"},{label:"\u5408\u540C\u53F7\u7801[Contract number]",value:"contract_number"},{label:"\u5B89\u88C5\u540D\u79F0[Installer name]",value:"installer_name"},{label:"\u90E8\u7F72\u72B6\u6001[Deployment status]",value:"deployment_status"},{label:"URL A[URL A]",value:"url_a"},{label:"URL B[URL B]",value:"url_b"},{label:"URL C[URL C]",value:"url_c"},{label:"\u4E3B\u673A\u7F51\u7EDC[Host networks]",value:"host_networks"},{label:"\u4E3B\u673A\u5B50\u7F51\u63A9\u7801[Host subnet mask]",value:"host_netmask"},{label:"\u4E3B\u673A\u8DEF\u7531[Host router]",value:"host_router"},{label:"\u5E26\u5916 IP \u5730\u5740[OOB IP address]",value:"oob_ip"},{label:"\u5E26\u5916\u5B50\u7F51\u63A9\u7801[OOB subnet mask]",value:"oob_netmask"},{label:"\u5E26\u5916\u8DEF\u7531\u5668[OOB router]",value:"oob_router"},{label:"\u786C\u4EF6\u8D2D\u4E70\u65E5\u671F[Date HW purchased]",value:"date_hw_purchase"},{label:"\u786C\u4EF6\u5B89\u88C5\u65E5\u671F[Date HW installed]",value:"date_hw_install"},{label:"\u786C\u4EF6\u7EF4\u4FEE\u8FC7\u671F\u65E5\u671F[Date HW maintenance expires]",value:"date_hw_expiry"},{label:"\u786C\u4EF6\u9000\u5F79\u65E5\u671F[Date HW decommissioned]",value:"date_hw_decomm"},{label:"\u573A\u6240\u5730\u5740A[Site address A]",value:"site_address_a"},{label:"\u573A\u6240\u5730\u5740B[Site address B]",value:"site_address_b"},{label:"\u573A\u6240\u5730\u5740C[Site address C]",value:"site_address_c"},{label:"\u573A\u6240\u57CE\u5E02[Site city]",value:"site_city"},{label:"\u573A\u6240\u5DDE/\u7701[Site state / province]",value:"site_state"},{label:"\u573A\u6240\u56FD\u5BB6[Site country]",value:"site_country"},{label:"\u5730\u5740\u90AE\u653F\u7F16\u7801[Site ZIP / postal]",value:"site_zip"},{label:"\u573A\u6240\u673A\u67DC\u4F4D\u7F6E[Site rack location]",value:"site_rack"},{label:"\u573A\u6240\u5907\u6CE8[Site notes]",value:"site_notes"},{label:"\u4E3B\u8981\u7684POC\u540D\u79F0[Primary POC name]",value:"poc_1_name"},{label:"\u4E3B\u8981\u7684POC email[Primary POC email]",value:"poc_1_email"},{label:"\u4E3B\u8981\u7684POC\u7535\u8BDDA[Primary POC phone A]",value:"poc_1_phone_a"},{label:"\u4E3B\u8981\u7684POC\u7535\u8BDDB[Primary POC phone B]",value:"poc_1_phone_b"},{label:"\u4E3B\u8981\u7684POC\u624B\u673A[Primary POC cell]",value:"poc_1_cell"},{label:"\u4E3B\u8981\u7684POC\u5C4F\u5E55\u540D\u79F0[Primary POC screen name]",value:"poc_1_screen"},{label:"\u4E3B\u8981\u7684POC\u6CE8\u8BB0[Primary POC notes]",value:"poc_1_notes"},{label:"\u7B2C\u4E8C\u4E2APOC\u540D\u79F0[Secondary POC name]",value:"poc_2_name"},{label:"\u7B2C\u4E8C\u4E2APOC email[Secondary POC email]",value:"poc_2_email"},{label:"\u7B2C\u4E8C\u4E2APOC\u7535\u8BDDA[Secondary POC phone A]",value:"poc_2_phone_a"},{label:"\u7B2C\u4E8C\u4E2APOC\u7535\u8BDDB[Secondary POC phone B]",value:"poc_2_phone_b"},{label:"\u7B2C\u4E8C\u4E2APOC\u624B\u673A\u53F7\u7801[Secondary POC cell]",value:"poc_2_cell"},{label:"\u7B2C\u4E8C\u4E2APOC\u805A\u5408\u56FE\u5F62\u540D\u79F0[Secondary POC screen name]",value:"poc_2_screen"},{label:"\u7B2C\u4E8C\u4E2APOC\u6CE8\u8BB0[Secondary POC notes",value:"poc_2_notes"}]),$=Ce(()=>{const l=c.cloneDeep(D.value);return c.filter(l,t=>c.find(s.value.fields,{inventoryField:t.value})).forEach(t=>{t.disabled=!0}),l}),m={appKeys:[{required:!0,message:"\u8BF7\u9009\u62E9Zabbix\u5E94\u7528",trigger:"change"}],groups:[{required:!0,message:"\u8BF7\u9009\u62E9Zabbix\u4E3B\u673A\u7EC4",trigger:"change"}],fields:[{validator:(l,e)=>{s.value.fields.forEach(t=>{t.inventoryField?t.fieldName?t.fieldGroup||e("\u8BF7\u9009\u62E9\u8D44\u4EA7\u5206\u7EC4"):e("\u8BF7\u9009\u62E9\u8D44\u4EA7\u5B57\u6BB5"):e("\u8BF7\u9009\u62E9Zabbix\u5B57\u6BB5")})},trigger:"blur"}]},O=p({}),y={get:()=>{const l={appKeys:[],groups:[],fields:[]};r.value.groups.forEach(e=>{l.appKeys.push(e.appKey),l.groups.push(`${e.appKey}/${e.groupId}`)}),l.appKeys=c.uniq(l.appKeys),l.fields=c.cloneDeep(r.value.fields),s.value=l},set:()=>{const l=c.filter(i.value,t=>s.value.appKeys.includes(t.id)).map(t=>t.name),e={id:v.config.id,appInstanceNames:l,name:v.config.name,groups:[],fields:[]};s.value.groups.forEach(t=>{const[d,h]=t.split("/"),S=c.find(O.value[d],{groupid:h});e.groups.push({appKey:d,groupId:h,groupName:S==null?void 0:S.name})}),s.value.fields.forEach(t=>{const d=c.find(D.value,{value:t.inventoryField});e.fields.push({inventoryField:t.inventoryField,fieldName:t.fieldName,fieldGroup:t.fieldGroup,inventoryFieldName:d==null?void 0:d.label})}),r.value=e}},C=async l=>{r.value=(await me(l)).data,y.get()},A=async()=>{i.value=c.filter((await xe("ZABBIX")).data,l=>l.datasourceId)},n=async()=>{O.value=(await Se(s.value.appKeys)).data,s.value.groups=c.filter(s.value.groups,l=>s.value.appKeys.includes(l.split("/")[0]))},N=async()=>{await C(v.config.name),await A(),await n()};Q(()=>{N()});const L=l=>{var t;const e=(t=c.find(D.value,{value:l}))==null?void 0:t.label;return e?e.split("[")[0]:""},R=()=>{s.value.fields.push({inventoryField:"",fieldName:"",fieldGroup:"\u57FA\u7840\u5B57\u6BB5"})},T=l=>{s.value.fields.splice(l,1)},H=async()=>{if(!await b.value.validate())try{y.set(),await X(r.value),W.success("\u4FDD\u5B58\u6210\u529F")}catch(e){console.error(e)}},Z=_,M=async()=>{try{ee.confirm({title:"\u63D0\u793A",simple:!1,draggable:!0,closable:!1,titleAlign:"start",content:()=>q("div",["\u6B64\u64CD\u4F5C\u5C06",q("span",{style:"color: rgb(var(--danger-6))"},"\u5220\u9664"),":",q("span",{style:"color: rgb(var(--danger-6))"},`${v.config.name}`),"\u5BF9\u8C61\u914D\u7F6E\uFF0C\u662F\u5426\u7EE7\u7EED\uFF1F"]),onOk:async()=>{try{await _e(v.config.id),Z("refresh"),W.success("\u5220\u9664\u6210\u529F")}catch(l){console.error(l)}}})}catch(l){console.error(l)}};return(l,e)=>{const t=ye,d=ge,h=ue,S=De,U=Ae,re=ae,ie=ve,J=he,G=j,de=le,ce=te;return f(),x(J,{gutter:[10,10],style:{height:"calc(100vh - 170px)","overflow-y":"auto"}},{default:u(()=>[a(U,{span:12},{default:u(()=>[a(ce,{ref_key:"formRef",ref:b,model:s.value,size:"medium",rules:m},{default:u(()=>[Ie,a(h,{label:"Zabbix\u5E94\u7528",field:"appKeys"},{default:u(()=>[a(d,{modelValue:s.value.appKeys,"onUpdate:modelValue":e[0]||(e[0]=o=>s.value.appKeys=o),"allow-clear":"",placeholder:"\u8BF7\u9009\u62E9Zabbix\u5E94\u7528",multiple:"","fallback-option":o=>({value:o,label:"\u5DF2\u5220\u9664"}),onChange:n},{default:u(()=>[(f(!0),w(P,null,V(i.value,(o,k)=>(f(),x(t,{key:k,value:o.id},{default:u(()=>[E(K(o.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue","fallback-option"])]),_:1}),a(h,{label:"Zabbix\u4E3B\u673A\u7EC4",field:"groups"},{default:u(()=>[g("div",$e,[g("div",null,[a(d,{modelValue:s.value.groups,"onUpdate:modelValue":e[1]||(e[1]=o=>s.value.groups=o),multiple:"","allow-clear":"",placeholder:"\u8BF7\u9009\u62E9Zabbix\u4E3B\u673A\u7EC4","fallback-option":o=>({value:o,label:"\u5DF2\u5220\u9664"})},{default:u(()=>[(f(!0),w(P,null,V(I(c).filter(i.value,o=>s.value.appKeys.indexOf(o.id)>-1),(o,k)=>(f(),x(S,{key:k,label:o.name},{default:u(()=>[(f(!0),w(P,null,V(O.value[o.id],(B,pe)=>(f(),x(t,{key:pe,value:`${o.id}/${B.groupid}`},{default:u(()=>[E(K(o.name)+"-"+K(B.name),1)]),_:2},1032,["value"]))),128))]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue","fallback-option"])])])]),_:1}),Ne,a(h,{class:"noAfter",field:"fields"},{default:u(()=>[g("div",Ue,[(f(!0),w(P,null,V(s.value.fields,(o,k)=>(f(),w("div",{key:k,style:{"margin-bottom":"5px"}},[a(J,{gutter:5,style:{width:"100%"}},{default:u(()=>[a(U,{span:12},{default:u(()=>[a(d,{modelValue:o.inventoryField,"onUpdate:modelValue":B=>o.inventoryField=B,"allow-search":"",placeholder:"Zabbix\u5B57\u6BB5",options:$.value,onChange:B=>o.fieldName=L(B)},null,8,["modelValue","onUpdate:modelValue","options","onChange"])]),_:2},1024),a(U,{span:6},{default:u(()=>[a(re,{modelValue:o.fieldName,"onUpdate:modelValue":B=>o.fieldName=B,placeholder:"\u5B57\u6BB5\u522B\u540D"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),a(U,{span:6},{default:u(()=>[a(d,{modelValue:o.fieldGroup,"onUpdate:modelValue":B=>o.fieldGroup=B,style:{width:"calc(100% - 30px)"}},{default:u(()=>[a(t,{value:"\u57FA\u7840\u5B57\u6BB5"},{default:u(()=>[E("\u57FA\u7840\u5B57\u6BB5")]),_:1}),a(t,{value:"\u6269\u5C55\u5B57\u6BB5"},{default:u(()=>[E("\u6269\u5C55\u5B57\u6BB5")]),_:1})]),_:2},1032,["modelValue","onUpdate:modelValue"]),a(ie,{style:{"margin-left":"5px",color:"var(--color-danger-light-4)",cursor:"pointer"},size:"20",onClick:B=>T(k)},null,8,["onClick"])]),_:2},1024)]),_:2},1024)]))),128)),g("div",null,[a(G,{style:{width:"100%"},type:"dashed",onClick:R},{default:u(()=>[E(" \u6DFB\u52A0 ")]),_:1})])])]),_:1}),a(h,{class:"noAfter"},{default:u(()=>[a(de,null,{default:u(()=>[a(G,{type:"primary",onClick:H},{default:u(()=>[E("\u4FDD\u5B58")]),_:1}),a(G,{status:"danger",onClick:M},{default:u(()=>[E("\u5220\u9664")]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})]),_:1})}}});const Le=Y(Ke,[["__scopeId","data-v-3d208f50"]]),Re=F=>(oe("data-v-0bc65800"),F=F(),se(),F),Te={class:"field-draggable"},He=Re(()=>g("span",null,"\u22EE\u22EE",-1)),Ze=z({__name:"order-config",props:{types:{type:Array,default:()=>[]}},emits:["change"],setup(F,{emit:_}){const v=F,i=p([]),r=p(!1),b=_,s=()=>{i.value=c.cloneDeep(v.types)},D=()=>{fe(i.value).then(()=>{b("change"),r.value=!1})};return($,m)=>{const O=j,y=we;return f(),w(P,null,[a(O,{onClick:m[0]||(m[0]=C=>r.value=!0)},{default:u(()=>[E("\u6392\u5E8F")]),_:1}),a(y,{visible:r.value,width:"30vw",title:"\u5BF9\u8C61\u5206\u7C7B\u987A\u5E8F","mask-closable":!1,"unmount-on-close":"",onOpen:s,onBeforeOpen:m[2]||(m[2]=C=>i.value=[]),onOk:D,onCancel:m[3]||(m[3]=C=>r.value=!1)},{default:u(()=>[a(I(Ve),{modelValue:i.value,"onUpdate:modelValue":m[1]||(m[1]=C=>i.value=C),"item-key":"name"},{item:u(({element:C})=>[g("div",Te,[He,E(" "+K(C.name),1)])]),_:1},8,["modelValue"])]),_:1},8,["visible"])],64)}}});const Me=Y(Ze,[["__scopeId","data-v-0bc65800"]]),Ge={class:"page-container"},qe={class:"page-panel"},tu=z({__name:"config",setup(F){const _=p([]),v=p(!1),i=p("\u521B\u5EFA\u7C7B\u578B"),r=p(0),b=p({name:""}),s=p(),D=(A="create")=>{A==="edit"?(i.value="\u7F16\u8F91\u7C7B\u578B",b.value.name=_.value[r.value].name||""):A==="create"&&(i.value="\u521B\u5EFA\u7C7B\u578B",b.value.name=""),v.value=!0},{loading:$,setLoading:m}=Fe(!1),O=be(),y=()=>{_.value=[],Oe(async()=>{_.value=(await Ee()).data,r.value=0,await O.fetchZabbixMonitorObjectTypeList()})},C=async()=>{const A={id:void 0,name:b.value.name,onlyUpdateName:!0,groups:[],fields:[]};if(i.value==="\u7F16\u8F91\u7C7B\u578B"){const n=_.value[r.value];A.id=n.id}try{m(!0),await s.value.validate()||(await X(A),await y(),v.value=!1,i.value==="\u521B\u5EFA\u7C7B\u578B"&&(r.value=_.value.length-1),W.success("\u4FDD\u5B58\u6210\u529F"))}catch(n){console.error(n)}finally{m(!1)}};return Q(()=>{y()}),(A,n)=>{const N=j,L=le,R=ke,T=Pe,H=ae,Z=ue,M=te,l=ee;return f(),w("div",Ge,[g("div",qe,[a(T,{"destroy-on-hide":"","lazy-load":"","active-key":r.value,onTabClick:n[3]||(n[3]=e=>r.value=e)},{extra:u(()=>[a(L,null,{default:u(()=>[a(N,{type:"primary",onClick:n[0]||(n[0]=e=>D())},{default:u(()=>[E("\u65B0\u589E")]),_:1}),a(N,{onClick:n[1]||(n[1]=e=>D("edit"))},{default:u(()=>[E("\u7F16\u8F91")]),_:1}),a(Me,{types:_.value,"onUpdate:types":n[2]||(n[2]=e=>_.value=e),onChange:y},null,8,["types"])]),_:1})]),default:u(()=>[(f(!0),w(P,null,V(_.value,(e,t)=>(f(),x(R,{key:t,title:e.name},{default:u(()=>[a(Le,{config:e,onRefresh:y},null,8,["config"])]),_:2},1032,["title"]))),128))]),_:1},8,["active-key"]),a(l,{"unmount-on-close":"",visible:v.value,top:"20vh","align-center":!1,width:"500","title-align":"start",title:i.value,"mask-closable":!1,draggable:"","ok-loading":I($),onOk:C,onCancel:n[5]||(n[5]=e=>v.value=!1)},{default:u(()=>[a(M,{ref_key:"formRef",ref:s,model:b.value},{default:u(()=>[a(Z,{field:"name",label:"\u7C7B\u578B\u540D\u79F0",rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u7C7B\u578B\u540D\u79F0"},{maxLength:20,message:"\u7C7B\u578B\u540D\u79F0\u4E0D\u80FD\u8D85\u8FC720\u4E2A\u5B57\u7B26"},{validator:async(e,t)=>{let d={name:""};i.value==="\u7F16\u8F91\u7C7B\u578B"&&(d=I(c).cloneDeep(_.value[r.value])),d.name=e,(await I(Be)(d)).data&&t("\u540D\u79F0\u5DF2\u7ECF\u5B58\u5728")}}]},{default:u(()=>[a(H,{modelValue:b.value.name,"onUpdate:modelValue":n[4]||(n[4]=e=>b.value.name=e)},null,8,["modelValue"])]),_:1},8,["rules"])]),_:1},8,["model"])]),_:1},8,["visible","title","ok-loading"])])])}}});export{tu as default};
