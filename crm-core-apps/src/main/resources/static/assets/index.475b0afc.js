import{l as ee,a as ae}from"./index.e9d54774.js";/* empty css                */import{d as X,f as d,c as j,w as pe,o as re,D as p,E as C,aS as o,aI as l,aH as k,aU as V,aV as Q,aY as v,u as y,H as G,aW as D,a$ as ce,aO as de,bo as me,cf as fe,aM as te,bE as ve,ca as be,aP as he,bZ as ye,aN as le,bt as oe,bp as _e,r as ge,aT as xe,aZ as ke,bz as Ce,bg as Ie,a_ as ue,b0 as se,bB as Ke,c3 as Ve,c4 as Fe}from"./arco.a97fe066.js";/* empty css              *//* empty css               *//* empty css               *//* empty css                *//* empty css                */import{c as Ee}from"./host-group.ed397ed1.js";import{q as Oe}from"./monitor-object.647fdfa2.js";import{_ as ze}from"./index.vue_vue_type_script_setup_true_lang.77100c06.js";import{_ as Ae}from"./index.vue_vue_type_script_setup_true_lang.d3e8b168.js";/* empty css                */import{p as Be}from"./pagination.72a5f225.js";import{_ as Se}from"./index.vue_vue_type_script_setup_true_lang.8d2e7b7f.js";import{c as We,Z as f,a as Ge}from"./item-instance.4f13cfef.js";import{u as He}from"./unit-util.2cbd6bbc.js";import"./chart.a235fbdf.js";import"./vue.4eb70094.js";import"./config-backup-device.df1a641e.js";import"./color.562bf6e9.js";import"./monitor-object-table.vue_vue_type_script_setup_true_lang.322c60e6.js";import"./index.127a6572.js";import"./category.8586a983.js";import"./performance-data.vue_vue_type_script_setup_true_lang.419c45ec.js";/* empty css                *//* empty css               *//* empty css                */import"./text-data-table.vue_vue_type_script_setup_true_lang.2f77f7d2.js";import"./chart-option.8bf8c179.js";import"./date-time.3a778351.js";import"./moment.a1678c09.js";import"./global.90f51a62.js";const we=X({__name:"search-form",emits:["search","reset"],setup(R,{emit:F}){const I=d(),t=d({appKey:"",appKeys:[],zabbixHostGroupIds:[],zabbixHostGroupIdsWithAppKey:[],application:"",ip:"",name:"",accurateIp:!0,monitorObjectIdsWithAppKey:[],subtype:""}),r=j(()=>({filterSubtypeBlack:!1,appKey:t.value.appKey,appKeys:t.value.appKeys,zabbixHostGroupIds:t.value.zabbixHostGroupIds,zabbixHostGroupIdsWithAppKey:t.value.zabbixHostGroupIdsWithAppKey})),H=F,b=()=>{H("search",t.value)},x=d([]),h=d([]),_=d(!1),P=()=>{Ee().then(a=>{x.value=a.data,a.data.forEach(e=>{h.value.push(e)}),a.data.length===1&&(_.value=!0,t.value.appKey=a.data[0].value),b()})},T=j(()=>{const a=[];let e;return t.value.appKey?e=x.value.filter(s=>s.value===t.value.appKey):e=x.value,e.length>0&&e.forEach(s=>{var c;const i=(c=s.children)==null?void 0:c.map(g=>{const W=g.value;return{label:g.label,value:W.split("/")[1]}});a.push(...i)}),a}),O=j(()=>t.value.appKeys&&t.value.appKeys.length>0?x.value.filter(a=>ee.includes(t.value.appKeys,a.value)):x.value),z=a=>{var e;t.value.zabbixHostGroupIdsWithAppKey&&t.value.zabbixHostGroupIdsWithAppKey.length>0&&a.length>0&&(t.value.zabbixHostGroupIdsWithAppKey=(e=t.value.zabbixHostGroupIdsWithAppKey)==null?void 0:e.filter(s=>{const[i]=s.split("/");return ee.includes(a,i)}))},M=()=>{I.value.resetFields(),t.value.zabbixHostGroupIds=[],t.value.subtype="",b()},{loading:N,setLoading:A}=ae(!1),m=d([]),B=d([]),w=d(""),K=async a=>{A(!0),w.value=a;const{data:e}=await Oe({displayNameForDropSelect:a,appKey:t.value.appKey,appKeys:t.value.appKeys,zabbixHostGroupIds:t.value.zabbixHostGroupIds,zabbixHostGroupIdsWithAppKey:t.value.zabbixHostGroupIdsWithAppKey,filterSubtypeBlack:!1,page:{current:1,pageSize:20,total:0}});m.value=[],e.content.length>0&&e.content.forEach(i=>{m.value.some(g=>g.value===`${i.checkId}`)||m.value.push({label:i.displayName,value:`${i.checkId}`})});const s=B.value.filter(i=>!m.value.some(g=>g.value===i.value));m.value.push(...s),A(!1)},S=a=>{B.value=m.value.filter(e=>a.indexOf(e.value)!==-1)},E=d(!1),U=()=>{E.value=!0},L=a=>{B.value=a.map(e=>({label:e.displayName,value:`${e.checkId}`})),a.forEach(e=>{m.value.some(i=>i.value===`${e.checkId}`)||m.value.push({label:e.displayName,value:`${e.checkId}`})})},q=a=>{m.value=m.value.filter(e=>e.value!==a)};return pe(()=>t.value.monitorObjectIdsWithAppKey,a=>{a&&a.length===0&&(m.value=[])}),re(()=>{P()}),(a,e)=>{const s=ce,i=de,c=me,g=fe,W=te,Z=ve,$=be,n=he,J=ye,Y=le,ne=oe,ie=_e;return p(),C(V,null,[o(ie,{ref_key:"formRef",ref:I,class:"page-panel",model:t.value,size:"medium",layout:"vertical","label-col-props":{span:7,offset:0},"wrapper-col-props":{span:17,offset:0}},{default:l(()=>[_.value?(p(),k(c,{key:0,field:"appKey",label:"\u5E94\u7528"},{default:l(()=>[o(i,{modelValue:t.value.appKey,"onUpdate:modelValue":e[0]||(e[0]=u=>t.value.appKey=u),disabled:""},{default:l(()=>[(p(!0),C(V,null,Q(h.value,u=>(p(),k(s,{key:u.value,value:u.value,label:u.label},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1})):(p(),k(c,{key:1,field:"appKeys",label:"\u5E94\u7528"},{default:l(()=>[o(i,{modelValue:t.value.appKeys,"onUpdate:modelValue":e[1]||(e[1]=u=>t.value.appKeys=u),placeholder:"\u8BF7\u9009\u62E9","allow-clear":"",multiple:"",onChange:z},{default:l(()=>[(p(!0),C(V,null,Q(h.value,u=>(p(),k(s,{key:u.value,value:u.value,label:u.label},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1})),_.value?(p(),k(c,{key:2,field:"zabbixHostGroupIds",label:"\u5206\u7EC4"},{default:l(()=>[o(i,{modelValue:t.value.zabbixHostGroupIds,"onUpdate:modelValue":e[2]||(e[2]=u=>t.value.zabbixHostGroupIds=u),"virtual-list-props":{height:200},options:T.value,"allow-search":"","max-tag-count":5,"allow-clear":"",multiple:"",placeholder:"\u8BF7\u9009\u62E9"},null,8,["modelValue","options"])]),_:1})):(p(),k(c,{key:3,field:"zabbixHostGroupIdsWithAppKey",label:"\u5206\u7EC4"},{default:l(()=>[o(g,{modelValue:t.value.zabbixHostGroupIdsWithAppKey,"onUpdate:modelValue":e[3]||(e[3]=u=>t.value.zabbixHostGroupIdsWithAppKey=u),options:O.value,placeholder:"\u8BF7\u9009\u62E9","allow-search":"","max-tag-count":5,"allow-clear":"",multiple:"","virtual-list-props":{height:200}},null,8,["modelValue","options"])]),_:1})),o(c,{field:"category",label:"\u5BF9\u8C61\u7C7B\u578B"},{default:l(()=>[o(Ae,{modelValue:t.value.subtype,"onUpdate:modelValue":e[4]||(e[4]=u=>t.value.subtype=u),placeholder:"\u8BF7\u9009\u62E9"},null,8,["modelValue"])]),_:1}),o(c,{field:"monitorObjectIdsWithAppKey",label:"\u5BF9\u8C61",style:{position:"relative"}},{default:l(()=>[o(W,{style:{position:"absolute",top:"0",right:"0"},onClick:U},{default:l(()=>[v(" \u9009\u62E9 ")]),_:1}),o(i,{modelValue:t.value.monitorObjectIdsWithAppKey,"onUpdate:modelValue":e[5]||(e[5]=u=>t.value.monitorObjectIdsWithAppKey=u),loading:y(N),placeholder:"\u8BF7\u8F93\u5165\u5173\u952E\u5B57\u6216\u9009\u62E9",multiple:"","filter-option":!1,"show-extra-options":!1,"allow-clear":"","max-tag-count":5,onSearch:K,onChange:S,onRemove:q},{empty:l(()=>[w.value?(p(),k($,{key:0})):(p(),k($,{key:1},{default:l(()=>[v("\u8BF7\u8F93\u5165\u5173\u952E\u5B57\u8FDB\u884C\u641C\u7D22")]),_:1}))]),default:l(()=>[(p(!0),C(V,null,Q(m.value,u=>(p(),k(s,{key:u.value,value:u.value},{default:l(()=>[o(Z,{content:u.label},{default:l(()=>[G("span",null,D(u.label),1)]),_:2},1032,["content"])]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue","loading"])]),_:1}),o(c,{field:"application",label:"\u5E94\u7528\u96C6"},{default:l(()=>[o(n,{modelValue:t.value.application,"onUpdate:modelValue":e[6]||(e[6]=u=>t.value.application=u),placeholder:"\u8BF7\u8F93\u5165","allow-clear":""},null,8,["modelValue"])]),_:1}),o(c,{field:"ip",label:"IP"},{default:l(()=>[o(n,{modelValue:t.value.ip,"onUpdate:modelValue":e[8]||(e[8]=u=>t.value.ip=u),placeholder:"\u8BF7\u8F93\u5165","allow-clear":""},{suffix:l(()=>[o(J,{modelValue:t.value.accurateIp,"onUpdate:modelValue":e[7]||(e[7]=u=>t.value.accurateIp=u)},{default:l(()=>[v("\u7CBE\u786E")]),_:1},8,["modelValue"])]),_:1},8,["modelValue"])]),_:1}),o(c,{field:"name",label:"\u76D1\u63A7\u9879"},{default:l(()=>[o(n,{modelValue:t.value.name,"onUpdate:modelValue":e[9]||(e[9]=u=>t.value.name=u),placeholder:"\u8BF7\u8F93\u5165","allow-clear":""},null,8,["modelValue"])]),_:1}),o(ne,null,{default:l(()=>[o(Y,{type:"primary",onClick:b},{default:l(()=>[v("\u67E5\u8BE2")]),_:1}),o(Y,{onClick:M},{default:l(()=>[v("\u91CD\u7F6E")]),_:1})]),_:1})]),_:1},8,["model"]),o(ze,{modelValue:t.value.monitorObjectIdsWithAppKey,"onUpdate:modelValue":e[10]||(e[10]=u=>t.value.monitorObjectIdsWithAppKey=u),visible:E.value,"monitor-object-query-params":r.value,onGetCurrentSelectRow:L,onOk:e[11]||(e[11]=u=>E.value=!1),onCancel:e[12]||(e[12]=u=>E.value=!1)},null,8,["modelValue","visible","monitor-object-query-params"])],64)}}}),$e={key:0},je={class:"selected-count"},De={style:{height:"calc(100vh - 146px)"}},Re=X({__name:"item-instance-table",props:{searchForm:{}},setup(R,{expose:F}){const{loading:I,setLoading:t}=ae(!1),{pagination:r,pageSizeOptions:H}=Be(),b=d(),x=d(),h=R,_=j(()=>{const a=b.value,e=[];return a&&(e.push(...a.getCheckboxRecords()),e.push(...a.getCheckboxReserveRecords())),e}),P=d({size:"mini",height:"auto",columnConfig:{resizable:!0},rowConfig:{keyField:"checkId",isHover:!0},checkboxConfig:{reserve:!0,checkMethod:({row:a})=>a.lastClock!=="0"},showOverflow:"tooltip",columns:[{type:"checkbox",width:40},{title:"\u76D1\u63A7\u5BF9\u8C61",field:"displayName",minWidth:120},{title:"IP",field:"ip",minWidth:120},{title:"\u76D1\u63A7\u9879",field:"name",minWidth:120},{title:"\u5E94\u7528",field:"appName",minWidth:120},{title:"\u6700\u65B0\u503C",field:"lastValue",minWidth:80,slots:{default:"lastValue"}},{title:"\u6700\u65B0\u65F6\u95F4",field:"lastClockStr",minWidth:140},{title:"\u5E94\u7528\u96C6",field:"applications",minWidth:80},{title:"\u5355\u4F4D",field:"units",minWidth:60},{title:"\u95F4\u9694",field:"delay",minWidth:60},{title:"\u952E\u503C",field:"key_",minWidth:100},{title:"\u64CD\u4F5C",width:120,fixed:"right",slots:{default:"action"}}]}),T=ge({}),O=async(a={...T,page:r})=>{t(!0);const e=b.value;try{const{data:s}=await Ge(a);r.total=s.totalElements,e&&await e.loadData(s.content)}catch(s){console.error(s)}finally{t(!1)}},z=(a,e)=>{e&&(r.current=e);const s={...a,page:r};O(s)},M=a=>{r.current=a,h.searchForm?z(h.searchForm):O()},N=a=>{r.pageSize=a,h.searchForm?z(h.searchForm):O()},A=()=>{const a=b.value;a&&a.getCheckboxRecords().push(...a.getCheckboxReserveRecords())},m=A,B=A,w=()=>{const a=b.value;a&&(a.clearCheckboxReserve(),a.clearCheckboxRow())},K=d(!1),S=d([]),E=a=>{S.value=[{appKey:a.appKey,itemId:a.itemid}],K.value=!0},U=()=>{S.value=_.value.map(a=>({appKey:a.appKey,itemId:a.itemid})),K.value=!0},L=async(a,e)=>{await We(a,e),Ie.success("\u8BF7\u6C42\u6210\u529F!")},q=a=>[f.ZabbixAgent,f.SimpleCheck,f.ZabbixInternal,f.ExternalCheck,f.DatabaseMonitor,f.IPMIAgent,f.SSHAgent,f.TelnetAgent,f.Calculated,f.JMXAgent,f.HTTPAgent,f.SNMPAgent].includes(a);return F({searchDataByParam:z}),(a,e)=>{const s=te,i=le,c=oe,g=ue,W=se,Z=Ke,$=xe("vxe-grid");return p(),C(V,null,[o(W,null,{default:l(()=>[o(g,{span:24,style:{"text-align":"right"}},{default:l(()=>[o(c,{style:{"margin-bottom":"5px"}},{default:l(()=>[_.value.length>0?(p(),C("span",$e,[G("span",je," \u5DF2\u9009\u62E9\u4E86"+D(_.value.length)+"\u6761 ",1),o(s,{onClick:w},{default:l(()=>[v("\u6E05\u7A7A")]),_:1})])):ke("",!0),o(i,{type:"primary",size:"medium",disabled:_.value.length===0,onClick:U},{default:l(()=>[v(" \u6298\u7EBF\u56FE ")]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1}),G("div",De,[o($,Ce({ref_key:"xGrid",ref:b,loading:y(I)},P.value,{onCheckboxChange:y(m),onCheckboxAll:y(B)}),{index:l(({rowIndex:n})=>[v(D(n+1+(y(r).current-1)*y(r).pageSize),1)]),lastValue:l(({row:n})=>[n.lastValue&&n.lastClock!=="0"?(p(),C(V,{key:0},[v(D(n.units?y(He)(n.units,Number(n.lastValue)):n.valueType==="0"||n.valueType==="3"?Math.round(Number(n.lastValue)*1e3)/1e3:n.lastValue),1)],64)):(p(),C(V,{key:1},[v("-")],64))]),action:l(({row:n})=>[o(c,null,{default:l(()=>[o(s,{disabled:n.lastClock==="0",style:{"font-size":"12px"},hoverable:!1,onClick:J=>E(n)},{default:l(()=>[v(" \u6027\u80FD\u6570\u636E ")]),_:2},1032,["disabled","onClick"]),o(s,{disabled:!q(n.type),hoverable:!1,style:{"font-size":"12px"},onClick:J=>L(n.appKey,n.itemid)},{default:l(()=>[v(" \u8BF7\u6C42 ")]),_:2},1032,["disabled","onClick"])]),_:2},1024)]),pager:l(()=>[o(Z,{ref_key:"xPagination",ref:x,current:y(r).current,"page-size":y(r).pageSize,total:y(r).total,"page-size-options":y(H),style:{"padding-top":"10px"},"show-total":"","show-jumper":"","show-page-size":"",onChange:M,onPageSizeChange:N},null,8,["current","page-size","total","page-size-options"])]),_:1},16,["loading","onCheckboxChange","onCheckboxAll"])]),o(Se,{visible:K.value,"app-key-item-ids":S.value,onOk:e[0]||(e[0]=n=>K.value=!1),onCancel:e[1]||(e[1]=n=>K.value=!1)},null,8,["visible","app-key-item-ids"])],64)}}}),Pe={class:"page-container"},Te={class:"page-panel-no-padding",style:{height:"calc(100vh - 84px)","overflow-y":"auto"}},Me={class:"page-panel",style:{height:"calc(100vh - 84px)"}},Ia=X({__name:"index",setup(R){const F=d(),I=d(),t=r=>{I.value=r,F.value.searchDataByParam(r,1)};return(r,H)=>{const b=Ve,x=Fe,h=ue,_=se;return p(),C("div",Pe,[o(_,{gutter:5},{default:l(()=>[o(h,{xxl:4,xl:4,lg:6,md:6,sm:6,xs:6},{default:l(()=>[G("div",Te,[o(x,{"default-active-key":"search-pane"},{default:l(()=>[o(b,{key:"search-pane",title:"\u67E5\u8BE2\u6761\u4EF6"},{default:l(()=>[o(we,{onSearch:t})]),_:1})]),_:1})])]),_:1}),o(h,{xxl:20,xl:20,lg:18,md:18,sm:18,xs:18},{default:l(()=>[G("div",Me,[o(Re,{ref_key:"itemInstanceTableRef",ref:F,"search-form":I.value},null,8,["search-form"])])]),_:1})]),_:1})])}}});export{Ia as default};
